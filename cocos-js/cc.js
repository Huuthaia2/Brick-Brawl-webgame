System.register(["./instantiated-0ee83a0e.js"],(function(t){"use strict";var e,i,r,n,o,s,a,l,h,u,c,d,p,f,_,g,m,y,v,b,S,T,E,A,C,w,x,R,M,O,P,D,I,B,L,F,k,N,z,U,V,H,G,W,X,Y,j,q,K,Z,J,Q,$,tt,et,it,rt,nt,ot,st,at,lt,ht,ut,ct,dt,pt,ft,_t,gt,mt,yt,vt,bt,St,Tt,Et,At,Ct,wt,xt,Rt,Mt,Ot,Pt,Dt,It,Bt,Lt,Ft,kt,Nt,zt,Ut,Vt,Ht,Gt,Wt,Xt,Yt,jt,qt,Kt,Zt,Jt,Qt,$t,te,ee,ie,re,ne,oe,se,ae,le,he,ue,ce,de,pe,fe,_e,ge,me,ye,ve,be,Se,Te,Ee,Ae,Ce,we,xe,Re,Me,Oe,Pe,De,Ie,Be,Le,Fe,ke,Ne,ze,Ue,Ve,He,Ge,We,Xe,Ye,je,qe,Ke,Ze,Je,Qe,$e,ti,ei,ii,ri,ni,oi,si,ai,li,hi,ui,ci,di,pi,fi,_i,gi,mi,yi,vi,bi,Si,Ti,Ei,Ai,Ci,wi,xi,Ri,Mi,Oi,Pi,Di,Ii,Bi,Li,Fi,ki,Ni,zi,Ui,Vi,Hi,Gi,Wi,Xi,Yi,ji,qi,Ki,Zi,Ji,Qi,$i,tr,er,ir,rr,nr,or,sr,ar,lr,hr,ur,cr,dr,pr,fr,_r,gr,mr,yr,vr,br,Sr,Tr,Er,Ar,Cr,wr,xr,Rr,Mr,Or,Pr,Dr,Ir,Br,Lr,Fr,kr,Nr,zr,Ur,Vr,Hr,Gr,Wr,Xr,Yr,jr,qr,Kr,Zr,Jr,Qr,$r,tn,en,rn,nn,on,sn,an,ln,hn,un,cn,dn,pn,fn,_n,gn,mn,yn,vn,bn,Sn,Tn,En,An,Cn,wn,xn,Rn,Mn,On,Pn,Dn,In,Bn,Ln,Fn,kn,Nn,zn,Un,Vn,Hn,Gn,Wn,Xn,Yn,jn,qn,Kn,Zn,Jn,Qn,$n,to,eo,io,ro,no,oo,so,ao,lo,ho,uo,co,po,fo,_o;return{setters:[function(go){e=go.P,i=go.R,r=go.C,n=go.D,o=go.B,s=go.a,a=go.O,l=go.S,h=go.A,u=go.b,c=go.F,d=go.c,p=go.d,f=go.T,_=go.e,g=go.f,m=go.M,y=go.g,v=go.h,b=go.i,S=go.j,T=go.k,E=go.l,A=go.m,C=go.n,w=go.o,x=go.p,R=go.q,M=go.r,O=go.s,P=go.L,D=go.t,I=go.u,B=go.v,L=go.w,F=go.x,k=go.y,N=go.z,z=go.E,U=go.G,V=go.H,H=go.I,G=go.Q,W=go.J,X=go.K,Y=go.N,j=go.U,q=go.V,K=go.W,Z=go.X,J=go.Y,Q=go.Z,$=go._,tt=go.$,et=go.a0,it=go.a1,rt=go.a2,nt=go.a3,ot=go.a4,st=go.a5,at=go.a6,lt=go.a7,ht=go.a8,ut=go.a9,ct=go.aa,dt=go.ab,pt=go.ac,ft=go.ad,_t=go.ae,gt=go.af,mt=go.ag,yt=go.ah,vt=go.ai,bt=go.aj,St=go.ak,Tt=go.al,Et=go.am,At=go.an,Ct=go.ao,wt=go.ap,xt=go.aq,Rt=go.ar,Mt=go.as,Ot=go.at,Pt=go.au,Dt=go.av,It=go.aw,Bt=go.ax,Lt=go.ay,Ft=go.az,kt=go.aA,Nt=go.aB,zt=go.aC,Ut=go.aD,Vt=go.aE,Ht=go.aF,Gt=go.aG,Wt=go.aH,Xt=go.aI,Yt=go.aJ,jt=go.aK,qt=go.aL,Kt=go.aM,Zt=go.aN,Jt=go.aO,Qt=go.aP,$t=go.aQ,te=go.aR,ee=go.aS,ie=go.aT,re=go.aU,ne=go.aV,oe=go.aW,se=go.aX,ae=go.aY,le=go.aZ,he=go.a_,ue=go.a$,ce=go.b0,de=go.b1,pe=go.b2,fe=go.b3,_e=go.b4,ge=go.b5,me=go.b6,ye=go.b7,ve=go.b8,be=go.b9,Se=go.ba,Te=go.bb,Ee=go.bc,Ae=go.bd,Ce=go.be,we=go.bf,xe=go.bg,Re=go.bh,Me=go.bi,Oe=go.bj,Pe=go.bk,De=go.bl,Ie=go.bm,Be=go.bn,Le=go.bo,Fe=go.bp,ke=go.bq,Ne=go.br,ze=go.bs,Ue=go.bt,Ve=go.bu,He=go.bv,Ge=go.bw,We=go.bx,Xe=go.by,Ye=go.bz,je=go.bA,qe=go.bB,Ke=go.bC,Ze=go.bD,Je=go.bE,Qe=go.bF,$e=go.bG,ti=go.bH,ei=go.bI,ii=go.bJ,ri=go.bK,ni=go.bL,oi=go.bM,si=go.bN,ai=go.bO,li=go.bP,hi=go.bQ,ui=go.bR,ci=go.bS,di=go.bT,pi=go.bU,fi=go.bV,_i=go.bW,gi=go.bX,mi=go.bY,yi=go.bZ,vi=go.b_,bi=go.b$,Si=go.c0,Ti=go.c1,Ei=go.c2,Ai=go.c3,Ci=go.c4,wi=go.c5,xi=go.c6,Ri=go.c7,Mi=go.c8,Oi=go.c9,Pi=go.ca,Di=go.cb,Ii=go.cc,Bi=go.cd,Li=go.ce,Fi=go.cf,ki=go.cg,Ni=go.ch,zi=go.ci,Ui=go.cj,Vi=go.ck,Hi=go.cl,Gi=go.cm,Wi=go.cn,Xi=go.co,Yi=go.cp,ji=go.cq,qi=go.cr,Ki=go.cs,Zi=go.ct,Ji=go.cu,Qi=go.cv,$i=go.cw,tr=go.cx,er=go.cy,ir=go.cz,rr=go.cA,nr=go.cB,or=go.cC,sr=go.cD,ar=go.cE,lr=go.cF,hr=go.cG,ur=go.cH,cr=go.cI,dr=go.cJ,pr=go.cK,fr=go.cL,_r=go.cM,gr=go.cN,mr=go.cO,yr=go.cP,vr=go.cQ,br=go.cR,Sr=go.cS,Tr=go.cT,Er=go.cU,Ar=go.cV,Cr=go.cW,wr=go.cX,xr=go.cY,Rr=go.cZ,Mr=go.c_,Or=go.c$,Pr=go.d0,Dr=go.d1,Ir=go.d2,Br=go.d3,Lr=go.d4,Fr=go.d5,kr=go.d6,Nr=go.d7,zr=go.d8,Ur=go.d9,Vr=go.da,Hr=go.db,Gr=go.dc,Wr=go.dd,Xr=go.de,Yr=go.df,jr=go.dg,qr=go.dh,Kr=go.di,Zr=go.dj,Jr=go.dk,Qr=go.dl,$r=go.dm,tn=go.dn,en=go.dp,rn=go.dq,nn=go.dr,on=go.ds,sn=go.dt,an=go.du,ln=go.dv,hn=go.dw,un=go.dx,cn=go.dy,dn=go.dz,pn=go.dA,fn=go.dB,_n=go.dC,gn=go.dD,mn=go.dE,yn=go.dF,vn=go.dG,bn=go.dH,Sn=go.dI,Tn=go.dJ,En=go.dK,An=go.dL,Cn=go.dM,wn=go.dN,xn=go.dO,Rn=go.dP,Mn=go.dQ,On=go.dR,Pn=go.dS,Dn=go.dT,In=go.dU,Bn=go.dV,Ln=go.dW,Fn=go.dX,kn=go.dY,Nn=go.dZ,zn=go.d_,Un=go.d$,Vn=go.e0,Hn=go.e1,Gn=go.e2,Wn=go.e3,Xn=go.e4,Yn=go.e5,jn=go.e6,qn=go.e7,Kn=go.e8,Zn=go.e9,Jn=go.ea,Qn=go.eb,$n=go.ec,to=go.ed,eo=go.ee,io=go.ef,ro=go.eg,no=go.eh,oo=go.ei,so=go.ej,ao=go.ek,lo=go.el,ho=go.em,uo=go.en,co=go.eo,po=go.ep,fo=go.eq,_o=go.er;var mo={};mo.AffineTransform=go.eC,mo.AnimCurve=go.gc,mo.Animation=go.cY,mo.AnimationClip=go.g8,mo.AnimationComponent=go.cY,mo.AnimationManager=go.gg,mo.AnimationState=go.cX,mo.Asset=go.b_,mo.AssetLibrary=go.fW,mo.AssetManager=go.fS,mo.BaseNode=go.fY,mo.BitMask=go.eP,mo.BufferAsset=go.f9,mo.CCBoolean=go.f4,mo.CCClass=go.er,mo.CCFloat=go.f3,mo.CCInteger=go.f2,mo.CCLoader=go.fU,mo.CCObject=go.dg,mo.CCString=go.cq,mo.CachedArray=go.C,mo.Camera=go.dm,mo.CameraComponent=go.dm,mo.Color=go.cx,mo.CompactValueTypeArray=go.f5,mo.Component=go.cw,mo.ComponentModifier=go.g2,mo.CubicSplineNumberValue=go.bu,mo.CubicSplineQuatValue=go.bt,mo.CubicSplineVec2Value=go.bq,mo.CubicSplineVec3Value=go.br,mo.CubicSplineVec4Value=go.bs,mo.CurveValueAdapter=go.g3,mo.DebugMode=go.fo,mo.DeferredPipeline=go.fH,mo.Details=go.f0,mo.Director=go.d6,mo.EPSILON=go.eG,mo.EffectAsset=go.ff,mo.Enum=go.c8,mo.Event=go.dN,mo.EventAcceleration=go.fu,mo.EventHandler=go.dB,mo.EventInfo=go.gd,mo.EventKeyboard=go.fv,mo.EventMouse=go.ft,mo.EventTarget=go.eo,mo.EventTouch=go.dL,mo.Eventify=go.ea,mo.ExtrapolationMode=go.gj,mo.ForwardFlow=go.fF,mo.ForwardPipeline=go.fE,mo.ForwardStage=go.fG,mo.Game=go.fx,mo.GbufferFlow=go.fI,mo.GbufferStage=go.fJ,mo.HierachyModifier=go.g1,mo.ImageAsset=go.bM,mo.InstancedBuffer=go.fP,mo.JavaScript=go.fh,mo.JsonAsset=go.fd,mo.KeyCode=go.dG,mo.Layers=go.ds,mo.LightingFlow=go.fK,mo.LightingStage=go.fL,mo.MATH_FLOAT_ARRAY=go.eN,mo.Mat3=go.eA,mo.Mat4=go.cn,mo.Material=go.cS,mo.MathBase=go.eO,mo.MissingScript=go.f$,mo.Node=go.cR,mo.NodeActivator=go.fZ,mo.NodePool=go.go,mo.ObjectCurve=go.gn,mo.PipelineStateManager=go.fQ,mo.Pool=go.P,mo.PostprocessStage=go.fM,mo.Prefab=go.fa,mo.PrefabLink=go.eU,mo.PrivateNode=go.f_,mo.Quat=go.bZ,mo.QuatCurve=go.gl,mo.QuatInterpolationMode=go.gm,mo.RatioSampler=go.gb,mo.RealCurve=go.dV,mo.RealInterpolationMode=go.gi,mo.Rect=go.cZ,mo.RecyclePool=go.R,mo.RenderFlow=go.fC,mo.RenderPipeline=go.fB,mo.RenderStage=go.fD,mo.RenderTexture=go.dk,mo.RenderableComponent=go.cm,mo.RenderingSubMesh=go.bX,mo.ResolutionPolicy=go.fq,mo.Scene=go.dP,mo.SceneAsset=go.fb,mo.Scheduler=go.fy,mo.Script=go.fg,mo.ShadowFlow=go.fN,mo.ShadowStage=go.fO,mo.Size=go.c_,mo.SkelAnimDataHub=go.cG,mo.System=go.e9,mo.SystemEvent=go.fr,mo.SystemEventType=go.dM,mo.TangentWeightMode=go.gk,mo.TextAsset=go.fc,mo.Texture2D=go.bN,mo.TextureCube=go.fe,mo.Touch=go.fw,mo.TypeScript=go.fi,mo.UniformCurveValueAdapter=go.g4,mo.VERSION=go.eq,mo.ValueType=go.eQ,mo.Vec2=go.cW,mo.Vec3=go.bV,mo.Vec4=go.cg,mo.View=go.dS,mo.WorldNode3DToLocalNodeUI=go.eW,mo.WorldNode3DToWorldNodeUI=go.eX,mo._decorator=go.eZ,mo.absMax=go.ed,mo.absMaxComponent=go.ef,mo.approx=go.eH,mo.assert=go.fk,mo.assertID=go.fl,mo.assetManager=go.el,mo.bezier=go.g9,mo.bezierByTime=go.ga,mo.bits=go.ev,mo.builtinResMgr=go.ce,mo.ccenum=go.db,mo.cclegacy=go.bI,mo.clamp=go.dj,mo.clamp01=go.dK,mo.color=go.eF,mo.computeRatioByType=go.gf,mo.convertUtils=go.eY,mo.createDefaultPipeline=go.fA,mo.debug=go.by,mo.deserialize=go.e$,mo.deserializeTag=go.f7,mo.director=go.d5,mo.easing=go.ep,mo.editorExtrasTag=go.f6,mo.effects=go.g0,mo.enumerableProps=go.eM,mo.equals=go.e8,mo.error=go.bz,mo.errorID=go.bx,mo.find=go.c5,mo.game=go.dn,mo.geometry=go.eu,mo.getError=go.ej,mo.getPathFromRoot=go.gh,mo.getPhaseID=go.fR,mo.getSerializationMetadata=go.f1,mo.getWorldTransformUntilRoot=go.cF,mo.instantiate=go.e6,mo.inverseLerp=go.eL,mo.isCustomTargetModifier=go.g7,mo.isDisplayStats=go.fm,mo.isElementModifier=go.g6,mo.isPropertyModifier=go.g5,mo.isValid=go.e_,mo.js=go.eR,mo.lerp=go.dC,mo.loader=go.fV,mo.log=go.fj,mo.logID=go.dw,mo.macro=go.bA,mo.markAsWarning=go.dq,mo.mat4=go.eB,mo.math=go.et,mo.misc=go.eS,mo.murmurhash2_32_gc=go.c2,mo.nextPow2=go.eK,mo.path=go.eT,mo.pingPong=go.e4,mo.pipeline=go.fz,mo.pseudoRandom=go.d_,mo.pseudoRandomRange=go.eI,mo.pseudoRandomRangeInt=go.eJ,mo.quat=go.ez,mo.random=go.d$,mo.randomRange=go.e0,mo.randomRangeInt=go.e1,mo.rect=go.eE,mo.removeProperty=go.cp,mo.renderer=go.es,mo.repeat=go.dZ,mo.replaceProperty=go.co,mo.resources=go.fT,mo.sampleAnimationCurve=go.ge,mo.screen=go.fp,mo.serializeTag=go.f8,mo.setDefaultLogTimes=go.eV,mo.setDisplayStats=go.fn,mo.size=go.eD,mo.sys=go.bC,mo.systemEvent=go.fs,mo.toDegree=go.dU,mo.toRadian=go.cD,mo.url=go.fX,mo.v2=go.ew,mo.v3=go.ex,mo.v4=go.ey,mo.view=go.dp,mo.warn=go.bH,mo.warnID=go.bG,t(mo)}],execute:function(){t({CacheMode:void 0,EAxisDirection:void 0,ERigidBodyType:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,Overflow:void 0,VerticalTextAlignment:void 0,earcut:$y,fragmentText:Kc,getBaselineOffset:function(){return 0},isUnicodeCJK:Xc,isUnicodeSpace:Yc,safeMeasureText:jc,tween:V2,tweenUtil:H2}),t("memop",Object.freeze({__proto__:null,Pool:e,RecyclePool:i,CachedArray:r})),t("gfx",Object.freeze({__proto__:null,DescriptorSet:n,Buffer:o,CommandBuffer:s,get ObjectType(){return a},get Status(){return l},get API(){return h},get SurfaceTransform(){return u},get Feature(){return c},get Format(){return d},get FormatType(){return p},get Type(){return f},get BufferUsageBit(){return _},get BufferFlagBit(){return g},get MemoryAccessBit(){return m},get MemoryUsageBit(){return y},get TextureType(){return v},get TextureUsageBit(){return b},get TextureFlagBit(){return S},get SampleCount(){return T},get Filter(){return E},get Address(){return A},get ComparisonFunc(){return C},get StencilOp(){return w},get BlendFactor(){return x},get BlendOp(){return R},get ColorMask(){return M},get ShaderStageFlagBit(){return O},get LoadOp(){return P},get StoreOp(){return D},get AccessType(){return I},get ResolveMode(){return B},get PipelineBindPoint(){return L},get PrimitiveMode(){return F},get PolygonMode(){return k},get ShadeModel(){return N},get CullMode(){return z},get DynamicStateFlagBit(){return U},get StencilFace(){return V},get DescriptorType(){return H},get QueueType(){return G},get CommandBufferType(){return W},get ClearFlagBit(){return X},Size:Y,DeviceCaps:j,Offset:q,Rect:K,Extent:Z,TextureSubresLayers:J,TextureSubresRange:Q,TextureCopy:$,TextureBlit:tt,BufferTextureCopy:et,Viewport:it,Color:rt,BindingMappingInfo:nt,BufferInfo:ot,BufferViewInfo:st,DrawInfo:at,DispatchInfo:lt,IndirectBuffer:ht,TextureInfo:ut,TextureViewInfo:ct,SamplerInfo:dt,Uniform:pt,UniformBlock:ft,UniformSamplerTexture:_t,UniformSampler:gt,UniformTexture:mt,UniformStorageImage:yt,UniformStorageBuffer:vt,UniformInputAttachment:bt,ShaderStage:St,Attribute:Tt,ShaderInfo:Et,InputAssemblerInfo:At,ColorAttachment:Ct,DepthStencilAttachment:wt,SubpassInfo:xt,SubpassDependency:Rt,RenderPassInfo:Mt,GlobalBarrierInfo:Ot,TextureBarrierInfo:Pt,FramebufferInfo:Dt,DescriptorSetLayoutBinding:It,DescriptorSetLayoutInfo:Bt,DescriptorSetInfo:Lt,PipelineLayoutInfo:Ft,InputState:kt,CommandBufferInfo:Nt,QueueInfo:zt,FormatInfo:Ut,MemoryStatus:Vt,DynamicStencilStates:Ht,DynamicStates:Gt,Obj:Wt,DeviceInfo:Xt,get AttributeName(){return Yt},FormatInfos:jt,DESCRIPTOR_BUFFER_TYPE:qt,DESCRIPTOR_SAMPLER_TYPE:Kt,DESCRIPTOR_DYNAMIC_TYPE:Zt,DRAW_INFO_SIZE:Jt,IsPowerOf2:Qt,FormatSize:$t,FormatSurfaceSize:te,GetTypeSize:ee,getTypedArrayConstructor:ie,Device:re,Framebuffer:ne,InputAssembler:oe,DescriptorSetLayout:se,PipelineLayout:ae,RasterizerState:le,DepthStencilState:he,BlendTarget:ue,BlendState:ce,PipelineStateInfo:de,PipelineState:pe,Queue:fe,RenderPass:_e,Sampler:ge,Shader:me,Texture:ye,GlobalBarrier:ve,TextureBarrier:be})),t("animation",Object.freeze({__proto__:null,UniformProxyFactory:Se,MorphWeightValueProxy:Te,MorphWeightsValueProxy:Ee,MorphWeightsAllValueProxy:Ae,Track:Ce,TrackPath:we,RealTrack:xe,VectorTrack:Re,QuatTrack:Me,ColorTrack:Oe,SizeTrack:Pe,ObjectTrack:De,isPropertyPath:Ie,isCustomPath:Be,HierarchyPath:Le,ComponentPath:Fe,CubicSplineVec2Value:ke,CubicSplineVec3Value:Ne,CubicSplineVec4Value:ze,CubicSplineQuatValue:Ue,CubicSplineNumberValue:Ve}));var go,mo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSet=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,i=e.bindings,r=e.descriptorIndices,n=e.descriptorCount;this._buffers=Array(n).fill(null),this._textures=Array(n).fill(null),this._samplers=Array(n).fill(null);var o=[];this._gpuDescriptorSet={gpuDescriptors:o,descriptorIndices:r};for(var s=0;s<i.length;++s)for(var a=i[s],l=0;l<a.count;l++)o.push({type:a.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null});return!0},i.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},i.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&qt){var i=this._buffers[e];i&&(t[e].gpuBuffer=i.gpuBuffer||i.gpuBufferView)}else t[e].type&Kt&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Ge(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(n);function yo(t,e){switch(t){case d.R8:return e.UNSIGNED_BYTE;case d.R8SN:return e.BYTE;case d.R8UI:return e.UNSIGNED_BYTE;case d.R8I:return e.BYTE;case d.R16F:return go.HALF_FLOAT_OES;case d.R16UI:return e.UNSIGNED_SHORT;case d.R16I:return e.SHORT;case d.R32F:return e.FLOAT;case d.R32UI:return e.UNSIGNED_INT;case d.R32I:return e.INT;case d.RG8:return e.UNSIGNED_BYTE;case d.RG8SN:return e.BYTE;case d.RG8UI:return e.UNSIGNED_BYTE;case d.RG8I:return e.BYTE;case d.RG16F:return go.HALF_FLOAT_OES;case d.RG16UI:return e.UNSIGNED_SHORT;case d.RG16I:return e.SHORT;case d.RG32F:return e.FLOAT;case d.RG32UI:return e.UNSIGNED_INT;case d.RG32I:return e.INT;case d.RGB8:case d.SRGB8:return e.UNSIGNED_BYTE;case d.RGB8SN:return e.BYTE;case d.RGB8UI:return e.UNSIGNED_BYTE;case d.RGB8I:return e.BYTE;case d.RGB16F:return go.HALF_FLOAT_OES;case d.RGB16UI:return e.UNSIGNED_SHORT;case d.RGB16I:return e.SHORT;case d.RGB32F:return e.FLOAT;case d.RGB32UI:return e.UNSIGNED_INT;case d.RGB32I:return e.INT;case d.BGRA8:case d.RGBA8:case d.SRGB8_A8:return e.UNSIGNED_BYTE;case d.RGBA8SN:return e.BYTE;case d.RGBA8UI:return e.UNSIGNED_BYTE;case d.RGBA8I:return e.BYTE;case d.RGBA16F:return go.HALF_FLOAT_OES;case d.RGBA16UI:return e.UNSIGNED_SHORT;case d.RGBA16I:return e.SHORT;case d.RGBA32F:return e.FLOAT;case d.RGBA32UI:return e.UNSIGNED_INT;case d.RGBA32I:return e.INT;case d.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case d.R11G11B10F:return e.FLOAT;case d.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case d.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case d.RGB10A2:return e.UNSIGNED_BYTE;case d.RGB10A2UI:return e.UNSIGNED_INT;case d.RGB9E5:return e.UNSIGNED_BYTE;case d.D16:return e.UNSIGNED_SHORT;case d.D16S8:return go.UNSIGNED_INT_24_8_WEBGL;case d.D24:return e.UNSIGNED_INT;case d.D24S8:return go.UNSIGNED_INT_24_8_WEBGL;case d.D32F:return e.UNSIGNED_INT;case d.D32F_S8:return go.UNSIGNED_INT_24_8_WEBGL;case d.BC1:case d.BC1_SRGB:case d.BC2:case d.BC2_SRGB:case d.BC3:case d.BC3_SRGB:case d.BC4:return e.UNSIGNED_BYTE;case d.BC4_SNORM:return e.BYTE;case d.BC5:return e.UNSIGNED_BYTE;case d.BC5_SNORM:return e.BYTE;case d.BC6H_SF16:case d.BC6H_UF16:return e.FLOAT;case d.BC7:case d.BC7_SRGB:case d.ETC_RGB8:case d.ETC2_RGB8:case d.ETC2_SRGB8:case d.ETC2_RGB8_A1:case d.ETC2_SRGB8_A1:case d.EAC_R11:return e.UNSIGNED_BYTE;case d.EAC_R11SN:return e.BYTE;case d.EAC_RG11:return e.UNSIGNED_BYTE;case d.EAC_RG11SN:return e.BYTE;case d.PVRTC_RGB2:case d.PVRTC_RGBA2:case d.PVRTC_RGB4:case d.PVRTC_RGBA4:case d.PVRTC2_2BPP:case d.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case d.ASTC_RGBA_4X4:case d.ASTC_RGBA_5X4:case d.ASTC_RGBA_5X5:case d.ASTC_RGBA_6X5:case d.ASTC_RGBA_6X6:case d.ASTC_RGBA_8X5:case d.ASTC_RGBA_8X6:case d.ASTC_RGBA_8X8:case d.ASTC_RGBA_10X5:case d.ASTC_RGBA_10X6:case d.ASTC_RGBA_10X8:case d.ASTC_RGBA_10X10:case d.ASTC_RGBA_12X10:case d.ASTC_RGBA_12X12:case d.ASTC_SRGBA_4X4:case d.ASTC_SRGBA_5X4:case d.ASTC_SRGBA_5X5:case d.ASTC_SRGBA_6X5:case d.ASTC_SRGBA_6X6:case d.ASTC_SRGBA_8X5:case d.ASTC_SRGBA_8X6:case d.ASTC_SRGBA_8X8:case d.ASTC_SRGBA_10X5:case d.ASTC_SRGBA_10X6:case d.ASTC_SRGBA_10X8:case d.ASTC_SRGBA_10X10:case d.ASTC_SRGBA_12X10:case d.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function vo(t,e){switch(t){case d.A8:return e.ALPHA;case d.L8:return e.LUMINANCE;case d.LA8:return e.LUMINANCE_ALPHA;case d.RGB8:case d.RGB16F:case d.RGB32F:return e.RGB;case d.BGRA8:case d.RGBA8:case d.SRGB8_A8:case d.RGBA16F:case d.RGBA32F:return e.RGBA;case d.R5G6B5:return e.RGB;case d.RGB5A1:case d.RGBA4:return e.RGBA;case d.D16:return e.DEPTH_COMPONENT;case d.D16S8:return e.DEPTH_STENCIL;case d.D24:return e.DEPTH_COMPONENT;case d.D24S8:return e.DEPTH_STENCIL;case d.D32F:return e.DEPTH_COMPONENT;case d.D32F_S8:return e.DEPTH_STENCIL;case d.BC1:return go.COMPRESSED_RGB_S3TC_DXT1_EXT;case d.BC1_ALPHA:return go.COMPRESSED_RGBA_S3TC_DXT1_EXT;case d.BC1_SRGB:return go.COMPRESSED_SRGB_S3TC_DXT1_EXT;case d.BC1_SRGB_ALPHA:return go.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case d.BC2:return go.COMPRESSED_RGBA_S3TC_DXT3_EXT;case d.BC2_SRGB:return go.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case d.BC3:return go.COMPRESSED_RGBA_S3TC_DXT5_EXT;case d.BC3_SRGB:return go.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case d.ETC_RGB8:return go.COMPRESSED_RGB_ETC1_WEBGL;case d.ETC2_RGB8:return go.COMPRESSED_RGB8_ETC2;case d.ETC2_SRGB8:return go.COMPRESSED_SRGB8_ETC2;case d.ETC2_RGB8_A1:return go.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case d.ETC2_SRGB8_A1:return go.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case d.ETC2_RGBA8:return go.COMPRESSED_RGBA8_ETC2_EAC;case d.ETC2_SRGB8_A8:return go.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case d.EAC_R11:return go.COMPRESSED_R11_EAC;case d.EAC_R11SN:return go.COMPRESSED_SIGNED_R11_EAC;case d.EAC_RG11:return go.COMPRESSED_RG11_EAC;case d.EAC_RG11SN:return go.COMPRESSED_SIGNED_RG11_EAC;case d.PVRTC_RGB2:return go.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case d.PVRTC_RGBA2:return go.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case d.PVRTC_RGB4:return go.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case d.PVRTC_RGBA4:return go.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case d.ASTC_RGBA_4X4:return go.COMPRESSED_RGBA_ASTC_4x4_KHR;case d.ASTC_RGBA_5X4:return go.COMPRESSED_RGBA_ASTC_5x4_KHR;case d.ASTC_RGBA_5X5:return go.COMPRESSED_RGBA_ASTC_5x5_KHR;case d.ASTC_RGBA_6X5:return go.COMPRESSED_RGBA_ASTC_6x5_KHR;case d.ASTC_RGBA_6X6:return go.COMPRESSED_RGBA_ASTC_6x6_KHR;case d.ASTC_RGBA_8X5:return go.COMPRESSED_RGBA_ASTC_8x5_KHR;case d.ASTC_RGBA_8X6:return go.COMPRESSED_RGBA_ASTC_8x6_KHR;case d.ASTC_RGBA_8X8:return go.COMPRESSED_RGBA_ASTC_8x8_KHR;case d.ASTC_RGBA_10X5:return go.COMPRESSED_RGBA_ASTC_10x5_KHR;case d.ASTC_RGBA_10X6:return go.COMPRESSED_RGBA_ASTC_10x6_KHR;case d.ASTC_RGBA_10X8:return go.COMPRESSED_RGBA_ASTC_10x8_KHR;case d.ASTC_RGBA_10X10:return go.COMPRESSED_RGBA_ASTC_10x10_KHR;case d.ASTC_RGBA_12X10:return go.COMPRESSED_RGBA_ASTC_12x10_KHR;case d.ASTC_RGBA_12X12:return go.COMPRESSED_RGBA_ASTC_12x12_KHR;case d.ASTC_SRGBA_4X4:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case d.ASTC_SRGBA_5X4:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case d.ASTC_SRGBA_5X5:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case d.ASTC_SRGBA_6X5:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case d.ASTC_SRGBA_6X6:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case d.ASTC_SRGBA_8X5:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case d.ASTC_SRGBA_8X6:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case d.ASTC_SRGBA_8X8:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case d.ASTC_SRGBA_10X5:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case d.ASTC_SRGBA_10X6:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case d.ASTC_SRGBA_10X8:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case d.ASTC_SRGBA_10X10:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case d.ASTC_SRGBA_12X10:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case d.ASTC_SRGBA_12X12:return go.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}function bo(t,e){switch(t){case f.BOOL:return e.BOOL;case f.BOOL2:return e.BOOL_VEC2;case f.BOOL3:return e.BOOL_VEC3;case f.BOOL4:return e.BOOL_VEC4;case f.INT:return e.INT;case f.INT2:return e.INT_VEC2;case f.INT3:return e.INT_VEC3;case f.INT4:return e.INT_VEC4;case f.UINT:return e.UNSIGNED_INT;case f.FLOAT:return e.FLOAT;case f.FLOAT2:return e.FLOAT_VEC2;case f.FLOAT3:return e.FLOAT_VEC3;case f.FLOAT4:return e.FLOAT_VEC4;case f.MAT2:return e.FLOAT_MAT2;case f.MAT3:return e.FLOAT_MAT3;case f.MAT4:return e.FLOAT_MAT4;case f.SAMPLER2D:return e.SAMPLER_2D;case f.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),f.UNKNOWN}}function So(t){switch(t){case f.BOOL:case f.BOOL2:case f.BOOL3:case f.BOOL4:case f.INT:case f.INT2:case f.INT3:case f.INT4:case f.UINT:return Int32Array;case f.FLOAT:case f.FLOAT2:case f.FLOAT3:case f.FLOAT4:case f.MAT2:case f.MAT3:case f.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function To(t,e){switch(t){case e.BOOL:return f.BOOL;case e.BOOL_VEC2:return f.BOOL2;case e.BOOL_VEC3:return f.BOOL3;case e.BOOL_VEC4:return f.BOOL4;case e.INT:return f.INT;case e.INT_VEC2:return f.INT2;case e.INT_VEC3:return f.INT3;case e.INT_VEC4:return f.INT4;case e.UNSIGNED_INT:return f.UINT;case e.FLOAT:return f.FLOAT;case e.FLOAT_VEC2:return f.FLOAT2;case e.FLOAT_VEC3:return f.FLOAT3;case e.FLOAT_VEC4:return f.FLOAT4;case e.FLOAT_MAT2:return f.MAT2;case e.FLOAT_MAT3:return f.MAT3;case e.FLOAT_MAT4:return f.MAT4;case e.SAMPLER_2D:return f.SAMPLER2D;case e.SAMPLER_CUBE:return f.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),f.UNKNOWN}}function Eo(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function Ao(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(go||(go={}));var Co,wo=[512,513,514,515,516,517,518,519],xo=[0,7680,7681,7682,7683,5386,34055,34056],Ro=[32774,32778,32779,32775,32776],Mo=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(Co||(Co={}));var Oo=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},Po=function(t){function e(){var e;return(e=t.call(this,Co.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new K,e.clearFlag=X.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return He(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(Oo),Do=function(t){function e(){var e;return(e=t.call(this,Co.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new Gt,e}return He(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(Oo),Io=function(t){function e(){var e;return(e=t.call(this,Co.DRAW)||this).drawInfo=new at,e}return He(e,t),e.prototype.clear=function(){},e}(Oo),Bo=function(t){function e(){var e;return(e=t.call(this,Co.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return He(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(Oo),Lo=function(t){function e(){var e;return(e=t.call(this,Co.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return He(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(Oo),Fo=function(){function t(){this.cmds=new r(1),this.beginRenderPassCmds=new r(1),this.bindStatesCmds=new r(1),this.drawCmds=new r(1),this.updateBufferCmds=new r(1),this.copyBufferToTextureCmds=new r(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function ko(t,e,i,r,n){if(e.usage&_.UNIFORM)ArrayBuffer.isView(i)?e.vf32.set(i,r/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(i),r/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&_.INDIRECT)e.indirects.length=r,Array.prototype.push.apply(e.indirects,i.drawInfos);else{var o=i,s=t.gl,a=t.stateCache;switch(e.glTarget){case s.ARRAY_BUFFER:t.useVAO&&a.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),a.glVAO=No.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(s.bindBuffer(s.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case s.ELEMENT_ARRAY_BUFFER:t.useVAO&&a.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),a.glVAO=No.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}n===o.byteLength?s.bufferSubData(e.glTarget,r,o):s.bufferSubData(e.glTarget,r,o.slice(0,n))}}var No={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0};function zo(t,e,i,r,n,o,s){var a=t.gl,l=t.stateCache,h=0;if(i&&e){l.glFramebuffer!==i.glFramebuffer&&(a.bindFramebuffer(a.FRAMEBUFFER,i.glFramebuffer),l.glFramebuffer=i.glFramebuffer),l.viewport.left===r.x&&l.viewport.top===r.y&&l.viewport.width===r.width&&l.viewport.height===r.height||(a.viewport(r.x,r.y,r.width,r.height),l.viewport.left=r.x,l.viewport.top=r.y,l.viewport.width=r.width,l.viewport.height=r.height),l.scissorRect.x===r.x&&l.scissorRect.y===r.y&&l.scissorRect.width===r.width&&l.scissorRect.height===r.height||(a.scissor(r.x,r.y,r.width,r.height),l.scissorRect.x=r.x,l.scissorRect.y=r.y,l.scissorRect.width=r.width,l.scissorRect.height=r.height);var u=n.length;t.WEBGL_draw_buffers||(u=1);for(var c=0;c<u;++c){var p=e.colorAttachments[c];if(p.format!==d.UNKNOWN)switch(p.loadOp){case P.LOAD:break;case P.CLEAR:l.bs.targets[0].blendColorMask!==M.ALL&&a.colorMask(!0,!0,!0,!0);var f=n[0];a.clearColor(f.x,f.y,f.z,f.w),h|=a.COLOR_BUFFER_BIT;break;case P.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==d.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case P.LOAD:break;case P.CLEAR:l.dss.depthWrite||a.depthMask(!0),a.clearDepth(o),h|=a.DEPTH_BUFFER_BIT;break;case P.DISCARD:}if(jt[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case P.LOAD:break;case P.CLEAR:l.dss.stencilWriteMaskFront||a.stencilMaskSeparate(a.FRONT,65535),l.dss.stencilWriteMaskBack||a.stencilMaskSeparate(a.BACK,65535),a.clearStencil(s),h|=a.STENCIL_BUFFER_BIT;break;case P.DISCARD:}}if(h&&a.clear(h),h&a.COLOR_BUFFER_BIT){var _=l.bs.targets[0].blendColorMask;if(_!==M.ALL){var g=(_&M.R)!==M.NONE,m=(_&M.G)!==M.NONE,y=(_&M.B)!==M.NONE,v=(_&M.A)!==M.NONE;a.colorMask(g,m,y,v)}}h&a.DEPTH_BUFFER_BIT&&!l.dss.depthWrite&&a.depthMask(!1),h&a.STENCIL_BUFFER_BIT&&(l.dss.stencilWriteMaskFront||a.stencilMaskSeparate(a.FRONT,0),l.dss.stencilWriteMaskBack||a.stencilMaskSeparate(a.BACK,0))}}function Uo(t,e,i,r,n,o){var s,a,l,h=t.gl,u=t.stateCache,c=e&&e.gpuShader,d=!1;if(e&&No.gpuPipelineState!==e){if(No.gpuPipelineState=e,No.glPrimitive=e.glPrimitive,e.gpuShader){var p=e.gpuShader.glProgram;u.glProgram!==p&&(h.useProgram(p),u.glProgram=p,d=!0)}var f=e.rs;if(f){if(u.rs.cullMode!==f.cullMode){switch(f.cullMode){case z.NONE:h.disable(h.CULL_FACE);break;case z.FRONT:h.enable(h.CULL_FACE),h.cullFace(h.FRONT);break;case z.BACK:h.enable(h.CULL_FACE),h.cullFace(h.BACK)}u.rs.cullMode=f.cullMode}var _=f.isFrontFaceCCW;u.rs.isFrontFaceCCW!==_&&(h.frontFace(_?h.CCW:h.CW),u.rs.isFrontFaceCCW=_),u.rs.depthBias===f.depthBias&&u.rs.depthBiasSlop===f.depthBiasSlop||(h.polygonOffset(f.depthBias,f.depthBiasSlop),u.rs.depthBias=f.depthBias,u.rs.depthBiasSlop=f.depthBiasSlop),u.rs.lineWidth!==f.lineWidth&&(h.lineWidth(f.lineWidth),u.rs.lineWidth=f.lineWidth)}var g=e.dss;g&&(u.dss.depthTest!==g.depthTest&&(g.depthTest?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),u.dss.depthTest=g.depthTest),u.dss.depthWrite!==g.depthWrite&&(h.depthMask(g.depthWrite),u.dss.depthWrite=g.depthWrite),u.dss.depthFunc!==g.depthFunc&&(h.depthFunc(wo[g.depthFunc]),u.dss.depthFunc=g.depthFunc),u.dss.stencilTestFront===g.stencilTestFront&&u.dss.stencilTestBack===g.stencilTestBack||(g.stencilTestFront||g.stencilTestBack?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),u.dss.stencilTestFront=g.stencilTestFront,u.dss.stencilTestBack=g.stencilTestBack),u.dss.stencilFuncFront===g.stencilFuncFront&&u.dss.stencilRefFront===g.stencilRefFront&&u.dss.stencilReadMaskFront===g.stencilReadMaskFront||(h.stencilFuncSeparate(h.FRONT,wo[g.stencilFuncFront],g.stencilRefFront,g.stencilReadMaskFront),u.dss.stencilFuncFront=g.stencilFuncFront,u.dss.stencilRefFront=g.stencilRefFront,u.dss.stencilReadMaskFront=g.stencilReadMaskFront),u.dss.stencilFailOpFront===g.stencilFailOpFront&&u.dss.stencilZFailOpFront===g.stencilZFailOpFront&&u.dss.stencilPassOpFront===g.stencilPassOpFront||(h.stencilOpSeparate(h.FRONT,xo[g.stencilFailOpFront],xo[g.stencilZFailOpFront],xo[g.stencilPassOpFront]),u.dss.stencilFailOpFront=g.stencilFailOpFront,u.dss.stencilZFailOpFront=g.stencilZFailOpFront,u.dss.stencilPassOpFront=g.stencilPassOpFront),u.dss.stencilWriteMaskFront!==g.stencilWriteMaskFront&&(h.stencilMaskSeparate(h.FRONT,g.stencilWriteMaskFront),u.dss.stencilWriteMaskFront=g.stencilWriteMaskFront),u.dss.stencilFuncBack===g.stencilFuncBack&&u.dss.stencilRefBack===g.stencilRefBack&&u.dss.stencilReadMaskBack===g.stencilReadMaskBack||(h.stencilFuncSeparate(h.BACK,wo[g.stencilFuncBack],g.stencilRefBack,g.stencilReadMaskBack),u.dss.stencilFuncBack=g.stencilFuncBack,u.dss.stencilRefBack=g.stencilRefBack,u.dss.stencilReadMaskBack=g.stencilReadMaskBack),u.dss.stencilFailOpBack===g.stencilFailOpBack&&u.dss.stencilZFailOpBack===g.stencilZFailOpBack&&u.dss.stencilPassOpBack===g.stencilPassOpBack||(h.stencilOpSeparate(h.BACK,xo[g.stencilFailOpBack],xo[g.stencilZFailOpBack],xo[g.stencilPassOpBack]),u.dss.stencilFailOpBack=g.stencilFailOpBack,u.dss.stencilZFailOpBack=g.stencilZFailOpBack,u.dss.stencilPassOpBack=g.stencilPassOpBack),u.dss.stencilWriteMaskBack!==g.stencilWriteMaskBack&&(h.stencilMaskSeparate(h.BACK,g.stencilWriteMaskBack),u.dss.stencilWriteMaskBack=g.stencilWriteMaskBack));var m=e.bs;if(m){u.bs.isA2C!==m.isA2C&&(m.isA2C?h.enable(h.SAMPLE_ALPHA_TO_COVERAGE):h.disable(h.SAMPLE_ALPHA_TO_COVERAGE),u.bs.isA2C=m.isA2C),u.bs.blendColor.x===m.blendColor.x&&u.bs.blendColor.y===m.blendColor.y&&u.bs.blendColor.z===m.blendColor.z&&u.bs.blendColor.w===m.blendColor.w||(h.blendColor(m.blendColor.x,m.blendColor.y,m.blendColor.z,m.blendColor.w),u.bs.blendColor.x=m.blendColor.x,u.bs.blendColor.y=m.blendColor.y,u.bs.blendColor.z=m.blendColor.z,u.bs.blendColor.w=m.blendColor.w);var y=m.targets[0],v=u.bs.targets[0];v.blend!==y.blend&&(y.blend?h.enable(h.BLEND):h.disable(h.BLEND),v.blend=y.blend),v.blendEq===y.blendEq&&v.blendAlphaEq===y.blendAlphaEq||(h.blendEquationSeparate(Ro[y.blendEq],Ro[y.blendAlphaEq]),v.blendEq=y.blendEq,v.blendAlphaEq=y.blendAlphaEq),v.blendSrc===y.blendSrc&&v.blendDst===y.blendDst&&v.blendSrcAlpha===y.blendSrcAlpha&&v.blendDstAlpha===y.blendDstAlpha||(h.blendFuncSeparate(Mo[y.blendSrc],Mo[y.blendDst],Mo[y.blendSrcAlpha],Mo[y.blendDstAlpha]),v.blendSrc=y.blendSrc,v.blendDst=y.blendDst,v.blendSrcAlpha=y.blendSrcAlpha,v.blendDstAlpha=y.blendDstAlpha),v.blendColorMask!==y.blendColorMask&&(h.colorMask((y.blendColorMask&M.R)!==M.NONE,(y.blendColorMask&M.G)!==M.NONE,(y.blendColorMask&M.B)!==M.NONE,(y.blendColorMask&M.A)!==M.NONE),v.blendColorMask=y.blendColorMask)}}if(e&&e.gpuPipelineLayout&&c){for(var b=c.glBlocks.length,S=e.gpuPipelineLayout.dynamicOffsetIndices,T=0;T<b;T++){var E=c.glBlocks[T],A=r[E.set],C=A&&A.descriptorIndices[E.binding],w=C>=0&&A.gpuDescriptors[C],x=null,R=0;if(w&&w.gpuBuffer){var O=w.gpuBuffer,P=S[E.set],D=P&&P[E.binding];D>=0&&(R=n[D]),"vf32"in O?x=O.vf32:(R+=O.offset,x=O.gpuBuffer.vf32),R>>=2}if(x)for(var I=E.glActiveUniforms.length,B=0;B<I;B++){var L=E.glActiveUniforms[B];switch(L.glType){case h.BOOL:case h.INT:for(var F=0;F<L.array.length;++F){var k=L.offset+R+F;if(x[k]!==L.array[F]){for(var N=F,V=k;N<L.array.length;++N,++V)L.array[N]=x[V];h.uniform1iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC2:case h.INT_VEC2:for(var H=0;H<L.array.length;++H){var G=L.offset+R+H;if(x[G]!==L.array[H]){for(var W=H,X=G;W<L.array.length;++W,++X)L.array[W]=x[X];h.uniform2iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC3:case h.INT_VEC3:for(var Y=0;Y<L.array.length;++Y){var j=L.offset+R+Y;if(x[j]!==L.array[Y]){for(var q=Y,K=j;q<L.array.length;++q,++K)L.array[q]=x[K];h.uniform3iv(L.glLoc,L.array);break}}break;case h.BOOL_VEC4:case h.INT_VEC4:for(var Z=0;Z<L.array.length;++Z){var J=L.offset+R+Z;if(x[J]!==L.array[Z]){for(var Q=Z,$=J;Q<L.array.length;++Q,++$)L.array[Q]=x[$];h.uniform4iv(L.glLoc,L.array);break}}break;case h.FLOAT:for(var tt=0;tt<L.array.length;++tt){var et=L.offset+R+tt;if(x[et]!==L.array[tt]){for(var it=tt,rt=et;it<L.array.length;++it,++rt)L.array[it]=x[rt];h.uniform1fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC2:for(var nt=0;nt<L.array.length;++nt){var ot=L.offset+R+nt;if(x[ot]!==L.array[nt]){for(var st=nt,at=ot;st<L.array.length;++st,++at)L.array[st]=x[at];h.uniform2fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC3:for(var lt=0;lt<L.array.length;++lt){var ht=L.offset+R+lt;if(x[ht]!==L.array[lt]){for(var ut=lt,ct=ht;ut<L.array.length;++ut,++ct)L.array[ut]=x[ct];h.uniform3fv(L.glLoc,L.array);break}}break;case h.FLOAT_VEC4:for(var dt=0;dt<L.array.length;++dt){var pt=L.offset+R+dt;if(x[pt]!==L.array[dt]){for(var ft=dt,_t=pt;ft<L.array.length;++ft,++_t)L.array[ft]=x[_t];h.uniform4fv(L.glLoc,L.array);break}}break;case h.FLOAT_MAT2:for(var gt=0;gt<L.array.length;++gt){var mt=L.offset+R+gt;if(x[mt]!==L.array[gt]){for(var yt=gt,vt=mt;yt<L.array.length;++yt,++vt)L.array[yt]=x[vt];h.uniformMatrix2fv(L.glLoc,!1,L.array);break}}break;case h.FLOAT_MAT3:for(var bt=0;bt<L.array.length;++bt){var St=L.offset+R+bt;if(x[St]!==L.array[bt]){for(var Tt=bt,Et=St;Tt<L.array.length;++Tt,++Et)L.array[Tt]=x[Et];h.uniformMatrix3fv(L.glLoc,!1,L.array);break}}break;case h.FLOAT_MAT4:for(var At=0;At<L.array.length;++At){var Ct=L.offset+R+At;if(x[Ct]!==L.array[At]){for(var wt=At,xt=Ct;wt<L.array.length;++wt,++xt)L.array[wt]=x[xt];h.uniformMatrix4fv(L.glLoc,!1,L.array);break}}}}else Ye("Buffer binding '"+E.name+"' at set "+E.set+" binding "+E.binding+" is not bounded")}for(var Rt=c.glSamplerTextures.length,Mt=0;Mt<Rt;Mt++)for(var Ot=c.glSamplerTextures[Mt],Pt=r[Ot.set],Dt=Pt&&Pt.descriptorIndices[Ot.binding],It=Dt>=0&&Pt.gpuDescriptors[Dt],Bt=Ot.units.length,Lt=0;Lt<Bt;Lt++){var Ft=Ot.units[Lt];if(It&&It.gpuSampler){if(It.gpuTexture&&It.gpuTexture.size>0){var kt=It.gpuTexture,Nt=u.glTexUnits[Ft];Nt.glTexture!==kt.glTexture&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),kt.glTexture?h.bindTexture(kt.glTarget,kt.glTexture):h.bindTexture(kt.glTarget,t.nullTex2D.gpuTexture.glTexture),Nt.glTexture=kt.glTexture);var zt=It.gpuSampler;kt.isPowerOf2?(s=zt.glWrapS,a=zt.glWrapT):(s=h.CLAMP_TO_EDGE,a=h.CLAMP_TO_EDGE),l=kt.isPowerOf2?kt.mipLevel<=1&&(zt.glMinFilter===h.LINEAR_MIPMAP_NEAREST||zt.glMinFilter===h.LINEAR_MIPMAP_LINEAR)?h.LINEAR:zt.glMinFilter:zt.glMinFilter===h.LINEAR||zt.glMinFilter===h.LINEAR_MIPMAP_NEAREST||zt.glMinFilter===h.LINEAR_MIPMAP_LINEAR?h.LINEAR:h.NEAREST,kt.glWrapS!==s&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_WRAP_S,s),kt.glWrapS=s),kt.glWrapT!==a&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_WRAP_T,a),kt.glWrapT=a),kt.glMinFilter!==l&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_MIN_FILTER,l),kt.glMinFilter=l),kt.glMagFilter!==zt.glMagFilter&&(u.texUnit!==Ft&&(h.activeTexture(h.TEXTURE0+Ft),u.texUnit=Ft),h.texParameteri(kt.glTarget,h.TEXTURE_MAG_FILTER,zt.glMagFilter),kt.glMagFilter=zt.glMagFilter)}It=Pt.gpuDescriptors[++Dt]}else Ye("Sampler binding '"+Ot.name+"' at set "+Ot.set+" binding "+Ot.binding+" index "+Lt+" is not bounded")}}if(i&&c&&(d||No.gpuInputAssembler!==i)){No.gpuInputAssembler=i;var Ut=t.ANGLE_instanced_arrays;if(t.useVAO){var Vt=t.OES_vertex_array_object,Ht=i.glVAOs.get(c.glProgram);if(!Ht){var Gt;Ht=Vt.createVertexArrayOES(),i.glVAOs.set(c.glProgram,Ht),Vt.bindVertexArrayOES(Ht),h.bindBuffer(h.ARRAY_BUFFER,null),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null;for(var Wt=c.glInputs.length,Xt=0;Xt<Wt;Xt++){var Yt=c.glInputs[Xt];Gt=null;for(var jt=i.glAttribs.length,qt=0;qt<jt;qt++){var Kt=i.glAttribs[qt];if(Kt.name===Yt.name){Gt=Kt;break}}if(Gt){u.glArrayBuffer!==Gt.glBuffer&&(h.bindBuffer(h.ARRAY_BUFFER,Gt.glBuffer),u.glArrayBuffer=Gt.glBuffer);for(var Zt=0;Zt<Gt.componentCount;++Zt){var Jt=Yt.glLoc+Zt,Qt=Gt.offset+Gt.size*Zt;h.enableVertexAttribArray(Jt),u.glCurrentAttribLocs[Jt]=!0,h.vertexAttribPointer(Jt,Gt.count,Gt.glType,Gt.isNormalized,Gt.stride,Qt),Ut&&Ut.vertexAttribDivisorANGLE(Jt,Gt.isInstanced?1:0)}}}var $t=i.gpuIndexBuffer;$t&&h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,$t.glBuffer),Vt.bindVertexArrayOES(null),h.bindBuffer(h.ARRAY_BUFFER,null),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,null),u.glArrayBuffer=null,u.glElementArrayBuffer=null}u.glVAO!==Ht&&(Vt.bindVertexArrayOES(Ht),u.glVAO=Ht)}else{for(var te=0;te<t.capabilities.maxVertexAttributes;++te)u.glCurrentAttribLocs[te]=!1;for(var ee=c.glInputs.length,ie=0;ie<ee;ie++){for(var re=c.glInputs[ie],ne=null,oe=i.glAttribs.length,se=0;se<oe;se++){var ae=i.glAttribs[se];if(ae.name===re.name){ne=ae;break}}if(ne){u.glArrayBuffer!==ne.glBuffer&&(h.bindBuffer(h.ARRAY_BUFFER,ne.glBuffer),u.glArrayBuffer=ne.glBuffer);for(var le=0;le<ne.componentCount;++le){var he=re.glLoc+le,ue=ne.offset+ne.size*le;!u.glEnabledAttribLocs[he]&&he>=0&&(h.enableVertexAttribArray(he),u.glEnabledAttribLocs[he]=!0),u.glCurrentAttribLocs[he]=!0,h.vertexAttribPointer(he,ne.count,ne.glType,ne.isNormalized,ne.stride,ue),Ut&&Ut.vertexAttribDivisorANGLE(he,ne.isInstanced?1:0)}}}var ce=i.gpuIndexBuffer;ce&&u.glElementArrayBuffer!==ce.glBuffer&&(h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,ce.glBuffer),u.glElementArrayBuffer=ce.glBuffer);for(var de=0;de<t.capabilities.maxVertexAttributes;++de)u.glEnabledAttribLocs[de]!==u.glCurrentAttribLocs[de]&&(h.disableVertexAttribArray(de),u.glEnabledAttribLocs[de]=!1)}}if(e&&e.dynamicStates.length)for(var pe=e.dynamicStates.length,fe=0;fe<pe;fe++)switch(e.dynamicStates[fe]){case U.VIEWPORT:var _e=o.viewport;u.viewport.left===_e.left&&u.viewport.top===_e.top&&u.viewport.width===_e.width&&u.viewport.height===_e.height||(h.viewport(_e.left,_e.top,_e.width,_e.height),u.viewport.left=_e.left,u.viewport.top=_e.top,u.viewport.width=_e.width,u.viewport.height=_e.height);break;case U.SCISSOR:var ge=o.scissor;u.scissorRect.x===ge.x&&u.scissorRect.y===ge.y&&u.scissorRect.width===ge.width&&u.scissorRect.height===ge.height||(h.scissor(ge.x,ge.y,ge.width,ge.height),u.scissorRect.x=ge.x,u.scissorRect.y=ge.y,u.scissorRect.width=ge.width,u.scissorRect.height=ge.height);break;case U.LINE_WIDTH:u.rs.lineWidth!==o.lineWidth&&(h.lineWidth(o.lineWidth),u.rs.lineWidth=o.lineWidth);break;case U.DEPTH_BIAS:u.rs.depthBias===o.depthBiasConstant&&u.rs.depthBiasSlop===o.depthBiasSlope||(h.polygonOffset(o.depthBiasConstant,o.depthBiasSlope),u.rs.depthBias=o.depthBiasConstant,u.rs.depthBiasSlop=o.depthBiasSlope);break;case U.BLEND_CONSTANTS:var me=o.blendConstant;u.bs.blendColor.x===me.x&&u.bs.blendColor.y===me.y&&u.bs.blendColor.z===me.z&&u.bs.blendColor.w===me.w||(h.blendColor(me.x,me.y,me.z,me.w),u.bs.blendColor.copy(me));break;case U.STENCIL_WRITE_MASK:var ye=o.stencilStatesFront,ve=o.stencilStatesBack;u.dss.stencilWriteMaskFront!==ye.writeMask&&(h.stencilMaskSeparate(h.FRONT,ye.writeMask),u.dss.stencilWriteMaskFront=ye.writeMask),u.dss.stencilWriteMaskBack!==ve.writeMask&&(h.stencilMaskSeparate(h.BACK,ve.writeMask),u.dss.stencilWriteMaskBack=ve.writeMask);break;case U.STENCIL_COMPARE_MASK:var be=o.stencilStatesFront,Se=o.stencilStatesBack;u.dss.stencilRefFront===be.reference&&u.dss.stencilReadMaskFront===be.compareMask||(h.stencilFuncSeparate(h.FRONT,wo[u.dss.stencilFuncFront],be.reference,be.compareMask),u.dss.stencilRefFront=be.reference,u.dss.stencilReadMaskFront=be.compareMask),u.dss.stencilRefBack===Se.reference&&u.dss.stencilReadMaskBack===Se.compareMask||(h.stencilFuncSeparate(h.BACK,wo[u.dss.stencilFuncBack],Se.reference,Se.compareMask),u.dss.stencilRefBack=Se.reference,u.dss.stencilReadMaskBack=Se.compareMask)}}function Vo(t,e){var i=t.gl,r=t.ANGLE_instanced_arrays,n=No.gpuInputAssembler,o=No.glPrimitive;if(n)if(n.gpuIndirectBuffer)for(var s=n.gpuIndirectBuffer.indirects.length,a=0;a<s;a++){var l=n.gpuIndirectBuffer.indirects[a],h=n.gpuIndexBuffer;if(l.instanceCount&&r)if(h){if(l.indexCount>0){var u=l.firstIndex*h.stride;r.drawElementsInstancedANGLE(o,l.indexCount,n.glIndexType,u,l.instanceCount)}}else l.vertexCount>0&&r.drawArraysInstancedANGLE(o,l.firstVertex,l.vertexCount,l.instanceCount);else if(h){if(l.indexCount>0){var c=l.firstIndex*h.stride;i.drawElements(o,l.indexCount,n.glIndexType,c)}}else l.vertexCount>0&&i.drawArrays(o,l.firstVertex,l.vertexCount)}else{var d=n.gpuIndexBuffer;if(e.instanceCount&&r)if(d){if(e.indexCount>0){var p=e.firstIndex*d.stride;r.drawElementsInstancedANGLE(o,e.indexCount,n.glIndexType,p,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(o,e.firstVertex,e.vertexCount,e.instanceCount);else if(d){if(e.indexCount>0){var f=e.firstIndex*d.stride;i.drawElements(o,e.indexCount,n.glIndexType,f)}}else e.vertexCount>0&&i.drawArrays(o,e.firstVertex,e.vertexCount)}}var Ho=new Array(Co.COUNT);function Go(t,e){Ho.fill(0);for(var i=0;i<e.cmds.length;++i){var r=e.cmds.array[i],n=Ho[r]++;switch(r){case Co.BEGIN_RENDER_PASS:var o=e.beginRenderPassCmds.array[n];zo(t,o.gpuRenderPass,o.gpuFramebuffer,o.renderArea,o.clearColors,o.clearDepth,o.clearStencil);break;case Co.BIND_STATES:var s=e.bindStatesCmds.array[n];Uo(t,s.gpuPipelineState,s.gpuInputAssembler,s.gpuDescriptorSets,s.dynamicOffsets,s.dynamicStates);break;case Co.DRAW:Vo(t,e.drawCmds.array[n].drawInfo);break;case Co.UPDATE_BUFFER:var a=e.updateBufferCmds.array[n];ko(t,a.gpuBuffer,a.buffer,a.offset,a.size);break;case Co.COPY_BUFFER_TO_TEXTURE:var l=e.copyBufferToTextureCmds.array[n];Wo(t,l.buffers,l.gpuTexture,l.regions)}}}function Wo(t,e,i,r){var n=t.gl,o=t.stateCache.glTexUnits[t.stateCache.texUnit];o.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),o.glTexture=i.glTexture);var s=0,a=1,l=1,h=0,u=jt[i.format].isCompressed;switch(i.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var d=r[c];a=d.texExtent.width,l=d.texExtent.height;var p=e[s++];u?i.glInternalFmt===go.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_2D,d.texSubres.mipLevel,i.glInternalFmt,a,l,0,p):n.compressedTexSubImage2D(n.TEXTURE_2D,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,a,l,i.glFormat,p):n.texSubImage2D(n.TEXTURE_2D,d.texSubres.mipLevel,d.texOffset.x,d.texOffset.y,a,l,i.glFormat,i.glType,p)}break;case n.TEXTURE_CUBE_MAP:for(var f=0;f<r.length;f++){var _=r[f],g=_.texSubres.baseArrayLayer+_.texSubres.layerCount;for(h=_.texSubres.baseArrayLayer;h<g;++h){a=_.texExtent.width,l=_.texExtent.height;var m=e[s++];u?i.glInternalFmt===go.COMPRESSED_RGB_ETC1_WEBGL||t.noCompressedTexSubImage2D?n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,i.glInternalFmt,a,l,0,m):n.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,a,l,i.glFormat,m):n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+h,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,a,l,i.glFormat,i.glType,m)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&n.generateMipmap(i.glTarget)}var Xo,Yo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&_.INDIRECT&&(this._indirectBuffer=new ht),this._usage&_.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:[],glTarget:0,glBuffer:null},t.usage&_.INDIRECT&&(this._gpuBuffer.indirects=this._indirectBuffer.drawInfos),this._usage&_.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var i=t.gl,r=t.stateCache,n=e.memUsage&y.HOST?i.DYNAMIC_DRAW:i.STATIC_DRAW;if(e.usage&_.VERTEX){e.glTarget=i.ARRAY_BUFFER;var o=i.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=No.gpuInputAssembler=null),t.stateCache.glArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),i.bufferData(i.ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&_.INDEX){e.glTarget=i.ELEMENT_ARRAY_BUFFER;var s=i.createBuffer();s&&(e.glBuffer=s,e.size>0&&(t.useVAO&&r.glVAO&&(t.OES_vertex_array_object.bindVertexArrayOES(null),r.glVAO=No.gpuInputAssembler=null),t.stateCache.glElementArrayBuffer!==e.glBuffer&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.size,n),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&_.UNIFORM?(e.glTarget=i.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&_.INDIRECT||e.usage&_.TRANSFER_DST||e.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=i.NONE)}(this._device,this._gpuBuffer),this._device.memoryStatus.bufferSize+=this._size;return!0},i.destroy=function(){var t,e;this._gpuBuffer&&(t=this._device,(e=this._gpuBuffer).glBuffer&&(t.gl.deleteBuffer(e.glBuffer),e.glBuffer=null),this._device.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},i.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e,i,r,n,o,s=this._size;s!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(e=this._device,i=this._gpuBuffer,r=e.gl,n=e.stateCache,o=i.memUsage&y.HOST?r.DYNAMIC_DRAW:r.STATIC_DRAW,i.usage&_.VERTEX?(e.useVAO&&n.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=No.gpuInputAssembler=null),e.stateCache.glArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ARRAY_BUFFER,i.buffer,o):r.bufferData(r.ARRAY_BUFFER,i.size,o),r.bindBuffer(r.ARRAY_BUFFER,null),e.stateCache.glArrayBuffer=null):i.usage&_.INDEX?(e.useVAO&&n.glVAO&&(e.OES_vertex_array_object.bindVertexArrayOES(null),n.glVAO=No.gpuInputAssembler=null),e.stateCache.glElementArrayBuffer!==i.glBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glBuffer),i.buffer?r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.buffer,o):r.bufferData(r.ELEMENT_ARRAY_BUFFER,i.size,o),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null),e.stateCache.glElementArrayBuffer=null):i.usage&_.UNIFORM?i.buffer&&(i.vf32=new Float32Array(i.buffer.buffer)):(i.usage&_.INDIRECT||i.usage&_.TRANSFER_DST||i.usage&_.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),i.glTarget=r.NONE),this._device.memoryStatus.bufferSize-=s,this._device.memoryStatus.bufferSize+=t)))}},i.update=function(t,e){var i;this._isBufferView?console.warn("cannot update through buffer views!"):(i=void 0!==e?e:this._usage&_.INDIRECT?0:t.byteLength,ko(this._device,this._gpuBuffer,t,0,i))},Ge(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(o),jo=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new r(e);for(var i=0;i<e;++i)this._frees[i]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,i=this._frees;this._frees=new Array(e);for(var r=e-i.length,n=0;n<r;++n)this._frees[n]=new t;for(var o=r,s=0;o<e;++o,++s)this._frees[o]=i[s];this._freeIdx+=r}var a=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++a.refCount,a},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),qo=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new jo(Po,1),this.bindStatesCmdPool=new jo(Do,1),this.drawCmdPool=new jo(Io,1),this.updateBufferCmdPool=new jo(Bo,1),this.copyBufferToTextureCmdPool=new jo(Lo,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),Ko=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).cmdPackage=new Fo,e._webGLAllocator=null,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new Gt,e._isStateInvalied=!1,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._type=t.type,this._queue=t.queue,this._webGLAllocator=this._device.cmdAllocator;for(var e=this._device.bindingMappingInfo.bufferOffsets.length,i=0;i<e;i++)this._curGPUDescriptorSets.push(null);return!0},i.destroy=function(){this._webGLAllocator&&(this._webGLAllocator.clearCmds(this.cmdPackage),this._webGLAllocator=null)},i.begin=function(){this._webGLAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},i.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},i.beginRenderPass=function(t,e,i,r,n,o){var s=this._webGLAllocator.beginRenderPassCmdPool.alloc(Po);s.gpuRenderPass=t.gpuRenderPass,s.gpuFramebuffer=e.gpuFramebuffer,s.renderArea=i,s.clearColors.length=r.length;for(var a=0;a<r.length;++a)s.clearColors[a]=r[a];s.clearDepth=n,s.clearStencil=o,this.cmdPackage.beginRenderPassCmds.push(s),this.cmdPackage.cmds.push(Co.BEGIN_RENDER_PASS),this._isInRenderPass=!0},i.endRenderPass=function(){this._isInRenderPass=!1},i.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},i.bindDescriptorSet=function(t,e,i){var r=e.gpuDescriptorSet;if(r!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=r,this._isStateInvalied=!0),i){var n,o=null===(n=this._curGPUPipelineState)||void 0===n?void 0:n.gpuPipelineLayout;if(o){for(var s=this._curDynamicOffsets,a=o.dynamicOffsetOffsets[t],l=0;l<i.length;l++)s[a+l]=i[l];this._isStateInvalied=!0}}},i.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},i.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},i.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},i.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},i.setDepthBias=function(t,e,i){var r=this._curDynamicStates;r.depthBiasConstant===t&&r.depthBiasClamp===e&&r.depthBiasSlope===i||(r.depthBiasConstant=t,r.depthBiasClamp=e,r.depthBiasSlope=i,this._isStateInvalied=!0)},i.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},i.setDepthBound=function(t,e){var i=this._curDynamicStates;i.depthMinBounds===t&&i.depthMaxBounds===e||(i.depthMinBounds=t,i.depthMaxBounds=e,this._isStateInvalied=!0)},i.setStencilWriteMask=function(t,e){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&V.FRONT&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0),t&V.BACK&&r.writeMask!==e&&(r.writeMask=e,this._isStateInvalied=!0)},i.setStencilCompareMask=function(t,e,i){var r=this._curDynamicStates.stencilStatesFront,n=this._curDynamicStates.stencilStatesBack;t&V.FRONT&&(r.compareMask===i&&r.reference===e||(r.reference=e,r.compareMask=i,this._isStateInvalied=!0)),t&V.BACK&&(n.compareMask===i&&n.reference===e||(n.reference=e,n.compareMask=i,this._isStateInvalied=!0))},i.draw=function(t){if(this._type===W.PRIMARY&&this._isInRenderPass||this._type===W.SECONDARY){this._isStateInvalied&&this.bindStates();var e=this._webGLAllocator.drawCmdPool.alloc(Io);e.drawInfo.vertexCount=t.vertexCount,e.drawInfo.firstVertex=t.firstVertex,e.drawInfo.indexCount=t.indexCount,e.drawInfo.firstIndex=t.firstIndex,e.drawInfo.vertexOffset=t.vertexOffset,e.drawInfo.instanceCount=t.instanceCount,e.drawInfo.firstInstance=t.firstInstance,this.cmdPackage.drawCmds.push(e),this.cmdPackage.cmds.push(Co.DRAW),++this._numDrawCalls,this._numInstances+=t.instanceCount;var i=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._type===W.PRIMARY&&!this._isInRenderPass||this._type===W.SECONDARY){var r=t.gpuBuffer;if(r){var n,o=this._webGLAllocator.updateBufferCmdPool.alloc(Bo),s=0;t.usage&_.INDIRECT||(s=void 0!==i?i:e.byteLength),n=e,o.gpuBuffer=r,o.buffer=n,o.offset=0,o.size=s,this.cmdPackage.updateBufferCmds.push(o),this.cmdPackage.cmds.push(Co.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},i.copyBuffersToTexture=function(t,e,i){if(this._type===W.PRIMARY&&!this._isInRenderPass||this._type===W.SECONDARY){var r=e.gpuTexture;if(r){var n=this._webGLAllocator.copyBufferToTextureCmdPool.alloc(Lo);n&&(n.gpuTexture=r,n.regions=i,n.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(n),this.cmdPackage.cmds.push(Co.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},i.execute=function(t,e){for(var i=0;i<e;++i){for(var r=t[i],n=0;n<r.cmdPackage.beginRenderPassCmds.length;++n){var o=r.cmdPackage.beginRenderPassCmds.array[n];++o.refCount,this.cmdPackage.beginRenderPassCmds.push(o)}for(var s=0;s<r.cmdPackage.bindStatesCmds.length;++s){var a=r.cmdPackage.bindStatesCmds.array[s];++a.refCount,this.cmdPackage.bindStatesCmds.push(a)}for(var l=0;l<r.cmdPackage.drawCmds.length;++l){var h=r.cmdPackage.drawCmds.array[l];++h.refCount,this.cmdPackage.drawCmds.push(h)}for(var u=0;u<r.cmdPackage.updateBufferCmds.length;++u){var c=r.cmdPackage.updateBufferCmds.array[u];++c.refCount,this.cmdPackage.updateBufferCmds.push(c)}for(var d=0;d<r.cmdPackage.copyBufferToTextureCmds.length;++d){var p=r.cmdPackage.copyBufferToTextureCmds.array[d];++p.refCount,this.cmdPackage.copyBufferToTextureCmds.push(p)}this.cmdPackage.cmds.concat(r.cmdPackage.cmds.array),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.pipelineBarrier=function(){},i.bindStates=function(){var t=this._webGLAllocator.bindStatesCmdPool.alloc(Do);t&&(t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(Co.BIND_STATES),this._isStateInvalied=!1)},Ge(e,[{key:"webGLDevice",get:function(){return this._device}}]),e}(s),Zo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuFramebuffer=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=[],i=0;i<t.colorTextures.length;++i){var r=t.colorTextures[i];r&&e.push(r.gpuTexture)}var n=null;return t.depthStencilTexture&&(n=t.depthStencilTexture.gpuTexture),this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:e,gpuDepthStencilTexture:n,glFramebuffer:null},function(t,e){if(e.gpuColorTextures.length||e.gpuDepthStencilTexture){var i=t.gl,r=[],n=i.createFramebuffer();if(n){e.glFramebuffer=n,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorTextures.length;++o){var s=e.gpuColorTextures[o];s&&(s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,s.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o))}var a=e.gpuDepthStencilTexture;if(a){var l=jt[a.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;a.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,a.glTarget,a.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,a.glRenderbuffer)}t.WEBGL_draw_buffers&&t.WEBGL_draw_buffers.drawBuffersWEBGL(r);var h=i.checkFramebufferStatus(i.FRAMEBUFFER);if(h!==i.FRAMEBUFFER_COMPLETE)switch(h){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}}(this._device,this._gpuFramebuffer),!0},i.destroy=function(){var t,e;this._gpuFramebuffer&&(t=this._device,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),e.glFramebuffer=null),this._gpuFramebuffer=null)},Ge(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(ne),Jo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuInputAssembler=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){if(0===t.vertexBuffers.length)return console.error("InputAssemblerInfo.vertexBuffers is null."),!1;if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._firstIndex=0;else{var e=this._vertexBuffers[0];this._vertexCount=e.size/e.stride,this._firstVertex=0,this._vertexOffset=0}this._instanceCount=0,this._firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var i=new Array(t.vertexBuffers.length),r=0;r<t.vertexBuffers.length;++r){var n=t.vertexBuffers[r];n.gpuBuffer&&(i[r]=n.gpuBuffer)}var o=null,s=0;if(t.indexBuffer&&(o=t.indexBuffer.gpuBuffer))switch(o.stride){case 1:s=5121;break;case 2:s=5123;break;case 4:s=5125;break;default:console.error("Error index buffer stride.")}var a=null;return t.indirectBuffer&&(a=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:i,gpuIndexBuffer:o,gpuIndirectBuffer:a,glAttribs:[],glIndexType:s,glVAOs:new Map},function(t,e){var i=t.gl;e.glAttribs=new Array(e.attributes.length);for(var r=[0,0,0,0,0,0,0,0],n=0;n<e.attributes.length;++n){var o=e.attributes[n],s=void 0!==o.stream?o.stream:0,a=e.gpuVertexBuffers[s],l=yo(o.format,i),h=jt[o.format].size;e.glAttribs[n]={name:o.name,glBuffer:a.glBuffer,glType:l,size:h,count:jt[o.format].count,stride:a.stride,componentCount:Ao(l,i),isNormalized:void 0!==o.isNormalized&&o.isNormalized,isInstanced:void 0!==o.isInstanced&&o.isInstanced,offset:r[s]},r[s]+=h}}(this._device,this._gpuInputAssembler),!0},i.destroy=function(){var t=this._device;this._gpuInputAssembler&&t.useVAO&&function(t,e){for(var i=e.glVAOs.values(),r=i.next();!r.done;)t.OES_vertex_array_object.deleteVertexArrayOES(r.value),r=i.next();e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Ge(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(oe),Qo=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuDescriptorSetLayout=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,i=-1,r=[],n=0;n<this._bindings.length;n++){var o=this._bindings[n];r.push(e),e+=o.count,o.binding>i&&(i=o.binding)}this._bindingIndices=Array(i+1).fill(-1);for(var s=this._descriptorIndices=Array(i+1).fill(-1),a=0;a<this._bindings.length;a++){var l=this._bindings[a];this._bindingIndices[l.binding]=a,s[l.binding]=r[a]}for(var h=[],u=0;u<this._bindings.length;u++){var c=this._bindings[u];if(c.descriptorType&Zt)for(var d=0;d<c.count;d++)h.push(c.binding)}return this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:h,descriptorIndices:s,descriptorCount:e},!0},i.destroy=function(){this._bindings.length=0},Ge(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(se),$o=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineLayout=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],i=[],r=0,n=[],o=0;o<this._setLayouts.length;o++){for(var s=this._setLayouts[o],a=s.gpuDescriptorSetLayout.dynamicBindings,l=Array(s.bindingIndices.length).fill(-1),h=0;h<a.length;h++){var u=a[h];l[u]<0&&(l[u]=r+h)}i.push(s.gpuDescriptorSetLayout),e.push(l),n.push(r),r+=a.length}return this._gpuPipelineLayout={gpuSetLayouts:i,dynamicOffsetIndices:e,dynamicOffsetCount:r,dynamicOffsetOffsets:n},!0},i.destroy=function(){this._setLayouts.length=0},Ge(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(ae),ts=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],es=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuPipelineState=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var i=t.blendState,r=i.targets;r&&r.forEach((function(t,i){e.setTarget(i,t)})),void 0!==i.isA2C&&(e.isA2C=i.isA2C),void 0!==i.isIndepend&&(e.isIndepend=i.isIndepend),void 0!==i.blendColor&&(e.blendColor=i.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var n=[],o=0;o<31;o++)this._dynamicStates&1<<o&&n.push(1<<o);return this._gpuPipelineState={glPrimitive:ts[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:n},!0},i.destroy=function(){this._gpuPipelineState=null},Ge(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(pe),is=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.beginRenderPass=function(t,e,i,r,n,o){zo(this._device,t.gpuRenderPass,e.gpuFramebuffer,i,r,n,o),this._isInRenderPass=!0},i.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates(),Vo(this._device,t),++this._numDrawCalls,this._numInstances+=t.instanceCount;var e=t.indexCount||t.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=e/3*Math.max(t.instanceCount,1);break;case 5:case 6:this._numTris+=(e-2)*Math.max(t.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},i.updateBuffer=function(t,e,i){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var r,n=t.gpuBuffer;n&&(r=void 0!==i?i:t.usage&_.INDIRECT?0:e.byteLength,ko(this._device,n,e,0,r))}},i.copyBuffersToTexture=function(t,e,i){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var r=e.gpuTexture;r&&Wo(this._device,t,r,i)}},i.execute=function(t,e){for(var i=0;i<e;++i){var r=t[i];Go(this._device,r.cmdPackage),this._numDrawCalls+=r._numDrawCalls,this._numInstances+=r._numInstances,this._numTris+=r._numTris}},i.bindStates=function(){Uo(this._device,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(Ko),rs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}He(e,t);var i=e.prototype;return i.initialize=function(t){return this._type=t.type,!0},i.destroy=function(){},i.submit=function(t){if(!this._isAsync)for(var e=t.length,i=0;i<e;i++){var r=t[i];this.numDrawCalls+=r.numDrawCalls,this.numInstances+=r.numInstances,this.numTris+=r.numTris}},i.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(fe),ns=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuRenderPass=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){return this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,t.subpasses&&(this._subpasses=t.subpasses),this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash(),!0},i.destroy=function(){this._gpuRenderPass=null},Ge(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(_e),os=[10497,33648,33071,33071],ss=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuSampler=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._minFilter=t.minFilter,this._magFilter=t.magFilter,this._mipFilter=t.mipFilter,this._addressU=t.addressU,this._addressV=t.addressV,this._addressW=t.addressW,this._maxAnisotropy=t.maxAnisotropy,this._cmpFunc=t.cmpFunc,this._borderColor=t.borderColor,this._mipLODBias=t.mipLODBias;var e,i,r=this._minFilter,n=this._magFilter,o=this._mipFilter;e=r===E.LINEAR||r===E.ANISOTROPIC?o===E.LINEAR||o===E.ANISOTROPIC?9987:o===E.POINT?9985:9729:o===E.LINEAR||o===E.ANISOTROPIC?9986:o===E.POINT?9984:9728,i=n===E.LINEAR||n===E.ANISOTROPIC?9729:9728;var s=os[this._addressU],a=os[this._addressV],l=os[this._addressW];return this._gpuSampler={glMinFilter:e,glMagFilter:i,glWrapS:s,glWrapT:a,glWrapR:l},!0},i.destroy=function(){this._gpuSampler=null},Ge(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(ge),as=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuShader=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks,samplerTextures:t.samplerTextures,gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var i=t.stages[e];this._gpuShader.gpuStages[e]={type:i.stage,source:i.source,glShader:null}}return function(t,e){for(var i=t.gl,r=function(t){var r=e.gpuStages[t],n=0,o="",s=1;switch(r.type){case O.VERTEX:o="VertexShader",n=i.VERTEX_SHADER;break;case O.FRAGMENT:o="FragmentShader",n=i.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var a=i.createShader(n);if(a&&(r.glShader=a,i.shaderSource(r.glShader,r.source),i.compileShader(r.glShader),!i.getShaderParameter(r.glShader,i.COMPILE_STATUS))){console.error(o+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",r.source.replace(/^|\n/g,(function(){return"\n"+s+++" "}))),console.error(i.getShaderInfoLog(r.glShader));for(var l=0;l<e.gpuStages.length;l++){var h=e.gpuStages[t];h.glShader&&(i.deleteShader(h.glShader),h.glShader=null)}return{v:void 0}}},n=0;n<e.gpuStages.length;n++){var o=r(n);if("object"==typeof o)return o.v}var s=i.createProgram();if(s){e.glProgram=s;for(var a=0;a<e.gpuStages.length;a++){var l=e.gpuStages[a];i.attachShader(e.glProgram,l.glShader)}if(i.linkProgram(e.glProgram),t.destroyShadersImmediately)for(var h=0;h<e.gpuStages.length;h++){var u=e.gpuStages[h];u.glShader&&(i.detachShader(e.glProgram,u.glShader),i.deleteShader(u.glShader),u.glShader=null)}if(!i.getProgramParameter(e.glProgram,i.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(i.getProgramInfoLog(e.glProgram));Xe("Shader '"+e.name+"' compilation succeeded.");var c=i.getProgramParameter(e.glProgram,i.ACTIVE_ATTRIBUTES);e.glInputs=new Array(c);for(var d=0;d<c;++d){var p=i.getActiveAttrib(e.glProgram,d);if(p){var f,_=p.name.indexOf("[");f=-1!==_?p.name.substr(0,_):p.name;var g=i.getAttribLocation(e.glProgram,f),m=To(p.type,i),y=Eo(p.type,i);e.glInputs[d]={binding:g,name:f,type:m,stride:y,count:p.size,size:y*p.size,glType:p.type,glLoc:g}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var v=0;v<e.blocks.length;++v){var b=e.blocks[v],S={set:b.set,binding:b.binding,name:b.name,size:0,glUniforms:new Array(b.members.length),glActiveUniforms:[]};e.glBlocks[v]=S;for(var T=0;T<b.members.length;++T){var E=b.members[T],A=bo(E.type,i),C=Eo(A,i),w=C*E.count;S.glUniforms[T]={binding:-1,name:E.name,type:E.type,stride:C,count:E.count,size:w,offset:0,glType:A,glLoc:-1,array:null}}}}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var x=0;x<e.samplerTextures.length;++x){var R=e.samplerTextures[x];e.glSamplerTextures[x]={set:R.set,binding:R.binding,name:R.name,type:R.type,count:R.count,units:[],glUnits:null,glType:bo(R.type,i),glLoc:null}}}for(var M=i.getProgramParameter(e.glProgram,i.ACTIVE_UNIFORMS),P=0;P<M;++P){var D=i.getActiveUniform(e.glProgram,P);if(D&&D.type!==i.SAMPLER_2D&&D.type!==i.SAMPLER_CUBE){var I=i.getUniformLocation(e.glProgram,D.name);if(null!==I&&("number"==typeof I||-1!==I.id)){var B,L=D.name.indexOf("[");B=-1!==L?D.name.substr(0,L):D.name;for(var F=0;F<e.glBlocks.length;F++)for(var k=e.glBlocks[F],N=0;N<k.glUniforms.length;N++){var z=k.glUniforms[N];if(z.name===B){z.glLoc=I,z.count=D.size,z.size=z.stride*z.count,z.array=new(So(z.type))(z.size/4),k.glActiveUniforms.push(z);break}}}}}for(var U=0;U<e.glBlocks.length;U++)for(var V=e.glBlocks[U],H=0;H<V.glUniforms.length;H++){var G=V.glUniforms[H];G.offset=V.size/4,V.size+=G.size}for(var W=[],X=[],Y=t.bindingMappingInfo,j=t.stateCache.texUnitCacheMap,q=0,K=0;K<e.blocks.length;++K)e.blocks[K].set===Y.flexibleSet&&q++;for(var Z=0,J=0;J<e.samplerTextures.length;++J){var Q=e.samplerTextures[J],$=i.getUniformLocation(e.glProgram,Q.name);if(null===$||"number"!=typeof $&&-1===$.id||(W.push(e.glSamplerTextures[J]),X.push($)),void 0===j[Q.name]){var tt=Q.binding+Y.samplerOffsets[Q.set]+Z;Q.set===Y.flexibleSet&&(tt-=q),j[Q.name]=tt%t.capabilities.maxTextureUnits,Z+=Q.count-1}}if(W.length){for(var et=[],it=0;it<W.length;++it){var rt=W[it],nt=j[rt.name];if(void 0!==nt){rt.glLoc=X[it];for(var ot=0;ot<rt.count;++ot){for(;et[nt];)nt=(nt+1)%t.capabilities.maxTextureUnits;rt.units.push(nt),et[nt]=!0}}}for(var st=0,at=0;at<W.length;++at){var lt=W[at];if(!lt.glLoc){lt.glLoc=X[at];for(var ht=0;ht<lt.count;++ht){for(;et[st];)st=(st+1)%t.capabilities.maxTextureUnits;void 0===j[lt.name]&&(j[lt.name]=st),lt.units.push(st),et[st]=!0}}}t.stateCache.glProgram!==e.glProgram&&i.useProgram(e.glProgram);for(var ut=0;ut<W.length;ut++){var ct=W[ut];ct.glUnits=new Int32Array(ct.units),i.uniform1iv(ct.glLoc,ct.glUnits)}t.stateCache.glProgram!==e.glProgram&&i.useProgram(t.stateCache.glProgram)}for(var dt=0;dt<e.glBlocks.length;)e.glBlocks[dt].glActiveUniforms.length?dt++:(e.glBlocks[dt]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplerTextures=W}}(this._device,this._gpuShader),!0},i.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var i=t.gl;if(!t.destroyShadersImmediately)for(var r=0;r<e.gpuStages.length;r++){var n=e.gpuStages[r];n.glShader&&(i.detachShader(e.glProgram,n.glShader),i.deleteShader(n.glShader),n.glShader=null)}i.deleteProgram(e.glProgram),e.glProgram=null}}(this._device,this._gpuShader),this._gpuShader=null)},Ge(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(me),ls=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new it,this.scissorRect=new K(0,0,0,0),this.rs=new le,this.dss=new he,this.bs=new ce,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var i=0;i<t;++i)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),hs=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._gpuTexture=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){return"texture"in t?(console.log("WebGL does not support texture view."),!1):(this._type=t.type,this._usage=t.usage,this._format=t.format,this._width=t.width,this._height=t.height,this._depth=t.depth,this._layerCount=t.layerCount,this._levelCount=t.levelCount,this._samples=t.samples,this._flags=t.flags,this._isPowerOf2=Qt(this._width)&&Qt(this._height),this._size=te(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture={type:this._type,format:this._format,usage:this._usage,width:this._width,height:this._height,depth:this._depth,size:this._size,arrayLayer:this._layerCount,mipLevel:this._levelCount,samples:this._samples,flags:this._flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0},function(t,e){var i=t.gl;e.glFormat=e.glInternalFmt=vo(e.format,i),e.glType=yo(e.format,i);var r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var o=Math.max(r,n);if(o>t.capabilities.maxTextureSize&&We(9100,o,t.capabilities.maxTextureSize),!t.WEBGL_depth_texture&&jt[e.format].hasDepth){e.glInternalFmt=function(t,e){switch(t){case d.R5G6B5:return e.RGB565;case d.RGB5A1:return e.RGB5_A1;case d.RGBA4:return e.RGBA4;case d.RGBA16F:return go.RGBA16F_EXT;case d.RGBA32F:return go.RGBA32F_EXT;case d.SRGB8_A8:return go.SRGB8_ALPHA8_EXT;case d.D16:return e.DEPTH_COMPONENT16;case d.D16S8:return e.DEPTH_STENCIL;case d.D24:return e.DEPTH_COMPONENT16;case d.D24S8:return e.DEPTH_STENCIL;case d.D32F:return e.DEPTH_COMPONENT16;case d.D32F_S8:return e.DEPTH_STENCIL;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,i);var s=i.createRenderbuffer();s&&e.size>0&&(e.glRenderbuffer=s,t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n))}else{var a=i.createTexture();if(a&&e.size>0){e.glTexture=a;var l=t.stateCache.glTexUnits[t.stateCache.texUnit];if(l.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),l.glTexture=e.glTexture),jt[e.format].isCompressed)if(e.glInternalFmt!==go.COMPRESSED_RGB_ETC1_WEBGL)for(var h=0;h<e.mipLevel;++h){var u=$t(e.format,r,n,1),c=new Uint8Array(u);i.compressedTexImage2D(i.TEXTURE_2D,h,e.glInternalFmt,r,n,0,c),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}else{var p=$t(e.format,2,2,1),f=new Uint8Array(p);i.compressedTexImage2D(i.TEXTURE_2D,0,e.glInternalFmt,2,2,0,f)}else for(var _=0;_<e.mipLevel;++_)i.texImage2D(i.TEXTURE_2D,_,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1);e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}else i.deleteTexture(a)}break;case v.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var g=Math.max(r,n);g>t.capabilities.maxCubeMapTextureSize&&We(9100,g,t.capabilities.maxTextureSize);var m=i.createTexture();if(m&&e.size>0){e.glTexture=m;var y=t.stateCache.glTexUnits[t.stateCache.texUnit];if(y.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),y.glTexture=e.glTexture),jt[e.format].isCompressed)if(e.glInternalFmt!==go.COMPRESSED_RGB_ETC1_WEBGL)for(var b=0;b<6;++b){r=e.width,n=e.height;for(var S=0;S<e.mipLevel;++S){var T=$t(e.format,r,n,1),E=new Uint8Array(T);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+b,S,e.glInternalFmt,r,n,0,E),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var A=0;A<6;++A){var C=$t(e.format,2,2,1),w=new Uint8Array(C);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+A,0,e.glInternalFmt,2,2,0,w)}else for(var x=0;x<6;++x){r=e.width,n=e.height;for(var R=0;R<e.mipLevel;++R)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+x,R,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}e.isPowerOf2?(e.glWrapS=i.REPEAT,e.glWrapT=i.REPEAT):(e.glWrapS=i.CLAMP_TO_EDGE,e.glWrapT=i.CLAMP_TO_EDGE),e.glMinFilter=i.LINEAR,e.glMagFilter=i.LINEAR,i.texParameteri(e.glTarget,i.TEXTURE_WRAP_S,e.glWrapS),i.texParameteri(e.glTarget,i.TEXTURE_WRAP_T,e.glWrapT),i.texParameteri(e.glTarget,i.TEXTURE_MIN_FILTER,e.glMinFilter),i.texParameteri(e.glTarget,i.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize+=this._size,!0)},i.destroy=function(){var t,e;this._gpuTexture&&(t=this._device,(e=this._gpuTexture).glTexture&&(t.gl.deleteTexture(e.glTexture),e.glTexture=null),e.glRenderbuffer&&(t.gl.deleteRenderbuffer(e.glRenderbuffer),e.glRenderbuffer=null),this._device.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},i.resize=function(t,e){var i=this._size;this._width=t,this._height=e,this._size=te(this._format,this.width,this.height,this.depth,this._levelCount)*this._layerCount,this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=e,this._gpuTexture.size=this._size,function(t,e){var i=t.gl,r=e.width,n=e.height;switch(e.type){case v.TEX2D:e.glTarget=i.TEXTURE_2D;var o=Math.max(r,n);if(o>t.capabilities.maxTextureSize&&We(9100,o,t.capabilities.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),i.renderbufferStorage(i.RENDERBUFFER,e.glInternalFmt,r,n);else if(e.glTexture){var s=t.stateCache.glTexUnits[t.stateCache.texUnit];if(s.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_2D,e.glTexture),s.glTexture=e.glTexture),jt[e.format].isCompressed){if(e.glInternalFmt!==go.COMPRESSED_RGB_ETC1_WEBGL)for(var a=0;a<e.mipLevel;++a){var l=$t(e.format,r,n,1),h=new Uint8Array(l);i.compressedTexImage2D(i.TEXTURE_2D,a,e.glInternalFmt,r,n,0,h),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}else for(var u=0;u<e.mipLevel;++u)i.texImage2D(i.TEXTURE_2D,u,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;case v.CUBE:e.glTarget=i.TEXTURE_CUBE_MAP;var c=Math.max(r,n);c>t.capabilities.maxCubeMapTextureSize&&We(9100,c,t.capabilities.maxTextureSize);var d=t.stateCache.glTexUnits[t.stateCache.texUnit];if(d.glTexture!==e.glTexture&&(i.bindTexture(i.TEXTURE_CUBE_MAP,e.glTexture),d.glTexture=e.glTexture),jt[e.format].isCompressed){if(e.glInternalFmt!==go.COMPRESSED_RGB_ETC1_WEBGL)for(var p=0;p<6;++p){r=e.width,n=e.height;for(var f=0;f<e.mipLevel;++f){var _=$t(e.format,r,n,1),g=new Uint8Array(_);i.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+p,f,e.glInternalFmt,r,n,0,g),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}}}else for(var m=0;m<6;++m){r=e.width,n=e.height;for(var y=0;y<e.mipLevel;++y)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+m,y,e.glInternalFmt,r,n,0,e.glFormat,e.glType,null),r=Math.max(1,r>>1),n=Math.max(1,n>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=v.TEX2D,e.glTarget=i.TEXTURE_2D}}(this._device,this._gpuTexture),this._device.memoryStatus.textureSize-=i,this._device.memoryStatus.textureSize+=this._size)},Ge(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}}]),e}(ye),us="webglcontextlost",cs=t("WebGLDevice",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).stateCache=new ls,e.cmdAllocator=new qo,e.nullTex2D=null,e.nullTexCube=null,e._webGLRC=null,e._isAntialias=!0,e._isPremultipliedAlpha=!0,e._useVAO=!1,e._destroyShadersImmediately=!0,e._noCompressedTexSubImage2D=!1,e._bindingMappingInfo=new nt,e._webGLContextLostHandler=null,e._extensions=null,e._EXT_texture_filter_anisotropic=null,e._EXT_blend_minmax=null,e._EXT_frag_depth=null,e._EXT_shader_texture_lod=null,e._EXT_sRGB=null,e._OES_vertex_array_object=null,e._EXT_color_buffer_half_float=null,e._WEBGL_color_buffer_float=null,e._WEBGL_compressed_texture_etc1=null,e._WEBGL_compressed_texture_etc=null,e._WEBGL_compressed_texture_pvrtc=null,e._WEBGL_compressed_texture_astc=null,e._WEBGL_compressed_texture_s3tc=null,e._WEBGL_compressed_texture_s3tc_srgb=null,e._WEBGL_debug_shaders=null,e._WEBGL_draw_buffers=null,e._WEBGL_lose_context=null,e._WEBGL_depth_texture=null,e._WEBGL_debug_renderer_info=null,e._OES_texture_half_float=null,e._OES_texture_half_float_linear=null,e._OES_texture_float=null,e._OES_texture_float_linear=null,e._OES_standard_derivatives=null,e._OES_element_index_uint=null,e._ANGLE_instanced_arrays=null,e}He(e,t);var i=e.prototype;return i.initialize=function(t){this._canvas=t.canvasElm,this._isAntialias=t.isAntialias,this._isPremultipliedAlpha=t.isPremultipliedAlpha,this._bindingMappingInfo=t.bindingMappingInfo,this._bindingMappingInfo.bufferOffsets.length||this._bindingMappingInfo.bufferOffsets.push(0),this._bindingMappingInfo.samplerOffsets.length||this._bindingMappingInfo.samplerOffsets.push(0);try{var e={alpha:je.ENABLE_TRANSPARENT_CANVAS,antialias:this._isAntialias,depth:!0,stencil:!0,premultipliedAlpha:this._isPremultipliedAlpha,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};this._webGLRC=this._canvas.getContext("webgl",e)}catch(t){return console.error(t),!1}if(!this._webGLRC)return console.error("This device does not support WebGL."),!1;this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(us,this._onWebGLContextLost),this._canvas2D=document.createElement("canvas"),console.info("WebGL device initialized."),this._gfxAPI=h.WEBGL,this._deviceName="WebGL";var i=this._webGLRC;this._WEBGL_debug_renderer_info=this.getExtension("WEBGL_debug_renderer_info"),this._WEBGL_debug_renderer_info?(this._renderer=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=i.getParameter(this._WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=i.getParameter(i.RENDERER),this._vendor=i.getParameter(i.VENDOR)),this._version=i.getParameter(i.VERSION),this._caps.maxVertexAttributes=i.getParameter(i.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.depthBits=i.getParameter(i.DEPTH_BITS),this._caps.stencilBits=i.getParameter(i.STENCIL_BITS),this.stateCache.initialize(this._caps.maxTextureUnits,this._caps.maxVertexAttributes),this._devicePixelRatio=t.devicePixelRatio||1,this._width=t.width,this._height=t.height,this._colorFmt=d.RGBA8,24===this._caps.depthBits?8===this._caps.stencilBits?this._depthStencilFmt=d.D24S8:this._depthStencilFmt=d.D24:8===this._caps.stencilBits?this._depthStencilFmt=d.D16S8:this._depthStencilFmt=d.D16,this._extensions=i.getSupportedExtensions();var r="";if(this._extensions){for(var n,o=qe(this._extensions);!(n=o()).done;)r+=n.value+" ";Xe("EXTENSIONS: "+r)}this._EXT_texture_filter_anisotropic=this.getExtension("EXT_texture_filter_anisotropic"),this._EXT_blend_minmax=this.getExtension("EXT_blend_minmax"),this._EXT_frag_depth=this.getExtension("EXT_frag_depth"),this._EXT_shader_texture_lod=this.getExtension("EXT_shader_texture_lod"),this._EXT_sRGB=this.getExtension("EXT_sRGB"),this._OES_vertex_array_object=this.getExtension("OES_vertex_array_object"),this._EXT_color_buffer_half_float=this.getExtension("EXT_color_buffer_half_float"),this._WEBGL_color_buffer_float=this.getExtension("WEBGL_color_buffer_float"),this._WEBGL_compressed_texture_etc1=this.getExtension("WEBGL_compressed_texture_etc1"),this._WEBGL_compressed_texture_etc=this.getExtension("WEBGL_compressed_texture_etc"),this._WEBGL_compressed_texture_pvrtc=this.getExtension("WEBGL_compressed_texture_pvrtc"),this._WEBGL_compressed_texture_s3tc=this.getExtension("WEBGL_compressed_texture_s3tc"),this._WEBGL_compressed_texture_s3tc_srgb=this.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this._WEBGL_debug_shaders=this.getExtension("WEBGL_debug_shaders"),this._WEBGL_draw_buffers=this.getExtension("WEBGL_draw_buffers"),this._WEBGL_lose_context=this.getExtension("WEBGL_lose_context"),this._WEBGL_depth_texture=this.getExtension("WEBGL_depth_texture"),this._OES_texture_half_float=this.getExtension("OES_texture_half_float"),this._OES_texture_half_float_linear=this.getExtension("OES_texture_half_float_linear"),this._OES_texture_float=this.getExtension("OES_texture_float"),this._OES_texture_float_linear=this.getExtension("OES_texture_float_linear"),this._OES_standard_derivatives=this.getExtension("OES_standard_derivatives"),this._OES_element_index_uint=this.getExtension("OES_element_index_uint"),this._ANGLE_instanced_arrays=this.getExtension("ANGLE_instanced_arrays"),Ke.os===Ze.IOS&&14===Ke.osMainVersion&&Ke.isBrowser||(this._WEBGL_compressed_texture_astc=this.getExtension("WEBGL_compressed_texture_astc")),Ke.browserType===Je.UC&&(this._ANGLE_instanced_arrays=null),(Ke.os===Ze.IOS&&Ke.osMainVersion<=10||Qe)&&(this._destroyShadersImmediately=!1),this._features.fill(!1),this._EXT_sRGB&&(this._features[c.FORMAT_SRGB]=!0),this._EXT_blend_minmax&&(this._features[c.BLEND_MINMAX]=!0),this._WEBGL_color_buffer_float&&(this._features[c.COLOR_FLOAT]=!0),this._EXT_color_buffer_half_float&&(this._features[c.COLOR_HALF_FLOAT]=!0),this._OES_texture_float&&(this._features[c.TEXTURE_FLOAT]=!0),this._OES_texture_half_float&&(this._features[c.TEXTURE_HALF_FLOAT]=!0),this._OES_texture_float_linear&&(this._features[c.TEXTURE_FLOAT_LINEAR]=!0),this._OES_texture_half_float_linear&&(this._features[c.TEXTURE_HALF_FLOAT_LINEAR]=!0),this._features[c.FORMAT_RGB8]=!0,this._OES_element_index_uint&&(this._features[c.ELEMENT_INDEX_UINT]=!0),this._ANGLE_instanced_arrays&&(this._features[c.INSTANCED_ARRAYS]=!0),this._WEBGL_draw_buffers&&(this._features[c.MULTIPLE_RENDER_TARGETS]=!0);var s="";this._WEBGL_compressed_texture_etc1&&(this._features[c.FORMAT_ETC1]=!0,s+="etc1 "),this._WEBGL_compressed_texture_etc&&(this._features[c.FORMAT_ETC2]=!0,s+="etc2 "),this._WEBGL_compressed_texture_s3tc&&(this._features[c.FORMAT_DXT]=!0,s+="dxt "),this._WEBGL_compressed_texture_pvrtc&&(this._features[c.FORMAT_PVRTC]=!0,s+="pvrtc "),this._WEBGL_compressed_texture_astc&&(this._features[c.FORMAT_ASTC]=!0,s+="astc "),this._OES_vertex_array_object&&(this._useVAO=!0),Xe("RENDERER: "+this._renderer),Xe("VENDOR: "+this._vendor),Xe("VERSION: "+this._version),Xe("DPR: "+this._devicePixelRatio),Xe("SCREEN_SIZE: "+this._width+" x "+this._height),Xe("MAX_VERTEX_UNIFORM_VECTORS: "+this._caps.maxVertexUniformVectors),Xe("DEPTH_BITS: "+this._caps.depthBits),Xe("STENCIL_BITS: "+this._caps.stencilBits),this._EXT_texture_filter_anisotropic&&Xe("MAX_TEXTURE_MAX_ANISOTROPY_EXT: "+this._EXT_texture_filter_anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT),Xe("USE_VAO: "+this._useVAO),Xe("COMPRESSED_FORMAT: "+s),this.initStates(i),this._queue=this.createQueue(new zt(G.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Nt(this._queue)),this.nullTex2D=this.createTexture(new ut(v.TEX2D,b.SAMPLED,d.RGBA8,2,2,S.GEN_MIPMAP)),this.nullTexCube=this.createTexture(new ut(v.CUBE,b.SAMPLED,d.RGBA8,2,2,S.GEN_MIPMAP,6));var a=new et;a.texExtent.width=2,a.texExtent.height=2;var l=new Uint8Array(this.nullTex2D.size);return l.fill(0),this.copyBuffersToTexture([l],this.nullTex2D,[a]),a.texSubres.layerCount=6,this.copyBuffersToTexture([l,l,l,l,l,l],this.nullTexCube,[a]),!0},i.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(us,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null),this._extensions=null,this._webGLRC=null},i.resize=function(t,e){this._width===t&&this._height===e||(Xe("Resizing device: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._width=t,this._height=e)},i.flushCommands=function(){},i.acquire=function(){this.cmdAllocator.releaseCmds()},i.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},i.createCommandBuffer=function(t){var e=new(t.type===W.PRIMARY?is:Ko)(this);return e.initialize(t)?e:null},i.createBuffer=function(t){var e=new Yo(this);return e.initialize(t)?e:null},i.createTexture=function(t){var e=new hs(this);return e.initialize(t)?e:null},i.createSampler=function(t){var e=new ss(this);return e.initialize(t)?e:null},i.createDescriptorSet=function(t){var e=new mo(this);return e.initialize(t)?e:null},i.createShader=function(t){var e=new as(this);return e.initialize(t)?e:null},i.createInputAssembler=function(t){var e=new Jo(this);return e.initialize(t)?e:null},i.createRenderPass=function(t){var e=new ns(this);return e.initialize(t)?e:null},i.createFramebuffer=function(t){var e=new Zo(this);return e.initialize(t)?e:null},i.createDescriptorSetLayout=function(t){var e=new Qo(this);return e.initialize(t)?e:null},i.createPipelineLayout=function(t){var e=new $o(this);return e.initialize(t)?e:null},i.createPipelineState=function(t){var e=new es(this);return e.initialize(t)?e:null},i.createQueue=function(t){var e=new rs(this);return e.initialize(t)?e:null},i.createGlobalBarrier=function(t){var e=new ve(this);return e.initialize(t)?e:null},i.createTextureBarrier=function(t){var e=new be(this);return e.initialize(t)?e:null},i.copyBuffersToTexture=function(t,e,i){Wo(this,t,e.gpuTexture,i)},i.copyTextureToBuffers=function(t,e,i){!function(t,e,i,r){var n=t.gl,o=t.stateCache,s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s);var a=0,l=0,h=1,u=1;switch(e.glTarget){case n.TEXTURE_2D:for(var c=0;c<r.length;c++){var d=r[c];n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,d.texSubres.mipLevel),a=d.texOffset.x,l=d.texOffset.y,h=d.texExtent.width,u=d.texExtent.height,n.readPixels(a,l,h,u,e.glFormat,e.glType,i[c])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}n.bindFramebuffer(n.FRAMEBUFFER,null),o.glFramebuffer=null,n.deleteFramebuffer(s)}(this,t.gpuTexture,e,i)},i.copyTexImagesToTexture=function(t,e,i){!function(t,e,i,r){var n=t.gl,o=t.stateCache.glTexUnits[t.stateCache.texUnit];o.glTexture!==i.glTexture&&(n.bindTexture(i.glTarget,i.glTexture),o.glTexture=i.glTexture);var s=0,a=0;switch(i.glTarget){case n.TEXTURE_2D:for(var l=0;l<r.length;l++){var h=r[l];n.texSubImage2D(n.TEXTURE_2D,h.texSubres.mipLevel,h.texOffset.x,h.texOffset.y,i.glFormat,i.glType,e[s++])}break;case n.TEXTURE_CUBE_MAP:for(var u=0;u<r.length;u++){var c=r[u],d=c.texSubres.baseArrayLayer+c.texSubres.layerCount;for(a=c.texSubres.baseArrayLayer;a<d;++a)n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+a,c.texSubres.mipLevel,c.texOffset.x,c.texOffset.y,i.glFormat,i.glType,e[s++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}i.flags&S.GEN_MIPMAP&&i.isPowerOf2&&n.generateMipmap(i.glTarget)}(this,t,e.gpuTexture,i)},i.copyFramebufferToBuffer=function(t,e,i){var r=this._webGLRC,n=t.gpuFramebuffer,o=n.gpuColorTextures[0].format,s=vo(o,r),a=yo(o,r),l=ie(jt[o]),h=this.stateCache.glFramebuffer;this.stateCache.glFramebuffer!==n.glFramebuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,n.glFramebuffer),this.stateCache.glFramebuffer=n.glFramebuffer);for(var u,c=new l(e),d=qe(i);!(u=d()).done;){var p=u.value,f=p.texExtent.width,_=p.texExtent.height;r.readPixels(p.texOffset.x,p.texOffset.y,f,_,s,a,c)}this.stateCache.glFramebuffer!==h&&(r.bindFramebuffer(r.FRAMEBUFFER,h),this.stateCache.glFramebuffer=h)},i.blitFramebuffer=function(){},i.getExtension=function(t){for(var e=["","WEBKIT_","MOZ_"],i=0;i<e.length;++i){var r=this.gl.getExtension(e[i]+t);if(r)return r}return null},i.initStates=function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)},i._onWebGLContextLost=function(t){$e(11e3),ti(t)},Ge(e,[{key:"gl",get:function(){return this._webGLRC}},{key:"webGLQueue",get:function(){return this._queue}},{key:"isAntialias",get:function(){return this._isAntialias}},{key:"isPremultipliedAlpha",get:function(){return this._isPremultipliedAlpha}},{key:"useVAO",get:function(){return this._useVAO}},{key:"destroyShadersImmediately",get:function(){return this._destroyShadersImmediately}},{key:"noCompressedTexSubImage2D",get:function(){return this._noCompressedTexSubImage2D}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}},{key:"EXT_texture_filter_anisotropic",get:function(){return this._EXT_texture_filter_anisotropic}},{key:"EXT_blend_minmax",get:function(){return this._EXT_blend_minmax}},{key:"EXT_frag_depth",get:function(){return this._EXT_frag_depth}},{key:"EXT_shader_texture_lod",get:function(){return this._EXT_shader_texture_lod}},{key:"EXT_sRGB",get:function(){return this._EXT_sRGB}},{key:"OES_vertex_array_object",get:function(){return this._OES_vertex_array_object}},{key:"WEBGL_color_buffer_float",get:function(){return this._WEBGL_color_buffer_float}},{key:"WEBGL_compressed_texture_etc1",get:function(){return this._WEBGL_compressed_texture_etc1}},{key:"WEBGL_compressed_texture_pvrtc",get:function(){return this._WEBGL_compressed_texture_pvrtc}},{key:"WEBGL_compressed_texture_astc",get:function(){return this._WEBGL_compressed_texture_astc}},{key:"WEBGL_compressed_texture_s3tc",get:function(){return this._WEBGL_compressed_texture_s3tc}},{key:"WEBGL_compressed_texture_s3tc_srgb",get:function(){return this._WEBGL_compressed_texture_s3tc_srgb}},{key:"WEBGL_debug_shaders",get:function(){return this._WEBGL_debug_shaders}},{key:"WEBGL_draw_buffers",get:function(){return this._WEBGL_draw_buffers}},{key:"WEBGL_lose_context",get:function(){return this._WEBGL_lose_context}},{key:"WEBGL_depth_texture",get:function(){return this._WEBGL_depth_texture}},{key:"WEBGL_debug_renderer_info",get:function(){return this._WEBGL_debug_renderer_info}},{key:"OES_texture_half_float",get:function(){return this._OES_texture_half_float}},{key:"OES_texture_half_float_linear",get:function(){return this._OES_texture_half_float_linear}},{key:"OES_texture_float",get:function(){return this._OES_texture_float}},{key:"OES_standard_derivatives",get:function(){return this._OES_standard_derivatives}},{key:"OES_element_index_uint",get:function(){return this._OES_element_index_uint}},{key:"ANGLE_instanced_arrays",get:function(){return this._ANGLE_instanced_arrays}}]),e}(re));ei.WebGLDevice=cs,function(t){t[t.positions=Yt.ATTR_POSITION]="positions",t[t.normals=Yt.ATTR_NORMAL]="normals",t[t.uvs=Yt.ATTR_TEX_COORD]="uvs",t[t.colors=Yt.ATTR_COLOR]="colors"}(Xo||(Xo={}));var ds,ps,fs,_s,gs,ms=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var i=t-e;this._arrayBufferOrPaddings.push(i),this._length+=i}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(i){"number"==typeof i?e+=i:(t.set(new Uint8Array(i),e),e+=i.byteLength)})),t.buffer},t}(),ys=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var i=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(i).fill(null);for(var r=0;r<i;++r){var n=this._mesh.struct.morph.subMeshMorphs[r];n&&(n.targets.length>ni.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[r]=new bs(this._mesh,r,this._mesh.struct.morph,e):this._subMeshRenderings[r]=new vs(this._mesh,r,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,i=new Array(e),r=0;r<e;++r){var n,o;i[r]=null!==(n=null===(o=this._subMeshRenderings[r])||void 0===o?void 0:o.createInstance())&&void 0!==n?n:null}return{setWeights:function(t,e){var r;null===(r=i[t])||void 0===r||r.setWeights(e)},requiredPatches:function(e){ui(t._mesh.struct.morph);var r=t._mesh.struct.morph.subMeshMorphs[e],n=i[e];if(null===n)return null;var o=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:r.targets.length}];return r.attributes.includes(Yt.ATTR_POSITION)&&o.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),r.attributes.includes(Yt.ATTR_NORMAL)&&o.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),r.attributes.includes(Yt.ATTR_TANGENT)&&o.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),o.push.apply(o,n.requiredPatches()),o},adaptPipelineState:function(t,e){var r;null===(r=i[t])||void 0===r||r.adaptPipelineState(e)},destroy:function(){for(var t,e=qe(i);!(t=e()).done;){var r=t.value;null==r||r.destroy()}}}},t}(),vs=function(){function t(t,e,i,r){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=r;var n=i.subMeshMorphs[e];this._subMeshMorph=n,As(t,e,r);var o=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=o;var s=n.targets.length,a=Es(r,o*s);this._textureInfo={width:a.width,height:a.height},this._attributes=n.attributes.map((function(e,i){var r=a.create(),s=r.valueView;return n.targets.forEach((function(e,r){for(var n=e.displacements[i],a=new Float32Array(t.data.buffer,t.data.byteOffset+n.offset,n.count),l=o*r*4,h=0;h<o;++h)s[l+4*h+0]=a[3*h+0],s[l+4*h+1]=a[3*h+1],s[l+4*h+2]=a[3*h+2]})),r.updatePixels(),{name:e,morphTexture:r}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=qe(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new Ts(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(i){for(var r,n=qe(t._attributes);!(r=n()).done;){var o=r.value,s=void 0;switch(o.name){case Yt.ATTR_POSITION:s=pi;break;case Yt.ATTR_NORMAL:s=di;break;case Yt.ATTR_TANGENT:s=ci;break;default:ti("Unexpected attribute!")}void 0!==s&&(i.bindSampler(s,o.morphTexture.sampler),i.bindTexture(s,o.morphTexture.texture))}i.bindBuffer(ni.BINDING,e.buffer),i.update()},destroy:function(){}}},t}(),bs=function(){function t(t,e,i,r){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=r;var n=i.subMeshMorphs[e];As(t,e,r),this._attributes=n.attributes.map((function(e,i){return{name:e,targets:n.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[i].offset,e.displacements[i].count)}}))}}))}return t.prototype.createInstance=function(){return new Ss(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},Ge(t,[{key:"data",get:function(){return this._attributes}}]),t}(),Ss=function(){function t(t,e,i){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new Ts(i,0);var r=Es(i,e);this._morphUniforms.setMorphTextureInfo(r.width,r.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=r.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var i=this._attributes[e],r=i.morphTexture.valueView,n=this._owner.data[e];ri(t.length===n.targets.length);for(var o=0;o<n.targets.length;++o){var s=n.targets[o].displacements,a=t[o],l=s.length/3;if(0===o)for(var h=0;h<l;++h)r[4*h+0]=s[3*h+0]*a,r[4*h+1]=s[3*h+1]*a,r[4*h+2]=s[3*h+2]*a;else if(0!==a)for(var u=0;u<l;++u)r[4*u+0]+=s[3*u+0]*a,r[4*u+1]+=s[3*u+1]*a,r[4*u+2]+=s[3*u+2]*a}i.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,i=qe(this._attributes);!(e=i()).done;){var r=e.value,n=void 0;switch(r.attributeName){case Yt.ATTR_POSITION:n=pi;break;case Yt.ATTR_NORMAL:n=di;break;case Yt.ATTR_TANGENT:n=ci;break;default:ti("Unexpected attribute!")}void 0!==n&&(t.bindSampler(n,r.morphTexture.sampler),t.bindTexture(n,r.morphTexture.texture))}t.bindBuffer(ni.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),Ts=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(ni.SIZE)),this._remoteBuffer=t.createBuffer(new ot(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,ni.SIZE,ni.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){ri(t.length===this._targetCount);for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(ni.OFFSET_OF_WEIGHTS+4*e,t[e],ei.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(ni.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,ei.sys.isLittleEndian),this._localBuffer.setFloat32(ni.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,ei.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(ni.OFFSET_OF_VERTICES_COUNT,t,ei.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},Ge(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function Es(t,e){var i,r,n,o;t.hasFeature(c.TEXTURE_FLOAT)?(i=e,n=16,r=si.PixelFormat.RGBA32F,o=Float32Array):(i=4*e,n=4,r=si.PixelFormat.RGBA8888,o=Uint8Array);var s=function(t){t<5&&(t=5);var e=li(t),i=hi(e),r=i>>1;return{width:1<<(1&i?r+1:r),height:1<<r}}(i),a=s.width,l=s.height;return{width:a,height:l,create:function(){var e=new ArrayBuffer(a*l*n),i=new Float32Array(e),s=o===Float32Array?i:new o(e),h=new oi({width:a,height:l,_data:s,_compressed:!1,format:r}),u=new si;u.setFilters(si.Filter.NEAREST,si.Filter.NEAREST),u.setMipFilter(si.Filter.NONE),u.setWrapMode(si.WrapMode.CLAMP_TO_EDGE,si.WrapMode.CLAMP_TO_EDGE,si.WrapMode.CLAMP_TO_EDGE),u.image=h,u.getGFXTexture()||ti("Unexpected: failed to create morph texture?");var c=ai.getSampler(t,u.getSamplerHash());return{get texture(){return u.getGFXTexture()},get sampler(){return c},get valueView(){return i},destroy:function(){u.destroy()},updatePixels:function(){u.uploadData(s)}}}}}function As(t,e,i){t.renderingSubMeshes[e].enableVertexIdChannel(i)}function Cs(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var ws=new fi,xs=new fi,Rs=new Uint8Array,Ms=t("Mesh",_i("cc.Mesh")((gs=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,Si(e,"_struct",fs,Ti(e)),Si(e,"_hash",_s,Ti(e)),e._data=Rs,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}He(e,t);var i=e.prototype;return i.initialize=function(){if(!this._initialized){this._initialized=!0;for(var t=this._data.buffer,e=ei.director.root.device,i=this._createVertexBuffers(e,t),r=[],n=0;n<this._struct.primitives.length;n++){var o=this._struct.primitives[n];if(0!==o.vertexBundelIndices.length){var s=null,a=null;if(o.indexView){var l=o.indexView,h=l.stride,u=l.length;if(4===h&&!e.hasFeature(c.ELEMENT_INDEX_UINT)){var d=this._struct.vertexBundles[o.vertexBundelIndices[0]].view.count;if(d>=65536){$e(10001,d,65536);continue}h>>=1,u>>=1}s=e.createBuffer(new ot(_.INDEX,y.DEVICE,u,h)),a=new(Cs(l.stride))(t,l.offset,l.count),l.stride!==h&&(a=Cs(h).from(a)),s.update(a)}var p=o.vertexBundelIndices.map((function(t){return i[t]})),f=[];if(o.vertexBundelIndices.length>0)for(var g=o.vertexBundelIndices[0],m=this._struct.vertexBundles[g].attributes,v=0;v<m.length;++v){var b=m[v];f[v]=new Tt(b.name,b.format,b.isInstanced,b.stream,b.isInstanced,b.location)}var S=new gi(p,f,o.primitiveMode,s);S.mesh=this,S.subMeshIdx=n,r.push(S)}}this._renderingSubMeshes=r,this._struct.morph&&(this.morphRendering=function(t,e){return new ys(t,e)}(this,e))}},i.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},i.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},i.assign=function(t,e){this.reset({struct:t,data:e})},i.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},i.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var i=[],r=t.bindposes,n=0;n<r.length;n++)e.push(new mi(1/0,1/0,1/0,-1/0,-1/0,-1/0)),i.push(!1);for(var o=this._struct.primitives,s=0;s<o.length;s++){var a=this.readAttribute(s,Yt.ATTR_JOINTS),l=this.readAttribute(s,Yt.ATTR_WEIGHTS),h=this.readAttribute(s,Yt.ATTR_POSITION);if(a&&l&&h)for(var u=Math.min(a.length/4,l.length/4,h.length/3),c=0;c<u;c++){fi.set(ws,h[3*c+0],h[3*c+1],h[3*c+2]);for(var d=0;d<4;++d){var p=4*c+d,f=a[p];if(!(0===l[p]||f>=r.length)){fi.transformMat4(xs,ws,r[f]),i[f]=!0;var _=e[f];fi.min(_.center,_.center,xs),fi.max(_.halfExtents,_.halfExtents,xs)}}}}for(var g=0;g<r.length;g++){var m=e[g];i[g]?mi.fromPoints(m,m.center,m.halfExtents):e[g]=null}return e},i.merge=function(t,e,i){if(i&&!this.validateMergingMesh(t))return!1;var r=new fi,n=e&&new yi,o=e&&new mi;if(n&&e.getRotation(n),!this._initialized){var s=JSON.parse(JSON.stringify(t._struct)),a=t._data.slice();if(e){s.maxPosition&&s.minPosition&&(fi.add(o.center,s.maxPosition,s.minPosition),fi.multiplyScalar(o.center,o.center,.5),fi.subtract(o.halfExtents,s.maxPosition,s.minPosition),fi.multiplyScalar(o.halfExtents,o.halfExtents,.5),mi.transform(o,o,e),fi.add(s.maxPosition,o.center,o.halfExtents),fi.subtract(s.minPosition,o.center,o.halfExtents));for(var l=0;l<s.vertexBundles.length;l++)for(var h=s.vertexBundles[l],u=0;u<h.attributes.length;u++)if(h.attributes[u].name===Yt.ATTR_POSITION||h.attributes[u].name===Yt.ATTR_NORMAL){var c=h.attributes[u].format,d=new DataView(a.buffer,h.view.offset+Os(h.attributes,u)),p=Is(d,c),f=Bs(d,c);if(!p||!f)continue;for(var _=h.view.count,g=h.view.stride,m=Ds(c),y=0;y<_;y++){var v=y*g,b=v+m,S=b+m;switch(r.set(p(v),p(b),p(S)),h.attributes[u].name){case Yt.ATTR_POSITION:r.transformMat4(e);break;case Yt.ATTR_NORMAL:fi.transformQuat(r,r,n)}f(v,r.x),f(b,r.y),f(S,r.z)}}}return this.reset({struct:s,data:a}),this.initialize(),!0}for(var T,E,A,C,w,x=new ms,R=0,M=0,O=0,P=0,D=0,I=0,B=0,L=0,F=!1,k=new Array(this._struct.vertexBundles.length),N=0;N<this._struct.vertexBundles.length;++N){var z=this._struct.vertexBundles[N],U=t._struct.vertexBundles[N];O=z.view.offset,P=U.view.offset,M=z.view.stride,R=z.view.count+U.view.count,T=new ArrayBuffer(R*M),E=new Uint8Array(T),O+=(A=this._data.subarray(O,O+z.view.length)).length,P+=(C=t._data.subarray(P,P+U.view.length)).length,E.set(A),D=0;for(var V,H=qe(z.attributes);!(V=H()).done;){var G=V.value;B=0,F=!1;for(var W,X=qe(U.attributes);!(W=X()).done;){var Y=W.value;if(G.name===Y.name&&G.format===Y.format){F=!0;break}B+=jt[Y.format].size}if(F){L=jt[G.format].size,I=z.view.length+D;for(var j=0;j<U.view.count;++j){if(w=C.subarray(B,B+L),E.set(w,I),(G.name===Yt.ATTR_POSITION||G.name===Yt.ATTR_NORMAL)&&e){var q=new Float32Array(E.buffer,I,3);switch(r.set(q[0],q[1],q[2]),G.name){case Yt.ATTR_POSITION:r.transformMat4(e);break;case Yt.ATTR_NORMAL:fi.transformQuat(r,r,n)}q[0]=r.x,q[1]=r.y,q[2]=r.z}I+=z.view.stride,B+=U.view.stride}}D+=jt[G.format].size}k[N]={attributes:z.attributes,view:{offset:x.getLength(),length:T.byteLength,count:R,stride:M}},x.addBuffer(T)}for(var K,Z,J,Q=0,$=2,tt=0,et=new Array(this._struct.primitives.length),it=0;it<this._struct.primitives.length;++it){var rt=this._struct.primitives[it],nt=t._struct.primitives[it];et[it]={primitiveMode:rt.primitiveMode,vertexBundelIndices:rt.vertexBundelIndices};for(var ot,st=qe(rt.vertexBundelIndices);!(ot=st()).done;){var at=ot.value;tt=Math.max(tt,this._struct.vertexBundles[at].view.count)}if(rt.indexView&&nt.indexView){Q=rt.indexView.count,Q+=nt.indexView.count,O=rt.indexView.offset,P=nt.indexView.offset,$=Q<256?1:Q<65536?2:4;var lt=new ArrayBuffer(Q*$);if(K=2===$?new Uint16Array(lt):1===$?new Uint8Array(lt):new Uint32Array(lt),Z=2===rt.indexView.stride?new Uint16Array(this._data.buffer,O,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(this._data.buffer,O,rt.indexView.count):new Uint32Array(this._data.buffer,O,rt.indexView.count),$===rt.indexView.stride)K.set(Z);else for(var ht=0;ht<rt.indexView.count;++ht)K[ht]=Z[ht];O+=rt.indexView.length,J=2===nt.indexView.stride?new Uint16Array(t._data.buffer,P,nt.indexView.count):1===nt.indexView.stride?new Uint8Array(t._data.buffer,P,nt.indexView.count):new Uint32Array(t._data.buffer,P,nt.indexView.count);for(var ut=0;ut<nt.indexView.count;++ut)K[rt.indexView.count+ut]=tt+J[ut];P+=nt.indexView.length,et[it].indexView={offset:x.getLength(),length:lt.byteLength,count:Q,stride:$},x.setNextAlignment($),x.addBuffer(lt)}}var ct={vertexBundles:k,primitives:et,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return ct.minPosition&&t._struct.minPosition&&ct.maxPosition&&t._struct.maxPosition&&(e?(fi.add(o.center,t._struct.maxPosition,t._struct.minPosition),fi.multiplyScalar(o.center,o.center,.5),fi.subtract(o.halfExtents,t._struct.maxPosition,t._struct.minPosition),fi.multiplyScalar(o.halfExtents,o.halfExtents,.5),mi.transform(o,o,e),fi.add(r,o.center,o.halfExtents),fi.max(ct.maxPosition,ct.maxPosition,r),fi.subtract(r,o.center,o.halfExtents),fi.min(ct.minPosition,ct.minPosition,r)):(fi.min(ct.minPosition,ct.minPosition,t._struct.minPosition),fi.max(ct.maxPosition,ct.maxPosition,t._struct.maxPosition))),this.reset({struct:ct,data:new Uint8Array(x.getCombined())}),this.initialize(),!0},i.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var i=this._struct.vertexBundles[e],r=t._struct.vertexBundles[e];if(i.attributes.length!==r.attributes.length)return!1;for(var n=0;n<i.attributes.length;++n)if(i.attributes[n].format!==r.attributes[n].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var o=0;o<this._struct.primitives.length;++o){var s=this._struct.primitives[o],a=t._struct.primitives[o];if(s.vertexBundelIndices.length!==a.vertexBundelIndices.length)return!1;for(var l=0;l<s.vertexBundelIndices.length;++l)if(s.vertexBundelIndices[l]!==a.vertexBundelIndices[l])return!1;if(s.primitiveMode!==a.primitiveMode)return!1;if(s.indexView){if(void 0===a.indexView)return!1}else if(a.indexView)return!1}return!0},i.readAttribute=function(t,e){var i=this,r=null;return this._accessAttribute(t,e,(function(t,e){var n=t.view.count,o=t.attributes[e].format,s=ie(jt[o]);if(0!==n){var a=new DataView(i._data.buffer,t.view.offset+Os(t.attributes,e)),l=jt[o],h=Is(a,o);if(s&&h){for(var u=l.count,c=new s(n*u),d=t.view.stride,p=0;p<n;++p)for(var f=0;f<u;++f)c[u*p+f]=h(d*p+c.BYTES_PER_ELEMENT*f);r=c}}})),r},i.copyAttribute=function(t,e,i,r,n){var o=this,s=!1;return this._accessAttribute(t,e,(function(t,e){var a=t.view.count;if(0!==a){var l=t.attributes[e].format,h=new DataView(o._data.buffer,t.view.offset+Os(t.attributes,e)),u=new DataView(i,n),c=jt[l],d=Is(h,l),p=Bs(u,l);if(d&&p){for(var f=c.count,_=t.view.stride,g=Ds(l),m=r,y=g,v=0;v<a;++v)for(var b=0;b<f;++b)p(m*v+y*b,d(_*v+g*b));s=!0}}else s=!0})),s},i.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var i=e.indexView.stride;return new(1===i?Uint8Array:2===i?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},i.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var i=this._struct.primitives[t];if(!i.indexView)return!1;for(var r=i.indexView.count,n=1===i.indexView.stride?d.R8UI:2===i.indexView.stride?d.R16UI:d.R32UI,o=Is(new DataView(this._data.buffer),n),s=0;s<r;++s)e[s]=o(i.indexView.offset+jt[n].size*s);return!0},i._accessAttribute=function(t,e,i){if(!(t>=this._struct.primitives.length))for(var r,n=this._struct.primitives[t],o=qe(n.vertexBundelIndices);!(r=o()).done;){var s=r.value,a=this._struct.vertexBundles[s],l=a.attributes.findIndex((function(t){return t.name===e}));if(!(l<0)){i(a,l);break}}},i._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(i){var r=t.createBuffer(new ot(_.VERTEX,y.DEVICE,i.view.length,i.view.stride)),n=new Uint8Array(e,i.view.offset,i.view.length);return r.update(n),r}))},i.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:Rs})},i.validate=function(){return this.renderingSubMeshes.length>0&&this.data.byteLength>0},Ge(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=Ei(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]),e}(vi),fs=bi((ps=gs).prototype,"_struct",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),_s=bi(ps.prototype,"_hash",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ds=ps))||ds);function Os(t,e){for(var i=0,r=0;r<e;++r){var n=t[r];i+=jt[n.format].size}return i}ei.Mesh=Ms;var Ps=Ke.isLittleEndian;function Ds(t){var e=jt[t];return e.size/e.count}function Is(t,e){var i=jt[e],r=i.size/i.count;switch(i.type){case p.UNORM:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Ps)};case 4:return function(e){return t.getUint32(e,Ps)}}break;case p.SNORM:case p.INT:switch(r){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Ps)};case 4:return function(e){return t.getInt32(e,Ps)}}break;case p.UINT:switch(r){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Ps)};case 4:return function(e){return t.getUint32(e,Ps)}}break;case p.FLOAT:return function(e){return t.getFloat32(e,Ps)}}return null}function Bs(t,e){var i=jt[e],r=i.size/i.count;switch(i.type){case p.UNORM:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Ps)};case 4:return function(e,i){return t.setUint32(e,i,Ps)}}break;case p.SNORM:case p.INT:switch(r){case 1:return function(e,i){return t.setInt8(e,i)};case 2:return function(e,i){return t.setInt16(e,i,Ps)};case 4:return function(e,i){return t.setInt32(e,i,Ps)}}break;case p.UINT:switch(r){case 1:return function(e,i){return t.setUint8(e,i)};case 2:return function(e,i){return t.setUint16(e,i,Ps)};case 4:return function(e,i){return t.setUint32(e,i,Ps)}}break;case p.FLOAT:return function(e,i){return t.setFloat32(e,i,Ps)}}return null}var Ls=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_NORMAL,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RG32F),new Tt(Yt.ATTR_TANGENT,d.RGBA32F),new Tt(Yt.ATTR_COLOR,d.RGBA32F)],Fs=new fi;function ks(t,e,i){i=i||{};var r,n=[],o=0,s=[],a=0,l=t.positions.slice();if(l.length>0){if(r=null,t.attributes)for(var h,u=qe(t.attributes);!(h=u()).done;){var c=h.value;if(c.name===Yt.ATTR_POSITION){r=c;break}}r||(r=Ls[0]),n.push(r);var p=jt[r.format];a=Math.max(a,Math.floor(l.length/p.count)),s.push({offset:o,data:l,attribute:r}),o+=p.size}if(t.normals&&t.normals.length>0){if(r=null,t.attributes)for(var f,_=qe(t.attributes);!(f=_()).done;){var g=f.value;if(g.name===Yt.ATTR_NORMAL){r=g;break}}r||(r=Ls[1]);var m=jt[r.format];n.push(r),a=Math.max(a,Math.floor(t.normals.length/m.count)),s.push({offset:o,data:t.normals,attribute:r}),o+=m.size}if(t.uvs&&t.uvs.length>0){if(r=null,t.attributes)for(var y,v=qe(t.attributes);!(y=v()).done;){var b=y.value;if(b.name===Yt.ATTR_TEX_COORD){r=b;break}}r||(r=Ls[2]);var S=jt[r.format];n.push(r),a=Math.max(a,Math.floor(t.uvs.length/S.count)),s.push({offset:o,data:t.uvs,attribute:r}),o+=S.size}if(t.tangents&&t.tangents.length>0){if(r=null,t.attributes)for(var T,E=qe(t.attributes);!(T=E()).done;){var A=T.value;if(A.name===Yt.ATTR_TANGENT){r=A;break}}r||(r=Ls[3]);var C=jt[r.format];n.push(r),a=Math.max(a,Math.floor(t.tangents.length/C.count)),s.push({offset:o,data:t.tangents,attribute:r}),o+=C.size}if(t.colors&&t.colors.length>0){if(r=null,t.attributes)for(var w,x=qe(t.attributes);!(w=x()).done;){var R=w.value;if(R.name===Yt.ATTR_COLOR){r=R;break}}r||(r=Ls[4]);var M=jt[r.format];n.push(r),a=Math.max(a,Math.floor(t.colors.length/M.count)),s.push({offset:o,data:t.colors,attribute:r}),o+=M.size}if(t.customAttributes)for(var O,P=qe(t.customAttributes);!(O=P()).done;){var D=O.value,I=jt[D.attr.format];n.push(D.attr),a=Math.max(a,Math.floor(D.values.length/I.count)),s.push({offset:o,data:D.values,attribute:D.attr}),o+=I.size}for(var B=new ms,L=new ArrayBuffer(a*o),k=new DataView(L),N=0,z=s;N<z.length;N++){var U=z[N];Ci(k,U.data,U.attribute.format,U.offset,o)}B.setNextAlignment(0);var V={attributes:n,view:{offset:B.getLength(),length:L.byteLength,count:a,stride:o}};B.addBuffer(L);var H=null,G=0;if(t.indices){var W=t.indices;G=W.length,H=new ArrayBuffer(2*G);var X=new DataView(H);Ci(X,W,d.R16UI)}var Y={primitiveMode:t.primitiveMode||F.TRIANGLE_LIST,vertexBundelIndices:[0]};H&&(B.setNextAlignment(2),Y.indexView={offset:B.getLength(),length:H.byteLength,count:G,stride:2},B.addBuffer(H));var j=t.minPos;if(!j&&i.calculateBounds){j=fi.set(new fi,1/0,1/0,1/0);for(var q=0;q<a;++q)fi.set(Fs,l[3*q+0],l[3*q+1],l[3*q+2]),fi.min(j,j,Fs)}var K=t.maxPos;if(!K&&i.calculateBounds){K=fi.set(new fi,-1/0,-1/0,-1/0);for(var Z=0;Z<a;++Z)fi.set(Fs,l[3*Z+0],l[3*Z+1],l[3*Z+2]),fi.max(K,K,Fs)}var J={vertexBundles:[V],primitives:[Y]};return j&&(J.minPosition=new fi(j.x,j.y,j.z)),K&&(J.maxPosition=new fi(K.x,K.y,K.z)),e||(e=new Ms),e.reset({struct:J,data:new Uint8Array(B.getCombined())}),e}var Ns=Object.freeze({__proto__:null,find:wi,toPPM:function(t,e,i){return"P3 "+e+" "+i+" 255\n"+t.filter((function(t,e){return e%4<3})).toString()+"\n"},readMesh:function(t,e){void 0===e&&(e=0);for(var i,r={positions:[]},n=new DataView(t.data.buffer,t.data.byteOffset,t.data.byteLength),o=t.struct,s=o.primitives[e],a=qe(s.vertexBundelIndices);!(i=a()).done;)for(var l,h=i.value,u=o.vertexBundles[h],c=u.view.offset,p=u.view,f=p.length,_=p.stride,g=qe(u.attributes);!(l=g()).done;){var m=l.value,y=Xo[m.name];y&&(r[y]=(r[y]||[]).concat(ii(n,m.format,c,f,_))),c+=jt[m.format].size}var v=s.indexView;return r.indices=ii(n,d["R"+8*v.stride+"UI"],v.offset,v.length),r},createMesh:ks,readBuffer:ii,writeBuffer:Ci,mapBuffer:xi});t("utils",Ns);var zs,Us,Vs,Hs,Gs,Ws,Xs,Ys,js,qs,Ks,Zs,Js,Qs,$s,ta,ea,ia,ra,na,oa,sa,aa,la,ha,ua,ca,da,pa,fa,_a,ga,ma,ya,va,ba,Sa,Ta,Ea,Aa,Ca,wa=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}He(e,t);var i=e.prototype;return i.getMacroPatches=function(t){return this._morphRenderingInstance?this._morphRenderingInstance.requiredPatches(t):null},i.initSubModel=function(e,i,r){return t.prototype.initSubModel.call(this,e,i,this._launderMaterial(r))},i.destroy=function(){t.prototype.destroy.call(this),this._morphRenderingInstance=null},i.setSubModelMaterial=function(e,i){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(i))},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,i)},i._launderMaterial=function(t){return t},i.setMorphRendering=function(t){this._morphRenderingInstance=t},e}(Ri),xa=Mi({OFF:0,ON:1}),Ra=Mi({OFF:0,ON:1}),Ma=(zs=_i("cc.ModelLightmapSettings"),Us=Oi("_recieveShadow"),zs((Ks=function(){function t(){Si(this,"texture",Gs,this),Si(this,"uvParam",Ws,this),Si(this,"_bakeable",Xs,this),Si(this,"_castShadow",Ys,this),Si(this,"_receiveShadow",js,this),Si(this,"_lightmapSize",qs,this)}return Ge(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Gs=bi((Hs=Ks).prototype,"texture",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ws=bi(Hs.prototype,"uvParam",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ki}}),Xs=bi(Hs.prototype,"_bakeable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ys=bi(Hs.prototype,"_castShadow",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),js=bi(Hs.prototype,"_receiveShadow",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qs=bi(Hs.prototype,"_lightmapSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),bi(Hs.prototype,"bakeable",[Pi],Object.getOwnPropertyDescriptor(Hs.prototype,"bakeable"),Hs.prototype),bi(Hs.prototype,"castShadow",[Pi],Object.getOwnPropertyDescriptor(Hs.prototype,"castShadow"),Hs.prototype),bi(Hs.prototype,"receiveShadow",[Pi],Object.getOwnPropertyDescriptor(Hs.prototype,"receiveShadow"),Hs.prototype),bi(Hs.prototype,"lightmapSize",[Pi],Object.getOwnPropertyDescriptor(Hs.prototype,"lightmapSize"),Hs.prototype),Vs=Hs))||Vs),Oa=(Zs=_i("cc.MeshRenderer"),Js=Ni(),Qs=zi(100),$s=Ui(),ta=Di(xa),ea=Vi(),ia=Di(Ra),ra=Vi(),na=Di(Ms),oa=Vi(),sa=Hi(),ga=Zs(aa=Js(aa=Qs(aa=$s(aa=Ii((_a=fa=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"lightmapSettings",ha,Ti(e)),Si(e,"_mesh",ua,Ti(e)),Si(e,"_shadowCastingMode",ca,Ti(e)),Si(e,"_shadowReceivingMode",da,Ti(e)),e._subMeshShapesWeights=[],e._modelType=void 0,e._model=null,e._morphInstance=null,Si(e,"_enableMorph",pa,Ti(e)),e._modelType=Ri,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this._mesh&&this._mesh.initialize(),this._validateShapeWeights()||this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onRestore=function(){this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow()},i.onEnable=function(){this._model||this._updateModels(),this._attachToScene()},i.onDisable=function(){this._model&&this._detachFromScene()},i.onDestroy=function(){this._model&&(ei.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},i.getWeight=function(t,e){var i=this._subMeshShapesWeights;ri(t<i.length);var r=this._subMeshShapesWeights[t];return ri(e<r.length),r[e]},i.setWeights=function(t,e){var i=this._subMeshShapesWeights;e>=i.length||i[e].length===t.length&&(i[e]=t.slice(0),this._uploadSubMeshShapesWeights(e))},i.setWeight=function(t,e,i){var r=this._subMeshShapesWeights;if(!(e>=r.length)){var n=r[e];i>=n.length||(n[i]=t,this._uploadSubMeshShapesWeights(e))}},i.setInstancedAttribute=function(t,e){if(this.model)for(var i=this.model.instancedAttributes,r=i.attributes,n=i.views,o=0;o<r.length;o++)if(r[o].name===t){n[o].set(e);break}},i._updateLightmap=function(t,e,i,r,n){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=i,this.lightmapSettings.uvParam.z=r,this.lightmapSettings.uvParam.w=n,this._onUpdateLightingmap()},i._updateModels=function(){if(this.enabledInHierarchy&&this._mesh){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap())}},i._createModel=function(){var t=this._morphInstance&&this._modelType===Ri?wa:this._modelType,e=this._model=ei.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof wa&&e.setMorphRendering(this._morphInstance)},i._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=Bi.POSITION,this._model.transform.hasChangedFlags|=Bi.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var i=0;i<t;++i){var r=this.getRenderMaterial(i);r&&!r.isValid&&(r=null);var n=e[i];n&&this._model.initSubModel(i,n,r||this._getBuiltinMaterial())}this._model.enabled=!0}},i._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},i._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},i._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap())},i._onMeshChanged=function(){},i._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},i._getBuiltinMaterial=function(){return Li.get("missing-material")},i._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},i._updateCastShadow=function(){this._model&&(this._shadowCastingMode===xa.OFF?this._model.castShadow=!1:(ri(this._shadowCastingMode===xa.ON,"ShadowCastingMode "+this._shadowCastingMode+" is not supported."),this._model.castShadow=!0))},i._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===Ra.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},i._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var i=0;i<e.passes.length;++i)if(e.passes[i].batchingScheme)return!0}return!1},i._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this._morphInstance=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,e=0;e<t;++e)this._uploadSubMeshShapesWeights(e);this._model&&this._model instanceof wa&&this._model.setMorphRendering(this._morphInstance)}},i._initSubMeshShapesWeights=function(){var t=this._mesh;if(this._subMeshShapesWeights.length=0,t){var e=t.struct.morph;if(e){var i=e.weights;this._subMeshShapesWeights=e.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):i?(ri(i.length===t.targets.length),i.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},i._validateShapeWeights=function(){var t=this._mesh,e=this._subMeshShapesWeights;if(!t||!t.struct.morph)return 0===e.length;var i=t.struct.morph;return i.subMeshMorphs.length===e.length&&e.every((function(t,e){var r,n,o=t.length;return(null!==(r=null===(n=i.subMeshMorphs[e])||void 0===n?void 0:n.targets.length)&&void 0!==r?r:0)===o}))},i._uploadSubMeshShapesWeights=function(t){var e;null===(e=this._morphInstance)||void 0===e||e.setWeights(t,this._subMeshShapesWeights[t])},Ge(e,[{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh,i=this._mesh=t;null==i||i.initialize(),this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]),e}(Gi),fa.ShadowCastingMode=xa,fa.ShadowReceivingMode=Ra,ha=bi((la=_a).prototype,"lightmapSettings",[Ai,Pi,Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ma}}),ua=bi(la.prototype,"_mesh",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ca=bi(la.prototype,"_shadowCastingMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xa.OFF}}),da=bi(la.prototype,"_shadowReceivingMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ra.ON}}),bi(la.prototype,"shadowCastingMode",[ta,ea,Fi],Object.getOwnPropertyDescriptor(la.prototype,"shadowCastingMode"),la.prototype),bi(la.prototype,"receiveShadow",[ia,ra,Fi],Object.getOwnPropertyDescriptor(la.prototype,"receiveShadow"),la.prototype),bi(la.prototype,"mesh",[na,oa],Object.getOwnPropertyDescriptor(la.prototype,"mesh"),la.prototype),bi(la.prototype,"enableMorph",[sa,Fi],Object.getOwnPropertyDescriptor(la.prototype,"enableMorph"),la.prototype),pa=bi(la.prototype,"_enableMorph",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aa=la))||aa)||aa)||aa)||aa)||aa,t({MeshRenderer:ga,ModelComponent:ga}),ga);function Pa(t,e){var i=t.sharedMaterials.length;if(i!==e.sharedMaterials.length)return!1;for(var r=0;r<i;r++)if(t.getRenderMaterial(r)!==e.getRenderMaterial(r))return!1;return!0}t("BatchingUtility",function(){function t(){}return t.batchStaticModel=function(t,e){var i=t.getComponentsInChildren(Oa);if(i.length<2)return console.error("the number of static models to batch is less than 2,it needn't batch."),!1;for(var r=1;r<i.length;r++){if(!i[0].mesh.validateMergingMesh(i[r].mesh))return console.error("the meshes of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1;if(!Pa(i[0],i[r]))return console.error("the materials of "+i[0].node.name+" and "+i[r].node.name+" can't be merged"),!1}var n=new Ms,o=new Wi,s=new Wi;t.getWorldMatrix(s),Wi.invert(s,s);for(var a=0;a<i.length;a++){var l=i[a];l.node.getWorldMatrix(o),Wi.multiply(o,s,o),n.merge(i[a].mesh,o),l.enabled=!1}var h=e.addComponent(Oa);return h.mesh=n,h.sharedMaterials=i[0].sharedMaterials,!0},t.unbatchStaticModel=function(t,e){for(var i=t.getComponentsInChildren(Oa),r=0;r<i.length;r++)i[r].enabled=!0;var n=e.getComponent(Oa);return n&&(n.mesh&&n.mesh.destroyRenderingMesh(),n.destroy()),!0},t}()),Xi(Ms.prototype,"Mesh.prototype",[{name:"renderingMesh",newName:"renderingSubMeshes"}]),Yi(Ms.prototype,"Mesh.prototype",[{name:"hasFlatBuffers"},{name:"destroyFlatBuffers"}]);var Da,Ia,Ba,La,Fa,ka,Na,za,Ua,Va,Ha,Ga,Wa,Xa,Ya,ja,qa,Ka,Za,Ja,Qa,$a=t("Skeleton",(ma=_i("cc.Skeleton"),ya=Di([ji]),va=Di([Wi]),ma((Ca=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_joints",Ta,Ti(e)),Si(e,"_bindposes",Ea,Ti(e)),Si(e,"_hash",Aa,Ti(e)),e._invBindposes=null,e}He(e,t);var i=e.prototype;return i.destroy=function(){var e,i;return null===(e=null===(i=ei.director.root)||void 0===i?void 0:i.dataPoolManager)||void 0===e||e.releaseSkeleton(this),t.prototype.destroy.call(this)},i.validate=function(){return this.joints.length>0&&this.bindposes.length>0},Ge(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new Wi;Wi.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var i=this._bindposes[e];t+=i.m00.toPrecision(2)+" "+i.m01.toPrecision(2)+" "+i.m02.toPrecision(2)+" "+i.m03.toPrecision(2)+" "+i.m04.toPrecision(2)+" "+i.m05.toPrecision(2)+" "+i.m06.toPrecision(2)+" "+i.m07.toPrecision(2)+" "+i.m08.toPrecision(2)+" "+i.m09.toPrecision(2)+" "+i.m10.toPrecision(2)+" "+i.m11.toPrecision(2)+" "+i.m12.toPrecision(2)+" "+i.m13.toPrecision(2)+" "+i.m14.toPrecision(2)+" "+i.m15.toPrecision(2)+"\n"}this._hash=Ei(t,666)}return this._hash}}]),e}(vi),Ta=bi((Sa=Ca).prototype,"_joints",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ea=bi(Sa.prototype,"_bindposes",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Aa=bi(Sa.prototype,"_hash",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ba=Sa))||ba));ei.Skeleton=$a,Yi(Oa.prototype,"MeshRenderer.prototype",[{name:"enableDynamicBatching"},{name:"recieveShadows"}]),ei.ModelComponent=Oa,qi.setClassAlias(Oa,"cc.ModelComponent");var tl,el,il,rl,nl,ol,sl,al,ll,hl,ul,cl,dl,pl,fl,_l,gl,ml,yl,vl,bl,Sl,Tl,El,Al,Cl,wl,xl,Rl,Ml,Ol,Pl,Dl,Il,Bl,Ll,Fl,kl,Nl,zl,Ul,Vl,Hl,Gl,Wl,Xl,Yl,jl,ql=Mi({LUMINOUS_FLUX:0,LUMINANCE:1}),Kl=new fi,Zl=_i("cc.StaticLightSettings")((Na=function(){function t(){Si(this,"_baked",Ba,this),Si(this,"_editorOnly",La,this),Si(this,"_bakeable",Fa,this),Si(this,"_castShadow",ka,this)}return Ge(t,[{key:"editorOnly",get:function(){return this._editorOnly},set:function(t){this._editorOnly=t}},{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}}]),t}(),Ba=bi((Ia=Na).prototype,"_baked",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),La=bi(Ia.prototype,"_editorOnly",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fa=bi(Ia.prototype,"_bakeable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ka=bi(Ia.prototype,"_castShadow",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(Ia.prototype,"editorOnly",[Pi],Object.getOwnPropertyDescriptor(Ia.prototype,"editorOnly"),Ia.prototype),bi(Ia.prototype,"bakeable",[Pi],Object.getOwnPropertyDescriptor(Ia.prototype,"bakeable"),Ia.prototype),bi(Ia.prototype,"castShadow",[Pi],Object.getOwnPropertyDescriptor(Ia.prototype,"castShadow"),Ia.prototype),Da=Ia))||Da,Jl=function(e){return t({Light:e,LightComponent:e}),e}((za=_i("cc.Light"),Ua=Vi(),Va=Vi(),Ha=Ji(),Ga=Vi(),Wa=Di(Zl),za((Qa=Ja=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_color",ja,Ti(e)),Si(e,"_useColorTemperature",qa,Ti(e)),Si(e,"_colorTemperature",Ka,Ti(e)),Si(e,"_staticSettings",Za,Ti(e)),e._type=Ki.UNKNOWN,e._lightType=void 0,e._light=null,e._lightType=Qi,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this._createLight()},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._detachFromScene()},i.onDestroy=function(){this._destroyLight()},i._createLight=function(){this._light||(this._light=ei.director.root.createLight(this._lightType)),this.color=this._color,this.useColorTemperature=this._useColorTemperature,this.colorTemperature=this._colorTemperature,this._light.node=this.node,this._light.baked=this.baked},i._destroyLight=function(){this._light&&(ei.director.root.destroyLight(this),this._light=null)},i._attachToScene=function(){if(this._detachFromScene(),this._light&&!this._light.scene&&this.node.scene){var t=this._getRenderScene();switch(this._type){case Ki.DIRECTIONAL:t.addDirectionalLight(this._light),t.setMainLight(this._light);break;case Ki.SPHERE:t.addSphereLight(this._light);break;case Ki.SPOT:t.addSpotLight(this._light)}}},i._detachFromScene=function(){if(this._light&&this._light.scene){var t=this._light.scene;switch(this._type){case Ki.DIRECTIONAL:t.removeDirectionalLight(this._light),t.unsetMainLight(this._light);break;case Ki.SPHERE:t.removeSphereLight(this._light);break;case Ki.SPOT:t.removeSpotLight(this._light)}}},Ge(e,[{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._light&&(Kl.x=t.r/255,Kl.y=t.g/255,Kl.z=t.b/255,this._light.color=Kl)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t,this._light&&(this._light.useColorTemperature=t)}},{key:"colorTemperature",get:function(){return this._colorTemperature},set:function(t){this._colorTemperature=t,this._light&&(this._light.colorTemperature=t)}},{key:"staticSettings",get:function(){return this._staticSettings},set:function(t){this._staticSettings=t}},{key:"type",get:function(){return this._type}},{key:"baked",get:function(){return this.staticSettings.baked},set:function(t){this.staticSettings.baked=t,null!==this._light&&(this._light.baked=t)}}]),e}($i),Ja.Type=Ki,Ja.PhotometricTerm=ql,ja=bi((Ya=Qa).prototype,"_color",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),qa=bi(Ya.prototype,"_useColorTemperature",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ka=bi(Ya.prototype,"_colorTemperature",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 6550}}),Za=bi(Ya.prototype,"_staticSettings",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Zl}}),bi(Ya.prototype,"color",[Ua],Object.getOwnPropertyDescriptor(Ya.prototype,"color"),Ya.prototype),bi(Ya.prototype,"useColorTemperature",[Va],Object.getOwnPropertyDescriptor(Ya.prototype,"useColorTemperature"),Ya.prototype),bi(Ya.prototype,"colorTemperature",[Zi,Ha,Ga],Object.getOwnPropertyDescriptor(Ya.prototype,"colorTemperature"),Ya.prototype),bi(Ya.prototype,"staticSettings",[Wa],Object.getOwnPropertyDescriptor(Ya.prototype,"staticSettings"),Ya.prototype),Xa=Ya))||Xa)),Ql=function(e){return t({DirectionalLight:e,DirectionalLightComponent:e}),e}((tl=_i("cc.DirectionalLight"),el=Ni(),il=Ui(),rl=er(),nl=Vi(),tl(ol=el(ol=il(ol=Ii((ll=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_illuminance",al,Ti(e)),e._type=Ki.DIRECTIONAL,e._light=null,e._lightType=ir,e}return He(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.illuminance=this._illuminance)},Ge(e,[{key:"illuminance",get:function(){return this._illuminance},set:function(t){this._illuminance=t,this._light&&(this._light.illuminance=this._illuminance)}}]),e}(Jl),al=bi((sl=ll).prototype,"_illuminance",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65e3}}),bi(sl.prototype,"illuminance",[rl,nl],Object.getOwnPropertyDescriptor(sl.prototype,"illuminance"),sl.prototype),ol=sl))||ol)||ol)||ol)||ol)),$l=function(e){return t({SphereLight:e,SphereLightComponent:e}),e}((hl=_i("cc.SphereLight"),ul=Ni(),cl=Ui(),dl=er(),pl=Vi(),fl=er(),_l=Vi(),gl=Di(ql),ml=Vi(),yl=Vi(),vl=Vi(),hl(bl=ul(bl=cl(bl=Ii((wl=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_size",Tl,Ti(e)),Si(e,"_luminance",El,Ti(e)),Si(e,"_term",Al,Ti(e)),Si(e,"_range",Cl,Ti(e)),e._type=Ki.SPHERE,e._light=null,e._lightType=rr,e}return He(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range)},Ge(e,[{key:"luminousFlux",get:function(){return this._luminance*nr(this._size)},set:function(t){this._luminance=t/nr(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}}]),e}(Jl),Tl=bi((Sl=wl).prototype,"_size",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),El=bi(Sl.prototype,"_luminance",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/nr(.15)}}),Al=bi(Sl.prototype,"_term",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ql.LUMINOUS_FLUX}}),Cl=bi(Sl.prototype,"_range",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bi(Sl.prototype,"luminousFlux",[dl,pl],Object.getOwnPropertyDescriptor(Sl.prototype,"luminousFlux"),Sl.prototype),bi(Sl.prototype,"luminance",[fl,_l],Object.getOwnPropertyDescriptor(Sl.prototype,"luminance"),Sl.prototype),bi(Sl.prototype,"term",[gl,ml],Object.getOwnPropertyDescriptor(Sl.prototype,"term"),Sl.prototype),bi(Sl.prototype,"size",[yl],Object.getOwnPropertyDescriptor(Sl.prototype,"size"),Sl.prototype),bi(Sl.prototype,"range",[vl],Object.getOwnPropertyDescriptor(Sl.prototype,"range"),Sl.prototype),bl=Sl))||bl)||bl)||bl)||bl)),th=function(e){return t({SpotLight:e,SpotLightComponent:e}),e}((xl=_i("cc.SpotLight"),Rl=Ni(),Ml=Ui(),Ol=er(),Pl=Vi(),Dl=er(),Il=Vi(),Bl=Di(ql),Ll=Vi(),Fl=Vi(),kl=Vi(),Nl=Ji(),zl=Vi(),xl(Ul=Rl(Ul=Ml(Ul=Ii((jl=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_size",Hl,Ti(e)),Si(e,"_luminance",Gl,Ti(e)),Si(e,"_term",Wl,Ti(e)),Si(e,"_range",Xl,Ti(e)),Si(e,"_spotAngle",Yl,Ti(e)),e._type=Ki.SPOT,e._light=null,e._lightType=or,e}return He(e,t),e.prototype._createLight=function(){t.prototype._createLight.call(this),this._light&&(this.luminance=this._luminance,this.size=this._size,this.range=this._range,this.spotAngle=this._spotAngle)},Ge(e,[{key:"luminousFlux",get:function(){return this._luminance*nr(this._size)},set:function(t){this._luminance=t/nr(this._size),this._light&&(this._light.luminance=this._luminance)}},{key:"luminance",get:function(){return this._luminance},set:function(t){this._luminance=t,this._light&&(this._light.luminance=t)}},{key:"term",get:function(){return this._term},set:function(t){this._term=t}},{key:"size",get:function(){return this._size},set:function(t){this._size=t,this._light&&(this._light.size=t)}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._light&&(this._light.range=t)}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._spotAngle=t,this._light&&(this._light.spotAngle=sr(t))}}]),e}(Jl),Hl=bi((Vl=jl).prototype,"_size",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),Gl=bi(Vl.prototype,"_luminance",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1700/nr(.15)}}),Wl=bi(Vl.prototype,"_term",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ql.LUMINOUS_FLUX}}),Xl=bi(Vl.prototype,"_range",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Yl=bi(Vl.prototype,"_spotAngle",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),bi(Vl.prototype,"luminousFlux",[Ol,Pl],Object.getOwnPropertyDescriptor(Vl.prototype,"luminousFlux"),Vl.prototype),bi(Vl.prototype,"luminance",[Dl,Il],Object.getOwnPropertyDescriptor(Vl.prototype,"luminance"),Vl.prototype),bi(Vl.prototype,"term",[Bl,Ll],Object.getOwnPropertyDescriptor(Vl.prototype,"term"),Vl.prototype),bi(Vl.prototype,"size",[Fl],Object.getOwnPropertyDescriptor(Vl.prototype,"size"),Vl.prototype),bi(Vl.prototype,"range",[kl],Object.getOwnPropertyDescriptor(Vl.prototype,"range"),Vl.prototype),bi(Vl.prototype,"spotAngle",[Zi,Nl,zl],Object.getOwnPropertyDescriptor(Vl.prototype,"spotAngle"),Vl.prototype),Ul=Vl))||Ul)||Ul)||Ul)||Ul));ei.LightComponent=Jl,qi.setClassAlias(Jl,"cc.LightComponent"),ei.DirectionalLightComponent=Ql,qi.setClassAlias(Ql,"cc.DirectionalLightComponent"),ei.SphereLightComponent=$l,qi.setClassAlias($l,"cc.SphereLightComponent"),ei.SpotLightComponent=th,qi.setClassAlias(th,"cc.SpotLightComponent"),Xi(th.prototype,"SpotLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter:function(){return this.luminousFlux},customSetter:function(t){this.luminousFlux=t}}]),Xi($l.prototype,"SphereLight.prototype",[{name:"luminousPower",newName:"luminousFlux",customGetter:function(){return this.luminousFlux},customSetter:function(t){this.luminousFlux=t}}]),Xi(Jl.PhotometricTerm,"Light.PhotometricTerm",[{name:"LUMINOUS_POWER",newName:"LUMINOUS_FLUX"}]);var eh=function(t,e,i){t[e+0]=i.m00,t[e+1]=i.m01,t[e+2]=i.m02,t[e+3]=i.m12,t[e+4]=i.m04,t[e+5]=i.m05,t[e+6]=i.m06,t[e+7]=i.m13,t[e+8]=i.m08,t[e+9]=i.m09,t[e+10]=i.m10,t[e+11]=i.m14};function ih(t,e){var i=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*i,t)/12)}new yi,new yi,new fi,new yi,new fi;var rh=ar([E.POINT,E.POINT,E.NONE,A.CLAMP,A.CLAMP,A.CLAMP]),nh=new fi,oh=new fi,sh=new fi,ah=new fi,lh=new Wi,hh=new Wi,uh=new mi,ch=Number.MAX_SAFE_INTEGER,dh=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=function(t){return t.hasFeature(c.TEXTURE_FLOAT)?d.RGBA32F:d.RGBA8}(this._device);this._formatSize=jt[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new ur(t),this._pool.initialize({format:e,roundUpFn:ih}),this._customPool=new ur(t),this._customPool.initialize({format:e,roundUpFn:ih})}var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var i=t[e],r=this._customPool.createChunk(i.textureLength),n=0;n<i.contents.length;n++){var o=i.contents[n],s=o.skeleton;this._chunkIdxMap.set(s,r);for(var a=0;a<o.clips.length;a++){var l=o.clips[a];this._chunkIdxMap.set(s^l,r)}}},e.getDefaultPoseTexture=function(t,e,i){var r=0^t.hash,n=this._textureBuffers.get(r)||null;if(n&&n.bounds.has(e.hash))return n.refCount++,n;var o=t.joints,s=t.bindposes,a=null,l=!1,h=o.length;if(n)n.refCount++;else{var u=12*h,c=this._chunkIdxMap.get(r),d=void 0!==c?this._customPool.alloc(u*Float32Array.BYTES_PER_ELEMENT,c):this._pool.alloc(u*Float32Array.BYTES_PER_ELEMENT);if(!d)return n;n={pixelOffset:d.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:d},a=new Float32Array(u),l=!0}fi.set(sh,ch,ch,ch),fi.set(ah,-ch,-ch,-ch);for(var p=e.getBoneSpaceBounds(t),f=0,_=0;f<h;f++,_+=12){var g=i.getChildByPath(o[f]),m=g?lr(g,i,lh):t.inverseBindposes[f],y=p[f];y&&(mi.transform(uh,y,m),uh.getBoundary(nh,oh),fi.min(sh,sh,nh),fi.max(ah,ah,oh)),l&&(g&&Wi.multiply(m,m,s[f]),eh(a,_,g?m:Wi.IDENTITY))}var v=[new mi];return n.bounds.set(e.hash,v),mi.fromPoints(v[0],sh,ah),l&&(this._pool.update(n.handle,a.buffer),this._textureBuffers.set(r,n)),n},e.getSequencePoseTexture=function(t,e,i,r){var n=t.hash^e.hash,o=this._textureBuffers.get(n)||null;if(o&&o.bounds.has(i.hash))return o.refCount++,o;var s=t.joints,a=t.bindposes,l=hr.getOrExtract(e).frames,h=null,u=!1,c=s.length;if(o)o.refCount++;else{var d=12*c*l,p=this._chunkIdxMap.get(n),f=void 0!==p?this._customPool.alloc(d*Float32Array.BYTES_PER_ELEMENT,p):this._pool.alloc(d*Float32Array.BYTES_PER_ELEMENT);if(!f)return null;var _=this._createAnimInfos(t,e,r);o={pixelOffset:f.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:f,animInfos:_},h=new Float32Array(d),u=!0}var g=i.getBoneSpaceBounds(t),m=[];o.bounds.set(i.hash,m);for(var y=0;y<l;y++)m.push(new mi(ch,ch,ch,-ch,-ch,-ch));for(var v=0,b=0;v<l;v++){for(var S=m[v],T=0;T<c;T++,b+=12){var E=o.animInfos[T],A=E.curveData,C=E.downstream,w=E.bindposeIdx,x=E.bindposeCorrection,R=void 0,M=!0;A&&C?R=Wi.multiply(lh,A[v],C):A?R=A[v]:C?R=C:(R=t.inverseBindposes[w],M=!1);var O=g[T];if(O){var P=x?Wi.multiply(hh,R,x):R;mi.transform(uh,O,P),uh.getBoundary(nh,oh),fi.min(S.center,S.center,nh),fi.max(S.halfExtents,S.halfExtents,oh)}u&&(M&&Wi.multiply(lh,R,a[w]),eh(h,b,M?lh:Wi.IDENTITY))}mi.fromPoints(S,S.center,S.halfExtents)}return u&&(this._pool.update(o.handle,h.buffer),this._textureBuffers.set(n,o)),o},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.skeletonHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),i=e.next();!i.done;){var r=i.value;r.clipHash===t.hash&&(r.readyToBeDeleted=!0,r.refCount?this._textureBuffers.delete(r.skeletonHash^r.clipHash):this.releaseHandle(r)),i=e.next()}},e._createAnimInfos=function(t,e,i){for(var r=[],n=t.joints,o=t.bindposes,s=n.length,a=hr.getOrExtract(e),l=0;l<s;l++){for(var h=n[l],u=a.joints[h],c=i.getChildByPath(h),d=void 0,p=void 0;!u;){var f=h.lastIndexOf("/");if(h=h.substring(0,f),u=a.joints[h],c?(d||(d=new Wi),Wi.fromRTS(lh,c.rotation,c.position,c.scale),Wi.multiply(d,lh,d),c=c.parent):p=h,f<0)break}var _=l,g=void 0;if(void 0!==p&&u){_=l-1;for(var m=0;m<s;m++)if(n[m]===p){_=m,g=new Wi,Wi.multiply(g,o[m],t.inverseBindposes[l]);break}}r.push({curveData:u&&u.transforms,downstream:d,bindposeIdx:_,bindposeCorrection:g})}return r},Ge(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]),t}(),ph=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var i=this._device.createBuffer(new ot(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,cr.SIZE,cr.SIZE)),r=new Float32Array([0,0,0,0]);i.update(r);var n={buffer:i,data:r,dirty:!1};return this._setAnimInfoDirty(n,!1),this._pool.set(t,n),n},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e._setAnimInfoDirty=function(t,e){t.dirty=e},e.switchClip=function(t){return t.data[0]=0,t.buffer.update(t.data),this._setAnimInfoDirty(t,!1),t},e.clear=function(){for(var t,e=qe(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),fh=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new dh(t),this.jointAnimationInfo=new ph(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();ei.internal.DataPoolManager=fh;var _h=[{name:"CC_USE_SKINNING",value:!0}];function gh(t,e,i,r){for(var n=0;n<i.length;n++){for(var o=i[n],s=-1,a=0;a<o.length;a++)if(o[a]===r){s=a;break}s>=0&&(e.push(n),t.push(s))}}var mh,yh,vh,bh,Sh,Th,Eh,Ah,Ch,wh,xh,Rh,Mh,Oh,Ph,Dh,Ih,Bh,Lh,Fh,kh,Nh,zh,Uh,Vh,Hh,Gh,Wh,Xh,Yh,jh,qh,Kh,Zh,Jh,Qh,$h,tu,eu,iu,ru,nu,ou,su,au,lu=new fi,hu=new fi,uu=new fi,cu=new fi,du=new Wi,pu=new mi,fu=function(t){function e(){var e;return(e=t.call(this)||this).uploadAnimation=null,e._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=gr.SKINNING,e}He(e,t);var i=e.prototype;return i._init=function(){},i.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null);for(var r=0;r<this._joints.length;r++)dr(this._joints[r].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&i){this.transform=e;var n=i.getBoneSpaceBounds(t),o=i.struct.jointMaps;this._ensureEnoughBuffers(o&&o.length||1),this._bufferIndices=i.jointBufferIndices;for(var s=0;s<t.joints.length;s++){var a=n[s],l=e.getChildByPath(t.joints[s]);if(a&&l){var h=pr(l,e),u=t.bindposes[s],c=[],d=[];o?gh(c,d,o,s):(c.push(s),d.push(0)),this._joints.push({indices:c,buffers:d,bound:a,target:l,bindpose:u,transform:h})}}}},i.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._transformUpdated=!0),fi.set(lu,1/0,1/0,1/0),fi.set(hu,-1/0,-1/0,-1/0);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.bound,o=r.transform,s=fr(o,t);mi.transform(pu,n,s),pu.getBoundary(uu,cu),fi.min(lu,lu,uu),fi.max(hu,hu,cu)}var a=this._worldBounds;this._modelBounds&&a&&(mi.fromPoints(this._modelBounds,lu,hu),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),this._updateNativeBounds())},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var i=0;i<this._joints.length;i++){var r=this._joints[i],n=r.indices,o=r.buffers,s=r.transform,a=r.bindpose;Wi.multiply(du,s.world,a);for(var l=0;l<o.length;l++)eh(this._dataArray[o[l]],12*n[l],du)}for(var h=0;h<this._buffers.length;h++)this._buffers[h].update(this._dataArray[h]);return!0},i.initSubModel=function(e,i,r){var n=i.vertexBuffers,o=i.iaInfo;o.vertexBuffers=i.jointMappedBuffers,t.prototype.initSubModel.call(this,e,i,r),o.vertexBuffers=n},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?_h.concat(i):_h},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._buffers[this._bufferIndices[e]];r&&i.bindBuffer(_r.BINDING,r)},i._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new ot(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,_r.SIZE,_r.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(_r.COUNT))},e}(wa),_u=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],gu=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=gr.BAKED_SKINNING,e._dataPoolManager=ei.director.root.dataPoolManager;var i=new Float32Array(4),r=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:i,animInfo:r,texture:null,boundsInfo:null},e}He(e,t);var i=e.prototype;return i._init=function(){},i.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),this._applyNativeJointMedium(),t.prototype.destroy.call(this)},i.bindSkeleton=function(t,e,i){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),this._skeleton=t,this._mesh=i,t&&e&&i){this.transform=e;var r=this._dataPoolManager;this._jointsMedium.animInfo=r.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new ot(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,mr.SIZE,mr.SIZE)))}},i.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var i=this._jointsMedium,r=i.animInfo,n=i.boundsInfo[r.data[0]],o=this._worldBounds;if(o&&n){var s=this.transform;n.transform(s._mat,s._pos,s._rot,s._scale,o)}}},i.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var i=this._jointsMedium.animInfo,r=this._instAnimInfoIdx;return r>=0?this.instancedAttributes.views[r][0]=i.data[0]:i.dirty&&(i.buffer.update(i.data),i.dirty=!1),!0},i._applyNativeJointMedium=function(){},i._updateModelBounds=function(t){this._modelBounds=t},i.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,i=null;t?(i=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=i&&i.bounds.get(this._mesh.hash),this._updateModelBounds(null)):(i=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._updateModelBounds(i&&i.bounds.get(this._mesh.hash)[0])),this._applyJointTexture(i),this._applyNativeJointMedium()}},i._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var i=this._jointsMedium,r=i.buffer,n=i.jointTextureInfo;n[0]=t.handle.texture.width,n[1]=this._skeleton.joints.length,n[2]=t.pixelOffset+.1,n[3]=1/n[0],this.updateInstancedJointTextureInfo(),r&&r.update(n);for(var o=t.handle.texture,s=0;s<this._subModels.length;++s)this._subModels[s].descriptorSet.bindTexture(yr,o)}},i.getMacroPatches=function(e){var i=t.prototype.getMacroPatches.call(this,e);return i?i.concat(_u):_u},i._updateLocalDescriptors=function(e,i){t.prototype._updateLocalDescriptors.call(this,e,i);var r=this._jointsMedium,n=r.buffer,o=r.texture,s=r.animInfo;if(i.bindBuffer(mr.BINDING,n),i.bindBuffer(cr.BINDING,s.buffer),o){var a=ai.getSampler(this._device,rh);i.bindTexture(yr,o.handle.texture),i.bindSampler(yr,a)}},i._setInstAnimInfoIdx=function(t){this._instAnimInfoIdx=t},i._updateInstancedAttributes=function(e,i){t.prototype._updateInstancedAttributes.call(this,e,i),this._setInstAnimInfoIdx(this._getInstancedAttributeIndex(vr)),this.updateInstancedJointTextureInfo()},i.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,i=t.animInfo,r=this._instAnimInfoIdx;if(r>=0){var n=this.instancedAttributes.views[r];n[0]=i.data[0],n[1]=e[1],n[2]=e[2]}},e}(wa),mu=function(e){return t({SkinnedMeshRenderer:e,SkinningModelComponent:e}),e}((mh=_i("cc.SkinnedMeshRenderer"),yh=Ni(),vh=zi(100),bh=Ui(),Sh=Di($a),Th=Di(br),Eh=Di($a),Ah=Di(br),Ch=Vi(),mh(wh=yh(wh=vh(wh=Ii(wh=bh((Oh=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_skeleton",Rh,Ti(e)),Si(e,"_skinningRoot",Mh,Ti(e)),e._clip=null,e._modelType=gu,e}He(e,t);var i=e.prototype;return i.__preload=function(){this._updateModelType()},i.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},i.setUseBakedAnimation=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=t?gu:fu;(e||this._modelType!==i)&&(this._modelType=i,this._model&&(ei.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this.enabledInHierarchy&&this._attachToScene()))},i.setMaterial=function(e,i){t.prototype.setMaterial.call(this,e,i),this._modelType===fu&&this.getMaterialInstance(i)},i._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},i._updateModelType=function(){if(this._skinningRoot){var t=this._skinningRoot.getComponent("cc.SkeletalAnimation");t?this.setUseBakedAnimation(t.useBakedAnimation):this.setUseBakedAnimation(!1)}},i._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},Ge(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){t!==this._skinningRoot&&(this._skinningRoot=t,this._updateModelType(),this._update())}},{key:"model",get:function(){return this._model}}]),e}(Oa),Rh=bi((xh=Oh).prototype,"_skeleton",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mh=bi(xh.prototype,"_skinningRoot",[Th],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(xh.prototype,"skeleton",[Eh],Object.getOwnPropertyDescriptor(xh.prototype,"skeleton"),xh.prototype),bi(xh.prototype,"skinningRoot",[Ah,Ch],Object.getOwnPropertyDescriptor(xh.prototype,"skinningRoot"),xh.prototype),wh=xh))||wh)||wh)||wh)||wh)||wh)),yu=new Tt(Yt.ATTR_BATCH_ID,d.R32F),vu=new Tt(Yt.ATTR_BATCH_UV,d.RG32F),bu=jt[yu.format].size+jt[vu.format].size,Su=function(e){return t({SkinnedMeshUnit:e,SkinningModelUnit:e}),e}((Ph=_i("cc.SkinnedMeshUnit"),Dh=Di(Ms),Ih=Di($a),Bh=Di(Sr),Lh=Di(mu),Ph((Wh=function(){function t(){Si(this,"mesh",Nh,this),Si(this,"skeleton",zh,this),Si(this,"material",Uh,this),Si(this,"_localTransform",Vh,this),Si(this,"_offset",Hh,this),Si(this,"_size",Gh,this)}return Ge(t,[{key:"offset",get:function(){return this._offset},set:function(t){Cr.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){Cr.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&lr(t.node,t.skinningRoot,this._localTransform))}}]),t}(),Nh=bi((kh=Wh).prototype,"mesh",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zh=bi(kh.prototype,"skeleton",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uh=bi(kh.prototype,"material",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vh=bi(kh.prototype,"_localTransform",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wi}}),Hh=bi(kh.prototype,"_offset",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(0,0)}}),Gh=bi(kh.prototype,"_size",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(1,1)}}),bi(kh.prototype,"offset",[Pi],Object.getOwnPropertyDescriptor(kh.prototype,"offset"),kh.prototype),bi(kh.prototype,"size",[Pi],Object.getOwnPropertyDescriptor(kh.prototype,"size"),kh.prototype),bi(kh.prototype,"copyFrom",[Lh],Object.getOwnPropertyDescriptor(kh.prototype,"copyFrom"),kh.prototype),Fh=kh))||Fh)),Tu=new Wi,Eu=(new Wi,new fi),Au=function(e){return t({SkinnedMeshBatchRenderer:e,BatchedSkinningModelComponent:e}),e}((Xh=_i("cc.SkinnedMeshBatchRenderer"),Yh=Ni(),jh=zi(100),qh=Ui(),Kh=Vi(),Zh=Di([ji]),Jh=Vi(),Qh=Di([Su]),$h=Vi(),tu=Hi(),eu=Hi(),Xh(iu=Yh(iu=jh(iu=Ii(iu=qh((au=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"atlasSize",nu,Ti(e)),Si(e,"batchableTextureNames",ou,Ti(e)),Si(e,"units",su,Ti(e)),e._textures={},e._batchMaterial=null,e}He(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},i.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},i._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},i.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},i.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var i=e.effectAsset.techniques[e.technique],r=function(r){var n=i.passes[r];if(!n.properties)return"continue";var o=function(i){if(n.properties[i].type>=f.SAMPLER1D){var o=null;t.batchableTextureNames.find((function(t){return t===i}))?((o=t._textures[i])||(o=t.createTexture(i)),t.cookTextures(o,i,r)):t.units.some((function(t){return o=t.material&&t.material.getProperty(i,r)})),o&&e.setProperty(i,o,r)}else{for(var s=[],a=0;a<t.units.length;a++){var l=t.units[a];l.material&&s.push(l.material.getProperty(i.slice(0,-3),r))}e.setProperty(i,s,r)}};for(var s in n.properties)o(s)},n=0;n<i.passes.length;n++)r(n)}else console.warn("incomplete batch material!")},i.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],i=0;i<this.units.length;i++){var r=this.units[i];if(r&&r.skeleton){var n=r.skeleton;Wi.invert(Tu,r._localTransform);for(var o=function(i){var r=n.joints[i];if(t.findIndex((function(t){return t===r}))>=0)return"continue";t.push(r),e.push(Wi.multiply(new Wi,n.bindposes[i]||Wi.IDENTITY,Tu))},s=0;s<n.joints.length;s++)o(s)}}var a=Array.from(Array(t.length).keys()).sort((function(e,i){return t[e]>t[i]?1:t[e]<t[i]?-1:0})),l=new $a;l.joints=t.map((function(t,e,i){return i[a[e]]})),l.bindposes=e.map((function(t,e,i){return i[a[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=l}else console.warn("no skinning root specified!")},i.cookMeshes=function(){for(var t=this,e=!1,i=0;i<this.units.length;i++)if(this.units[i].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new Ms;for(var r=0,n=d.UNKNOWN,o=0,s=d.UNKNOWN,a=0,l=d.UNKNOWN,h=0,u=d.UNKNOWN,c=0,p=d.UNKNOWN,f=new Array(this.units.length),_=this.units.length,g=0;g<_;g++){var m=this.units[g];m&&m.skeleton&&(f[g]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var y=function(e){var i=t.units[e];if(!i||!i.mesh||!i.mesh.data)return"continue";var _=t._createUnitMesh(e,i.mesh),g=new DataView(_.data.buffer);Wi.inverseTranspose(Tu,i._localTransform);for(var m=i.offset,y=i.size,v=function(t){var v=_.struct.vertexBundles[t];r=v.view.offset,n=d.UNKNOWN;for(var b=0;b<v.attributes.length;b++){var S=v.attributes[b];if(S.name===Yt.ATTR_POSITION){n=S.format;break}r+=jt[S.format].size}if(n){for(var T=ii(g,n,r,v.view.length,v.view.stride),E=0;E<T.length;E+=3)fi.fromArray(Eu,T,E),fi.transformMat4(Eu,Eu,i._localTransform),fi.toArray(T,Eu,E);Ci(g,T,n,r,v.view.stride)}o=v.view.offset,s=d.UNKNOWN;for(var A=0;A<v.attributes.length;A++){var C=v.attributes[A];if(C.name===Yt.ATTR_NORMAL){s=C.format;break}o+=jt[C.format].size}if(s){for(var w=ii(g,s,o,v.view.length,v.view.stride),x=0;x<w.length;x+=3)fi.fromArray(Eu,w,x),fi.transformMat4Normal(Eu,Eu,Tu),fi.toArray(w,Eu,x);Ci(g,w,s,o,v.view.stride)}a=v.view.offset,l=d.UNKNOWN;for(var R=0;R<v.attributes.length;R++){var M=v.attributes[R];if(M.name===Yt.ATTR_TANGENT){l=M.format;break}a+=jt[M.format].size}if(l){for(var O=ii(g,l,a,v.view.length,v.view.stride),P=0;P<O.length;P+=3)fi.fromArray(Eu,O,P),fi.transformMat4Normal(Eu,Eu,Tu),fi.toArray(O,Eu,P);Ci(g,O,l,a,v.view.stride)}h=v.view.offset,u=d.UNKNOWN;for(var D=0;D<v.attributes.length;D++){var I=v.attributes[D];if(I.name===Yt.ATTR_BATCH_UV){u=I.format;break}h+=jt[I.format].size}u&&xi(g,(function(t,e){var i,r=0===e?"x":"y";return(t=(i=t)-Math.floor(i))*y[r]+m[r]}),u,h,v.view.length,v.view.stride,g);var B=f[e];if(!B)return"continue";c=v.view.offset,p=d.UNKNOWN;for(var L=0;L<v.attributes.length;L++){var F=v.attributes[L];if(F.name===Yt.ATTR_JOINTS){p=F.format;break}c+=jt[F.format].size}p&&xi(g,(function(t){return B[t]}),p,c,v.view.length,v.view.stride,g)},b=0;b<_.struct.vertexBundles.length;b++)v(b);t._mesh.merge(_)},v=0;v<_;v++)y(v);this._onMeshChanged(this._mesh),this._updateModels()}},i.cookTextures=function(t,e,i){for(var r=[],n=[],o=[],s=[],a=0;a<this.units.length;a++){var l=this.units[a];if(l.material){var h=l.material.getProperty(e,i);if(h&&h.image&&h.image.data){var u=new et;u.texOffset.x=l.offset.x*this.atlasSize,u.texOffset.y=l.offset.y*this.atlasSize,u.texExtent.width=l.size.x*this.atlasSize,u.texExtent.height=l.size.y*this.atlasSize;var c=h.image.data;ArrayBuffer.isView(c)?(o.push(c),s.push(u)):(r.push(c),n.push(u))}}}var d=t.getGFXTexture(),p=ei.director.root.device;o.length>0&&p.copyBuffersToTexture(o,d,s),r.length>0&&p.copyTexImagesToTexture(r,d,n)},i.createTexture=function(t){var e=new si;return e.setFilters(Tr.LINEAR,Tr.LINEAR),e.setMipFilter(Tr.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:Er.RGBA8888}),this._textures[t]=e,e},i.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:Er.RGBA8888})},i._createUnitMesh=function(t,e){for(var i=JSON.parse(JSON.stringify(e.struct)),r={},n=0;n<e.struct.primitives.length;n++){for(var o=e.struct.primitives[n],s=0,a=d.UNKNOWN,l=0;l<o.vertexBundelIndices.length;l++){var h=e.struct.vertexBundles[o.vertexBundelIndices[l]];s=h.view.offset,a=d.UNKNOWN;for(var u=0;u<h.attributes.length;u++){var c=h.attributes[u];if(c.name===Yt.ATTR_TEX_COORD){a=c.format;break}s+=jt[c.format].size}if(a)break}if(void 0===r[l]){r[l]=[a,s];var p=i.vertexBundles[l];p.attributes.push(yu),p.attributes.push(vu),p.view.offset=0,p.view.length+=p.view.count*bu,p.view.stride+=bu}}for(var f=0,_=0;_<i.vertexBundles.length;_++)f+=i.vertexBundles[_].view.length;for(var g=0;g<i.primitives.length;g++){var m=i.primitives[g];m.indexView&&(m.indexView.offset=f,f+=m.indexView.length)}var y=new Uint8Array(f),v=e.data,b=new DataView(y.buffer),S=new DataView(v.buffer),T=ei.sys.isLittleEndian;for(var E in r)for(var A=i.vertexBundles[E],C=e.struct.vertexBundles[E],w=r[E],x=w[0],R=w[1],M=ii(S,x,R,C.view.length,C.view.stride),O=C.view,P=A.view,D=O.stride,I=P.stride,B=O.offset,L=P.offset,F=0;F<P.count;F++){var k=v.subarray(B,B+D);y.set(k,L),b.setFloat32(L+D,t),b.setFloat32(L+D+4,M[2*F],T),b.setFloat32(L+D+8,M[2*F+1],T),L+=I,B+=D}for(var N=0;N<i.primitives.length;N++){var z=e.struct.primitives[N],U=i.primitives[N];if(z.indexView&&U.indexView)for(var V=z.indexView.stride,H=U.indexView.stride,G=z.indexView.offset,W=U.indexView.offset,X=0;X<U.indexView.count;X++){var Y=v.subarray(G,G+V);y.set(Y,W),W+=H,G+=V}}var j=new Ms;return j.reset({struct:i,data:y}),j},Ge(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(mu),nu=bi((ru=au).prototype,"atlasSize",[Ai,Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),ou=bi(ru.prototype,"batchableTextureNames",[Zh,Ai,Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),su=bi(ru.prototype,"units",[Qh,Ai,$h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bi(ru.prototype,"mesh",[Ar,tu],Object.getOwnPropertyDescriptor(ru.prototype,"mesh"),ru.prototype),bi(ru.prototype,"skeleton",[Ar,eu],Object.getOwnPropertyDescriptor(ru.prototype,"skeleton"),ru.prototype),iu=ru))||iu)||iu)||iu)||iu)||iu));ei.SkinningModelComponent=mu,qi.setClassAlias(mu,"cc.SkinningModelComponent"),ei.SkinningModelUnit=Su,qi.setClassAlias(Su,"cc.SkinningModelUnit"),ei.BatchedSkinningModelComponent=Au,qi.setClassAlias(Au,"cc.BatchedSkinningModelComponent");var Cu,wu,xu,Ru,Mu,Ou,Pu,Du,Iu,Bu,Lu,Fu,ku,Nu,zu,Uu,Vu,Hu,Gu,Wu,Xu=new Wi,Yu=new Wi,ju=t("SkeletalAnimationState",function(t){function e(e,i){var r;return void 0===i&&(i=""),(r=t.call(this,e,i)||this)._frames=1,r._bakedDuration=0,r._animInfo=null,r._sockets=[],r._animInfoMgr=void 0,r._comps=[],r._parent=null,r._curvesInited=!1,r._animInfoMgr=ei.director.root.dataPoolManager.jointAnimationInfo,r}He(e,t);var i=e.prototype;return i.initialize=function(e){if(!this._curveLoaded){this._comps.length=0;for(var i=e.getComponentsInChildren(mu),r=0;r<i.length;++r){var n=i[r];n.skinningRoot===e&&this._comps.push(n)}this._parent=e.getComponent("cc.SkeletalAnimation");var o=this._parent.useBakedAnimation;this._doNotCreateEval=o,t.prototype.initialize.call(this,e),this._curvesInited=!o;var s=hr.getOrExtract(this.clip),a=s.frames,l=s.samples;this._frames=a-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/l}},i.onPlay=function(){if(t.prototype.onPlay.call(this),this._parent.useBakedAnimation){this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration,this._animInfoMgr.switchClip(this._animInfo,this.clip);for(var e=0;e<this._comps.length;++e)this._comps[e].uploadAnimation(this.clip)}else this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0)},i.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,i=0;i<t.length;++i){var r=t[i],n=e.getChildByPath(r.path);if(r.target){for(var o=hr.getOrExtract(this.clip),s=r.path,a=o.joints[s],l=n,h=void 0;!a;){var u=s.lastIndexOf("/");if(s=s.substring(0,u),a=o.joints[s],l&&(h||(h=Wi.identity(Yu)),Wi.fromRTS(Xu,l.rotation,l.position,l.scale),Wi.multiply(h,Xu,h),l=l.parent),u<0)break}for(var c=a&&a.transforms,d=o.frames,p=[],f=0;f<d;f++){var _;_=c&&h?Wi.multiply(Xu,c[f],h):c?c[f]:h||new Wi;var g={pos:new fi,rot:new yi,scale:new fi};Wi.toRTS(_,g.rot,g.pos,g.scale),p.push(g)}this._sockets.push({target:r.target,frames:p})}}},i._setAnimInfoDirty=function(t,e){t.dirty=e},i._sampleCurvesBaked=function(t){var e=t/this.duration,i=this._animInfo,r=e*this._frames+.5|0;if(r!==i.data[0]){i.data[0]=r,this._setAnimInfoDirty(i,!0);for(var n=0;n<this._sockets.length;++n){var o=this._sockets[n],s=o.target,a=o.frames[r],l=a.pos,h=a.rot,u=a.scale;s.setRTS(h,l,u)}}},e}(wr)),qu=t("Socket",(Cu=_i("cc.SkeletalAnimation.Socket"),wu=Di(br),Cu((Mu=bi((Ru=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),Si(this,"path",Mu,this),Si(this,"target",Ou,this),this.path=t,this.target=e}).prototype,"path",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ou=bi(Ru.prototype,"target",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xu=Ru))||xu));qi.setClassAlias(qu,"cc.SkeletalAnimationComponent.Socket");var Ku=new Wi,Zu=new Wi;function Ju(t,e,i){void 0===e&&(e=""),void 0===i&&(i=[]);for(var r=0;r<t.children.length;r++){var n=t.children[r];if(n){var o=e?e+"/"+n.name:n.name;i.push(o),Ju(n,o,i)}}return i}var Qu=function(e){return t({SkeletalAnimation:e,SkeletalAnimationComponent:e}),e}((Pu=_i("cc.SkeletalAnimation"),Du=Ni(),Iu=zi(99),Bu=Ui(),Lu=Di([qu]),Fu=Vi(),ku=Vi(),Nu=Di([qu]),Pu(zu=Du(zu=Iu(zu=Ii(zu=Bu((Wu=Gu=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_useBakedAnimation",Vu,Ti(e)),Si(e,"_sockets",Hu,Ti(e)),e}He(e,t);var i=e.prototype;return i.onDestroy=function(){t.prototype.onDestroy.call(this),ei.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),ei.director.getAnimationManager().removeSockets(this.node,this._sockets)},i.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},i.querySockets=function(){var t=this._defaultClip&&Object.keys(hr.getOrExtract(this._defaultClip).joints).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],i=0;i<t.length;i++){var r=t[i],n=this.node.getChildByPath(r);n&&(e.push(r),Ju(n,r,e))}return e},i.rebuildSocketAnimations=function(){for(var t,e=qe(this._sockets);!(t=e()).done;){var i=t.value,r=this.node.getChildByPath(i.path),n=i.target;r&&n&&(n.name=i.path.substring(i.path.lastIndexOf("/")+1)+" Socket",n.parent=this.node,lr(r,this.node,Ku),Wi.fromRTS(Zu,n.rotation,n.position,n.scale),Wi.equals(Zu,Ku)||(n.matrix=Ku))}for(var o=0,s=Object.keys(this._nameToState);o<s.length;o++){var a=s[o];this._nameToState[a].rebuildSocketCurves(this._sockets)}},i.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var i=new br;return i.parent=this.node,this._sockets.push(new qu(t,i)),this.rebuildSocketAnimations(),i},i._createState=function(t,e){return new ju(t,e)},i._doCreateState=function(e,i){var r=t.prototype._doCreateState.call(this,e,i);return r.rebuildSocketCurves(this._sockets),r},Ge(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=ei.director.getAnimationManager();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){this._useBakedAnimation=t;for(var e=this.node.getComponentsInChildren(mu),i=0;i<e.length;++i){var r=e[i];r.skinningRoot===this.node&&r.setUseBakedAnimation(this._useBakedAnimation,!0)}this._useBakedAnimation?ei.director.getAnimationManager().removeSockets(this.node,this._sockets):ei.director.getAnimationManager().addSockets(this.node,this._sockets)}}]),e}(xr),Gu.Socket=qu,bi((Uu=Wu).prototype,"sockets",[Lu,Fu],Object.getOwnPropertyDescriptor(Uu.prototype,"sockets"),Uu.prototype),bi(Uu.prototype,"useBakedAnimation",[ku],Object.getOwnPropertyDescriptor(Uu.prototype,"useBakedAnimation"),Uu.prototype),Vu=bi(Uu.prototype,"_useBakedAnimation",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hu=bi(Uu.prototype,"_sockets",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zu=Uu))||zu)||zu)||zu)||zu)||zu));ei.SkeletalAnimationComponent=Qu,qi.setClassAlias(Qu,"cc.SkeletalAnimationComponent"),ei.utils=Ns;var $u=new fi,tc=new Wi;function ec(t,e,i,r){var n=i.data,o=e.acquireBufferBatch(),s=o.byteOffset>>2,a=i.vertexCount,l=o.indicesOffset,h=o.vertexOffset;o.request(a,i.indicesCount)||(o=e.currBufferBatch,s=0,l=0,h=0);var u=o.vData,c=o.iData;t.getWorldMatrix(tc);for(var d=0;d<a;d++){var p=n[d];fi.set($u,p.x,p.y,0),fi.transformMat4($u,$u,tc),u[s++]=$u.x,u[s++]=$u.y,u[s++]=$u.z,u[s++]=p.u,u[s++]=p.v,tr.toArray(u,r,s),s+=4}for(var f=0,_=a/4;f<_;f++){var g=h+4*f;c[l++]=g,c[l++]=g+1,c[l++]=g+2,c[l++]=g+1,c[l++]=g+3,c[l++]=g+2}}var ic=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var i=new rc;i.initWithSize(t,e),this._texture=i,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,i=t.texture,r=this._innerTextureInfos[i.getId()],n=e.x,o=e.y;if(r)n+=r.x,o+=r.y;else{var s=i.width,a=i.height;if(this._x+s+2>this._width&&(this._x=2,this._y=this._nexty),this._y+a+2>this._nexty&&(this._nexty=this._y+a+2),this._nexty>this._height)return null;ei.internal.dynamicAtlasManager.textureBleeding&&((s<=8||a<=8)&&(this._texture.drawTextureAt(i.image,this._x-1,this._y-1),this._texture.drawTextureAt(i.image,this._x-1,this._y+1),this._texture.drawTextureAt(i.image,this._x+1,this._y-1),this._texture.drawTextureAt(i.image,this._x+1,this._y+1)),this._texture.drawTextureAt(i.image,this._x-1,this._y),this._texture.drawTextureAt(i.image,this._x+1,this._y),this._texture.drawTextureAt(i.image,this._x,this._y-1),this._texture.drawTextureAt(i.image,this._x,this._y+1)),this._texture.drawTextureAt(i.image,this._x,this._y),this._innerTextureInfos[i.getId()]={x:this._x,y:this._y,texture:i},this._count++,n+=this._x,o+=this._y,this._x+=s+2}var l={x:n,y:o,texture:this._texture};return this._innerSpriteFrames.push(t),l},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,i=t.length;e<i;e++){var r=t[e];r.isValid&&r._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),rc=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=Er.RGBA8888),this.reset({width:t,height:e,format:i})},i.drawTextureAt=function(t,e,i){var r=this.getGFXTexture();if(t&&r){var n=this._getGFXDevice();if(n){var o=new et;o.texOffset.x=e,o.texOffset.y=i,o.texExtent.width=t.width,o.texExtent.height=t.height,n.copyTexImagesToTexture([t.data],r,[o])}else console.warn("Unable to get device")}},e}(si),nc=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new ic(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=this._atlases[this._atlasIndex];e||(e=this.newAtlas());var i=e.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(e=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){var e=t._original._texture;this.deleteAtlasTexture(e)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(!e._original&&e.packable){var i=this.insertSpriteFrame(e);i&&e._setDynamicAtlasFrame(i)}},Ge(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),ei.director.on(ei.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),ei.director.off(ei.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();nc.instance=void 0;var oc,sc=t("dynamicAtlasManager",nc.instance=new nc);ei.internal.dynamicAtlasManager=sc;var ac,lc,hc,uc,cc=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],dc=t("SpriteFrame",_i("cc.SpriteFrame")(oc=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.uvHash=0,e.unbiasUV=[],e.uvSliced=[],e._rect=new Rr,e._offset=new Cr,e._originalSize=new Mr,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}He(e,t),e.createWithImage=function(t){var i=t instanceof oi?t:new oi(t),r=new si;r.image=i;var n=new e;return n.texture=r,n};var i=e.prototype;return i.textureLoaded=function(){return!!this.texture},i.isRotated=function(){return this._rotated},i.setRotated=function(t){this.rotated=t},i.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},i.setRect=function(t){this.rect=t},i.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},i.setOriginalSize=function(t){this.originalSize=t},i.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},i.setOffset=function(t){this.offset=t},i.getGFXTexture=function(){return this._texture.getGFXTexture()},i.getGFXSampler=function(){return this._texture.getGFXSampler()},i.getHash=function(){return this._texture.getHash()},i.getSamplerHash=function(){return this._texture.getSamplerHash()},i.reset=function(t,e){void 0===e&&(e=!1);var i=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,i=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),i=!0),i&&this.texture&&this._calculateUV()},i.checkRect=function(t){var e=this._rect,i=e.x,r=e.y;return this._rotated?(i+=e.height,r+=e.width):(i+=e.width,r+=e.height),i>t.width?(We(3300,this.name+"/"+t.name,i,t.width),!1):!(r>t.height&&(We(3301,this.name+"/"+t.name,r,t.height),1))},i.destroy=function(){return this._packable&&sc&&sc.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},i._calculateSlicedUV=function(){var t=this._rect,e=this.texture,i=e.width,r=e.height,n=this._capInsets[0],o=this._capInsets[2],s=t.width-n-o,a=this._capInsets[1],l=this._capInsets[3],h=t.height-a-l,u=this.uvSliced;if(u.length=0,this._rotated){cc[0].u=t.x/i,cc[1].u=(t.x+l)/i,cc[2].u=(t.x+l+h)/i,cc[3].u=(t.x+t.height)/i,cc[3].v=t.y/r,cc[2].v=(t.y+n)/r,cc[1].v=(t.y+n+s)/r,cc[0].v=(t.y+t.width)/r;for(var c=0;c<4;++c)for(var d=cc[c],p=0;p<4;++p){var f=cc[3-p];u.push({u:d.u,v:f.v})}}else{cc[0].u=t.x/i,cc[1].u=(t.x+n)/i,cc[2].u=(t.x+n+s)/i,cc[3].u=(t.x+t.width)/i,cc[3].v=t.y/r,cc[2].v=(t.y+a)/r,cc[1].v=(t.y+a+h)/r,cc[0].v=(t.y+t.height)/r;for(var _=0;_<4;++_)for(var g=cc[_],m=0;m<4;++m){var y=cc[m];u.push({u:y.u,v:g.v})}}},i._calculateUV=function(){var t=this._rect,e=this.uv,i=this.unbiasUV,r=this.texture,n=r.width,o=r.height;if(this._rotated){var s=0===n?0:t.x/n,a=0===n?1:(t.x+t.height)/n,l=0===o?0:t.y/o,h=0===o?1:(t.y+t.width)/o;this._isFlipUVX&&this._isFlipUVY?(e[0]=a,e[1]=h,e[2]=a,e[3]=l,e[4]=s,e[5]=h,e[6]=s,e[7]=l):this._isFlipUVX?(e[0]=a,e[1]=l,e[2]=a,e[3]=h,e[4]=s,e[5]=l,e[6]=s,e[7]=h):this._isFlipUVY?(e[0]=s,e[1]=h,e[2]=s,e[3]=l,e[4]=a,e[5]=h,e[6]=a,e[7]=l):(e[0]=s,e[1]=l,e[2]=s,e[3]=h,e[4]=a,e[5]=l,e[6]=a,e[7]=h);var u=0===n?0:t.x/n,c=0===n?1:(t.x+t.height)/n,d=0===o?0:t.y/o,p=0===o?1:(t.y+t.width)/o;this._isFlipUVX&&this._isFlipUVY?(i[0]=c,i[1]=p,i[2]=c,i[3]=d,i[4]=u,i[5]=p,i[6]=u,i[7]=d):this._isFlipUVX?(i[0]=c,i[1]=d,i[2]=c,i[3]=p,i[4]=u,i[5]=d,i[6]=u,i[7]=p):this._isFlipUVY?(i[0]=u,i[1]=p,i[2]=u,i[3]=d,i[4]=c,i[5]=p,i[6]=c,i[7]=d):(i[0]=u,i[1]=d,i[2]=u,i[3]=p,i[4]=c,i[5]=d,i[6]=c,i[7]=p)}else{var f=0===n?0:t.x/n,_=0===n?1:(t.x+t.width)/n,g=0===o?1:(t.y+t.height)/o,m=0===o?0:t.y/o;this._isFlipUVX&&this._isFlipUVY?(e[0]=_,e[1]=m,e[2]=f,e[3]=m,e[4]=_,e[5]=g,e[6]=f,e[7]=g):this._isFlipUVX?(e[0]=_,e[1]=g,e[2]=f,e[3]=g,e[4]=_,e[5]=m,e[6]=f,e[7]=m):this._isFlipUVY?(e[0]=f,e[1]=m,e[2]=_,e[3]=m,e[4]=f,e[5]=g,e[6]=_,e[7]=g):(e[0]=f,e[1]=g,e[2]=_,e[3]=g,e[4]=f,e[5]=m,e[6]=_,e[7]=m);var y=0===n?0:t.x/n,v=0===n?1:(t.x+t.width)/n,b=0===o?1:(t.y+t.height)/o,S=0===o?0:t.y/o;this._isFlipUVX&&this._isFlipUVY?(i[0]=v,i[1]=S,i[2]=y,i[3]=S,i[4]=v,i[5]=b,i[6]=y,i[7]=b):this._isFlipUVX?(i[0]=v,i[1]=b,i[2]=y,i[3]=b,i[4]=v,i[5]=S,i[6]=y,i[7]=S):this._isFlipUVY?(i[0]=y,i[1]=S,i[2]=v,i[3]=S,i[4]=y,i[5]=b,i[6]=v,i[7]=b):(i[0]=y,i[1]=b,i[2]=v,i[3]=b,i[4]=y,i[5]=S,i[6]=v,i[7]=S)}for(var T="",E=0;E<e.length;E++)T+=e[E];this.uvHash=Ei(T,666);var A=this.vertices;if(A){A.nu.length=0,A.nv.length=0;for(var C=0;C<A.u.length;C++)A.nu[C]=A.u[C]/n,A.nv[C]=A.v[C]/o}this._calculateSlicedUV()},i._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},i._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},i._checkPackable=function(){var t=sc;if(t){var e=this._texture;if(e instanceof si&&!e.isCompressed){var i=this.width,r=this.height;!e.image||i>t.maxFrameSize||r>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},i._serialize=function(){return null},i._deserialize=function(t){var e=t,i=e.rect;i&&(this._rect=new Rr(i.x,i.y,i.width,i.height));var r=e.offset;e.offset&&(this._offset=new Cr(r.x,r.y));var n=e.originalSize;e.originalSize&&(this._originalSize=new Mr(n.width,n.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var o=e.capInsets;o&&(this._capInsets[0]=o[0],this._capInsets[1]=o[1],this._capInsets[2]=o[2],this._capInsets[3]=o[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},i.clone=function(){var t,i,r,n,o,s,a,l,h=new e,u=this.vertices;return h.vertices=u?{x:u.x,y:u.y,triangles:u.triangles,nu:null===(t=u.nu)||void 0===t?void 0:t.slice(0),u:null===(i=u.u)||void 0===i?void 0:i.slice(0),nv:null===(r=u.nv)||void 0===r?void 0:r.slice(0),v:null===(n=u.v)||void 0===n?void 0:n.slice(0)}:null,(o=h.uv).splice.apply(o,[0,h.uv.length].concat(this.uv)),h.uvHash=this.uvHash,(s=h.unbiasUV).splice.apply(s,[0,h.unbiasUV.length].concat(this.unbiasUV)),(a=h.uvSliced).splice.apply(a,[0,h.uvSliced.length].concat(this.uvSliced)),h._rect.set(this._rect),h._offset.set(this._offset),h._originalSize.set(this._originalSize),h._rotated=this._rotated,(l=h._capInsets).splice.apply(l,[0,h._capInsets.length].concat(this._capInsets)),h._atlasUuid=this._atlasUuid,h._texture=this._texture,h._isFlipUVX=this._isFlipUVX,h._isFlipUVY=this._isFlipUVY,h},i._refreshTexture=function(t){this._texture=t;var e=this._texture,i={},r=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(i.rect=new Rr(0,0,e.width,e.height),r=!0),(0===this._originalSize.width||0===this._originalSize.height||r)&&(i.originalSize=new Mr(e.width,e.height),r=!0),r&&(this.reset(i),this.onLoaded()),this._checkPackable()},i.initDefault=function(e){t.prototype.initDefault.call(this,e);var i=new si;i.initDefault(),this._refreshTexture(i),this._calculateUV()},i.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},Ge(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?this.reset({texture:t},!0):console.warn("Error Texture in "+this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),e}(vi))||oc);ei.SpriteFrame=dc;var pc,fc=t("SpriteAtlas",_i("cc.SpriteAtlas")((uc=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"spriteFrames",hc,Ti(e)),e}He(e,t);var i=e.prototype;return i.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},i.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},i.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,i=0,r=Object.keys(e);i<r.length;i++){var n=r[i];t.push(e[n])}return t},i._serialize=function(){},i._deserialize=function(t,e){var i=t;this._name=i.name;var r=i.spriteFrames;this.spriteFrames=Or();for(var n=0;n<r.length;n+=2)e.result.push(this.spriteFrames,r[n],r[n+1],Pr(dc))},e}(vi),hc=bi((lc=uc).prototype,"spriteFrames",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Or()}}),ac=lc))||ac);ei.SpriteAtlas=fc;var _c,gc,mc,yc,vc=t("Font",_i("cc.Font")(pc=function(t){function e(){return t.apply(this,arguments)||this}return He(e,t),e}(vi))||pc);ei.Font=vc;var bc,Sc,Tc,Ec,Ac,Cc,wc,xc,Rc,Mc=t("TTFFont",_i("cc.TTFFont")((yc=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_fontFamily",mc,Ti(e)),e}return He(e,t),e.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},Ge(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:Ir(this._native),__isNative__:!0}}}]),e}(vc),mc=bi((gc=yc).prototype,"_fontFamily",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(gc.prototype,"_nativeAsset",[Ar,Dr],Object.getOwnPropertyDescriptor(gc.prototype,"_nativeAsset"),gc.prototype),bi(gc.prototype,"_nativeDep",[Ar],Object.getOwnPropertyDescriptor(gc.prototype,"_nativeDep"),gc.prototype),_c=gc))||_c);ei.TTFFont=Mc;var Oc,Pc=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},Dc=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,i=Object.keys(this.letterDefinitions);e<i.length;e++){var r=i[e],n=new Pc;Br(n,this.letterDefinitions[r]),t[r]=n}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),Ic=t("BitmapFont",(bc=_i("cc.BitmapFont"),Sc=Di(dc),bc((Rc=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"fntDataStr",Ac,Ti(e)),Si(e,"spriteFrame",Cc,Ti(e)),Si(e,"fontSize",wc,Ti(e)),Si(e,"fntConfig",xc,Ti(e)),e}return He(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new Dc(t.texture));var e=this.fntConfig;if(e){var i=e.fontDefDictionary;for(var r in i){var n=new Pc,o=i[r].rect;n.offsetX=i[r].xOffset,n.offsetY=i[r].yOffset,n.w=o.width,n.h=o.height,n.u=o.x,n.v=o.y,n.textureID=0,n.valid=!0,n.xAdvance=i[r].xAdvance,this.fontDefDictionary.addLetterDefinitions(r,n)}}else ti("The fnt config is not exists!")},e}(vc),Ac=bi((Ec=Rc).prototype,"fntDataStr",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Cc=bi(Ec.prototype,"spriteFrame",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wc=bi(Ec.prototype,"fontSize",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),xc=bi(Ec.prototype,"fntConfig",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tc=Ec))||Tc));ei.BitmapFont=Ic;var Bc=t("LabelAtlas",_i("cc.LabelAtlas")(Oc=function(t){function e(){return t.apply(this,arguments)||this}return He(e,t),e}(Ic))||Oc);ei.LabelAtlas=Bc;var Lc=t("BASELINE_RATIO",.26),Fc=t("MIDDLE_RATIO",(Lc+1)/2-Lc);var kc=new Lr(2);kc.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var Nc,zc=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var i=kc.get();if(i.key=t,i.value=e,this.count>=this.limit){var r=this.tail;delete this.datas[r.key],this.count--,this.tail=r.prev,this.tail.next=null,r.prev=null,r.next=null,kc.put(r)}this.moveToHead(i)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),Uc=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûа-яА-ЯЁё]+|\S)/,Vc=/^[!,.:;'}\]%\?>、‘“》？。，！]/,Hc=/([a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+|\S)$/,Gc=/[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]+$/,Wc=/^[a-zA-Z0-9ÄÖÜäöüßéèçàùêâîôûаíìÍÌïÁÀáàÉÈÒÓòóŐőÙÚŰúűñÑæÆœŒÃÂãÔõěščřžýáíéóúůťďňĚŠČŘŽÁÍÉÓÚŤżźśóńłęćąŻŹŚÓŃŁĘĆĄ-яА-ЯЁё]/;function Xc(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function Yc(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function jc(t,e,i){var r=(i||t.font)+"🎮"+e,n=zc.get(r);if(null!==n)return n;var o=t.measureText(e),s=o&&o.width||0;return zc.put(r,s),s}function qc(t,e,i){var r=e,n=i,o=t[e];if(o>="\udc00"&&o<="\udfff"&&r--,void 0!==i)if(i-1!==e){var s=t[i-1];s>="\ud800"&&s<="\udbff"&&n--}else o>="\ud800"&&o<="\udbff"&&n++;return t.substring(r,n)}function Kc(t,e,i,r){var n=[];if(0===t.length||i<0)return n.push(""),n;for(var o=t;e>i&&o.length>1;){for(var s=o.length*(i/e)|0,a=qc(o,s),l=e-r(a),h=a,u=0,c=0;l>i&&c++<10;)s*=i/l,l=e-r(a=qc(o,s|=0));for(c=0;l<=i&&c++<10;){if(a){var d=Uc.exec(a);u=d?d[0].length:1,h=a}l=e-r(a=qc(o,s+=u))}0==(s-=u)?(s=1,h=qc(o,1)):1===s&&o[0]>="\ud800"&&o[0]<="\udbff"&&(s=2,h=qc(o,2));var p=qc(o,0,s),f=void 0;Vc.test(h||a)&&(0==(s-=(f=Hc.exec(p))?f[0].length:0)&&(s=1),h=qc(o,s),p=qc(o,0,s)),Wc.test(h)&&(f=Gc.exec(p))&&p!==f[0]&&(h=qc(o,s-=f[0].length),p=qc(o,0,s)),(0===n.length||(p=p.trim()).length>0)&&n.push(p),e=r(o=h||a)}return(0===n.length||(o=o.trim()).length>0)&&n.push(o),n}var Zc,Jc,Qc,$c,td,ed,id,rd,nd,od,sd,ad,ld,hd,ud,cd=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return Nc||(Nc=new t),Nc};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),i=e.getContext("2d");t={canvas:e,context:i}}return t},e.put=function(t){this.pool.length>=je.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),dd=tr.WHITE.clone(),pd=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},fd="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",_d=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=cd.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=jc(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+Lc)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*Lc/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new oi),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,i=this.canvas.width,r=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,i,r),t.fillStyle=fd,t.fillRect(0,0,i,r),t.font=e.fontDesc;var n=e.fontSize,o=i/2,s=r/2+n*Fc+0*n,a=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+a.r+", "+a.g+", "+a.b+", 1)",e.isOutlined){var l=e.out||dd;t.strokeStyle="rgba("+l.r+", "+l.g+", "+l.b+", "+l.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,o,s)}t.fillText(this.char,o,s)}},t}(),gd=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.initWithSize=function(t,e,i){void 0===i&&(i=Er.RGBA8888),this.reset({width:t,height:e,format:i})},i.drawTextureAt=function(t,e,i){var r=this.getGFXTexture();if(t&&r){var n=this._getGFXDevice();if(n){var o=new et;o.texOffset.x=e,o.texOffset.y=i,o.texExtent.width=t.width,o.texExtent.height=t.height,n.copyTexImagesToTexture([t.data],r,[o])}else console.warn("Unable to get device")}},e}(si),md=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var i=new gd;i.initWithSize(t,e),this.fontDefDictionary=new Dc(i),this._halfBleed=1,this._width=t,this._height=e,Fr.on(kr.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,i=Fr.root.device;if(!e||!this.fontDefDictionary||!i)return null;var r=e.width,n=e.height;if(this._x+r+0>this._width&&(this._x=0,this._y=this._nextY),this._y+n>this._nextY&&(this._nextY=this._y+n+0),this._nextY>this._height)return $e(12100),null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var o=new pd;return o.u=this._x+this._halfBleed,o.v=this._y+this._halfBleed,o.texture=this.fontDefDictionary.texture,o.valid=!0,o.w=t.width-2,o.h=t.height-2,o.xAdvance=o.w,o.offsetY=t.offsetY,this._x+=r+0,this.fontDefDictionary.addLetterDefinitions(t.hash,o),o},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new gd;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var i=t.charCodeAt(0)+e.hash,r=this.fontDefDictionary.letterDefinitions[i];if(!r){var n=new _d(t,e);n.updateRenderData(),r=this.insertLetterTexture(n),n.destroy()}return r},Ge(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(),yd={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:tr.WHITE.clone(),isOutlined:!1,out:tr.WHITE.clone(),margin:0},vd=function(){this.material=null,this.vertexCount=0,this.indicesCount=0},bd=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).vData=null,e.uvDirty=!0,e.vertDirty=!0,e._data=[],e._indices=[],e._pivotX=0,e._pivotY=0,e._width=0,e._height=0,e}He(e,t),e.add=function(){return Ed.add()},e.remove=function(t){var e=Ed.data.indexOf(t);-1!==e&&(Ed.data[e].clear(),Ed.removeAt(e))};var i=e.prototype;return i.updateSizeNPivot=function(t,e,i,r){t===this._width&&e===this._height&&i===this._pivotX&&r===this._pivotY||(this._width=t,this._height=e,this._pivotX=i,this._pivotY=r,this.vertDirty=!0)},i.clear=function(){this._data.length=0,this._indices.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.uvDirty=!0,this.vertDirty=!0,this.material=null,this.vertexCount=0,this.indicesCount=0},Ge(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var i=e.length,r=0;for(r=t;r<i;r++)Td.free(e[r]);for(r=i;r<t;r++)e[r]=Td.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(vd),Sd=function(t){function e(e){var i;return void 0===e&&(e=9),(i=t.call(this)||this).vData=void 0,i.iData=void 0,i.vertexStart=0,i.indicesStart=0,i.byteStart=0,i.byteCount=0,i.lastFilledIndices=0,i.lastFilledVertex=0,i._formatByte=void 0,i._formatByte=e*Float32Array.BYTES_PER_ELEMENT,i.vData=new Float32Array(256*e*Float32Array.BYTES_PER_ELEMENT),i.iData=new Uint16Array(1536),i}He(e,t),e.add=function(){return Ad.add()},e.remove=function(t){var e=Ad.data.indexOf(t);-1!==e&&(Ad.data[e].reset(),Ad.removeAt(e))};var i=e.prototype;return i.request=function(t,e){var i=this.byteCount+t*this._formatByte;return this.reserve(t,e),this.vertexCount+=t,this.indicesCount+=e,this.byteCount=i,!0},i.reserve=function(t,e){var i=this.byteCount+t*this._formatByte,r=this.indicesCount+e;if(t+this.vertexCount>65535)return!1;var n=this.vData.byteLength,o=this.iData.length,s=this.vData.length,a=this.iData.length;if(i>n||r>o){for(;n<i||o<r;)n=4*(s*=2),o=a*=2;this._reallocBuffer(s,a)}return!0},i.advance=function(t,e){this.vertexCount+=t,this.indicesCount+=e,this.byteCount+=t*this._formatByte},i.reset=function(){this.vertexCount=0,this.indicesCount=0,this.byteCount=0,this.vertexStart=0,this.indicesStart=0,this.byteStart=0,this.lastFilledIndices=0,this.lastFilledVertex=0},i._reallocBuffer=function(t,e){var i=this.vData;this.vData=new Float32Array(t),this.vData.set(i,0);var r=this.iData;this.iData=new Uint16Array(e),this.iData.set(r,0)},Ge(e,[{key:"formatByte",get:function(){return this._formatByte},set:function(t){this._formatByte=t}},{key:"floatStride",get:function(){return this._formatByte>>2}},{key:"vDataOffset",get:function(){return this.byteCount>>>2}}]),e}(vd),Td=(function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;i._fillQuadBuffer=function(){for(var t=this.iData.length/6,e=this.iData,i=0,r=0;i<t;i++){var n=4*i;e[r++]=n,e[r++]=n+1,e[r++]=n+2,e[r++]=n+1,e[r++]=n+3,e[r++]=n+2}},i._reallocBuffer=function(e,i){t.prototype._reallocBuffer.call(this,e,i),this._fillQuadBuffer()}}(Sd),new e((function(){return{x:0,y:0,z:0,u:0,v:0,color:tr.WHITE.clone()}}),128)),Ed=new i((function(){return new bd}),32),Ad=new i((function(){return new Sd}),32),Cd=new Cr,wd=new Cr,xd=new Wi,Rd=new Wi,Md=new Wi,Od=new Wi(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),Pd=new Rr,Dd=function(e){return t({UITransform:e,UITransformComponent:e}),e}((Zc=_i("cc.UITransform"),Jc=Ni(),Qc=zi(110),$c=Ui(),td=Ur(),ed=Vi(),id=Ur(),rd=Vi(),Zc(nd=Jc(nd=Qc(nd=$c(nd=Nr(nd=Ii((hd=ld=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._priority=0,Si(e,"_contentSize",sd,Ti(e)),Si(e,"_anchorPoint",ad,Ti(e)),e}He(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiTransformComp=this},i.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},i.onEnable=function(){this.node.on(zr.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},i.onDisable=function(){this.node.off(zr.PARENT_CHANGED,this._parentChanged,this)},i.onDestroy=function(){this.node._uiProps.uiTransformComp=null},i.setContentSize=function(t,e){var i=this._contentSize;if(void 0===e){if((t=t).width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this.node.emit(zr.SIZE_CHANGED),this._markRenderDataDirty()},i.setAnchorPoint=function(t,e){var i=this._anchorPoint;if(void 0===e){if((t=t).x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this.node.emit(zr.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},i.isHit=function(t,e){for(var i=this._contentSize.width,r=this._contentSize.height,n=Cd,o=wd,s=this._getRenderScene().cameras,a=0;a<s.length;a++){var l=s[a];if(l.visibility&this.node.layer){l.node.getWorldRT(xd);var h=xd.m12,u=xd.m13,c=Vr.center;if(xd.m12=c.x-(xd.m00*h+xd.m04*u),xd.m13=c.y-(xd.m01*h+xd.m05*u),Wi.invert(xd,xd),Cr.transformMat4(n,t,xd),this.node.getWorldMatrix(Md),Wi.invert(xd,Md),!Wi.strictEquals(xd,Od)){Cr.transformMat4(o,n,xd),o.x+=this._anchorPoint.x*i,o.y+=this._anchorPoint.y*r;var d=!1;if(o.x>=0&&o.y>=0&&o.x<=i&&o.y<=r&&(d=!0,e&&e.mask))for(var p=e.mask,f=this.node,_=p?p.length:0,g=0,m=0;f&&m<_;++g,f=f.parent){var y=p[m];if(g===y.index){if(f!==y.comp.node){p.length=m;break}var v=y.comp;if(v&&v._enabled&&!v.isHit(n)){d=!1;break}m++}else if(g>y.index){p.length=m;break}}if(d)return!0}}}return!1},i.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(Md),Wi.invert(xd,Md),e||(e=new fi),fi.transformMat4(e,t,xd)},i.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(Md),e||(e=new fi),fi.transformMat4(e,t,Md)},i.getBoundingBox=function(){Wi.fromRTS(Rd,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,i=new Rr(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return i.transformMat4(Rd),i},i.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(Md),this.getBoundingBoxTo(Md)):this.getBoundingBox()},i.getBoundingBoxTo=function(t){Wi.fromRTS(Rd,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var i=this._contentSize.width,r=this._contentSize.height,n=new Rr(-this._anchorPoint.x*i,-this._anchorPoint.y*r,i,r);if(Wi.multiply(Md,t,Rd),n.transformMat4(Md),!this.node.children)return n;for(var o,s=this.node.children,a=qe(s);!(o=a()).done;){var l=o.value;if(l&&l.active){var h=l.getComponent(e);if(h){var u=h.getBoundingBoxTo(t);u&&Rr.union(n,n,u)}}}return n},i.getComputeAABB=function(t){var e=this._contentSize.width,i=this._contentSize.height;Pd.set(-this._anchorPoint.x*e,-this._anchorPoint.y*i,e,i),Pd.transformMat4(this.node.worldMatrix);var r=Pd.x+.5*Pd.width,n=Pd.y+.5*Pd.height,o=this.node.worldPosition.z,s=Pd.width/2,a=Pd.height/2;return null!=t?(mi.set(t,r,n,o,s,a,.001),t):new mi(r,n,o,s,a,.001)},i._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},i._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&t.markForUpdateRenderData()},e.insertChangeMap=function(t){var i=t.uuid;e.priorityChangeNodeMap.has(i)||e.priorityChangeNodeMap.set(i,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var i=t._uiProps.uiTransformComp,r=e._uiProps.uiTransformComp,n=(i?i._priority:0)-(r?r._priority:0);return 0===n?t.getSiblingIndex()-e.getSiblingIndex():n}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},Ge(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(zr.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(zr.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(zr.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(zr.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(zr.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(zr.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?$e(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=Fr.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=Fr.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}($i),ld.EventType=zr,ld.priorityChangeNodeMap=new Map,bi((od=hd).prototype,"contentSize",[td,ed],Object.getOwnPropertyDescriptor(od.prototype,"contentSize"),od.prototype),bi(od.prototype,"anchorPoint",[id,rd],Object.getOwnPropertyDescriptor(od.prototype,"anchorPoint"),od.prototype),sd=bi(od.prototype,"_contentSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mr(100,100)}}),ad=bi(od.prototype,"_anchorPoint",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(.5,.5)}}),nd=od))||nd)||nd)||nd)||nd)||nd)||nd));Fr.on(kr.EVENT_AFTER_UPDATE,Dd._sortSiblings),Fr.on(kr.EVENT_BEFORE_SCENE_LAUNCH,Dd._cleanChangeMap),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(ud||(ud={}));var Id,Bd,Ld,Fd,kd,Nd,zd,Ud,Vd,Hd,Gd,Wd,Xd,Yd,jd,qd,Kd,Zd,Jd,Qd=t("StencilManager",function(){function t(){this.stage=ud.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:C.ALWAYS,stencilMask:65535,writeMask:65535,failOp:w.KEEP,zFailOp:w.KEEP,passOp:w.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?ud.CLEAR_INVERTED:ud.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?ud.ENTER_LEVEL_INVERTED:ud.ENTER_LEVEL},e.enableMask=function(){this.stage=ud.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=ud.DISABLED:this.stage=ud.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=ud.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var i=0,r=!1,n=!1,o=C.LESS,s=this.stencilStateMap;if(e&&e.passes[0]){var a=e.passes[0].depthStencilState,l=0,h=0;a.depthTest&&(l=1),a.depthWrite&&(h=1),i=l|h<<1|a.depthFunc<<2|t<<6|this._maskStack.length<<9,r=a.depthTest,n=a.depthWrite,o=a.depthFunc,s=this.stencilStateMapWithDepth}else i=t<<16|this._maskStack.length;if(s&&s.has(i))return s.get(i);this.setStateFromStage(t);var u=new he(r,n,o,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return s.set(i,u),u},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===ud.DISABLED?(e.stencilTest=!1,e.func=C.ALWAYS,e.failOp=w.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===ud.ENABLED?(e.func=C.EQUAL,e.failOp=w.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===ud.CLEAR?(e.func=C.NEVER,e.failOp=w.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===ud.CLEAR_INVERTED||t===ud.ENTER_LEVEL?(e.func=C.NEVER,e.failOp=w.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===ud.ENTER_LEVEL_INVERTED&&(e.func=C.NEVER,e.failOp=w.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},Ge(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());Qd.sharedManager=null,Qd.sharedManager=new Qd,Hr(x),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(Jd||(Jd=t("InstanceMaterialType",{})));var $d,tp,ep,ip,rp,np,op,sp,ap,lp,hp,up,cp,dp,pp,fp,_p,gp,mp,yp,vp,bp,Sp,Tp,Ep,Ap,Cp,wp,xp,Rp,Mp,Op,Pp,Dp,Ip,Bp,Lp,Fp,kp,Np,zp,Up,Vp,Hp,Gp,Wp,Xp,Yp,jp,qp,Kp,Zp,Jp,Qp,$p,tf,ef,rf,nf,of,sf,af,lf,hf,uf=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}((Id=_i("cc.Renderable2D"),Bd=Gr(Dd),Ld=Hi(),Fd=Di(Sr),kd=Di(Sr),Nd=Ur(),zd=Wr(),Ud=Ur(),Vd=Vi(),Id(Hd=Bd(Hd=Nr(Hd=Ii((Zd=Kd=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_materials",Wd,Ti(e)),Si(e,"_customMaterial",Xd,Ti(e)),e.stencilStage=ud.DISABLED,Si(e,"_srcBlendFactor",Yd,Ti(e)),Si(e,"_dstBlendFactor",jd,Ti(e)),Si(e,"_color",qd,Ti(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=Jd.ADD_COLOR_AND_TEXTURE,e._blendState=new ce,e._blendHash=0,e._colorDirty=!0,e._cacheAlpha=1,e._lastParent=null,e}He(e,t);var i=e.prototype;return i.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc()},i.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},i.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},i.onEnable=function(){this.node.on(zr.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(zr.SIZE_CHANGED,this._nodeStateChange,this),this.updateMaterial(),this._renderFlag=this._canRender()},i.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender()},i.onDisable=function(){this.node.off(zr.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(zr.SIZE_CHANGED,this._nodeStateChange,this),this._renderFlag=!1},i.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++)this._materialInstances[t]&&this._materialInstances[t].destroy();this._renderData=null,this._blendState&&this._blendState.destroy()},i.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t&&this._renderFlag){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else t||(this._renderDataFlag=t)},i.requestRenderData=function(){var t=bd.add();return this._renderData=t,t},i.destroyRenderData=function(){this._renderData&&(bd.remove(this._renderData),this._renderData=null)},i.updateAssembler=function(t){this._updateColor(),this._renderFlag&&(this._checkAndUpdateRenderData(),this._render(t))},i.postUpdateAssembler=function(t){this._renderFlag&&this._postRender(t)},i._render=function(){},i._postRender=function(){},i._checkAndUpdateRenderData=function(){this._renderDataFlag&&(this._assembler.updateRenderData(this),this._renderDataFlag=!1)},i._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this.node._uiProps.opacity>0},i._postCanRender=function(){},i._updateColor=function(){var t=this._cacheAlpha<=0;this._updateWorldAlpha(),this._colorDirty&&this._assembler&&this._assembler.updateColor&&(this._assembler.updateColor(this),t&&(this._renderFlag=this._canRender()),this._colorDirty=!1)},i._updateWorldAlpha=function(){var t=this.color.a/255;1===t&&(t=this.node._uiProps.localOpacity);var e=this.node._uiProps.opacity*t;this.node._uiProps.opacity=e,this._colorDirty=this._colorDirty||e!==this._cacheAlpha,this._cacheAlpha=e},i._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new ue,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=x.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor),this.updateBlendHash()},i.getBlendState=function(){return this._blendState},i._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var i=this.node.children[t].getComponent(e);i&&i.markForUpdateRenderData()}},i._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case Jd.ADD_COLOR:t=Li.get("ui-base-material");break;case Jd.GRAYSCALE:t=Li.get("ui-sprite-gray-material");break;case Jd.USE_ALPHA_SEPARATED:t=Li.get("ui-sprite-alpha-sep-material");break;case Jd.USE_ALPHA_SEPARATED_AND_GRAY:t=Li.get("ui-sprite-gray-alpha-sep-material");break;default:t=Li.get("ui-sprite-material")}return t},i._setCacheAlpha=function(t){this._cacheAlpha=t},Ge(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var i=t.length;i<this._materials.length;i++)this.setMaterial(null,i);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"srcBlendFactor",get:function(){return this._customMaterial&&$e(12001),this._srcBlendFactor},set:function(t){this._customMaterial?$e(12001):this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"dstBlendFactor",get:function(){return this._customMaterial&&$e(12001),this._dstBlendFactor},set:function(t){this._customMaterial?$e(12001):this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._colorDirty=!0)}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}}]),e}(Gi),Kd.BlendState=x,Kd.Assembler=null,Kd.PostAssembler=null,Wd=bi((Gd=Zd).prototype,"_materials",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bi(Gd.prototype,"sharedMaterials",[Ar,Ld],Object.getOwnPropertyDescriptor(Gd.prototype,"sharedMaterials"),Gd.prototype),Xd=bi(Gd.prototype,"_customMaterial",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(Gd.prototype,"customMaterial",[kd,Nd,zd],Object.getOwnPropertyDescriptor(Gd.prototype,"customMaterial"),Gd.prototype),bi(Gd.prototype,"color",[Ud,Vd],Object.getOwnPropertyDescriptor(Gd.prototype,"color"),Gd.prototype),Yd=bi(Gd.prototype,"_srcBlendFactor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x.SRC_ALPHA}}),jd=bi(Gd.prototype,"_dstBlendFactor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x.ONE_MINUS_SRC_ALPHA}}),qd=bi(Gd.prototype,"_color",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),Hd=Gd))||Hd)||Hd)||Hd)||Hd));ei.internal.Renderable2D=uf,function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(sf||(sf=t("HorizontalTextAlignment",{}))),Hr(sf),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(af||(af=t("VerticalTextAlignment",{}))),Hr(af),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(lf||(lf=t("Overflow",{}))),Hr(lf),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(hf||(hf=t("CacheMode",{}))),Hr(hf);var cf,df,pf,ff=function(e){return t({Label:e,LabelComponent:e}),e}(($d=_i("cc.Label"),tp=Ni(),ep=zi(110),ip=Ui(),rp=Ur(),np=Vi(),op=Di(sf),sp=Ur(),ap=Vi(),lp=Di(af),hp=Ur(),up=Vi(),cp=Ur(),dp=Vi(),pp=Ur(),fp=Hi(),_p=Vi(),gp=Ur(),mp=Vi(),yp=Di(lf),vp=Ur(),bp=Vi(),Sp=Ur(),Tp=Vi(),Ep=Di(vc),Ap=Ur(),Cp=Hi(),wp=Vi(),xp=Ur(),Rp=Vi(),Mp=Di(hf),Op=Ur(),Pp=Vi(),Dp=Ur(),Ip=Vi(),Bp=Ur(),Lp=Vi(),Fp=Ur(),kp=Vi(),Np=Hi(),$d(zp=tp(zp=ep(zp=ip((of=nf=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_string",Vp,Ti(e)),Si(e,"_horizontalAlign",Hp,Ti(e)),Si(e,"_verticalAlign",Gp,Ti(e)),Si(e,"_actualFontSize",Wp,Ti(e)),Si(e,"_fontSize",Xp,Ti(e)),Si(e,"_fontFamily",Yp,Ti(e)),Si(e,"_lineHeight",jp,Ti(e)),Si(e,"_overflow",qp,Ti(e)),Si(e,"_enableWrapText",Kp,Ti(e)),Si(e,"_font",Zp,Ti(e)),Si(e,"_isSystemFontUsed",Jp,Ti(e)),e._spacingX=0,Si(e,"_isItalic",Qp,Ti(e)),Si(e,"_isBold",$p,Ti(e)),Si(e,"_isUnderline",tf,Ti(e)),Si(e,"_underlineHeight",ef,Ti(e)),Si(e,"_cacheMode",rf,Ti(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}He(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){var e=this._ttfSpriteFrame.texture;if(e&&null===this._ttfSpriteFrame.original){var i=e;i.image&&i.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},i.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture(),this._assembler&&this._assembler.updateRenderData(this))},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},i._updateColor=function(){this._updateWorldAlpha(),this._colorDirty&&(this.updateRenderData(!1),this._colorDirty=!1)},i._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof Ic){var i=e.spriteFrame;if(!i||!i.texture)return!1}return!0},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i._applyFontTexture=function(){this.markForUpdateRenderData();var t=this._font;if(t instanceof Ic){var e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===hf.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new dc,this._assemblerData=this._assembler.getAssemblerData();var i=new oi(this._assemblerData.canvas),r=new si;r.image=i,this._ttfSpriteFrame.texture=r}this.cacheMode!==hf.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},i.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==hf.CHAR){var e=this._texture.texture;if(e instanceof Xr){var i=e.getPixelFormat();t=i===Er.RGBA_ETC1||i===Er.RGB_A_PVRTC_4BPPV1||i===Er.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?Jd.USE_ALPHA_SEPARATED:Jd.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},Ge(e,[{key:"string",get:function(){return this._string},set:function(t){t?t+="":t="",this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==hf.BITMAP||this._font instanceof Ic||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===hf.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof Ic?this._font.fontSize:-1}}]),e}(uf),nf.HorizontalAlign=sf,nf.VerticalAlign=af,nf.Overflow=lf,nf.CacheMode=hf,nf._canvasPool=cd.getInstance(),bi((Up=of).prototype,"string",[rp,np,Yr],Object.getOwnPropertyDescriptor(Up.prototype,"string"),Up.prototype),bi(Up.prototype,"horizontalAlign",[op,sp,ap],Object.getOwnPropertyDescriptor(Up.prototype,"horizontalAlign"),Up.prototype),bi(Up.prototype,"verticalAlign",[lp,hp,up],Object.getOwnPropertyDescriptor(Up.prototype,"verticalAlign"),Up.prototype),bi(Up.prototype,"fontSize",[cp,dp],Object.getOwnPropertyDescriptor(Up.prototype,"fontSize"),Up.prototype),bi(Up.prototype,"fontFamily",[pp,fp,_p],Object.getOwnPropertyDescriptor(Up.prototype,"fontFamily"),Up.prototype),bi(Up.prototype,"lineHeight",[gp,mp],Object.getOwnPropertyDescriptor(Up.prototype,"lineHeight"),Up.prototype),bi(Up.prototype,"overflow",[yp,vp,bp],Object.getOwnPropertyDescriptor(Up.prototype,"overflow"),Up.prototype),bi(Up.prototype,"enableWrapText",[Sp,Tp],Object.getOwnPropertyDescriptor(Up.prototype,"enableWrapText"),Up.prototype),bi(Up.prototype,"font",[Ep,Ap,Cp,wp],Object.getOwnPropertyDescriptor(Up.prototype,"font"),Up.prototype),bi(Up.prototype,"useSystemFont",[xp,Rp],Object.getOwnPropertyDescriptor(Up.prototype,"useSystemFont"),Up.prototype),bi(Up.prototype,"cacheMode",[Mp,Op,Pp],Object.getOwnPropertyDescriptor(Up.prototype,"cacheMode"),Up.prototype),bi(Up.prototype,"isBold",[Dp,Ip],Object.getOwnPropertyDescriptor(Up.prototype,"isBold"),Up.prototype),bi(Up.prototype,"isItalic",[Bp,Lp],Object.getOwnPropertyDescriptor(Up.prototype,"isItalic"),Up.prototype),bi(Up.prototype,"isUnderline",[Fp,kp],Object.getOwnPropertyDescriptor(Up.prototype,"isUnderline"),Up.prototype),bi(Up.prototype,"underlineHeight",[Np,Pi],Object.getOwnPropertyDescriptor(Up.prototype,"underlineHeight"),Up.prototype),Vp=bi(Up.prototype,"_string",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),Hp=bi(Up.prototype,"_horizontalAlign",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sf.CENTER}}),Gp=bi(Up.prototype,"_verticalAlign",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return af.CENTER}}),Wp=bi(Up.prototype,"_actualFontSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xp=bi(Up.prototype,"_fontSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Yp=bi(Up.prototype,"_fontFamily",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),jp=bi(Up.prototype,"_lineHeight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),qp=bi(Up.prototype,"_overflow",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return lf.NONE}}),Kp=bi(Up.prototype,"_enableWrapText",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zp=bi(Up.prototype,"_font",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jp=bi(Up.prototype,"_isSystemFontUsed",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qp=bi(Up.prototype,"_isItalic",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$p=bi(Up.prototype,"_isBold",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tf=bi(Up.prototype,"_isUnderline",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ef=bi(Up.prototype,"_underlineHeight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),rf=bi(Up.prototype,"_cacheMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hf.NONE}}),zp=Up))||zp)||zp)||zp)||zp));!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(cf||(cf={})),Hr(cf),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(df||(df={})),Hr(df),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(pf||(pf={})),Hr(pf);var _f=Math.PI,gf=Math.min,mf=Math.max,yf=Math.cos,vf=Math.sin,bf=Math.abs,Sf=Math.sign,Tf=.5522847493;function Ef(t,e,i,r,n){t.moveTo(e-r,i),t.bezierCurveTo(e-r,i+n*Tf,e-r*Tf,i+n,e,i+n),t.bezierCurveTo(e+r*Tf,i+n,e+r,i+n*Tf,e+r,i),t.bezierCurveTo(e+r,i-n*Tf,e+r*Tf,i-n,e,i-n),t.bezierCurveTo(e-r*Tf,i-n,e-r,i-n*Tf,e-r,i),t.close()}function Af(t,e,i,r,n,o,s,a,l,h,u){var c,d,p,f,_,g,m,y,v,b,S,T,E,A,C,w;h>10||(_=.5*(o+a),g=.5*(s+l),m=.5*((c=.5*(e+r))+(p=.5*(r+o))),y=.5*((d=.5*(i+n))+(f=.5*(n+s))),((C=bf((r-a)*(A=l-i)-(n-l)*(E=a-e)))+(w=bf((o-a)*A-(s-l)*E)))*(C+w)<t.tessTol*(E*E+A*A)?t.addPoint(a,l,0===u?u|pf.PT_BEVEL:u):(Af(t,e,i,c,d,m,y,S=.5*(m+(v=.5*(p+_))),T=.5*(y+(b=.5*(f+g))),h+1,0),Af(t,S,T,v,b,_,g,a,l,h+1,u)))}var Cf,wf,xf,Rf,Mf,Of,Pf,Df,If,Bf,Lf,Ff,kf,Nf,zf,Uf,Vf,Hf,Gf,Wf,Xf,Yf,jf=function(t){function e(e,i){var r;return(r=t.call(this,e,i)||this).dx=0,r.dy=0,r.dmx=0,r.dmy=0,r.flags=0,r.len=0,r.reset(),r}return He(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Cr),qf=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),Kf=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=tr.WHITE.clone(),this.lineCap=cf.BUTT,this.strokeColor=tr.BLACK.clone(),this.lineJoin=df.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,pf.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,pf.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,i,r,n,o){var s=this._curPath,a=s.points[s.points.length-1];a&&(a.x!==t||a.y!==e||i!==n||r!==o?(Af(this,a.x,a.y,t,e,i,r,n,o,0,pf.PT_CORNER),this._commandX=n,this._commandY=o):this.lineTo(n,o))},e.quadraticCurveTo=function(t,e,i,r){var n=this._commandX,o=this._commandY;this.bezierCurveTo(n+2/3*(t-n),o+2/3*(e-o),i+2/3*(t-i),r+2/3*(e-r),i,r)},e.arc=function(t,e,i,r,n,o){!function(t,e,i,r,n,o,s){var a,l,h=0,u=0,c=0,d=0,p=0,f=0,_=0,g=0,m=0,y=0,v=0,b=0,S=0,T=0;if(u=o-n,s=s||!1)if(bf(u)>=2*_f)u=2*_f;else for(;u<0;)u+=2*_f;else if(bf(u)>=2*_f)u=2*-_f;else for(;u>0;)u-=2*_f;for(l=0|mf(1,gf(bf(u)/(.5*_f)+.5,5)),c=bf(4/3*(1-yf(a=u/l/2))/vf(a)),s||(c=-c),T=0;T<=l;T++)f=e+(d=yf(h=n+u*(T/l)))*r,_=i+(p=vf(h))*r,g=-p*r*c,m=d*r*c,0===T?t.moveTo(f,_):t.bezierCurveTo(y+b,v+S,f-g,_-m,f,_),y=f,v=_,b=g,S=m}(this,t,e,i,r,n,o)},e.ellipse=function(t,e,i,r){Ef(this,t,e,i,r),this._curPath.complex=!1},e.circle=function(t,e,i){Ef(this,t,e,i,i),this._curPath.complex=!1},e.rect=function(t,e,i,r){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+r),this.lineTo(t,e+r),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,i,r,n){!function(t,e,i,r,n,o){if(o<.1)t.rect(e,i,r,n);else{var s=gf(o,.5*bf(r))*Sf(r),a=gf(o,.5*bf(n))*Sf(n);t.moveTo(e,i+a),t.lineTo(e,i+n-a),t.bezierCurveTo(e,i+n-a*(1-Tf),e+s*(1-Tf),i+n,e+s,i+n),t.lineTo(e+r-s,i+n),t.bezierCurveTo(e+r-s*(1-Tf),i+n,e+r,i+n-a*(1-Tf),e+r,i+n-a),t.lineTo(e+r,i+a),t.bezierCurveTo(e+r,i+a*(1-Tf),e+r-s*(1-Tf),i,e+r-s,i),t.lineTo(e+s,i),t.bezierCurveTo(e+s*(1-Tf),i,e,i+a*(1-Tf),e,i+a),t.close()}}(this,t,e,i,r,n),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,i=t.length;e<i;e++){var r=t[e];r&&Sd.remove(r)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=Sd.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,i){var r=this._curPath;if(r){var n=this._points,o=r.points,s=n[this.pointsOffset++];s?(s.x=t,s.y=e):(s=new jf(t,e),n.push(s)),s.flags=i,o.push(s)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new qf,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),Zf=[new Tt(Yt.ATTR_POSITION,d.RGB32F)],Jf=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA32F)],Qf=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RG32F),new Tt(Yt.ATTR_COLOR,d.RGBA32F)],$f=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RG32F),new Tt(Yt.ATTR_COLOR,d.RGBA32F),new Tt(Yt.ATTR_COLOR2,d.RGBA32F)];function t_(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=jt[r.format].count}return e}function e_(t){for(var e=0,i=0;i<t.length;i++){var r=t[i];e+=jt[r.format].size}return e}ei.internal.vfmtPosUvColor=Qf,ei.internal.vfmtPosUvTwoColor=$f,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:Zf,vfmtPosColor:Jf,vfmtPosUvColor:Qf,vfmtPosUvTwoColor:$f,getComponentPerVertex:t_,getAttributeStride:e_}));var i_,r_,n_,o_,s_,a_,l_,h_,u_,c_,d_,p_,f_,__,g_,m_,y_,v_,b_,S_,T_,E_,A_,C_,w_,x_,R_=Jf.concat([new Tt("a_dist",d.R32F)]),M_=t_(R_),O_=e_(R_),P_=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((Cf=_i("cc.Graphics"),wf=Ni(),xf=zi(110),Rf=Ui(),Mf=Di(df),Of=Vi(),Pf=Di(cf),Df=Vi(),If=Vi(),Bf=Vi(),Lf=Vi(),Ff=Hi(),Cf(kf=wf(kf=xf(kf=Rf((Yf=Xf=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,Si(e,"_lineWidth",zf,Ti(e)),Si(e,"_strokeColor",Uf,Ti(e)),Si(e,"_lineJoin",Vf,Ti(e)),Si(e,"_lineCap",Hf,Ti(e)),Si(e,"_fillColor",Gf,Ti(e)),Si(e,"_miterLimit",Wf,Ti(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=Jd.ADD_COLOR,e.impl=new Kf,e}He(e,t);var i=e.prototype;return i.onRestore=function(){this.impl||this._flushAssembler()},i.onLoad=function(){this.model=Fr.root.createModel(Ri),this.model.node=this.model.transform=this.node,this._flushAssembler()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._sceneGetter=null,this.model&&(Fr.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var i=0;i<e;++i)this._graphicsUseSubMeshes[i].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null)},i.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},i.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},i.bezierCurveTo=function(t,e,i,r,n,o){this.impl&&this.impl.bezierCurveTo(t,e,i,r,n,o)},i.quadraticCurveTo=function(t,e,i,r){this.impl&&this.impl.quadraticCurveTo(t,e,i,r)},i.arc=function(t,e,i,r,n,o){this.impl&&this.impl.arc(t,e,i,r,n,o)},i.ellipse=function(t,e,i,r){this.impl&&this.impl.ellipse(t,e,i,r)},i.circle=function(t,e,i){this.impl&&this.impl.circle(t,e,i)},i.rect=function(t,e,i,r){this.impl&&this.impl.rect(t,e,i,r)},i.roundRect=function(t,e,i,r,n){this.impl&&this.impl.roundRect(t,e,i,r,n)},i.fillRect=function(t,e,i,r){this.rect(t,e,i,r),this.fill()},i.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},i.close=function(){this.impl&&this.impl.close()},i.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},i.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},i._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Li.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},i.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=ei.director.root.device,i=e.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.DEVICE,65535*O_,O_)),r=e.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),n=new gi([i],R_,F.TRIANGLE_LIST,r);n.subMeshIdx=0,this.model.initSubModel(t,n,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(n)}}else $e(4500,this.node.name)},i._uploadData=function(t){var e=this.impl;if(e){var i=e&&e.getRenderDataList();if(!(i.length<=0)&&this.model){for(var r=this.model.subModels,n=0;n<i.length;n++){var o=i[n],s=r[n].inputAssembler;if(o.lastFilledVertex!==o.vertexStart){var a=new Float32Array(o.vData.buffer,0,o.vertexStart*M_);s.vertexBuffers[0].update(a),s.vertexCount=o.vertexStart;var l=new Uint16Array(o.iData.buffer,0,o.indicesStart);s.indexBuffer.update(l),s.indexCount=o.indicesStart,o.lastFilledVertex=o.vertexStart,o.lastFilledIndices=o.indicesStart}}t.removeUploadBuffersFunc(this),this._isNeedUploadData=!1}}},i._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),i=this.model.subModels.length;if(e.length>i)for(var r=i;r<e.length;r++)this.activeSubModel(r)}t.addUploadBuffersFunc(this,this._uploadData)}t.commitModel(this,this.model,this.getMaterialInstance(0))},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},i._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},Ge(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),e}(uf),Xf.LineJoin=df,Xf.LineCap=cf,bi((Nf=Yf).prototype,"lineWidth",[Pi],Object.getOwnPropertyDescriptor(Nf.prototype,"lineWidth"),Nf.prototype),bi(Nf.prototype,"lineJoin",[Mf,Of],Object.getOwnPropertyDescriptor(Nf.prototype,"lineJoin"),Nf.prototype),bi(Nf.prototype,"lineCap",[Pf,Df],Object.getOwnPropertyDescriptor(Nf.prototype,"lineCap"),Nf.prototype),bi(Nf.prototype,"strokeColor",[If],Object.getOwnPropertyDescriptor(Nf.prototype,"strokeColor"),Nf.prototype),bi(Nf.prototype,"fillColor",[Bf],Object.getOwnPropertyDescriptor(Nf.prototype,"fillColor"),Nf.prototype),bi(Nf.prototype,"miterLimit",[Lf],Object.getOwnPropertyDescriptor(Nf.prototype,"miterLimit"),Nf.prototype),bi(Nf.prototype,"color",[Ar,Ff],Object.getOwnPropertyDescriptor(Nf.prototype,"color"),Nf.prototype),zf=bi(Nf.prototype,"_lineWidth",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Uf=bi(Nf.prototype,"_strokeColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.BLACK.clone()}}),Vf=bi(Nf.prototype,"_lineJoin",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return df.MITER}}),Hf=bi(Nf.prototype,"_lineCap",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cf.BUTT}}),Gf=bi(Nf.prototype,"_fillColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),Wf=bi(Nf.prototype,"_miterLimit",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),kf=Nf))||kf)||kf)||kf)||kf)),D_=new Wi,I_=new Cr,B_=new Wi,L_=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(x_||(x_={})),Hr(x_);var F_=function(e){return t({Mask:e,MaskComponent:e}),e}((i_=_i("cc.Mask"),r_=Ni(),n_=zi(110),o_=Ui(),s_=Di(x_),a_=Ur(),l_=Vi(),h_=Ur(),u_=Vi(),c_=Hi(),d_=Di(dc),p_=Hi(),f_=Hi(),__=Ji(),g_=Hi(),m_=Hi(),i_(y_=r_(y_=n_(y_=o_((w_=C_=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,Si(e,"_type",b_,Ti(e)),Si(e,"_inverted",S_,Ti(e)),Si(e,"_segments",T_,Ti(e)),Si(e,"_spriteFrame",E_,Ti(e)),Si(e,"_alphaThreshold",A_,Ti(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=Jd.ADD_COLOR,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},i.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._enableGraphics()},i.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},i.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearModel&&this._clearModelMesh&&(Fr.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics()},i.isHit=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=i.width,n=i.height,o=I_;this.node.getWorldMatrix(D_),Wi.invert(B_,D_),Cr.transformMat4(o,t,B_);var s=e.anchorPoint;o.x+=s.x*r,o.y+=s.y*n;var a=!1;if(this.type===x_.RECT||this.type===x_.GRAPHICS_STENCIL)a=o.x>=0&&o.y>=0&&o.x<=r&&o.y<=n;else if(this.type===x_.ELLIPSE){var l=r/2,h=n/2,u=o.x-.5*r,c=o.y-.5*n;a=u*u/(l*l)+c*c/(h*h)<1}return this._inverted&&(a=!a),a},i._render=function(t){t.commitComp(this,null,this._assembler,null)},i._postRender=function(t){this._postAssembler&&t.commitComp(this,null,this._postAssembler,null)},i._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},i._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==x_.IMAGE_STENCIL||null!==this._spriteFrame)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this),i=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==i&&(this._postAssembler=i),this._useRenderData()},i._createGraphics=function(){if(!this._graphics){var t=this._graphics=new P_;t._objFlags|=jr.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=tr.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},i._updateGraphics=function(){if(this._graphics&&(this._type===x_.RECT||this._type===x_.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var i=t.contentSize,r=i.width,n=i.height,o=t.anchorPoint,s=-r*o.x,a=-n*o.y;if(this._type===x_.RECT)e.rect(s,a,r,n);else if(this._type===x_.ELLIPSE){for(var l=function(t,e,i){L_.length=0;for(var r=2*Math.PI/i,n=0;n<i;++n)L_.push(new fi(e.x*Math.cos(r*n)+t.x,e.y*Math.sin(r*n)+t.y,0));return L_}(new fi(s+r/2,a+n/2,0),new fi(r/2,n/2,0),this._segments),h=0;h<l.length;++h){var u=l[h];0===h?e.moveTo(u.x,u.y):e.lineTo(u.x,u.y)}e.close()}e.fill()}},i._createClearModel=function(){if(!this._clearModel){var t=Li.get("default-clear-stencil");this._clearStencilMtl=new qr({parent:t,owner:this,subModelIdx:0}),this._clearModel=Fr.root.createModel(Ri),this._clearModel.node=this._clearModel.transform=this.node;var e=e_(Zf),i=ei.director.root.device,r=i.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.DEVICE,4*e,e)),n=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);r.update(n);var o=i.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),s=new Uint16Array([0,1,2,2,1,3]);o.update(s),this._clearModelMesh=new gi([r],Zf,F.TRIANGLE_LIST,o),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},i._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=ud.DISABLED,this._type===x_.IMAGE_STENCIL?(t=Li.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=Li.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},i._enableGraphics=function(){this._graphics&&(this._graphics._renderFlag=this._graphics._canRender())},i._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},i._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},i._useRenderData=function(){this._type!==x_.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},Ge(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==x_.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.stencilStage=ud.DISABLED,this._graphics&&(this._graphics.stencilStage=ud.DISABLED)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=Zr(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===x_.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===x_.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),e}(uf),C_.Type=x_,bi((v_=w_).prototype,"type",[s_,a_,l_],Object.getOwnPropertyDescriptor(v_.prototype,"type"),v_.prototype),bi(v_.prototype,"inverted",[h_,u_],Object.getOwnPropertyDescriptor(v_.prototype,"inverted"),v_.prototype),bi(v_.prototype,"segments",[c_],Object.getOwnPropertyDescriptor(v_.prototype,"segments"),v_.prototype),bi(v_.prototype,"spriteFrame",[d_,p_],Object.getOwnPropertyDescriptor(v_.prototype,"spriteFrame"),v_.prototype),bi(v_.prototype,"alphaThreshold",[f_,__,Zi],Object.getOwnPropertyDescriptor(v_.prototype,"alphaThreshold"),v_.prototype),bi(v_.prototype,"color",[Ar,g_],Object.getOwnPropertyDescriptor(v_.prototype,"color"),v_.prototype),bi(v_.prototype,"customMaterial",[Ar,m_],Object.getOwnPropertyDescriptor(v_.prototype,"customMaterial"),v_.prototype),b_=bi(v_.prototype,"_type",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x_.RECT}}),S_=bi(v_.prototype,"_inverted",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),T_=bi(v_.prototype,"_segments",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),E_=bi(v_.prototype,"_spriteFrame",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A_=bi(v_.prototype,"_alphaThreshold",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),y_=v_))||y_)||y_)||y_)||y_));Kr._comp=F_,ei.Mask=F_;var k_,N_,z_,U_,V_,H_,G_,W_,X_,Y_,j_,q_,K_,Z_,J_,Q_,$_,tg,eg,ig,rg,ng,og,sg,ag,lg,hg,ug,cg,dg,pg,fg,_g,gg,mg,yg,vg,bg,Sg,Tg,Eg,Ag,Cg,wg,xg,Rg,Mg,Og,Pg,Dg,Ig,Bg,Lg,Fg,kg,Ng=/^(click)(\s)*=|(param)(\s)*=/,zg=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,Ug=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,i=t.length;e<i;){var r=t.indexOf(">",e),n=-1;if(r>=0&&(n=t.lastIndexOf("<",r))<e-1&&(n=t.indexOf("<",r+1),r=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{var o=t.substring(e,n),s=t.substring(n+1,r);""===s&&(o=t.substring(e,r+1)),this._processResult(o),-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(s),e=r+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},i=/^(color|size)(\s)*=/.exec(t),r="",n=0,o="";if(i){if(r=i[0],""===(t=t.substring(r.length).trim()))return e;switch(n=t.indexOf(" "),r[0]){case"c":e.color=n>-1?t.substring(0,n).trim():t;break;case"s":e.size=parseInt(t)}return n>-1&&(o=t.substring(n+1).trim(),e.event=this._processEventHandler(o)),e}if((i=/^(br(\s)*\/)/.exec(t))&&i[0].length>0&&(r=i[0].trim()).startsWith("br")&&"/"===r[r.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var s="";if((i=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&i[0].length>0&&(r=i[0].trim()).startsWith("img")&&"/"===r[r.length-1]){var a;i=zg.exec(t);for(var l=!1;i;){if(r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),a=(n=(s=t.substring(r.length).trim()).indexOf(" "))>-1?s.substr(0,n):s,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=s.substring(n).trim(),a.endsWith("/")&&(a=a.slice(0,-1)),"src"===r){switch(a.charCodeAt(0)){case 34:case 39:l=!0,a=a.slice(1,-1)}e.isImage=!0,e.src=a}else if("height"===r)e.imageHeight=parseInt(a);else if("width"===r)e.imageWidth=parseInt(a);else if("align"===r){switch(a.charCodeAt(0)){case 34:case 39:a=a.slice(1,-1)}e.imageAlign=a.toLowerCase()}else"offset"===r?e.imageOffset=a:"click"===r&&(e.event=this._processEventHandler(r+"="+a));e.event&&"param"===r&&(e.event[r]=a.replace(/^"|"$/g,"")),i=zg.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(i=/^(outline(\s)*[^>]*)/.exec(t)){var h={color:"#ffffff",width:1};if(t=i[0].substring("outline".length).trim()){var u,c=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(i=c.exec(t);i;)r=(t=t.substring(t.indexOf(i[0]))).substr(0,i[0].length),u=(n=(s=t.substring(r.length).trim()).indexOf(" "))>-1?s.substr(0,n):s,r=(r=r.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=s.substring(n).trim(),"click"===r?e.event=this._processEventHandler(r+"="+u):"color"===r?h.color=u:"width"===r&&(h.width=parseInt(u)),e.event&&"param"===r&&(e.event[r]=u.replace(/^"|"$/g,"")),i=c.exec(t)}e.outline=h}if((i=/^(on|u|b|i)(\s)*/.exec(t))&&i[0].length>0){switch(r=i[0],t=t.substring(r.length).trim(),r[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e._processEventHandler=function(t){for(var e={},i=0,r=!1,n=Ng.exec(t);n;){var o=n[0],s="";if(r=!1,'"'===(t=t.substring(o.length).trim()).charAt(0))(i=t.indexOf('"',1))>-1&&(s=t.substring(1,i).trim(),r=!0),i++;else if("'"===t.charAt(0))(i=t.indexOf("'",1))>-1&&(s=t.substring(1,i).trim(),r=!0),i++;else{var a=/(\S)+/.exec(t);i=(s=a?a[0]:"").length}r&&(e[o=o.substring(0,o.length-1).trim()]=s),t=t.substring(i).trim(),n=Ng.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var r in i)e[r]||(e[r]=i[r]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,i=qe(this._specialSymbolArray);!(e=i()).done;){var r=e.value,n=r[0],o=r[1];t=t.replace(n,o)}return t},t}()),Vg=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((k_=_i("cc.LabelOutline"),N_=Ni(),z_=zi(110),U_=Ui(),V_=Gr(ff),H_=Vi(),G_=Vi(),k_(W_=N_(W_=z_(W_=U_(W_=V_(W_=Ii((q_=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_color",Y_,Ti(e)),Si(e,"_width",j_,Ti(e)),e}He(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(ff);t&&t.updateRenderData(!0)},Ge(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}($i),Y_=bi((X_=q_).prototype,"_color",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(0,0,0,255)}}),j_=bi(X_.prototype,"_width",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),bi(X_.prototype,"color",[H_],Object.getOwnPropertyDescriptor(X_.prototype,"color"),X_.prototype),bi(X_.prototype,"width",[G_],Object.getOwnPropertyDescriptor(X_.prototype,"width"),X_.prototype),W_=X_))||W_)||W_)||W_)||W_)||W_)||W_));!function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(Bg||(Bg={})),Hr(Bg),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(Lg||(Lg={})),Hr(Lg),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(Fg||(Fg={})),Hr(Fg),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(kg||(kg={}));var Hg,Gg,Wg,Xg,Yg,jg,qg,Kg,Zg,Jg,Qg,$g,tm,em,im,rm=function(e){return t({Sprite:e,SpriteComponent:e}),e}((K_=_i("cc.Sprite"),Z_=Ni(),J_=zi(110),Q_=Ui(),$_=Di(fc),tg=Ur(),eg=Vi(),ig=Di(dc),rg=Ur(),ng=Vi(),og=Di(Bg),sg=Ur(),ag=Vi(),lg=Di(Lg),hg=Vi(),ug=Vi(),cg=Ji(),dg=Vi(),pg=Ji(),fg=Vi(),_g=Ur(),gg=Vi(),mg=Di(Fg),yg=Ur(),vg=Vi(),K_(bg=Z_(bg=J_(bg=Q_((Ig=Dg=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_spriteFrame",Tg,Ti(e)),Si(e,"_type",Eg,Ti(e)),Si(e,"_fillType",Ag,Ti(e)),Si(e,"_sizeMode",Cg,Ti(e)),Si(e,"_fillCenter",wg,Ti(e)),Si(e,"_fillStart",xg,Ti(e)),Si(e,"_fillRange",Rg,Ti(e)),Si(e,"_isTrimmedMode",Mg,Ti(e)),Si(e,"_useGrayscale",Og,Ti(e)),Si(e,"_atlas",Pg,Ti(e)),e}He(e,t);var i=e.prototype;return i.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},i.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial(),this._markForUpdateUvDirty()},i.onDestroy=function(){this.destroyRenderData(),t.prototype.onDestroy.call(this)},i.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},i.changeMaterialForDefine=function(){var t,e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var i=!1;if(t instanceof Xr){var r=t.getPixelFormat();i=r===Er.RGBA_ETC1||r===Er.RGB_A_PVRTC_4BPPV1||r===Er.RGB_A_PVRTC_2BPPV1}i&&this.grayscale?this._instanceMaterialType=Jd.USE_ALPHA_SEPARATED_AND_GRAY:i?this._instanceMaterialType=Jd.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=Jd.GRAYSCALE:this._instanceMaterialType=Jd.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()},i._updateBuiltinMaterial=function(){var e=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof Jr){var i=Qr({SAMPLE_FROM_RT:!0},e.passes[0].defines),r=new Sr;r.initialize({effectAsset:e.effectAsset,defines:i}),e=r}return e},i._render=function(t){t.commitComp(this,this._spriteFrame,this._assembler,null)},i._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.texture)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this._colorDirty=!0,this._updateColor())},i._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(Fg.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(Fg.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},i._resized=function(){},i._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)},i._applySpriteFrame=function(t){var e=this._spriteFrame;this._renderData&&(this._renderData.uvDirty||(this._renderData.uvDirty=!t||!e||t.uvHash!==e.uvHash),this._renderDataFlag=this._renderData.uvDirty);var i=!1;e&&(t&&t.texture===e.texture||(i=!0),i&&this.changeMaterialForDefine(),this._applySpriteSize())},i._markForUpdateUvDirty=function(){this._renderData&&(this._renderData.uvDirty=!0,this._renderDataFlag=!0)},Ge(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===Lg.RADIAL||this._fillType===Lg.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===Bg.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=Zr(t,-1,1),this._type===Bg.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=Zr(t,-1,1),this._type===Bg.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._renderData.uvDirty=!0)}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===Bg.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this._instanceMaterialType=!0===t?Jd.GRAYSCALE:Jd.ADD_COLOR_AND_TEXTURE,this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==Fg.CUSTOM&&this._applySpriteSize())}}]),e}(uf),Dg.FillType=Lg,Dg.Type=Bg,Dg.SizeMode=Fg,Dg.EventType=kg,bi((Sg=Ig).prototype,"spriteAtlas",[$_,tg,eg],Object.getOwnPropertyDescriptor(Sg.prototype,"spriteAtlas"),Sg.prototype),bi(Sg.prototype,"spriteFrame",[ig,rg,ng],Object.getOwnPropertyDescriptor(Sg.prototype,"spriteFrame"),Sg.prototype),bi(Sg.prototype,"type",[og,sg,ag],Object.getOwnPropertyDescriptor(Sg.prototype,"type"),Sg.prototype),bi(Sg.prototype,"fillType",[lg,hg],Object.getOwnPropertyDescriptor(Sg.prototype,"fillType"),Sg.prototype),bi(Sg.prototype,"fillCenter",[ug],Object.getOwnPropertyDescriptor(Sg.prototype,"fillCenter"),Sg.prototype),bi(Sg.prototype,"fillStart",[cg,dg],Object.getOwnPropertyDescriptor(Sg.prototype,"fillStart"),Sg.prototype),bi(Sg.prototype,"fillRange",[pg,fg],Object.getOwnPropertyDescriptor(Sg.prototype,"fillRange"),Sg.prototype),bi(Sg.prototype,"trim",[_g,gg],Object.getOwnPropertyDescriptor(Sg.prototype,"trim"),Sg.prototype),bi(Sg.prototype,"grayscale",[Pi],Object.getOwnPropertyDescriptor(Sg.prototype,"grayscale"),Sg.prototype),bi(Sg.prototype,"sizeMode",[mg,yg,vg],Object.getOwnPropertyDescriptor(Sg.prototype,"sizeMode"),Sg.prototype),Tg=bi(Sg.prototype,"_spriteFrame",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Eg=bi(Sg.prototype,"_type",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bg.SIMPLE}}),Ag=bi(Sg.prototype,"_fillType",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Lg.HORIZONTAL}}),Cg=bi(Sg.prototype,"_sizeMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fg.TRIMMED}}),wg=bi(Sg.prototype,"_fillCenter",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(0,0)}}),xg=bi(Sg.prototype,"_fillStart",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rg=bi(Sg.prototype,"_fillRange",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mg=bi(Sg.prototype,"_isTrimmedMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Og=bi(Sg.prototype,"_useGrayscale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pg=bi(Sg.prototype,"_atlas",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bg=Sg))||bg)||bg)||bg)||bg)),nm=t("RenderRoot2D",_i("cc.RenderRoot2D")(Hg=zi(100)(Hg=Ui()(Hg=Gr(Dd)(Hg=Nr(Hg=Ii(Hg=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.onEnable=function(){ei.director.root.batcher2D.addScreen(this)},i.onDisable=function(){ei.director.root.batcher2D.removeScreen(this)},i.onDestroy=function(){ei.director.root.batcher2D.removeScreen(this)},e}($i))||Hg)||Hg)||Hg)||Hg)||Hg)||Hg),om=new fi,sm=Mi({OVERLAY:0,INTERSPERSE:1}),am=function(e){return t({Canvas:e,CanvasComponent:e}),e}((Gg=_i("cc.Canvas"),Wg=Ni(),Xg=zi(100),Yg=Ui(),jg=Di($r),qg=Vi(),Kg=Vi(),Zg=Di($r),Gg(Jg=Wg(Jg=Xg(Jg=Yg(Jg=Ii(Jg=Nr((em=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_cameraComponent",$g,Ti(e)),Si(e,"_alignCanvasWithScreen",tm,Ti(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new fi,e._renderMode=sm.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(Ti(e)),e}He(e,t);var i=e.prototype;return i.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on($r.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(zr.TRANSFORM_CHANGED,this._thisOnCameraResized)},i.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on($r.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},i.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off($r.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(zr.TRANSFORM_CHANGED,this._thisOnCameraResized)},i._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture){var t=this._cameraComponent.targetTexture.window;this._cameraComponent.camera&&this._cameraComponent.camera.setFixedSize(t.width,t.height),this._cameraComponent.orthoHeight=Vr.height/2}else if(tn.canvas){var e=tn.canvas;this._cameraComponent.camera&&this._cameraComponent.camera.resize(e.width,e.height),this._cameraComponent.orthoHeight=tn.canvas.height/en.getScaleY()/2}this.node.getWorldPosition(om),this._cameraComponent.node.setWorldPosition(om.x,om.y,1e3)}},i._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===sm.OVERLAY?e|1<<30:e&~(1<<30)}return 0},Ge(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),e}(nm),bi((Qg=em).prototype,"cameraComponent",[jg,qg],Object.getOwnPropertyDescriptor(Qg.prototype,"cameraComponent"),Qg.prototype),bi(Qg.prototype,"alignCanvasWithScreen",[Kg],Object.getOwnPropertyDescriptor(Qg.prototype,"alignCanvasWithScreen"),Qg.prototype),$g=bi(Qg.prototype,"_cameraComponent",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tm=bi(Qg.prototype,"_alignCanvasWithScreen",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Jg=Qg))||Jg)||Jg)||Jg)||Jg)||Jg)||Jg));ei.Canvas=am;var lm,hm,um,cm,dm,pm,fm,_m,gm,mm,ym,vm,bm,Sm,Tm,Em,Am,Cm,wm,xm,Rm,Mm,Om,Pm,Dm,Im,Bm,Lm,Fm,km,Nm,zm,Um,Vm,Hm,Gm=t("UIComponent",_i("cc.UIComponent")(im=Gr(Dd)(im=zi(110)(im=Nr(im=Ii(im=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastParent=null,e.stencilStage=ud.DISABLED,e}He(e,t);var i=e.prototype;return i.__preload=function(){this.node._uiProps.uiComp=this},i.onEnable=function(){},i.onDisable=function(){},i.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},i.updateAssembler=function(){},i.postUpdateAssembler=function(){},i.markForUpdateRenderData=function(){},e}($i))||im)||im)||im)||im)||im);Yi(Gm.prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),Xi(am.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:tr.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),rn(uf.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor",suggest:"Please use a custom material to specify blending options instead."},{name:"dstBlendFactor",suggest:"Please use a custom material to specify blending options instead."}]),rn(Dd.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),ei.UITransformComponent=Dd,qi.setClassAlias(Dd,"cc.UITransformComponent"),qi.setClassAlias(uf,"cc.RenderComponent"),ei.CanvasComponent=am,qi.setClassAlias(am,"cc.CanvasComponent");var Wm=new Ug,Xm="RICHTEXT_CHILD",Ym="RICHTEXT_Image_CHILD",jm=new Lr((function(t){if(!ei.isValid(t.node))return!1;var e=t.node.getComponent(Vg);return e&&(e.width=0),!0}),20),qm=new Lr((function(t){return ei.isValid(t.node)}),10);function Km(t){return{node:new br(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function Zm(t,e){var i;t===Xm?i=jm._get():t===Ym&&(i=qm._get());var r=(i=i||Km(t)).node;return r||(r=new br(t)),r.hideFlags|=jr.Flags.DontSave|jr.Flags.HideInHierarchy,t===Ym?(i.comp=r.getComponent(rm)||r.addComponent(rm),i.comp.spriteFrame=e,i.comp.type=rm.Type.SLICED,i.comp.sizeMode=rm.SizeMode.CUSTOM):(i.comp=r.getComponent(ff)||r.addComponent(ff),i.comp.string=e,i.comp.horizontalAlign=sf.LEFT,i.comp.verticalAlign=af.TOP),r.setPosition(0,0,0),r._uiProps.uiTransformComp.setAnchorPoint(.5,.5),i.node=r,i.lineCount=0,i.styleIndex=0,i.imageOffset="",i.clickParam="",i.clickHandler="",i}var Jm,Qm=function(e){return t({RichText:e,RichTextComponent:e}),e}((lm=_i("cc.RichText"),hm=Ni(),um=zi(110),cm=Ui(),dm=Vi(),pm=Di(sf),fm=Vi(),_m=Vi(),gm=Vi(),mm=Di(vc),ym=Vi(),vm=Vi(),bm=Di(hf),Sm=Vi(),Tm=Vi(),Em=Vi(),Am=Di(fc),Cm=Vi(),wm=Vi(),lm(xm=hm(xm=um(xm=cm(xm=Ii((Hm=Vm=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_lineHeight",Mm,Ti(e)),Si(e,"_string",Om,Ti(e)),Si(e,"_horizontalAlign",Pm,Ti(e)),Si(e,"_fontSize",Dm,Ti(e)),Si(e,"_maxWidth",Im,Ti(e)),Si(e,"_fontFamily",Bm,Ti(e)),Si(e,"_font",Lm,Ti(e)),Si(e,"_isSystemFontUsed",Fm,Ti(e)),Si(e,"_userDefinedFont",km,Ti(e)),Si(e,"_cacheMode",Nm,Ti(e)),Si(e,"_imageAtlas",zm,Ti(e)),Si(e,"_handleTouchEvent",Um,Ti(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._updateRichTextStatus=e._updateRichText,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this.node.on(zr.LAYER_CHANGED,this._applyLayer,this)},i.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},i.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},i.start=function(){this._onTTFLoaded(),this.node.on(zr.ANCHOR_CHANGED,this._updateRichTextPosition,this)},i.onRestore=function(){},i.onDestroy=function(){for(var t,e=qe(this._segments);!(t=e()).done;){var i=t.value;i.node.removeFromParent(),i.type===Xm?jm.put(i):i.type===Ym&&qm.put(i)}this.node.off(zr.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(zr.LAYER_CHANGED,this._applyLayer,this)},i._addEventListeners=function(){this.node.on(zr.TOUCH_END,this._onTouchEnded,this)},i._removeEventListeners=function(){this.node.off(zr.TOUCH_END,this._onTouchEnded,this)},i._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},i._createFontLabel=function(t){return Zm(Xm,t)},i._createImage=function(t){return Zm(Ym,t)},i._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},i._measureText=function(t,e){var i=this,r=function(e){var r;return 0===i._labelSegmentsCache.length?(r=i._createFontLabel(e),i._labelSegmentsCache.push(r)):(r=i._labelSegmentsCache[0]).node.getComponent(ff).string=e,r.styleIndex=t,i._applyTextAttribute(r),r.node._uiProps.uiTransformComp.contentSize.width};return e?r(e):r},i._onTouchEnded=function(t){for(var e,i=this,r=this.node.getComponents($i),n=function(){var n=e.value,o=n.clickHandler,s=n.clickParam;o&&i._containsTouchLocation(n,t.touch.getUILocation())&&(r.forEach((function(e){var i=e[o];e.enabledInHierarchy&&i&&i.call(e,t,s)})),t.propagationStopped=!0)},o=qe(this._segments);!(e=o()).done;)n()},i._containsTouchLocation=function(t,e){var i=t.node.getComponent(Dd);return!!i&&i.getBoundingBoxToWorld().contains(e)},i._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var i=t[e];if(i.name===Xm||i.name===Ym){i.parent===this.node?i.parent=null:t.splice(e,1);var r=Km(i.name);r.node=i,i.name===Xm?(r.comp=i.getComponent(ff),jm.put(r)):(r.comp=i.getComponent(rm),qm.put(r))}}t.length=0,this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},i._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var i=this.node.children[e];i.name!==Xm&&i.name!==Ym||(i.active=t)}},i._addLabelSegment=function(t,e){var i;if(0===this._labelSegmentsCache.length)i=this._createFontLabel(t);else{var r=(i=this._labelSegmentsCache.pop()).node.getComponent(ff);r&&(r.string=t)}return i.styleIndex=e,i.lineCount=this._lineCount,i.node._uiProps.uiTransformComp.setAnchorPoint(0,0),i.node.layer=this.node.layer,this._applyTextAttribute(i),this.node.addChild(i.node),this._segments.push(i),i},i._updateRichTextWithMaxWidth=function(t,e,i){var r=e;if(this._lineOffsetX>0&&r+this._lineOffsetX>this._maxWidth)for(var n=0;this._lineOffsetX<=this._maxWidth;){var o=this._getFirstWordLen(t,n,t.length),s=t.substr(n,o),a=this._measureText(i,s);if(!(this._lineOffsetX+a<=this._maxWidth)){if(n>0){var l=t.substr(0,n);this._addLabelSegment(l,i),t=t.substr(n,t.length),r=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,n+=o}if(r>this._maxWidth)for(var h=Kc(t,r,this._maxWidth,this._measureText(i)),u=0;u<h.length;++u){var c=h[u],d=this._addLabelSegment(c,i).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=d.width,h.length>1&&u<h.length-1&&this._updateLineInfo()}else this._lineOffsetX+=r,this._addLabelSegment(t,i)},i._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},i._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},i._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var i=this._textArray[e],r=t[e];if(i.text!==r.text)return!0;var n=i.style,o=r.style;if(n){if(o){if(!!o.outline!=!!n.outline)return!0;if(n.size!==o.size||n.italic!==o.italic||n.isImage!==o.isImage)return!0;if(n.src!==o.src||n.imageAlign!==o.imageAlign||n.imageHeight!==o.imageHeight||n.imageWidth!==o.imageWidth||n.imageOffset!==o.imageOffset)return!0}else if(n.size||n.italic||n.isImage||n.outline)return!0}else if(o&&(o.size||o.italic||o.isImage||o.outline))return!0}return!1},i._addRichTextImageElement=function(t){if(t.style){var e=t.style,i=e.src,r=this._imageAtlas&&i&&this._imageAtlas.getSpriteFrame(i);if(r){var n=this._createImage(r);switch(n.comp,e.imageAlign){case"top":n.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":n.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:n.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}n.node.layer=this.node.layer,this.node.addChild(n.node),this._segments.push(n);var o=r.rect.clone(),s=1,a=o.width,l=o.height,h=e.imageWidth||0,u=e.imageHeight||0;u>0?(a*=s=u/l,l*=s):(a*=s=this._lineHeight/l,l*=s),h>0&&(a=h),this._maxWidth>0?(this._lineOffsetX+a>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=a):(this._lineOffsetX+=a,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.node._uiProps.uiTransformComp.setContentSize(a,l),n.lineCount=this._lineCount,n.clickHandler="",n.clickParam="";var c=e.event;c&&(n.clickHandler=c.click,n.clickParam=c.param)}else $e(4400)}},i._updateRichText=function(){if(this.enabledInHierarchy){var t=Wm.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,i=!1,r=0;r<this._textArray.length;++r){var n=this._textArray[r],o=n.text;if(void 0!==o){if(""===o){if(n.style&&n.style.isNewLine){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this._imageAtlas){this._addRichTextImageElement(n);continue}}for(var s=o.split("\n"),a=0;a<s.length;++a){var l=s[a];if(""!==l)if(i=!1,this._maxWidth>0){var h=this._measureText(r,l);this._updateRichTextWithMaxWidth(l,h,r),s.length>1&&a<s.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(l,r),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),s.length>1&&a<s.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(o)&&a===s.length-1)continue;this._updateLineInfo(),i=!0}}}}i||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+Lc)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},i._getFirstWordLen=function(t,e,i){var r=t.charAt(e);if(Xc(r)||Yc(r))return 1;for(var n=1,o=e+1;o<i&&!Yc(r=t.charAt(o))&&!Xc(r);++o)n++;return n},i._updateRichTextPosition=function(){for(var t=0,e=1,i=this._lineCount,r=this.node._uiProps.uiTransformComp,n=r.anchorX,o=r.anchorY,s=0;s<this._segments.length;++s){var a=this._segments[s],l=a.lineCount;l>e&&(t=0,e=l);var h=this._labelWidth*(.5*this._horizontalAlign-n);switch(this._horizontalAlign){case sf.LEFT:break;case sf.CENTER:h-=this._linesWidth[l-1]/2;break;case sf.RIGHT:h-=this._linesWidth[l-1]}var u=a.node.position;if(a.node.setPosition(t+h,this._lineHeight*(i-l)-this._labelHeight*o,u.z),l===e&&(t+=a.node._uiProps.uiTransformComp.width),a.node.getComponent(rm)){var c=a.node.position.clone(),d=this._lineHeight,p=this._lineHeight*(1+Lc);switch(a.node._uiProps.uiTransformComp.anchorY){case 1:c.y+=d+(p-d)/2;break;case.5:c.y+=p/2;break;default:c.y+=(p-d)/2}if(a.imageOffset){var f=a.imageOffset.split(",");if(1===f.length&&f[0]){var _=parseFloat(f[0]);Number.isInteger(_)&&(c.y+=_)}else if(2===f.length){var g=parseFloat(f[0]),m=parseFloat(f[1]);Number.isInteger(g)&&(c.x+=g),Number.isInteger(m)&&(c.y+=m)}}a.node.position=c}var y=a.node.getComponent(Vg);if(y){var v=a.node.position.clone();v.y-=y.width,a.node.position=v}}},i._convertLiteralColorValue=function(t){var e=t.toUpperCase();return tr[e]?tr[e]:(new tr).fromHEX(t)},i._applyTextAttribute=function(t){var e=t.node.getComponent(ff);if(e){this._resetLabelState(e);var i,r=t.styleIndex;if(this._textArray[r]&&(i=this._textArray[r].style),i){if(e.color=this._convertLiteralColorValue(i.color||"white"),e.isBold=!!i.bold,e.isItalic=!!i.italic,e.isUnderline=!!i.underline,i.outline){var n=t.node.getComponent(Vg);n||(n=t.node.addComponent(Vg)),n.color=this._convertLiteralColorValue(i.outline.color),n.width=i.outline.width}e.fontSize=i.size||this._fontSize,t.clickHandler="",t.clickParam="";var o=i.event;o&&(t.clickHandler=o.click||"",t.clickParam=o.param||"")}e.cacheMode=this._cacheMode,this._font instanceof vc&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var s=e._assembler;s&&s.updateRenderData(e)}},i._applyLayer=function(){for(var t,e=qe(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},i._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=tr.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},Ge(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(Gm),Vm.HorizontalAlign=sf,Vm.VerticalAlign=af,bi((Rm=Hm).prototype,"string",[Yr,dm],Object.getOwnPropertyDescriptor(Rm.prototype,"string"),Rm.prototype),bi(Rm.prototype,"horizontalAlign",[pm,fm],Object.getOwnPropertyDescriptor(Rm.prototype,"horizontalAlign"),Rm.prototype),bi(Rm.prototype,"fontSize",[_m],Object.getOwnPropertyDescriptor(Rm.prototype,"fontSize"),Rm.prototype),bi(Rm.prototype,"fontFamily",[gm],Object.getOwnPropertyDescriptor(Rm.prototype,"fontFamily"),Rm.prototype),bi(Rm.prototype,"font",[mm,ym],Object.getOwnPropertyDescriptor(Rm.prototype,"font"),Rm.prototype),bi(Rm.prototype,"useSystemFont",[vm],Object.getOwnPropertyDescriptor(Rm.prototype,"useSystemFont"),Rm.prototype),bi(Rm.prototype,"cacheMode",[bm,Sm],Object.getOwnPropertyDescriptor(Rm.prototype,"cacheMode"),Rm.prototype),bi(Rm.prototype,"maxWidth",[Tm],Object.getOwnPropertyDescriptor(Rm.prototype,"maxWidth"),Rm.prototype),bi(Rm.prototype,"lineHeight",[Em],Object.getOwnPropertyDescriptor(Rm.prototype,"lineHeight"),Rm.prototype),bi(Rm.prototype,"imageAtlas",[Am,Cm],Object.getOwnPropertyDescriptor(Rm.prototype,"imageAtlas"),Rm.prototype),bi(Rm.prototype,"handleTouchEvent",[wm],Object.getOwnPropertyDescriptor(Rm.prototype,"handleTouchEvent"),Rm.prototype),Mm=bi(Rm.prototype,"_lineHeight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Om=bi(Rm.prototype,"_string",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),Pm=bi(Rm.prototype,"_horizontalAlign",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sf.LEFT}}),Dm=bi(Rm.prototype,"_fontSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Im=bi(Rm.prototype,"_maxWidth",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bm=bi(Rm.prototype,"_fontFamily",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),Lm=bi(Rm.prototype,"_font",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fm=bi(Rm.prototype,"_isSystemFontUsed",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),km=bi(Rm.prototype,"_userDefinedFont",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nm=bi(Rm.prototype,"_cacheMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hf.NONE}}),zm=bi(Rm.prototype,"_imageAtlas",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Um=bi(Rm.prototype,"_handleTouchEvent",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xm=Rm))||xm)||xm)||xm)||xm)||xm)),$m=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(_i("cc.UIMeshRenderer")(Jm=Ni()(Jm=zi(110)(Jm=Ui()(Jm=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._models=null,e._modelComponent=null,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent?this._models=this._modelComponent._collectModels():console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},i.onEnable=function(){t.prototype.onEnable.call(this)},i.onDisable=function(){t.prototype.onDisable.call(this)},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null,this._models=null)},i.updateAssembler=function(t){if(this._models){this._modelComponent._detachFromScene();for(var e,i=qe(this._models);!(e=i()).done;){var r=e.value;t.commitModel.call(t,this,r,this._modelComponent.material)}return!0}return!1},i.update=function(){this._fitUIRenderQueue()},i._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var i=this._modelComponent.getMaterialInstance(e);if(null!=i)for(var r=i.passes,n=r.length,o=0;o<n;o++)r[o]._priority=nn.MAX-11,i.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},o)}},Ge(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(Gm))||Jm)||Jm)||Jm)||Jm),ty=t("MeshBuffer",function(){function t(t){this.vData=null,this.iData=null,this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=1,this._attributes=null,this._vertexBuffers=[],this._indexBuffer=null,this._iaInfo=null,this._batcher=void 0,this._dirty=!1,this._vertexFormatBytes=0,this._initVDataCount=0,this._initIDataCount=1536,this._outOfCallback=null,this._hInputAssemblers=[],this._nextFreeIAHandle=0,this._batcher=t}var e=t.prototype;return e.initialize=function(t,e){this._outOfCallback=e;var i=t_(t);this._vertexFormatBytes=i*Float32Array.BYTES_PER_ELEMENT,this._initVDataCount=256*this._vertexFormatBytes;var r=Float32Array.BYTES_PER_ELEMENT*i;this.vertexBuffers.length||this.vertexBuffers.push(this._batcher.device.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,r,r)));var n=Uint16Array.BYTES_PER_ELEMENT;this.indexBuffer||(this._indexBuffer=this._batcher.device.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,n,n))),this._attributes=t,this._iaInfo=new At(this.attributes,this.vertexBuffers,this.indexBuffer),this.vData&&this.iData||this._reallocBuffer()},e.request=function(t,e){void 0===t&&(t=4),void 0===e&&(e=6),this.lastByteOffset=this.byteOffset;var i=this.byteOffset+t*this._vertexFormatBytes,r=this.indicesOffset+e;if(t+this.vertexOffset>65535)return this._outOfCallback&&this._outOfCallback.call(this._batcher,t,e),!1;var n=this.vData.byteLength,o=this.iData.length;if(i>n||r>o){for(;n<i||o<r;)this._initVDataCount*=2,this._initIDataCount*=2,n=4*this._initVDataCount,o=this._initIDataCount;this._reallocBuffer()}return this.vertexOffset+=t,this.indicesOffset+=e,this.byteOffset=i,this._dirty=!0,!0},e.reset=function(){this.byteStart=0,this.byteOffset=0,this.indicesStart=0,this.indicesOffset=0,this.vertexStart=0,this.vertexOffset=0,this.lastByteOffset=0,this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this._attributes=null,this.vertexBuffers[0].destroy(),this.vertexBuffers.length=0,this.indexBuffer.destroy(),this._indexBuffer=null;for(var t=0;t<this._hInputAssemblers.length;t++)this._hInputAssemblers[t].destroy();this._hInputAssemblers.length=0},e.recordBatch=function(){var t=this.indicesOffset-this.indicesStart;if(!t)return null;this._hInputAssemblers.length<=this._nextFreeIAHandle&&this._hInputAssemblers.push(this._batcher.device.createInputAssembler(this._iaInfo));var e=this._hInputAssemblers[this._nextFreeIAHandle++];return e.firstIndex=this.indicesStart,e.indexCount=t,e},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){var t=new Float32Array(this.vData.buffer,0,this.byteOffset>>2),e=new Uint16Array(this.iData.buffer,0,this.indicesOffset);this.byteOffset>this.vertexBuffers[0].size&&this.vertexBuffers[0].resize(this.byteOffset),this.vertexBuffers[0].update(t),2*this.indicesOffset>this.indexBuffer.size&&this.indexBuffer.resize(2*this.indicesOffset),this.indexBuffer.update(e),this._dirty=!1}},e._reallocBuffer=function(){this._reallocVData(!0),this._reallocIData(!0)},e._reallocVData=function(t){var e;if(this.vData&&(e=new Uint8Array(this.vData.buffer)),this.vData=new Float32Array(this._initVDataCount),e&&t)for(var i=new Uint8Array(this.vData.buffer),r=0,n=e.length;r<n;r++)i[r]=e[r]},e._reallocIData=function(t){var e=this.iData;if(this.iData=new Uint16Array(this._initIDataCount),e&&t)for(var i=this.iData,r=0,n=e.length;r<n;r++)i[r]=e[r]},Ge(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}());ty.OPACITY_OFFSET=8;var ey,iy,ry,ny,oy,sy,ay,ly,hy,uy,cy,dy,py,fy,_y,gy,my,yy,vy,by,Sy,Ty,Ey,Ay,Cy,wy,xy=on.Enum.NONE|on.Enum.UI_3D,Ry=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=xy,this._inputAssember=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this.bufferBatch=null,this.inputAssembler=null,this.descriptorSet=null,this.camera=null,this.texture=null,this.sampler=null,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=xy,this.renderScene=null},e.fillPasses=function(t,e,i,r,n,o){if(t){var s=t.passes;if(!s)return;var a=0;this._shaders.length=s.length;for(var l=0;l<s.length;l++){this._passes[l]||(this._passes[l]=new sn(ei.director.root));var h=s[l],u=this._passes[l];h.update(),e||(e=h.depthStencilState,i=0),r||(r=h.blendState,n=0),-1===n&&(n=0),a=i<<16|n,u._initPassFromTarget(h,e,r,a),this._shaders[l]=u.getShaderVariant(o)}}},Ge(t,[{key:"native",get:function(){return this._nativeObj}},{key:"inputAssembler",get:function(){return this._inputAssember},set:function(t){this._inputAssember=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),My=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((ey=_i("cc.UIStaticBatch"),iy=Ni(),ry=Ui(),ny=zi(110),oy=Hi(),ey(sy=iy(sy=ry(sy=ny((ly=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._init=!1,e._meshBuffer=null,e._dirty=!0,e._lastMeshBuffer=null,e._uiDrawBatchList=[],e}He(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._getBatcher();if(t){var e=Qf,i=new ty(t);i.initialize(e,this._arrivalMaxBuffer.bind(this)),this._meshBuffer=i}},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._clearData(),this._meshBuffer&&(this._meshBuffer.destroy(),this._meshBuffer=null)},i.updateAssembler=function(t){t.currIsStatic=!0,this._dirty&&(t.finishMergeBatches(),this._lastMeshBuffer=t.currBufferBatch,t.currBufferBatch=this._meshBuffer,t.currStaticRoot=this),this._init&&(t.finishMergeBatches(),t.commitStaticBatch(this))},i.postUpdateAssembler=function(t){this._dirty&&(t.finishMergeBatches(),t.currBufferBatch=this._lastMeshBuffer,t.currStaticRoot=null,this._dirty=!1,this._init=!0,this.node._static=!0,this._meshBuffer.uploadBuffers()),t.currIsStatic=!1},i.markAsDirty=function(){this._getBatcher()&&(this.node._static=!1,this._dirty=!0,this._init=!1,this._clearData())},i._requireDrawBatch=function(){var t=new Ry;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},i._clearData=function(){if(this._meshBuffer){this._meshBuffer.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},i._getBatcher=function(){return Fr.root&&Fr.root.batcher2D?Fr.root.batcher2D:($e(9301),null)},i._arrivalMaxBuffer=function(){var t=this._getBatcher();t&&t.autoMergeBatches(),$e(9300)},Ge(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(uf),bi((ay=ly).prototype,"color",[Ar,oy],Object.getOwnPropertyDescriptor(ay.prototype,"color"),ay.prototype),sy=ay))||sy)||sy)||sy)||sy)),Oy=t("LabelShadow",(hy=_i("cc.LabelShadow"),uy=Ni(),cy=zi(110),dy=Ui(),py=Gr(ff),fy=Vi(),_y=Vi(),gy=Vi(),hy(my=uy(my=cy(my=dy(my=py(my=Ii((Ty=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_color",vy,Ti(e)),Si(e,"_offset",by,Ti(e)),Si(e,"_blur",Sy,Ti(e)),e}He(e,t);var i=e.prototype;return i.onEnable=function(){this._updateRenderData()},i.onDisable=function(){this._updateRenderData()},i._updateRenderData=function(){var t=this.node.getComponent(ff);t&&t.updateRenderData(!0)},Ge(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}($i),vy=bi((yy=Ty).prototype,"_color",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(0,0,0,255)}}),by=bi(yy.prototype,"_offset",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(2,2)}}),Sy=bi(yy.prototype,"_blur",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),bi(yy.prototype,"color",[fy],Object.getOwnPropertyDescriptor(yy.prototype,"color"),yy.prototype),bi(yy.prototype,"offset",[_y],Object.getOwnPropertyDescriptor(yy.prototype,"offset"),yy.prototype),bi(yy.prototype,"blur",[gy],Object.getOwnPropertyDescriptor(yy.prototype,"blur"),yy.prototype),my=yy))||my)||my)||my)||my)||my)||my)),Py=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}(_i("cc.UIOpacity")(Ey=Ni()(Ey=zi(110)(Ey=Ui()(Ey=Ii((wy=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_opacity",Cy,Ti(e)),e}He(e,t);var i=e.prototype;return i.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},i.onDisable=function(){this.node._uiProps.localOpacity=1},Ge(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=an(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}($i),bi((Ay=wy).prototype,"opacity",[Pi],Object.getOwnPropertyDescriptor(Ay.prototype,"opacity"),Ay.prototype),Cy=bi(Ay.prototype,"_opacity",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Ey=Ay))||Ey)||Ey)||Ey)||Ey)||Ey);ei.MaskComponent=F_,qi.setClassAlias(F_,"cc.MaskComponent"),ei.LabelComponent=ff,qi.setClassAlias(ff,"cc.LabelComponent"),ei.LabelOutlineComponent=Vg,qi.setClassAlias(Vg,"cc.LabelOutlineComponent"),ei.RichTextComponent=Qm,qi.setClassAlias(Qm,"cc.RichTextComponent"),ei.SpriteComponent=rm,qi.setClassAlias(rm,"cc.SpriteComponent"),ei.UIModelComponent=$m,qi.setClassAlias($m,"cc.UIModelComponent"),ei.GraphicsComponent=P_,qi.setClassAlias(P_,"cc.GraphicsComponent"),qi.setClassAlias(My,"cc.UIStaticBatchComponent"),qi.setClassAlias(Py,"cc.UIOpacityComponent");var Dy=function(t,e,i){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i};function Iy(t,e,i,r,n){var o=0,s=null;if(n===function(t,e,i,r){for(var n=0,o=e,s=i-r;o<i;o+=r)n+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return n}(t,e,i,r)>0)for(o=e;o<i;o+=r)s=Jy(o,t[o],t[o+1],s);else for(o=i-r;o>=e;o-=r)s=Jy(o,t[o],t[o+1],s);return s&&jy(s,s.next)&&(Qy(s),s=s.next),s}function By(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var i=t,r=!1;do{if(r=!1,i.steiner||!jy(i,i.next)&&0!==Yy(i.prev,i,i.next))i=i.next;else{if(Qy(i),(i=e=i.prev)===i.next)return null;r=!0}}while(r||i!==e);return e}function Ly(t,e,i,r,n,o,s){if(void 0===s&&(s=0),t){!s&&o&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=Hy(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e=0,i=null,r=null,n=null,o=null,s=0,a=0,l=0,h=1;do{for(i=t,t=null,o=null,s=0;i;){for(s++,r=i,a=0,e=0;e<h&&(a++,r=r.nextZ);e++);for(l=h;a>0||l>0&&r;)0===a?(n=r,r=r.nextZ,l--):0!==l&&r?i.z<=r.z?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,a--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1)}(n)}(t,r,n,o);for(var a=t,l=null,h=null;t.prev!==t.next;)if(l=t.prev,h=t.next,o?ky(t,r,n,o):Fy(t))e.push(l.i/i),e.push(t.i/i),e.push(h.i/i),Qy(t),t=h.next,a=h.next;else if((t=h)===a){s?1===s?Ly(t=Ny(t,e,i),e,i,r,n,o,2):2===s&&zy(t,e,i,r,n,o):Ly(By(t),e,i,r,n,o,1);break}}}function Fy(t){var e=t.prev,i=t,r=t.next;if(Yy(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(Wy(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&Yy(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function ky(t,e,i,r){var n=t.prev,o=t,s=t.next;if(Yy(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,l=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,u=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,c=Hy(a,l,e,i,r),d=Hy(h,u,e,i,r),p=t.nextZ;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&Wy(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Yy(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&Wy(n.x,n.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Yy(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function Ny(t,e,i){var r=t;do{var n=r.prev,o=r.next.next;!jy(n,o)&&qy(n,r,r.next,o)&&Ky(n,o)&&Ky(o,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(o.i/i),Qy(r),Qy(r.next),r=t=o),r=r.next}while(r!==t);return r}function zy(t,e,i,r,n,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Xy(s,a)){var l=Zy(s,a);return s=By(s,s.next),l=By(l,l.next),Ly(s,e,i,r,n,o),void Ly(l,e,i,r,n,o)}a=a.next}s=s.next}while(s!==t)}function Uy(t,e){return t.x-e.x}function Vy(t,e){if(e=function(t,e){var i=e,r=t.x,n=t.y,o=-1/0,s=null;do{if(n<=i.y&&n>=i.next.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>o){if(o=a,a===r){if(n===i.y)return i;if(n===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(r===o)return s.prev;var l,h=s,u=s.x,c=s.y,d=1/0;for(i=s.next;i!==h;)r>=i.x&&i.x>=u&&Wy(n<c?r:o,n,u,c,n<c?o:r,n,i.x,i.y)&&((l=Math.abs(n-i.y)/(r-i.x))<d||l===d&&i.x>s.x)&&Ky(i,t)&&(s=i,d=l),i=i.next;return s}(t,e)){var i=Zy(e,t);By(i,i.next)}}function Hy(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Gy(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function Wy(t,e,i,r,n,o,s,a){return(n-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(i-s)*(e-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function Xy(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&qy(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&Ky(t,e)&&Ky(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{i.y>o!=i.next.y>o&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function Yy(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function jy(t,e){return t.x===e.x&&t.y===e.y}function qy(t,e,i,r){return!!(jy(t,e)&&jy(i,r)||jy(t,r)&&jy(i,e))||Yy(t,e,i)>0!=Yy(t,e,r)>0&&Yy(i,r,t)>0!=Yy(i,r,e)>0}function Ky(t,e){return Yy(t.prev,t,t.next)<0?Yy(t,e,t.next)>=0&&Yy(t,t.prev,e)>=0:Yy(t,e,t.prev)<0||Yy(t,t.next,e)<0}function Zy(t,e){var i=new Dy(t.i,t.x,t.y),r=new Dy(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function Jy(t,e,i,r){var n=new Dy(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Qy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $y(t,e,i){i=i||3;var r=e?e.length:0,n=r?e[0]*i:t.length,o=Iy(t,0,n,i,!0),s=[];if(!o)return s;var a=0,l=0,h=0,u=0,c=0,d=0,p=0;if(r&&(o=function(t,e,i,r){var n,o=[],s=0,a=null;for(s=0,n=e.length;s<n;s++)(a=Iy(t,e[s]*r,s<n-1?e[s+1]*r:t.length,r,!1))&&(a===a.next&&(a.steiner=!0),o.push(Gy(a)));if(o.sort(Uy),!i)return i;for(s=0;s<o.length;s++)Vy(o[s],i),i=By(i,i.next);return i}(t,e,o,i)),t.length>80*i){a=h=t[0],l=u=t[1];for(var f=i;f<n;f+=i)(c=t[f])<a&&(a=c),(d=t[f+1])<l&&(l=d),c>h&&(h=c),d>u&&(u=d);p=Math.max(h-a,u-l)}return Ly(o,s,i,a,l,p),s}for(var tv=Math.PI,ev=Math.min,iv=Math.max,rv=Math.ceil,nv=Math.acos,ov=Math.cos,sv=Math.sin,av=Math.atan2,lv=null,hv=null,uv=new tr,cv=[],dv=0;dv<4;dv++)cv.push(new fi);function pv(t,e,i){return t<e?e:t>i?i:t}var fv={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!hv)return null;var i=hv.getRenderDataList(),r=i[hv.dataOffset];if(!r)return null;var n=r,o=n?n.vertexStart+e:0;return(o>65535||3*o>131070)&&(++hv.dataOffset,hv.dataOffset<i.length?r=i[hv.dataOffset]:(r=hv.requestRenderData(),i[hv.dataOffset]=r),n=r),n&&n.vertexCount<o&&n.request(e,3*e),r},stroke:function(t){tr.copy(uv,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){tr.copy(uv,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e=.5*t.lineWidth,i=t.lineCap,r=t.lineJoin,n=t.miterLimit;if(hv=t.impl){var o=function(t,e,i){var r=2*nv(t/(t+i));return iv(2,rv(e/r))}(e,tv,hv.tessTol);this._calculateJoins(hv,e,r,n);for(var s=hv.paths,a=0,l=hv.pathOffset,h=hv.pathLength;l<h;l++){var u=s[l],c=u.points.length;r===df.ROUND?a+=2*(c+u.bevel*(o+2)+1):a+=2*(c+5*u.bevel+1),u.closed||(i===cf.ROUND?a+=2*(2*o+2):a+=12)}var d=lv=this.getRenderData(t,a);if(d){for(var p=d.vData,f=d.iData,_=hv.pathOffset,g=hv.pathLength;_<g;_++){var m=s[_],y=m.points,v=y.length,b=d.vertexStart,S=void 0,T=void 0,E=0,A=0,C=m.closed;if(C?(S=y[v-1],T=y[0],E=0,A=v):(S=y[0],T=y[1],E=1,A=v-1),T=T||S,!C){var w=new jf(T.x,T.y);w.subtract(S),w.normalize();var x=w.x,R=w.y;i===cf.BUTT?this._buttCapStart(S,x,R,e,0):i===cf.SQUARE?this._buttCapStart(S,x,R,e,e):i===cf.ROUND&&this._roundCapStart(S,x,R,e,o)}for(var M=E;M<A;++M)r===df.ROUND?this._roundJoin(S,T,e,e,o):0!=(T.flags&(pf.PT_BEVEL|pf.PT_INNERBEVEL))?this._bevelJoin(S,T,e,e):(this._vSet(T.x+T.dmx*e,T.y+T.dmy*e,1),this._vSet(T.x-T.dmx*e,T.y-T.dmy*e,-1)),S=T,T=y[M+1];if(C){var O=8*b;this._vSet(p[O],p[O+1],1),this._vSet(p[O+8],p[O+8+1],-1)}else{var P=new jf(T.x,T.y);P.subtract(S),P.normalize();var D=P.x,I=P.y;i===cf.BUTT?this._buttCapEnd(T,D,I,e,0):i===cf.SQUARE?this._buttCapEnd(T,D,I,e,e):i===cf.ROUND&&this._roundCapEnd(T,D,I,e,o)}for(var B=d.indicesStart,L=b+2,F=d.vertexStart;L<F;L++)f[B++]=L-2,f[B++]=L-1,f[B++]=L;d.indicesStart=B}lv=null,hv=null}}},_expandFill:function(t){if(hv=t.impl){for(var e=hv.paths,i=0,r=hv.pathOffset,n=hv.pathLength;r<n;r++)i+=e[r].points.length;var o=lv=this.getRenderData(t,i);if(o){for(var s=o,a=s.vData,l=s.iData,h=hv.pathOffset,u=hv.pathLength;h<u;h++){var c=e[h],d=c.points,p=d.length;if(0!==p){for(var f=o.vertexStart,_=0;_<p;++_)this._vSet(d[_].x,d[_].y);var g=o.indicesStart;if(c.complex){for(var m=[],y=f,v=o.vertexStart;y<v;y++){var b=8*y;m.push(a[b++]),m.push(a[b++]),m.push(a[b++])}var S=$y(m,null,3);if(!S||0===S.length)continue;for(var T=0,E=S.length;T<E;T++)l[g++]=S[T]+f}else for(var A=f,C=f+2,w=s.vertexStart;C<w;C++)l[g++]=A,l[g++]=C-1,l[g++]=C;s.indicesStart=g}}lv=null,hv=null}}},_calculateJoins:function(t,e,i,r){var n=0;e>0&&(n=1/e);for(var o=t.paths,s=t.pathOffset,a=t.pathLength;s<a;s++){var l=o[s],h=l.points,u=h.length,c=h[u-1],d=h[0];l.bevel=0;for(var p=0;p<u;p++){var f,_,g=c.dy,m=-c.dx,y=d.dy,v=-d.dx;if(d.dmx=.5*(g+y),d.dmy=.5*(m+v),(f=d.dmx*d.dmx+d.dmy*d.dmy)>1e-6){var b=1/f;b>600&&(b=600),d.dmx*=b,d.dmy*=b}d.dx*c.dy-c.dx*d.dy>0&&(d.flags|=pf.PT_LEFT),f*(_=iv(11,ev(c.len,d.len)*n))*_<1&&(d.flags|=pf.PT_INNERBEVEL),d.flags&pf.PT_CORNER&&(f*r*r<1||i===df.BEVEL||i===df.ROUND)&&(d.flags|=pf.PT_BEVEL),0!=(d.flags&(pf.PT_BEVEL|pf.PT_INNERBEVEL))&&l.bevel++,c=d,d=h[p+1]}}},_flattenPaths:function(t){for(var e=t.paths,i=t.pathOffset,r=t.pathLength;i<r;i++){var n=e[i],o=n.points,s=o[o.length-1],a=o[0];o.length>2&&s.equals(a)&&(n.closed=!0,o.pop(),s=o[o.length-1]);for(var l=0,h=o.length;l<h;l++){var u=new jf(a.x,a.y);u.subtract(s),s.len=u.length(),(u.x||u.y)&&u.normalize(),s.dx=u.x,s.dy=u.y,s=a,a=o[l+1]}}},_chooseBevel:function(t,e,i,r){var n=i.x,o=i.y,s=0,a=0,l=0,h=0;return 0!==t?(s=n+e.dy*r,a=o-e.dx*r,l=n+i.dy*r,h=o-i.dx*r):(s=l=n+i.dmx*r,a=h=o+i.dmy*r),[s,a,l,h]},_buttCapStart:function(t,e,i,r,n){var o=t.x-e*n,s=t.y-i*n,a=i,l=-e;this._vSet(o+a*r,s+l*r,1),this._vSet(o-a*r,s-l*r,-1)},_buttCapEnd:function(t,e,i,r,n){var o=t.x+e*n,s=t.y+i*n,a=i,l=-e;this._vSet(o+a*r,s+l*r,1),this._vSet(o-a*r,s-l*r,-1)},_roundCapStart:function(t,e,i,r,n){for(var o=t.x,s=t.y,a=i,l=-e,h=0;h<n;h++){var u=h/(n-1)*tv,c=ov(u)*r,d=sv(u)*r;this._vSet(o-a*c-e*d,s-l*c-i*d,1),this._vSet(o,s,0)}this._vSet(o+a*r,s+l*r,1),this._vSet(o-a*r,s-l*r,-1)},_roundCapEnd:function(t,e,i,r,n){var o=t.x,s=t.y,a=i,l=-e;this._vSet(o+a*r,s+l*r,1),this._vSet(o-a*r,s-l*r,-1);for(var h=0;h<n;h++){var u=h/(n-1)*tv,c=ov(u)*r,d=sv(u)*r;this._vSet(o,s,0),this._vSet(o-a*c+e*d,s-l*c+i*d,1)}},_roundJoin:function(t,e,i,r,n){var o=t.dy,s=-t.dx,a=e.dy,l=-e.dx,h=e.x,u=e.y;if(0!=(e.flags&pf.PT_LEFT)){var c=this._chooseBevel(e.flags&pf.PT_INNERBEVEL,t,e,i),d=c[0],p=c[1],f=c[2],_=c[3],g=av(-s,-o),m=av(-l,-a);m>g&&(m-=2*tv),this._vSet(d,p,1),this._vSet(h-o*r,e.y-s*r,-1);for(var y=pv(rv((g-m)/tv)*n,2,n),v=0;v<y;v++){var b=g+v/(y-1)*(m-g),S=h+ov(b)*r,T=u+sv(b)*r;this._vSet(h,u,0),this._vSet(S,T,-1)}this._vSet(f,_,1),this._vSet(h-a*r,u-l*r,-1)}else{var E=this._chooseBevel(e.flags&pf.PT_INNERBEVEL,t,e,-r),A=E[0],C=E[1],w=E[2],x=E[3],R=av(s,o),M=av(l,a);M<R&&(M+=2*tv),this._vSet(h+o*r,u+s*r,1),this._vSet(A,C,-1);for(var O=pv(rv((M-R)/tv)*n,2,n),P=0;P<O;P++){var D=R+P/(O-1)*(M-R),I=h+ov(D)*i,B=u+sv(D)*i;this._vSet(I,B,1),this._vSet(h,u,0)}this._vSet(h+a*r,u+l*r,1),this._vSet(w,x,-1)}},_bevelJoin:function(t,e,i,r){var n=0,o=0,s=0,a=0,l=0,h=0,u=0,c=0,d=t.dy,p=-t.dx,f=e.dy,_=-e.dx;if(e.flags&pf.PT_LEFT){var g=this._chooseBevel(e.flags&pf.PT_INNERBEVEL,t,e,i);l=g[0],h=g[1],u=g[2],c=g[3],this._vSet(l,h,1),this._vSet(e.x-d*r,e.y-p*r,-1),this._vSet(u,c,1),this._vSet(e.x-f*r,e.y-_*r,-1)}else{var m=this._chooseBevel(e.flags&pf.PT_INNERBEVEL,t,e,-r);n=m[0],o=m[1],s=m[2],a=m[3],this._vSet(e.x+d*i,e.y+p*i,1),this._vSet(n,o,-1),this._vSet(e.x+f*i,e.y+_*i,1),this._vSet(s,a,-1)}},_vSet:function(t,e,i){if(void 0===i&&(i=0),lv){var r=lv,n=8*r.vertexStart,o=r.vData;o[n++]=t,o[n++]=e,o[n++]=0,tr.toArray(o,uv,n),n+=4,o[n++]=i,r.vertexStart++}}},_v=t("graphicsAssembler",{getAssembler:function(){return fv}});P_.Assembler=_v;var gv=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},mv=new Rr,yv=null,vv=null,bv=[],Sv=[],Tv=[],Ev=[],Av=new Mr,Cv=new Mr,wv=new Cr,xv=null,Rv=0,Mv=0,Ov=0,Pv=0,Dv=0,Iv=1,Bv=null,Lv="",Fv=0,kv=0,Nv=0,zv=0,Uv=0,Vv=0,Hv=0,Gv=!1,Wv=0,Xv=0,Yv=0,jv={updateRenderData:function(t){t.renderData&&t.renderData.vertDirty&&yv!==t&&(vv=(yv=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),yv.actualFontSize=Fv,vv.setContentSize(Cv),yv.renderData.vertDirty=yv.renderData.uvDirty=!1,yv.markForUpdateRenderData(!1),yv=null,this._resetProperties())},_updateFontScale:function(){Iv=Fv/kv},_updateFontFamily:function(t){var e=t.font;Bv=e.spriteFrame,xv=e.fntConfig,yd.fontAtlas=e.fontDefDictionary,sc.packToDynamicAtlas(t,Bv)},_updateLabelInfo:function(){yd.hash="",yd.margin=0},_updateProperties:function(t){Lv=t.string.toString(),Fv=t.fontSize,kv=xv?xv.fontSize:t.fontSize,Nv=t.horizontalAlign,zv=t.verticalAlign,Uv=t.spacingX,Hv=t.overflow,Vv=t._lineHeight;var e=vv.contentSize;Cv.width=e.width,Cv.height=e.height,Hv===lf.NONE?(Gv=!1,Cv.width+=2*yd.margin,Cv.height+=2*yd.margin):Hv===lf.RESIZE_HEIGHT?(Gv=!0,Cv.height+=2*yd.margin):Gv=t.enableWrapText,yd.lineHeight=Vv,yd.fontSize=Fv,this._setupBMFontOverflowMetrics()},_resetProperties:function(){xv=null,Bv=null,yd.hash="",yd.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=Lv,e=t.length,i=xv.kerningDict,r=bv,n=-1,o=0;o<e;++o){var s=t.charCodeAt(o),a=i[n<<16|65535&s]||0;r[o]=o<e-1?a:0,n=s}},_multilineTextWrap:function(t){for(var e=Lv.length,i=0,r=0,n=0,o=0,s=0,a=0,l=0,h=null,u=0;u<e;){var c=Lv.charAt(u);if("\n"!==c){for(var d=t(Lv,u,e),p=a,f=l,_=s,g=r,m=!1,y=0;y<d;++y){var v=u+y;if("\r"!==(c=Lv.charAt(v)))if(h=yd.fontAtlas.getLetterDefinitionForChar(c,yd)){var b=g+h.offsetX*Iv-yd.margin;if(Gv&&Yv>0&&r>0&&b+h.w*Iv>Yv&&!Yc(c)){Tv.push(s),s=0,i++,r=0,n-=Vv*this._getFontScale()+0,m=!0;break}wv.x=b,wv.y=n-h.offsetY*Iv,this._recordLetterInfo(wv,c,v,i),v+1<bv.length&&v<e-1&&(g+=bv[v+1]),g+=h.xAdvance*Iv+Uv,_=wv.x+h.w*Iv,p<wv.y&&(p=wv.y),f>wv.y-h.h*Iv&&(f=wv.y-h.h*Iv)}else this._recordPlaceholderInfo(v,c),console.log("Can't find letter definition in texture atlas "+xv.atlasName+" for letter:"+c);else this._recordPlaceholderInfo(v,c)}m||(r=g,a<p&&(a=p),l>f&&(l=f),o<(s=_)&&(o=s),u+=d)}else Tv.push(s),s=0,i++,r=0,n-=Vv*this._getFontScale()+0,this._recordPlaceholderInfo(u,c),u++}return Tv.push(s),Mv=(Rv=i+1)*Vv*this._getFontScale(),Rv>1&&(Mv+=0*(Rv-1)),Cv.width=Wv,Cv.height=Xv,Wv<=0&&(Cv.width=parseFloat(o.toFixed(2))+2*yd.margin),Xv<=0&&(Cv.height=parseFloat(Mv.toFixed(2))+2*yd.margin),Pv=Cv.height,Dv=0,a>0&&(Pv=Cv.height+a),l<-Mv&&(Dv=Mv+l),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return Hv===lf.SHRINK?Iv:1},_getFirstWordLen:function(t,e,i){var r=t.charAt(e);if(Xc(r)||"\n"===r||Yc(r))return 1;var n=1,o=yd.fontAtlas.getLetterDefinitionForChar(r,yd);if(!o)return n;for(var s=o.xAdvance*Iv+Uv,a=e+1;a<i&&(r=t.charAt(a),o=yd.fontAtlas.getLetterDefinitionForChar(r,yd));++a){if(s+o.offsetX*Iv+o.w*Iv>Yv&&!Yc(r)&&Yv>0)return n;if(s+=o.xAdvance*Iv+Uv,"\n"===r||Yc(r)||Xc(r))break;n++}return n},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=Sv.length){var i=new gv;Sv.push(i)}Sv[t].char=e,Sv[t].hash=e.charCodeAt(0)+yd.hash,Sv[t].valid=!1},_recordLetterInfo:function(t,e,i,r){if(i>=Sv.length){var n=new gv;Sv.push(n)}var o=e.charCodeAt(0)+yd.hash;Sv[i].line=r,Sv[i].char=e,Sv[i].hash=o,Sv[i].valid=yd.fontAtlas.getLetter(o).valid,Sv[i].x=t.x,Sv[i].y=t.y},_alignText:function(){Mv=0,Tv.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),Hv===lf.SHRINK&&Fv>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||Hv===lf.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),Fv=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,i=0|Fv,r=0;e<i;){var n=r=e+i+1>>1;if(n<=0)break;Iv=n/kv,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?i=r-1:e=r}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return Mv>Cv.height},_isHorizontalClamp:function(){for(var t=!1,e=0,i=Lv.length;e<i;++e){var r=Sv[e];if(r.valid){var n=yd.fontAtlas.getLetterDefinitionForChar(r.char,yd);if(!n)continue;var o=r.x+n.w/2*Iv,s=r.line;if(Wv>0)if(Gv){if(Tv[s]>Cv.width&&(o>Cv.width||o<0)){t=!0;break}}else if(o>Cv.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var i=Tv[e],r=t>Cv.width||t<0;return Gv?i>Cv.width&&r:r},_updateQuads:function(){if(!yv)return!1;var t=Bv?Bv.texture:yd.fontAtlas.getTexture(),e=yv.renderData;e.dataLength=e.vertexCount=e.indicesCount=0;for(var i=vv.anchorPoint,r=Cv,n=i.x*r.width,o=i.y*r.height,s=!0,a=0,l=Lv.length;a<l;++a){var h=Sv[a];if(h.valid){var u=yd.fontAtlas.getLetter(h.hash);if(u){mv.height=u.h,mv.width=u.w,mv.x=u.u,mv.y=u.v;var c=h.y+Ov;if(Xv>0){if(c>Pv){var d=c-Pv;mv.y+=d,mv.height-=d,c-=d}c-u.h*Iv<Dv&&Hv===lf.CLAMP&&(mv.height=c<Dv?0:(c-Dv)/Iv)}var p=h.line,f=h.x+u.w/2*Iv+Ev[p];if(Wv>0&&this._isHorizontalClamped(f,p))if(Hv===lf.CLAMP)mv.width=0;else if(Hv===lf.SHRINK){if(Cv.width>u.w){s=!1;break}mv.width=0}if(mv.height>0&&mv.width>0){var _=this._determineRect(),g=h.x+Ev[h.line];this.appendQuad(yv,t,mv,_,g-n,c-o,Iv)}}else console.warn("Can't find letter in this bitmap-font")}}return s},appendQuad:function(){},_determineRect:function(){var t=Bv.isRotated(),e=Bv.getOriginalSize(),i=Bv.getRect(),r=Bv.getOffset(),n=r.x+(e.width-i.width)/2,o=r.y-(e.height-i.height)/2;if(t){var s=mv.x;mv.x=i.x+i.height-mv.y-mv.height-o,mv.y=s+i.y-n,mv.y<0&&(mv.height+=o)}else mv.x+=i.x-n,mv.y+=i.y+o;return t},_computeAlignmentOffset:function(){switch(Ev.length=0,Nv){case sf.LEFT:for(var t=0;t<Rv;++t)Ev.push(0);break;case sf.CENTER:for(var e=0,i=Tv.length;e<i;e++)Ev.push((Cv.width-Tv[e])/2);break;case sf.RIGHT:for(var r=0,n=Tv.length;r<n;r++)Ev.push(Cv.width-Tv[r])}if(Ov=Cv.height,zv!==af.TOP){var o=Cv.height-Mv+Vv*this._getFontScale()-kv*Iv;zv===af.BOTTOM?Ov-=o:Ov-=o/2}},_setupBMFontOverflowMetrics:function(){var t=Cv.width,e=Cv.height;Hv===lf.RESIZE_HEIGHT&&(e=0),Hv===lf.NONE&&(t=0,e=0),Wv=t,Xv=e,Av.width=t,Av.height=e,Yv=t}},qv=new tr(255,255,255,255),Kv={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){var i=t.node;t._setCacheAlpha(i._uiProps.opacity),qv.set(t.color),qv.a=255*i._uiProps.opacity,ec(i,e,t.renderData,qv)},appendQuad:function(t,e,i,r,n,o,s){var a=t.renderData;if(a){var l=a.dataLength;a.dataLength+=4,a.vertexCount=a.dataLength,a.indicesCount=a.dataLength/2*3;var h=a.data,u=e.width,c=e.height,d=i.width,p=i.height,f=0,_=0,g=0,m=0;r?(f=i.x/u,m=(i.x+p)/u,_=(i.y+d)/c,g=i.y/c,h[l].u=f,h[l].v=g,h[l+1].u=f,h[l+1].v=_,h[l+2].u=m,h[l+2].v=g,h[l+3].u=m,h[l+3].v=_):(f=i.x/u,m=(i.x+d)/u,_=(i.y+p)/c,g=i.y/c,h[l].u=f,h[l].v=_,h[l+1].u=m,h[l+1].v=_,h[l+2].u=f,h[l+2].v=g,h[l+3].u=m,h[l+3].v=g),h[l].x=n,h[l].y=o-p*s,h[l+1].x=n+d*s,h[l+1].y=o-p*s,h[l+2].x=n,h[l+2].y=o,h[l+3].x=n+d*s,h[l+3].y=o}}};ln(Kv,jv);var Zv=null,Jv=Br(jv,{getAssemblerData:function(){return Zv||(Zv=new md(1024,1024)),Zv.getTexture()},_updateFontFamily:function(t){yd.fontAtlas=Zv,yd.fontFamily=this._getFontFamily(t);var e=t.getComponent(Vg);e&&e.enabled?(yd.isOutlined=!0,yd.margin=e.width,yd.out=e.color.clone(),yd.out.a=e.color.a*t.color.a/255):(yd.isOutlined=!1,yd.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){var e,i,r;yd.fontDesc=this._getFontDesc(),yd.color=t.color,yd.hash=(i=(e=yd).color.toHEX(),r="",e.isOutlined&&e.margin>0&&(r=r+e.margin+e.out.toHEX()),""+e.fontSize+e.fontFamily+i+r)},_getFontDesc:function(){return yd.fontSize.toString()+"px "+yd.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),Qv=new tr(255,255,255,255),$v={createData:function(t){return t.requestRenderData()},fillBuffers:function(t,e){if(t.renderData){var i=t.node;t._setCacheAlpha(i._uiProps.opacity),Qv.a=255*i._uiProps.opacity,ec(i,e,t.renderData,Qv)}},appendQuad:Kv.appendQuad};ln($v,Jv);var tb=ff.Overflow,eb=(1/255).toFixed(3),ib=null,rb=null,nb=null,ob="",sb="",ab=0,lb=0,hb=[],ub=new Mr,cb=0,db=0,pb=0,fb=new tr,_b=1,gb="",mb=tb.NONE,yb=!1,vb=null,bb=tr.BLACK.clone(),Sb=null,Tb=tr.BLACK.clone(),Eb=new Rr,Ab=Mr.ZERO.clone(),Cb=Mr.ZERO.clone(),wb=Cr.ZERO.clone(),xb=Cr.ZERO.clone(),Rb=0,Mb=0,Ob=!1,Pb=!1,Db=!1,Ib=["left","center","right"],Bb={getAssemblerData:function(){return ff._canvasPool.get()},resetAssemblerData:function(t){t&&ff._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData&&t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._resetDynamicAtlas(t),this._updateTexture(t),this.updateOpacity(t),t._setCacheAlpha(_b),this._calDynamicAtlas(t),t.actualFontSize=ab,e.setContentSize(ub),this.updateVertexData(t),this.updateUvs(t),t.markForUpdateRenderData(!1),ib=null,rb=null,nb=null}},updateVertexData:function(){},updateUvs:function(){},updateOpacity:function(t){for(var e=t.renderData.vData,i=5,r=t.node._uiProps.opacity,n=0;n<4;n++)e[i+3]=r,i+=9},_updateFontFamily:function(t){gb=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var i=t.assemblerData;i&&(ib=i.context,rb=i.canvas,nb=t.spriteFrame,sb=t.string.toString(),ab=t.fontSize,lb=ab,mb=t.overflow,Cb.width=ub.width=e.width,Cb.height=ub.height=e.height,Mb=t.underlineHeight,cb=t.lineHeight,db=t.horizontalAlign,pb=t.verticalAlign,fb=t.color,_b=t.node._uiProps.opacity,Ob=t.isBold,Pb=t.isItalic,Db=t.isUnderline,yb=mb!==tb.NONE&&(mb===tb.RESIZE_HEIGHT||t.enableWrapText),(vb=(vb=Vg&&t.getComponent(Vg))&&vb.enabled&&vb.width>0?vb:null)&&bb.set(vb.color),(Sb=(Sb=Oy&&t.getComponent(Oy))&&Sb.enabled?Sb:null)&&Tb.set(Sb.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,i=0,r=0,n=0;if(Ab.width=Ab.height=0,vb&&(t=e=i=r=n=vb.width,Ab.width=Ab.height=2*n),Sb){var o=Sb.blur+n,s=Sb.offset.x,a=Sb.offset.y;i=Math.max(i,-s+o),r=Math.max(r,s+o),t=Math.max(t,a+o),e=Math.max(e,-a+o)}if(Pb){var l=lb*Math.tan(.20943951);r+=l,Ab.width+=l}Eb.x=i,Eb.y=t,Eb.width=i+r,Eb.height=t+e},_calculateFillTextStartPosition:function(){var t=0;db===sf.RIGHT?t=ub.width-Eb.width:db===sf.CENTER&&(t=(ub.width-Eb.width)/2);var e=this._getLineHeight()*(hb.length-1),i=ab*(1-Lc/2);if(pb!==af.TOP){var r=e+Eb.height+ab-ub.height;pb===af.BOTTOM?i-=r+=Lc/2*ab:i-=r/2}i+=0*ab,wb.set(t+Eb.x,i+Eb.y)},_updateTexture:function(t){if(ib&&rb){ib.clearRect(0,0,rb.width,rb.height),ib.font=ob,this._calculateFillTextStartPosition();var e=this._getLineHeight();ib.lineJoin="round",vb?(ib.fillStyle="rgba("+bb.r+", "+bb.g+", "+bb.b+", "+eb+")",ib.fillRect(0,0,rb.width,rb.height)):t._srcBlendFactor===x.SRC_ALPHA&&(ib.fillStyle="rgba("+fb.r+", "+fb.g+", "+fb.b+", "+eb+")",ib.fillRect(0,0,rb.width,rb.height)),ib.fillStyle="rgb("+fb.r+", "+fb.g+", "+fb.b+")";var i,r=wb.x,n=0;this._drawTextEffect(wb,e);for(var o=0;o<hb.length;++o)n=wb.y+o*e,vb&&ib.strokeText(hb[o],r,n),ib.fillText(hb[o],r,n);Sb&&(ib.shadowColor="transparent"),nb&&(i=nb instanceof dc?nb.texture:nb,0!==rb.width&&0!==rb.height&&(i.reset({width:rb.width,height:rb.height,mipmapLevel:1}),i.uploadData(rb),nb instanceof dc&&(nb.rect=new Rr(0,0,rb.width,rb.height),nb._calculateUV()),ei.director.root&&ei.director.root.batcher2D&&ei.director.root.batcher2D._releaseDescriptorSetCache(i.getHash())))}},_resetDynamicAtlas:function(t){if(t.cacheMode===ff.CacheMode.BITMAP){var e=t.ttfSpriteFrame;sc.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}},_calDynamicAtlas:function(t){if(t.cacheMode===ff.CacheMode.BITMAP){var e=t.ttfSpriteFrame;sc.packToDynamicAtlas(t,e),t.renderData.uvDirty=!0}},_setupOutline:function(){ib.strokeStyle="rgba("+bb.r+", "+bb.g+", "+bb.b+", "+bb.a/255+")",ib.lineWidth=2*vb.width},_setupShadow:function(){ib.shadowColor="rgba("+Tb.r+", "+Tb.g+", "+Tb.b+", "+Tb.a/255+")",ib.shadowBlur=Sb.blur,ib.shadowOffsetX=Sb.offset.x,ib.shadowOffsetY=-Sb.offset.y},_drawTextEffect:function(t,e){if(Sb||vb||Db){var i=hb.length>1&&Sb,r=this._measureText(ib,ob),n=0,o=0;Sb&&this._setupShadow(),vb&&this._setupOutline();for(var s=0;s<hb.length;++s)n=t.x,o=t.y+s*e,i&&(vb&&ib.strokeText(hb[s],n,o),ib.fillText(hb[s],n,o)),Db&&(Rb=r(hb[s]),db===sf.RIGHT?xb.x=t.x-Rb:db===sf.CENTER?xb.x=t.x-Rb/2:xb.x=t.x,xb.y=o+lb/8,ib.fillRect(xb.x,xb.y,Rb,Mb));i&&(ib.shadowColor="transparent")}},_updateLabelDimensions:function(){ub.width=Math.min(ub.width,2048),ub.height=Math.min(ub.height,2048);var t=!1;rb.width!==ub.width&&(rb.width=ub.width,t=!0),rb.height!==ub.height&&(rb.height=ub.height,t=!0),t&&(ib.font=ob),ib.textAlign=Ib[db],ib.textBaseline="alphabetic"},_getFontDesc:function(){var t=ab.toString()+"px ";return t+=gb,Ob&&(t="bold "+t),Pb&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===cb?ab:cb*ab/lb)},_calculateParagraphLength:function(t,e){for(var i,r=[],n=qe(t);!(i=n()).done;){var o=jc(e,i.value,ob);r.push(o)}return r},_measureText:function(t,e){return function(i){return jc(t,i,e)}},_calculateShrinkFont:function(t){if(ib){var e=this._calculateParagraphLength(t,ib),i=0,r=0,n=0;if(yb){var o=Cb.width,s=Cb.height;if(o<0||s<0)return;r=s+1;for(var a=0,l=0|ab+1,h=0;a<l;){if((h=a+l+1>>1)<=0){hn(4003);break}ab=h,ob=this._getFontDesc(),ib.font=ob;var u=this._getLineHeight();for(r=0,i=0;i<t.length;++i){var c=jc(ib,t[i],ob);r+=Kc(t[i],c,o,this._measureText(ib,ob)).length*u}r>s?l=h-1:a=h}0===a?hn(4003):(ab=a,ob=this._getFontDesc(),ib.font=ob)}else{for(r=t.length*this._getLineHeight(),i=0;i<t.length;++i)n<e[i]&&(n=e[i]);var d=(ub.width-Eb.width)/n,p=ub.height/r;ab=lb*Math.min(1,d,p)|0,ob=this._getFontDesc(),ib.font=ob}}},_calculateWrapText:function(t){if(yb&&ib){hb=[];for(var e=Cb.width,i=0;i<t.length;++i){var r=jc(ib,t[i],ob),n=Kc(t[i],r,e,this._measureText(ib,ob));hb=hb.concat(n)}}},_calculateLabelFont:function(){if(ib){var t=sb.split("\n");switch(hb=t,ob=this._getFontDesc(),ib.font=ob,mb){case tb.NONE:for(var e=0,i=0,r=0;r<t.length;++r){var n=jc(ib,t[r],ob);e=e>n?e:n}i=(hb.length+Lc)*this._getLineHeight();var o=parseFloat(e.toFixed(2)),s=parseFloat(i.toFixed(2));ub.width=o+Eb.width,ub.height=s+Eb.height,Cb.width=o+Ab.width,Cb.height=s+Ab.height;break;case tb.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case tb.CLAMP:this._calculateWrapText(t);break;case tb.RESIZE_HEIGHT:this._calculateWrapText(t);var a=(hb.length+Lc)*this._getLineHeight();ub.height=a+Eb.height,Cb.height=a+Ab.height}}}},Lb=tr.WHITE.clone(),Fb={createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.vertexCount=4,e.indicesCount=6;var i=e.vData=new Float32Array(36);i[3]=i[21]=i[22]=i[31]=0,i[4]=i[12]=i[13]=i[30]=1;for(var r=5,n=0;n<4;n++)tr.toArray(i,Lb,r),r+=9;return e},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=t.node,o=e.acquireBufferBatch(),s=o.byteOffset>>2,a=o.indicesOffset,l=o.vertexOffset;o.request()||(o=e.currBufferBatch,a=0,l=0,s=0);var h=o.vData,u=o.iData,c=i.vData,d=r[0],p=r[3];n.updateWorldTransform();var f=n._pos,_=n._rot,g=n._scale,m=d.x*g.x,y=p.x*g.x,v=d.y*g.y,b=p.y*g.y,S=_.x,T=_.y,E=_.z,A=_.w,C=S*T,w=E*A,x=S*S-T*T,R=A*A-E*E,M=R+x,O=2*(C-w),P=R-x,D=2*(C+w),I=f.x,B=f.y;c[0]=M*m+O*v+I,c[1]=P*v+D*m+B,c[9]=M*y+O*v+I,c[10]=P*v+D*y+B,c[18]=M*m+O*b+I,c[19]=P*b+D*m+B,c[27]=M*y+O*b+I,c[28]=P*b+D*y+B,h.set(c,s),u[a++]=l,u[a++]=l+1,u[a++]=l+2,u[a++]=l+2,u[a++]=l+1,u[a++]=l+3},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=i.width,n=i.height,o=i.anchorX*r,s=i.anchorY*n,a=e.data;a[0].x=-o,a[0].y=-s,a[3].x=r-o,a[3].y=n-s}},updateUvs:function(t){var e=t.renderData;if(e){var i=e.vData;if(i&&e.uvDirty){var r=t.ttfSpriteFrame.uv;i[3]=r[0],i[4]=r[1],i[12]=r[2],i[13]=r[3],i[21]=r[4],i[22]=r[5],i[30]=r[6],i[31]=r[7],e.uvDirty=!1}}}};ln(Fb,Bb);var kb=t("labelAssembler",{getAssembler:function(t){var e=Fb;return t.font instanceof Ic?e=Kv:t.cacheMode===ff.CacheMode.CHAR&&(e=$v),e}});ff.Assembler=kb;var Nb=rm.FillType,zb=new Wi,Ub=new tr(255,255,255,255),Vb={useModel:!1,updateRenderData:function(t){var e=t.spriteFrame;sc.packToDynamicAtlas(t,e);var i=t.renderData;if(i&&e){var r=i.uvDirty,n=i.vertDirty;if(!r&&!n)return;var o=t.fillStart,s=t.fillRange;s<0&&(o+=s,s=-s),s=(s=(s=o+s)>1?1:s)<0?0:s;var a=(o=(o=o>1?1:o)<0?0:o)+(s=(s-=o)<0?0:s);a=a>1?1:a,r&&this.updateUVs(t,o,a),n&&(this.updateVertexData&&this.updateVertexData(t,o,a),this.updateWorldVertexData(t))}},updateUVs:function(t,e,i){var r=t.spriteFrame,n=t.renderData,o=n.data,s=r.width,a=r.height,l=r.getRect(),h=0,u=0,c=0,d=0,p=0,f=0,_=0,g=0,m=0,y=0;switch(r.isRotated()?(h=l.x/s,u=(l.y+l.width)/a,c=p=h,_=m=(l.x+l.height)/s,f=y=u,d=g=l.y/a):(h=l.x/s,u=(l.y+l.height)/a,c=_=h,p=m=(l.x+l.width)/s,d=f=u,g=y=l.y/a),t.fillType){case Nb.HORIZONTAL:o[0].u=c+(p-c)*e,o[0].v=d+(f-d)*e,o[1].u=c+(p-c)*i,o[1].v=d+(f-d)*i,o[2].u=_+(m-_)*e,o[2].v=g+(y-g)*e,o[3].u=_+(m-_)*i,o[3].v=g+(y-g)*i;break;case Nb.VERTICAL:o[0].u=c+(_-c)*e,o[0].v=d+(g-d)*e,o[1].u=p+(m-p)*e,o[1].v=f+(y-f)*e,o[2].u=c+(_-c)*i,o[2].v=d+(g-d)*i,o[3].u=p+(m-p)*i,o[3].v=f+(y-f)*i;break;default:We(2626)}n.uvDirty=!1},updateVertexData:function(t,e,i){var r=t.renderData,n=r.data,o=t.node._uiProps.uiTransformComp,s=o.width,a=o.height,l=o.anchorX*s,h=o.anchorY*a,u=-l,c=-h,d=s-l,p=a-h,f=0;switch(t.fillType){case Nb.HORIZONTAL:f=u+(d-u)*i,u+=(d-u)*e,d=f;break;case Nb.VERTICAL:f=c+(p-c)*i,c+=(p-c)*e,p=f;break;default:We(2626)}n[4].x=u,n[4].y=c,n[5].x=d,n[5].y=c,n[6].x=u,n[6].y=p,n[7].x=d,n[7].y=p,r.vertDirty=!1},createData:function(t){var e=t.requestRenderData();e.dataLength=8,e.vertexCount=4,e.indicesCount=6;for(var i,r=e.data,n=qe(r);!(i=n()).done;)i.value.z=0;return e},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(zb);for(var r=0;r<4;r++){var n=i[r+4],o=i[r];fi.transformMat4(o,n,zb)}},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=t.node;Ub.set(t.color),Ub.a=255*i._uiProps.opacity,function(t,e,i,r){var n=i.data,o=e.acquireBufferBatch(),s=o.byteOffset>>2,a=i.vertexCount,l=o.indicesOffset,h=o.vertexOffset;o.request(a,i.indicesCount)||(o=e.currBufferBatch,s=0,l=0,h=0);for(var u=o.vData,c=0;c<a;c++){var d=n[c];u[s++]=d.x,u[s++]=d.y,u[s++]=d.z,u[s++]=d.u,u[s++]=d.v,tr.toArray(u,r,s),s+=4}var p=o.iData;p[l++]=h,p[l++]=h+1,p[l++]=h+2,p[l++]=h+1,p[l++]=h+3,p[l++]=h+2}(0,e,t.renderData,Ub)},updateColor:function(){}},Hb=2*Math.PI,Gb=1e-6,Wb=new tr(255,255,255,255),Xb=[new Cr,new Cr,new Cr,new Cr],Yb=new Array(4),jb=new Array(8),qb=[new Cr,new Cr,new Cr,new Cr],Kb=[new Cr,new Cr,new Cr,new Cr],Zb=new Cr,Jb=[new Cr,new Cr,new Cr,new Cr];function Qb(t,e,i,r,n,o,s){var a=Math.sin(o);a=Math.abs(a)>Gb?a:0;var l=Math.cos(o),h=0,u=0;if(0!==(l=Math.abs(l)>Gb?l:0)){if(h=a/l,(t-n.x)*l>0){var c=n.y+h*(t-n.x);s[0].x=t,s[0].y=c}if((e-n.x)*l>0){var d=n.y+h*(e-n.x);s[2].x=e,s[2].y=d}}if(0!==a){if(u=l/a,(r-n.y)*a>0){var p=n.x+u*(r-n.y);s[3].x=p,s[3].y=r}if((i-n.y)*a>0){var f=n.x+u*(i-n.y);s[1].x=f,s[1].y=i}}}function $b(t,e){var i=e.x-t.x,r=e.y-t.y;if(0===i&&0===r)return 0;if(0===i)return r>0?.5*Math.PI:1.5*Math.PI;var n=Math.atan(r/i);return i<0&&(n+=Math.PI),n}function tS(t,e,i,r,n){var o=Yb,s=o[0],a=o[1],l=o[2],h=o[3];t[e].x=i.x,t[e].y=i.y,t[e+1].x=r.x,t[e+1].y=r.y,t[e+2].x=n.x,t[e+2].y=n.y,eS((i.x-s)/(l-s),(i.y-a)/(h-a),t,e),eS((r.x-s)/(l-s),(r.y-a)/(h-a),t,e+1),eS((n.x-s)/(l-s),(n.y-a)/(h-a),t,e+2)}function eS(t,e,i,r){var n=jb,o=n[0]+(n[2]-n[0])*t,s=n[4]+(n[6]-n[4])*t,a=n[1]+(n[3]-n[1])*t,l=n[5]+(n[7]-n[5])*t,h=i[r];h.u=o+(s-o)*e,h.v=a+(l-a)*e}for(var iS={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;sc.packToDynamicAtlas(t,e);var i,r,n,o,s,a,l,h,u,c=t.renderData;if(c&&e&&(c.vertDirty||c.uvDirty)){var d=c.data,p=t.fillStart,f=t.fillRange;for(f<0&&(p+=f,f=-f);p>=1;)p-=1;for(;p<0;)p+=1;var _=(p*=Hb)+(f*=Hb);!function(t){var e=t.node._uiProps.uiTransformComp,i=e.width,r=e.height,n=e.anchorX*i,o=e.anchorY*r,s=-n,a=-o,l=i-n,h=r-o,u=Yb;u[0]=s,u[1]=a,u[2]=l,u[3]=h;var c=t.fillCenter,d=Zb.x=Math.min(Math.max(0,c.x),1)*(l-s)+s,p=Zb.y=Math.min(Math.max(0,c.y),1)*(h-a)+a;Xb[0].x=Xb[3].x=s,Xb[1].x=Xb[2].x=l,Xb[0].y=Xb[1].y=a,Xb[2].y=Xb[3].y=h;for(var f,_=qe(Jb);!(f=_()).done;){var g=f.value;Cr.set(g,0,0)}d!==u[0]&&Cr.set(Jb[0],3,0),d!==u[2]&&Cr.set(Jb[2],1,2),p!==u[1]&&Cr.set(Jb[1],0,1),p!==u[3]&&Cr.set(Jb[3],2,3)}(t),r=(i=e).width,n=i.height,o=i.getRect(),s=0,a=0,l=0,h=0,u=jb,i.isRotated()?(s=o.x/r,a=(o.x+o.height)/r,l=o.y/n,h=(o.y+o.width)/n,u[0]=u[2]=s,u[4]=u[6]=a,u[3]=u[7]=h,u[1]=u[5]=l):(s=o.x/r,a=(o.x+o.width)/r,l=o.y/n,h=(o.y+o.height)/n,u[0]=u[4]=s,u[2]=u[6]=a,u[1]=u[3]=h,u[5]=u[7]=l),Qb(Yb[0],Yb[2],Yb[1],Yb[3],Zb,p,qb),Qb(Yb[0],Yb[2],Yb[1],Yb[3],Zb,p+f,Kb);for(var g=0,m=0;m<4;++m){var y=Jb[m];if(y)if(f>=Hb)c.dataLength=g+3,tS(d,g,Zb,Xb[y.x],Xb[y.y]),g+=3;else{var v=$b(Zb,Xb[y.x]),b=$b(Zb,Xb[y.y]);b<v&&(b+=Hb),v-=Hb,b-=Hb;for(var S=0;S<3;++S)v>=_||(v>=p?(c.dataLength=g+3,tS(d,g,Zb,Xb[y.x],b>=_?Kb[m]:Xb[y.y]),g+=3):b>p&&(b<=_?(c.dataLength=g+3,tS(d,g,Zb,qb[m],Xb[y.y]),g+=3):(c.dataLength=g+3,tS(d,g,Zb,qb[m],Kb[m]),g+=3))),v+=Hb,b+=Hb}}c.indicesCount=c.vertexCount=g,c.vertDirty=c.uvDirty=!1}},fillBuffers:function(t,e){var i=t.node,r=t.renderData;Wb.set(t.color),Wb.a=255*i._uiProps.opacity,function(t,e,i,r){var n=i.data,o=e.acquireBufferBatch(),s=o.byteOffset>>2,a=i.vertexCount,l=o.indicesOffset,h=o.vertexOffset;o.request(a,i.indicesCount)||(o=e.currBufferBatch,s=0,l=0,h=0);var u=o.vData;t.getWorldMatrix(tc);for(var c=0;c<a;c++){var d=n[c];fi.set($u,d.x,d.y,0),fi.transformMat4($u,$u,tc),u[s++]=$u.x,u[s++]=$u.y,u[s++]=$u.z,u[s++]=d.u,u[s++]=d.v,tr.toArray(u,r,s),s+=4}for(var p=o.iData,f=0;f<i.dataLength;f++)p[l+f]=h+f}(i,e,r,Wb)},updateColor:function(){}},rS=[],nS=0;nS<4;nS++)rS.push(new fi);for(var oS={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){var e=t.spriteFrame;sc.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&(i.vertDirty&&this.updateVertexData(t),i.uvDirty&&this.updateUvs(t))},updateWorldVerts:function(t,e){var i=t.renderData.data,r=t.node,n=i[0],o=i[3],s=r.worldMatrix,a=s.m00,l=s.m01,h=s.m04,u=s.m05,c=1===a&&0===l&&0===h&&1===u,d=s.m12,p=s.m13,f=n.x,_=o.x,g=n.y,m=o.y;if(c){var y=f+d,v=_+d,b=g+p,S=m+p;e[0]=y,e[1]=b,e[9]=v,e[10]=b,e[18]=y,e[19]=S,e[27]=v,e[28]=S}else{var T=a*f,E=a*_,A=l*f,C=l*_,w=h*g+d,x=h*m+d,R=u*g+p,M=u*m+p;e[0]=T+w,e[1]=A+R,e[9]=E+w,e[10]=C+R,e[18]=T+x,e[19]=A+M,e[27]=E+x,e[28]=C+M}r._uiProps.uiTransformDirty=!1},fillBuffers:function(t,e){if(null!==t){var i=t.renderData.vData;t.node._uiProps.uiTransformDirty&&this.updateWorldVerts(t,i);var r=e.acquireBufferBatch(),n=r.byteOffset>>2,o=r.indicesOffset,s=r.vertexOffset;r.request()||(r=e.currBufferBatch,n=0,o=0,s=0);var a=r.vData,l=r.iData;a.set(i,n);var h=s,u=s+1,c=s+2,d=s+3;l[o++]=h,l[o++]=u,l[o++]=c,l[o++]=c,l[o++]=u,l[o++]=d}},updateVertexData:function(t){var e=t.renderData;if(e){var i=t.node._uiProps.uiTransformComp,r=e.data,n=i.width,o=i.height,s=i.anchorX*n,a=i.anchorY*o,l=0,h=0,u=0,c=0;if(t.trim)l=-s,h=-a,u=n-s,c=o-a;else{var d=t.spriteFrame,p=d.getOriginalSize(),f=d.getRect(),_=p.width,g=p.height,m=f.width,y=f.height,v=d.getOffset(),b=n/_,S=o/g,T=v.x+(_-m)/2,E=v.x-(_-m)/2;l=T*b-s,h=(v.y+(g-y)/2)*S-a,u=n+E*b-s,c=o+(v.y-(g-y)/2)*S-a}r[0].x=l,r[0].y=h,r[3].x=u,r[3].y=c,e.vertDirty=!1,this.updateWorldVerts(t,e.vData)}},updateUvs:function(t){var e=t.renderData,i=e.vData,r=t.spriteFrame.uv;i[3]=r[0],i[4]=r[1],i[12]=r[2],i[13]=r[3],i[21]=r[4],i[22]=r[5],i[30]=r[6],i[31]=r[7],e.uvDirty=!1},updateColor:function(t){for(var e=t.renderData.vData,i=5,r=t.color,n=r.r/255,o=r.g/255,s=r.b/255,a=t.node._uiProps.opacity,l=0;l<4;l++)e[i]=n,e[i+1]=o,e[i+2]=s,e[i+3]=a,i+=9}},sS=new fi,aS=new Wi,lS={useModel:!1,createData:function(t){var e=t.requestRenderData();return e.dataLength=20,e.vertexCount=16,e.indicesCount=54,e},updateRenderData:function(t){var e=t.spriteFrame;sc.packToDynamicAtlas(t,e);var i=t.renderData;i&&e&&i.vertDirty&&(this.updateVertexData(t),this.updateWorldVertexData(t))},updateVertexData:function(t){var e=t.renderData,i=e.data,r=t.node._uiProps.uiTransformComp,n=r.width,o=r.height,s=r.anchorX*n,a=r.anchorY*o,l=t.spriteFrame,h=l.insetLeft,u=l.insetRight,c=l.insetTop,d=l.insetBottom,p=n-h-u,f=o-c-d,_=n/(h+u),g=o/(c+d);_=Number.isNaN(_)||_>1?1:_,g=Number.isNaN(g)||g>1?1:g,p=p<0?0:p,f=f<0?0:f,i[0].x=-s,i[0].y=-a,i[1].x=h*_-s,i[1].y=d*g-a,i[2].x=i[1].x+p,i[2].y=i[1].y+f,i[3].x=n-s,i[3].y=o-a,e.vertDirty=!1},fillBuffers:function(t,e){t.node.hasChangedFlags&&this.updateWorldVertexData(t);var i=e.acquireBufferBatch(),r=t.renderData,n=r.data,o=i.byteOffset>>2,s=r.vertexCount,a=i.indicesOffset,l=i.vertexOffset,h=t.spriteFrame.uvSliced;i.request(s,r.indicesCount)||(i=e.currBufferBatch,o=0,a=0,l=0);for(var u=i.vData,c=i.iData,d=4;d<20;++d){var p=n[d],f=h[d-4];u[o++]=p.x,u[o++]=p.y,u[o++]=p.z,u[o++]=f.u,u[o++]=f.v,tr.toArray(u,n[d].color,o),o+=4}for(var _=0;_<3;++_)for(var g=0;g<3;++g){var m=l+4*_+g;c[a++]=m,c[a++]=m+1,c[a++]=m+4,c[a++]=m+1,c[a++]=m+5,c[a++]=m+4}},updateWorldVertexData:function(t){var e=t.node,i=t.renderData.data;e.getWorldMatrix(aS);for(var r=0;r<4;++r)for(var n=i[r],o=0;o<4;++o){var s=i[o],a=i[4+4*r+o];fi.set(sS,s.x,n.y,0),fi.transformMat4(a,sS,aS)}},updateColor:function(t){for(var e=t.renderData.data,i=t.color,r=i.r,n=i.g,o=i.b,s=255*t.node._uiProps.opacity,a=4;a<20;a++)e[a].color.r=r,e[a].color.g=n,e[a].color.b=o,e[a].color.a=s}},hS=[],uS=0;uS<4;uS++)hS.push(new fi);var cS={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,i=t.spriteFrame;if(i&&e&&(e.uvDirty||e.vertDirty)){var r=t.node._uiProps.uiTransformComp,n=Math.abs(r.width),o=Math.abs(r.height),s=i.getRect(),a=i.insetLeft,l=i.insetRight,h=s.width-a-l,u=i.insetTop,c=i.insetBottom,d=s.height-u-c,p=n-a-l,f=o-u-c;p=p>0?p:0,f=f>0?f:0;var _=0===h?p:p/h,g=0===d?f:f/d,m=Math.ceil(g+2),y=Math.ceil(_+2);e.dataLength=Math.max(8,m+1,y+1),this.updateVerts(t,p,f,m,y),e.vertexCount=m*y*4,e.indicesCount=m*y*6,e.uvDirty=!1,e.vertDirty=!1,this.updateColor(t)}},fillBuffers:function(t,e){var i=t.node,r=t.node._uiProps.uiTransformComp,n=Math.abs(r.width),o=Math.abs(r.height),s=t.renderData,a=e.acquireBufferBatch(),l=a.indicesOffset,h=a.byteOffset>>2,u=a.vertexOffset,c=s.vertexCount,d=s.indicesCount,p=a.vData,f=a.iData;a.request(c,d)||(a=e.currBufferBatch,h=0,l=0,u=0);var _=t.spriteFrame,g=_.isRotated(),m=_.uv,y=t.spriteFrame.uvSliced,v=_.getRect(),b=_.insetLeft,S=_.insetRight,T=v.width-b-S,E=_.insetTop,A=_.insetBottom,C=v.height-E-A,w=n-b-S,x=o-E-A;w=w>0?w:0,x=x>0?x:0;var R=0===T?w:w/T,M=0===C?x:x/C,O=Math.ceil(M+2),P=Math.ceil(R+2),D=i.worldMatrix,I=s.data;this.fillVertices(p,h,D,O,P,I);for(var B=0,L=0,F=[],k=[],N=0,z=O;N<z;++N){L=x>C?x>=N*C?1:M%1:M;for(var U=0,V=P;U<V;++U){B=w>T?w>=U*T?1:R%1:R;var H=h+3,G=H+1;g?(0===N?(F[0]=y[0].u,F[1]=y[0].u,F[2]=y[4].u+(y[8].u-y[4].u)*L):N<O-1?(F[0]=y[4].u,F[1]=y[4].u,F[2]=y[4].u+(y[8].u-y[4].u)*L):N===O-1&&(F[0]=y[8].u,F[1]=y[8].u,F[2]=y[12].u),0===U?(k[0]=y[0].v,k[1]=y[1].v+(y[2].v-y[1].v)*B,k[2]=y[0].v):U<P-1?(k[0]=y[1].v,k[1]=y[1].v+(y[2].v-y[1].v)*B,k[2]=y[1].v):U===P-1&&(k[0]=y[2].v,k[1]=y[3].v,k[2]=y[2].v),F[3]=F[2],k[3]=k[1]):(0===U?(F[0]=y[0].u,F[1]=y[1].u+(y[2].u-y[1].u)*B,F[2]=m[0]):U<P-1?(F[0]=y[1].u,F[1]=y[1].u+(y[2].u-y[1].u)*B,F[2]=y[1].u):U===P-1&&(F[0]=y[2].u,F[1]=y[3].u,F[2]=y[2].u),0===N?(k[0]=y[0].v,k[1]=y[0].v,k[2]=y[4].v+(y[8].v-y[4].v)*L):N<O-1?(k[0]=y[4].v,k[1]=y[4].v,k[2]=y[4].v+(y[8].v-y[4].v)*L):N===O-1&&(k[0]=y[8].v,k[1]=y[8].v,k[2]=y[12].v),F[3]=F[1],k[3]=k[2]),p[H]=F[0],p[G]=k[0],p[H+9]=F[1],p[G+9]=k[1],p[H+18]=F[2],p[G+18]=k[2],p[H+27]=F[3],p[G+27]=k[3],tr.toArray(p,I[0].color,G+1),tr.toArray(p,I[0].color,G+9+1),tr.toArray(p,I[0].color,G+18+1),tr.toArray(p,I[0].color,G+27+1),h+=36}}for(var W=0;W<d;W+=6)f[l++]=u,f[l++]=u+1,f[l++]=u+2,f[l++]=u+1,f[l++]=u+3,f[l++]=u+2,u+=4},fillVertices:function(t,e,i,r,n,o){for(var s=0,a=0,l=0,h=0,u=0,c=r;u<c;++u){l=o[u].y,h=o[u+1].y;for(var d=0,p=n;d<p;++d){s=o[d].x,a=o[d+1].x,fi.set(hS[0],s,l,0),fi.set(hS[1],a,l,0),fi.set(hS[2],s,h,0),fi.set(hS[3],a,h,0);for(var f=0;f<4;f++){var _=hS[f];fi.transformMat4(_,_,i);var g=9*f;t[e+g]=_.x,t[e+g+1]=_.y,t[e+g+2]=_.z}e+=36}}},updateVerts:function(t,e,i,r,n){var o,s,a=t.node._uiProps.uiTransformComp,l=t.renderData.data,h=t.spriteFrame,u=h.getRect(),c=Math.abs(a.width),d=Math.abs(a.height),p=a.anchorX*c,f=a.anchorY*d,_=h.insetLeft,g=h.insetRight,m=u.width-_-g,y=h.insetTop,v=h.insetBottom,b=u.height-y-v,S=a.width/(_+g)>1?1:a.width/(_+g),T=a.height/(y+v)>1?1:a.height/(y+v);o=m>0?Math.floor(1e3*e)/1e3%m==0?m:e%m:e,s=b>0?Math.floor(1e3*i)/1e3%b==0?b:i%b:i;for(var E=0;E<=n;E++)0===E?l[E].x=-p:E>0&&E<n?l[E].x=1===E?_*S+Math.min(m,e)-p:m>0?E===n-1?_+o+m*(E-2)-p:_+Math.min(m,e)+m*(E-2)-p:_+e-p:E===n&&(l[E].x=Math.min(_+e+g,c)-p);for(var A=0;A<=r;A++)0===A?l[A].y=-f:A>0&&A<r?l[A].y=1===A?v*T+Math.min(b,i)-f:b>0?A===r-1?v+s+(A-2)*b-f:v+Math.min(b,i)+(A-2)*b-f:v+i-f:A===r&&(l[A].y=Math.min(v+i+y,d)-f)},updateColor:function(t){var e=t.renderData.data,i=e.length;if(0!==i)for(var r=t.color,n=r.r,o=r.g,s=r.b,a=255*t.node._uiProps.opacity,l=0;l<i;l++)e[l].color.r=n,e[l].color.g=o,e[l].color.b=s,e[l].color.a=a}},dS=rm.Type,pS=rm.FillType,fS=t("spriteAssembler",{getAssembler:function(t){var e=oS,i=t;switch(i.type){case dS.SLICED:e=lS;break;case dS.TILED:e=cS;break;case dS.FILLED:e=i.fillType===pS.RADIAL?iS:Vb}return e}});rm.Assembler=fS;var _S=Qd.sharedManager,gS={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=4,e.indicesCount=6,e.vData=new Float32Array(36),e},updateRenderData:function(t){t.type===x_.IMAGE_STENCIL&&(oS.updateRenderData(t),oS.updateColor(t))},fillBuffers:function(t,e){(t.type!==x_.IMAGE_STENCIL||t.spriteFrame)&&(_S.pushMask(t),e.finishMergeBatches(),function(t,e){_S.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(_S.enterLevel(t),t.type===x_.IMAGE_STENCIL){oS.fillBuffers(t,e);var i=t.graphics.getMaterialInstance(0);e.forceMergeBatches(i,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),_S.enableMask())}},mS={fillBuffers:function(){_S.exitMask()}},yS={getAssembler:function(){return gS}},vS={getAssembler:function(){return mS}};F_.Assembler=yS,F_.PostAssembler=vS;var bS=new Lt(null),SS=new Wi,TS=t("UI",function(){var t=n.prototype;function n(t){var n=this;this.device=void 0,this._screens=[],this._bufferBatchPool=new i((function(){return new ty(n)}),128),this._drawBatchPool=void 0,this._meshBuffers=new Map,this._customMeshBuffers=new Map,this._meshBufferUseCount=new Map,this._batches=void 0,this._doUploadBuffersCall=new Map,this._emptyMaterial=new Sr,this._currScene=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currMeshBuffer=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currBlendTargetHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currOpacity=1,this._descriptorSetCache=new AS,this._root=t,this.device=t.device,this._batches=new r(64),this._drawBatchPool=new e((function(){return new Ry}),128)}return t.acquireBufferBatch=function(t){void 0===t&&(t=Qf);var e=t===Qf?36:e_(t);return this._currMeshBuffer&&this._currMeshBuffer.vertexFormatBytes===e||this._requireBufferBatch(t),this._currMeshBuffer},t.registerCustomBuffer=function(t,e){var i;t instanceof ty?i=t:(i=this._bufferBatchPool.add()).initialize(t,e||this._recreateMeshBuffer.bind(this,t));var r=i.vertexFormatBytes,n=this._customMeshBuffers.get(r);return n||(n=[],this._customMeshBuffers.set(r,n)),n.push(i),i},t.unRegisterCustomBuffer=function(t){var e=this._customMeshBuffers.get(t.vertexFormatBytes);if(e)for(var i=0;i<e.length;i++)if(e[i]===t){e.splice(i,1);break}var r=this._bufferBatchPool.data.indexOf(t);-1!==r&&(t.reset(),this._bufferBatchPool.removeAt(r))},t.initialize=function(){return!0},t.destroy=function(){for(var t=this,e=0;e<this._batches.length;e++)this._batches.array[e]&&this._batches.array[e].destroy(this);this._batches.destroy();for(var i,r=qe(this._meshBuffers.keys());!(i=r()).done;){var n=i.value,o=this._meshBuffers.get(n);o&&o.forEach((function(t){return t.destroy()}))}this._drawBatchPool&&this._drawBatchPool.destroy((function(e){e.destroy(t)})),this._descriptorSetCache.destroy(),this._meshBuffers.clear(),Qd.sharedManager.destroy()},t.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},t.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,i=0;i<e.length;i++){var r=e[i];if(r.visibility&t.layer)return r}return null},t.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},t.sortScreens=function(){this._screens.sort(this._screenSort)},t.addUploadBuffersFunc=function(t,e){this._doUploadBuffersCall.set(t,e)},t.removeUploadBuffersFunc=function(t){this._doUploadBuffersCall.delete(t)},t.update=function(){for(var t=this._screens,e=0;e<t.length;++e){var i=t[e];i.enabledInHierarchy&&(this._currOpacity=1,this._recursiveScreenNode(i.node))}var r=0;if(this._batches.length)for(var n=0;n<this._batches.length;++n){var o=this._batches.array[n];if(o.renderScene){if(o.model)for(var s=o.model.subModels,a=0;a<s.length;a++)s[a].priority=r++;else o.descriptorSet=this._descriptorSetCache.getDescriptorSet(o);o.renderScene.addBatch(o)}}},t.uploadBuffers=function(){var t=this;this._batches.length>0&&(this._doUploadBuffersCall.forEach((function(e,i){e.call(i,t)})),this._meshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._customMeshBuffers.forEach((function(t){t.forEach((function(t){t.uploadBuffers(),t.reset()}))})),this._descriptorSetCache.update())},t.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._currLayer=0,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._currScene=null,this._currMeshBuffer=null,this._currOpacity=1,this._meshBufferUseCount.clear(),this._batches.clear(),Qd.sharedManager.reset(),this._descriptorSetCache.reset()},t.commitComp=function(t,e,i,r){var n,o,s=t,a=0,l=0;e?(n=e.getGFXTexture(),o=e.getGFXSampler(),a=e.getHash(),l=e.getSamplerHash()):(n=null,o=null);var h=s._getRenderScene(),u=s.getRenderMaterial(0);s.stencilStage=Qd.sharedManager.stage;var c=s.blendHash,d=s.stencilStage;this._currScene===h&&this._currLayer===t.node.layer&&this._currMaterial===u&&this._currBlendTargetHash===c&&this._currDepthStencilStateStage===d&&this._currTextureHash===a&&this._currSamplerHash===l&&this._currTransform===r||(this.autoMergeBatches(this._currComponent),this._currScene=h,this._currComponent=s,this._currTransform=r,this._currMaterial=u,this._currTexture=n,this._currSampler=o,this._currTextureHash=a,this._currSamplerHash=l,this._currBlendTargetHash=c,this._currDepthStencilStateStage=d,this._currLayer=t.node.layer),i&&i.fillBuffers(s,this)},t.commitModel=function(t,e,i){var r;this._currMaterial!==this._emptyMaterial&&this.autoMergeBatches(this._currComponent);var n=0;i&&(t.stencilStage!==ud.ENABLED&&t.stencilStage!==ud.DISABLED||(t.stencilStage=Qd.sharedManager.stage),r=Qd.sharedManager.getStencilStage(t.stencilStage,i),n=Qd.sharedManager.getStencilHash(t.stencilStage));var o=ei.director.getTotalFrames();e&&(e.updateTransform(o),e.updateUBOs(o));for(var s=0;s<e.subModels.length;s++){var a=this._drawBatchPool.alloc(),l=e.subModels[s];a.renderScene=t._getRenderScene(),a.visFlags=t.node.layer,a.model=e,a.bufferBatch=null,a.texture=null,a.sampler=null,a.useLocalData=null,r||(r=null),a.fillPasses(i,r,n,null,0,l.patches),a.descriptorSet=l.descriptorSet,a.inputAssembler=l.inputAssembler,a.model.visFlags=a.visFlags,this._batches.push(a)}this._currMaterial=this._emptyMaterial,this._currScene=null,this._currComponent=null,this._currTransform=null,this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},t.autoMergeBatches=function(t){var e=this.currBufferBatch,i=null==e?void 0:e.recordBatch(),r=this._currMaterial;if(i&&r&&e){var n,o,s=0,a=0;t&&(n=-1===t.blendHash?null:t.getBlendState(),a=t.blendHash,o=null!==t.customMaterial?Qd.sharedManager.getStencilStage(t.stencilStage,r):Qd.sharedManager.getStencilStage(t.stencilStage),s=Qd.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.renderScene=this._currScene,l.visFlags=this._currLayer,l.bufferBatch=e,l.texture=this._currTexture,l.sampler=this._currSampler,l.inputAssembler=i,l.useLocalData=this._currTransform,l.textureHash=this._currTextureHash,l.samplerHash=this._currSamplerHash,l.fillPasses(r,o,s,n,a,null),this._batches.push(l),e.vertexStart=e.vertexOffset,e.indicesStart=e.indicesOffset,e.byteStart=e.byteOffset,Ke.__isWebIOS14OrIPadOS14Env&&!this._currIsStatic&&(this._currMeshBuffer=null)}},t.forceMergeBatches=function(t,e,i){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=e.getSamplerHash()):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=i.node.layer,this._currScene=i._getRenderScene(),this.autoMergeBatches(i)},t.finishMergeBatches=function(){this.autoMergeBatches(),this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},t.flushMaterial=function(t){this._currMaterial=t},t.walk=function(t,e){void 0===e&&(e=0);var i=t.children.length;if(this._preProcess(t),i>0&&!t._static)for(var r=t.children,n=0;n<r.length;++n){this._currOpacity=t._uiProps.opacity;var o=r[n];this.walk(o,e)}this._postProcess(t),e+=1},t._preProcess=function(t){var e=t._uiProps.uiComp,i=t._uiProps.localOpacity;t._uiProps.opacity=this._currOpacity*i,t._uiProps.uiTransformComp&&e&&e.enabledInHierarchy&&e.updateAssembler(this)},t._postProcess=function(t){var e=t._uiProps.uiComp;e&&e.enabledInHierarchy&&e.postUpdateAssembler(this)},t._recursiveScreenNode=function(t){this.walk(t),this.autoMergeBatches(this._currComponent)},t._createMeshBuffer=function(t){var e=this._bufferBatchPool.add();e.initialize(t,this._recreateMeshBuffer.bind(this,t));var i=e_(t),r=this._meshBuffers.get(i);return r||(r=[],this._meshBuffers.set(i,r)),r.push(e),e},t._recreateMeshBuffer=function(t,e,i){this.autoMergeBatches(),this._requireBufferBatch(t,e,i)},t._requireBufferBatch=function(t,e,i){var r=e_(t),n=this._meshBuffers.get(r);n||(n=[],this._meshBuffers.set(r,n));var o=this._meshBufferUseCount.get(r)||0;(e&&i||Ke.__isWebIOS14OrIPadOS14Env)&&o++,this._currMeshBuffer=n[o],this._currMeshBuffer||(this._currMeshBuffer=this._createMeshBuffer(t)),this._meshBufferUseCount.set(r,o),e&&i&&this._currMeshBuffer.request(e,i)},t._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},t._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},Ge(n,[{key:"currBufferBatch",get:function(){return this._currMeshBuffer||(this._currMeshBuffer=this.acquireBufferBatch()),this._currMeshBuffer},set:function(t){t&&(this._currMeshBuffer=t)}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),n}()),ES=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=ei.director.root.device;this._localData=new Float32Array(un.COUNT),this._localBuffer=t.createBuffer(new ot(_.UNIFORM|_.TRANSFER_DST,y.HOST|y.DEVICE,un.SIZE,un.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=ei.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,bS.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(bS),this._descriptorSet.bindBuffer(un.BINDING,this._localBuffer);var i=cn.SAMPLER_SPRITE;this._descriptorSet.bindTexture(i,t.texture),this._descriptorSet.bindSampler(i,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.updateLocal=function(){this._transform&&this.uploadLocalData()},e.equals=function(t,e,i){return this._transform===t&&this._textureHash===e&&this._samplerHash===i},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&t.updateWorldTransform(),this._transformUpdate){var e=t._mat;Wi.toArray(this._localData,e,un.MAT_WORLD_OFFSET),Wi.inverseTranspose(SS,e);var i=Wi.determinant(SS),r=1/Math.sqrt(i);Wi.multiplyScalar(SS,SS,r),Wi.toArray(this._localData,SS,un.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},Ge(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),AS=function(){function t(){this._descriptorSetCache=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new e((function(){return new ES}),16)}var i=t.prototype;return i.getDescriptorSet=function(t){var e=ei.director.root;if(t.useLocalData){for(var i=this._localDescriptorSetCache,r=0,n=i.length;r<n;r++){var o=i[r];if(o.equals(t.useLocalData,t.textureHash,t.samplerHash))return o.descriptorSet}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.descriptorSet}var a=this._descriptorSetCache.get(t.textureHash);if(a&&a.has(t.samplerHash))return a.get(t.samplerHash);ei.director.root.device,bS.layout=t.passes[0].localSetLayout;var l=e.device.createDescriptorSet(bS),h=cn.SAMPLER_SPRITE;return l.bindTexture(h,t.texture),l.bindSampler(h,t.sampler),l.update(),a?this._descriptorSetCache.get(t.textureHash).set(t.samplerHash,l):this._descriptorSetCache.set(t.textureHash,new Map([[t.samplerHash,l]])),l},i.update=function(){this._localDescriptorSetCache.forEach((function(t){t.updateLocal()}))},i.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},i.releaseDescriptorSetCache=function(t){this._descriptorSetCache.has(t)&&(this._descriptorSetCache.get(t).forEach((function(t){t.destroy()})),this._descriptorSetCache.delete(t))},i.destroy=function(){this._descriptorSetCache.forEach((function(t){t.forEach((function(t){t.destroy()}))})),this._descriptorSetCache.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy((function(t){t.destroy()}))},t}();ei.internal.Batcher2D=TS;var CS,wS,xS,RS,MS,OS,PS,DS,IS,BS,LS,FS,kS,NS,zS,US,VS,HS,GS,WS,XS,YS,jS,qS,KS,ZS,JS,QS,$S,tT,eT,iT,rT,nT,oT,sT,aT,lT,hT,uT,cT,dT,pT,fT,_T,gT,mT,yT,vT,bT,ST,TT=null,ET=-1,AT="BES bswy:->@123丁ぁᄁ",CT=Object.create(null),wT=[],xT=3e3;function RT(){for(var t=!0,e=Date.now(),i=wT.length-1;i>=0;i--){var r=wT[i],n=r.fontFamilyName;if(e-r.startTime>xT)$e(4933,n),r.onComplete(null,n),wT.splice(i,1);else{var o=r.refWidth,s="40px "+n;TT.font=s,o!==jc(TT,AT,s)?(wT.splice(i,1),r.onComplete(null,n)):t=!1}}t&&(clearInterval(ET),ET=-1)}function MT(t,e,i){var r=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i,r=t.lastIndexOf("/");return-1!==(i=-1===r?t.substring(0,e)+"_LABEL":t.substring(r+1,e)+"_LABEL").indexOf(" ")&&(i='"'+i+'"'),i}(t);if(CT[r])i(null,r);else{if(!TT){var n=document.createElement("canvas");n.width=100,n.height=100,TT=n.getContext("2d")}var o=jc(TT,AT,"40px "+r),s=document.createElement("style");s.type="text/css";var a="";Number.isNaN(r)?a+="@font-face { font-family:"+r+"; src:":a+='@font-face { font-family:"'+r+'"; src:',a+='url("'+t+'");',s.textContent=a+"}",document.body.appendChild(s);var l,h,u,c,d,p,f=document.createElement("div"),_=f.style;if(_.fontFamily=r,f.innerHTML=".",_.position="absolute",_.left="-100px",_.top="-100px",document.body.appendChild(f),function(){if(void 0===CS)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);CS=t?parseInt(t[1],10)>42:!e}else CS=!1;return CS}())l=Date.now(),h=r,u=i,c=new Promise((function(t,e){!function i(){Date.now()-l>=xT?e():document.fonts.load("40px "+h).then((function(e){e.length>=1?t():setTimeout(i,100)}),(function(){e()}))}()})),d=null,p=new Promise((function(t,e){d=setTimeout(e,xT)})),Promise.race([p,c]).then((function(){d&&(clearTimeout(d),d=null),u(null,h)}),(function(){$e(4933,h),u(null,h)}));else{var g={fontFamilyName:r,refWidth:o,onComplete:i,startTime:Date.now()};wT.push(g),-1===ET&&(ET=setInterval(RT,100))}CT[r]=s}}function OT(t,e,i,r){var n=new Mc;n._nativeUrl=t,n._nativeAsset=e,r(null,n)}dn.register({".font":MT,".eot":MT,".ttf":MT,".woff":MT,".svg":MT,".ttc":MT}),pn.register({".font":OT,".eot":OT,".ttf":OT,".woff":OT,".svg":OT,".ttc":OT}),ei.UI={MeshBuffer:ty,spriteAssembler:fS,graphicsAssembler:_v,labelAssembler:kb};var PT,DT,IT,BT=new tr;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(PT||(PT={})),Hr(PT),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(DT||(DT={})),function(t){t.CLICK="click"}(IT||(IT={}));var LT,FT,kT,NT=function(e){return t({Button:e,ButtonComponent:e}),e}((wS=_i("cc.Button"),xS=Ni(),RS=zi(110),MS=Ui(),OS=Gr(Dd),PS=Di(br),DS=Ur(),IS=Vi(),BS=Ur(),LS=Vi(),FS=Di(PT),kS=Ur(),NS=Vi(),zS=Vi(),US=Vi(),VS=Vi(),HS=Vi(),GS=gn(),WS=mn(),XS=Vi(),YS=Vi(),jS=Di(dc),qS=Vi(),KS=Di(dc),ZS=Vi(),JS=Di(dc),QS=Vi(),$S=Di(dc),tT=Vi(),eT=Di([fn]),iT=Ur(),rT=Vi(),wS(nT=xS(nT=RS(nT=MS(nT=OS(nT=Ii((ST=bT=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"clickEvents",sT,Ti(e)),Si(e,"_interactable",aT,Ti(e)),Si(e,"_transition",lT,Ti(e)),Si(e,"_normalColor",hT,Ti(e)),Si(e,"_hoverColor",uT,Ti(e)),Si(e,"_pressedColor",cT,Ti(e)),Si(e,"_disabledColor",dT,Ti(e)),Si(e,"_normalSprite",pT,Ti(e)),Si(e,"_hoverSprite",fT,Ti(e)),Si(e,"_pressedSprite",_T,Ti(e)),Si(e,"_disabledSprite",gT,Ti(e)),Si(e,"_duration",mT,Ti(e)),Si(e,"_zoomScale",yT,Ti(e)),Si(e,"_target",vT,Ti(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new tr,e._toColor=new tr,e._time=0,e._transitionFinished=!0,e._fromScale=new fi,e._toScale=new fi,e._originalScale=null,e._sprite=null,e._targetScale=new fi,e}He(e,t);var i=e.prototype;return i.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(rm);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},i.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},i.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===PT.COLOR||this._transition===PT.SCALE)){this._time+=t;var i=1;if(this._duration>0&&(i=this._time/this._duration),i>=1&&(i=1),this._transition===PT.COLOR){var r=e._uiProps.uiComp;tr.lerp(BT,this._fromColor,this._toColor,i),r&&(r.color=BT)}else this.transition===PT.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=_n(this._fromScale.x,this._toScale.x,i),this._targetScale.y=_n(this._fromScale.y,this._toScale.y,i),e.setScale(this._targetScale));1===i&&(this._transitionFinished=!0)}},i._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},i._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=this._transition;if(e===PT.COLOR&&this._interactable){var i=t.getComponent(uf);i&&(i.color=this._normalColor)}else e===PT.SCALE&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}},i._registerNodeEvent=function(){this.node.on(zr.TOUCH_START,this._onTouchBegan,this),this.node.on(zr.TOUCH_MOVE,this._onTouchMove,this),this.node.on(zr.TOUCH_END,this._onTouchEnded,this),this.node.on(zr.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(zr.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(zr.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._registerTargetEvent=function(t){t.on(zr.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},i._unregisterNodeEvent=function(){this.node.off(zr.TOUCH_START,this._onTouchBegan,this),this.node.off(zr.TOUCH_MOVE,this._onTouchMove,this),this.node.off(zr.TOUCH_END,this._onTouchEnded,this),this.node.off(zr.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(zr.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(zr.MOUSE_LEAVE,this._onMouseMoveOut,this)},i._unregisterTargetEvent=function(t){t.off(zr.TRANSFORM_CHANGED)},i._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(rm)),e},i._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new fi),fi.copy(this._originalScale,this.target.getScale()),this._registerTargetEvent(this.target))},i._onTargetSpriteFrameChanged=function(t){this._transition===PT.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},i._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case DT.NORMAL:this._normalSprite=t;break;case DT.HOVER:this._hoverSprite=t;break;case DT.PRESSED:this._pressedSprite=t;break;case DT.DISABLED:this._disabledSprite=t}},i._onTargetColorChanged=function(t){this._transition===PT.COLOR&&this._setCurrentStateColor(t)},i._setCurrentStateColor=function(t){switch(this._getButtonState()){case DT.NORMAL:this._normalColor=t;break;case DT.HOVER:this._hoverColor=t;break;case DT.PRESSED:this._pressedColor=t;break;case DT.DISABLED:this._disabledColor=t}},i._onTargetTransformChanged=function(t){t&Bi.SCALE&&this._originalScale&&this._transition===PT.SCALE&&this._transitionFinished&&fi.copy(this._originalScale,this.target.getScale())},i._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var i,r=this.node._uiProps.uiTransformComp.isHit(e.getUILocation());this._transition===PT.SCALE&&this.target&&this._originalScale?r?(fi.copy(this._fromScale,this._originalScale),fi.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(i=r?DT.PRESSED:DT.NORMAL,this._applyTransition(i)),t&&(t.propagationStopped=!0)}}},i._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(fn.emitEvents(this.clickEvents,t),this.node.emit(IT.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},i._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},i._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==PT.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},i._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},i._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},i._getButtonState=function(){var t=DT.NORMAL;return this._interactable?this._pressed?t=DT.PRESSED:this._hovered&&(t=DT.HOVER):t=DT.DISABLED,t.toString()},i._updateColorTransition=function(t){var e,i=this[t+"Color"],r=null===(e=this.target)||void 0===e?void 0:e.getComponent(uf);r&&(t===DT.DISABLED?r.color=i:(this._fromColor=r.color.clone(),this._toColor=i,this._time=0,this._transitionFinished=!1))},i._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},i._updateScaleTransition=function(t){this._interactable&&(t===DT.PRESSED?this._zoomUp():this._zoomBack())},i._zoomUp=function(){this._originalScale&&(fi.copy(this._fromScale,this._originalScale),fi.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},i._zoomBack=function(){this.target&&this._originalScale&&(fi.copy(this._fromScale,this.target.getScale()),fi.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},i._applyTransition=function(t){var e=this._transition;e===PT.COLOR?this._updateColorTransition(t):e===PT.SPRITE?this._updateSpriteTransition(t):e===PT.SCALE&&this._updateScaleTransition(t)},Ge(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable=t,this._updateState(),this._interactable||this._resetState()}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===PT.COLOR?this._updateColorTransition(DT.NORMAL):this._transition===PT.SPRITE&&this._updateSpriteTransition(DT.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(rm);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}($i),bT.Transition=PT,bT.EventType=IT,bi((oT=ST).prototype,"target",[PS,DS,IS],Object.getOwnPropertyDescriptor(oT.prototype,"target"),oT.prototype),bi(oT.prototype,"interactable",[BS,LS],Object.getOwnPropertyDescriptor(oT.prototype,"interactable"),oT.prototype),bi(oT.prototype,"transition",[FS,kS,NS],Object.getOwnPropertyDescriptor(oT.prototype,"transition"),oT.prototype),bi(oT.prototype,"normalColor",[zS],Object.getOwnPropertyDescriptor(oT.prototype,"normalColor"),oT.prototype),bi(oT.prototype,"pressedColor",[US],Object.getOwnPropertyDescriptor(oT.prototype,"pressedColor"),oT.prototype),bi(oT.prototype,"hoverColor",[VS],Object.getOwnPropertyDescriptor(oT.prototype,"hoverColor"),oT.prototype),bi(oT.prototype,"disabledColor",[HS],Object.getOwnPropertyDescriptor(oT.prototype,"disabledColor"),oT.prototype),bi(oT.prototype,"duration",[GS,WS,XS],Object.getOwnPropertyDescriptor(oT.prototype,"duration"),oT.prototype),bi(oT.prototype,"zoomScale",[YS],Object.getOwnPropertyDescriptor(oT.prototype,"zoomScale"),oT.prototype),bi(oT.prototype,"normalSprite",[jS,qS],Object.getOwnPropertyDescriptor(oT.prototype,"normalSprite"),oT.prototype),bi(oT.prototype,"pressedSprite",[KS,ZS],Object.getOwnPropertyDescriptor(oT.prototype,"pressedSprite"),oT.prototype),bi(oT.prototype,"hoverSprite",[JS,QS],Object.getOwnPropertyDescriptor(oT.prototype,"hoverSprite"),oT.prototype),bi(oT.prototype,"disabledSprite",[$S,tT],Object.getOwnPropertyDescriptor(oT.prototype,"disabledSprite"),oT.prototype),sT=bi(oT.prototype,"clickEvents",[eT,Ai,iT,rT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aT=bi(oT.prototype,"_interactable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lT=bi(oT.prototype,"_transition",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return PT.NONE}}),hT=bi(oT.prototype,"_normalColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),uT=bi(oT.prototype,"_hoverColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(211,211,211,255)}}),cT=bi(oT.prototype,"_pressedColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),dT=bi(oT.prototype,"_disabledColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(124,124,124,255)}}),pT=bi(oT.prototype,"_normalSprite",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fT=bi(oT.prototype,"_hoverSprite",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_T=bi(oT.prototype,"_pressedSprite",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gT=bi(oT.prototype,"_disabledSprite",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mT=bi(oT.prototype,"_duration",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),yT=bi(oT.prototype,"_zoomScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),vT=bi(oT.prototype,"_target",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nT=oT))||nT)||nT)||nT)||nT)||nT)||nT)),zT=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,i=e.indexOf(t);-1!==i&&e.splice(i,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,i=e.indexOf(t);if(t.setFocus(!1),-1!==i){var r=e[i+1];r&&r._delegate.tabIndex>=0&&r.setFocus(!0)}},t}();zT._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(LT||(LT={})),Mi(LT),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(FT||(FT={})),Mi(FT),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(kT||(kT={})),Mi(kT);var UT,VT,HT,GT,WT,XT,YT,jT,qT,KT,ZT,JT,QT,$T,tE,eE,iE,rE,nE,oE,sE,aE,lE,hE,uE,cE,dE,pE,fE,_E,gE,mE,yE,vE,bE,SE,TE,EE,AE,CE,wE,xE,RE,ME,OE,PE,DE,IE,BE,LE,FE,kE,NE,zE,UE,VE,HE,GE,WE,XE,YE,jE=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),qE=new Wi,KE=new Wi,ZE=new fi,JE=null,QE=0,$E=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++QE,e}He(e,t);var i=e.prototype;return i.init=function(t){t&&(this._delegate=t,t.inputMode===FT.ANY?this._createTextArea():this._createInput(),zT.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer(),this.__autoResize=en._resizeWithBrowserSize)},i.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),zT.remove(this),JE===this&&(JE=null),this._delegate=null},i.update=function(){this._updateMatrix()},i.setTabIndex=function(t){this._edTxt.tabIndex=t,zT.resort()},i.setSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px")},i.beginEditing=function(){JE&&JE!==this&&JE.setFocus(!1),this._editing=!0,JE=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},i.endEditing=function(){this._edTxt.blur()},i._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},i._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},i._addDomToGameContainer=function(){ei.GAME_VIEW&&this._edTxt?(ei.gameView.container.appendChild(this._edTxt),ei.gameView.head.appendChild(this._placeholderStyleSheet)):tn.container&&this._edTxt&&(tn.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},i._removeDomFromGameContainer=function(){(ei.GAME_VIEW?yn(ei.gameView.container,this._edTxt):yn(tn.container,this._edTxt))&&this._edTxt&&(ei.GAME_VIEW?ei.gameView.container.removeChild(this._edTxt):tn.container.removeChild(this._edTxt)),(ei.GAME_VIEW?yn(ei.gameView.head,this._placeholderStyleSheet):yn(document.head,this._placeholderStyleSheet))&&(ei.GAME_VIEW?ei.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},i._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),Ke.isMobile&&this._showDomOnMobile()},i._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),Ke.isMobile&&this._hideDomOnMobile()},i._showDomOnMobile=function(){Ke.os!==Ze.ANDROID&&Ke.os!==Ze.OHOS||(this.__autoResize&&en.resizeWithBrowserSize(!1),this._adjustWindowScroll())},i._hideDomOnMobile=function(){Ke.os!==Ze.ANDROID&&Ke.os!==Ze.OHOS||this.__autoResize&&en.resizeWithBrowserSize(!0),this._scrollBackWindow()},i._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},i._scrollBackWindow=function(){setTimeout((function(){Ke.browserType!==Je.WECHAT||Ke.os!==Ze.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},i._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=en.getScaleX(),i=en.getScaleY(),r=1,n=1;ei.GAME_VIEW&&(r=ei.gameView.canvas.width/ei.game.canvas.width,n=ei.gameView.canvas.height/ei.game.canvas.height),e*=r,i*=n;var o=en.getViewportRect(),s=en.getDevicePixelRatio();t.getWorldMatrix(qE);var a=t._uiProps.uiTransformComp;if(a&&fi.set(ZE,-a.anchorX*a.width,-a.anchorY*a.height,ZE.z),Wi.transform(qE,qE,ZE),t._uiProps.uiTransformComp){var l=Fr.root.batcher2D.getFirstRenderCamera(t);if(l){l.node.getWorldRT(KE);var h=KE.m12,u=KE.m13,c=Vr.center;KE.m12=c.x-(KE.m00*h+KE.m04*u),KE.m13=c.y-(KE.m01*h+KE.m05*u),Wi.multiply(KE,KE,qE),e/=s,i/=s;var d=ei.GAME_VIEW?ei.gameView.container:tn.container,p=KE.m00*e,f=qE.m01,_=qE.m04,g=KE.m05*i,m=parseInt(d&&d.style.paddingLeft||"0");m+=o.x*r/s;var y=parseInt(d&&d.style.paddingBottom||"0");y+=o.y/s;var v="matrix("+p+","+-f+","+-_+","+g+","+(KE.m12*e+m)+","+-(KE.m13*i+y)+")";this._edTxt.style.transform=v,this._edTxt.style["-webkit-transform"]=v,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},i._updateInputType=function(){var t=this._delegate,e=t.inputMode,i=t.inputFlag,r=t.returnType,n=this._edTxt;if(this._inputMode!==e||this._inputFlag!==i||this._returnType!==r){if(this._inputMode=e,this._inputFlag=i,this._returnType=r,this._isTextArea){var o="none";return i===kT.INITIAL_CAPS_ALL_CHARACTERS?o="uppercase":i===kT.INITIAL_CAPS_WORD&&(o="capitalize"),void(n.style.textTransform=o)}if(n=n,i===kT.PASSWORD)return n.type="password",void(n.style.textTransform="none");var s=n.type;e===FT.EMAIL_ADDR?s="email":e===FT.NUMERIC||e===FT.DECIMAL?s="number":e===FT.PHONE_NUMBER?(s="number",n.pattern="[0-9]*"):e===FT.URL?s="url":(s="text",r===LT.SEARCH&&(s="search")),n.type=s;var a="none";i===kT.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":i===kT.INITIAL_CAPS_WORD&&(a="capitalize"),n.style.textTransform=a}},i._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},i._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},i._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,e.placeholder=t.placeholder,this._updateTextLabel(t.textLabel),this._updatePlaceholderLabel(t.placeholderLabel))},i._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Ic?t.fontFamily:e._fontFamily;var i=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==i||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=i,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var r=this._edTxt;switch(r.style.fontSize=i+"px",r.style.color=t.color.toCSS(),r.style.fontFamily=e,t.horizontalAlign){case ff.HorizontalAlign.LEFT:r.style.textAlign="left";break;case ff.HorizontalAlign.CENTER:r.style.textAlign="center";break;case ff.HorizontalAlign.RIGHT:r.style.textAlign="right"}}}},i._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof Ic?t.fontFamily:t.font._fontFamily;var i=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==i||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=i,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var r=this._placeholderStyleSheet,n=t.color.toCSS(),o=t.fontSize,s="";switch(t.horizontalAlign){case ff.HorizontalAlign.LEFT:s="left";break;case ff.HorizontalAlign.CENTER:s="center";break;case ff.HorizontalAlign.RIGHT:s="right"}r.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+o+"px;text-align: "+s+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+o+"px;text-align: "+s+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+i+"px;color: "+n+";line-height: "+o+"px;text-align: "+s+";}",Ke.browserType===Je.EDGE&&(r.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},i._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,i=!1,r=this.__eventListeners;r.compositionStart=function(){i=!0},r.compositionEnd=function(){i=!1,t._delegate._editBoxTextChanged(e.value)},r.onInput=function(){if(!i){var r=t._delegate,n=r.maxLength;n>=0&&(e.value=e.value.slice(0,n)),r._editBoxTextChanged(e.value)}},r.onClick=function(){t._editing&&Ke.isMobile&&t._adjustWindowScroll()},r.onKeydown=function(i){i.keyCode===vn.ENTER?(i.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):i.keyCode===vn.TAB&&(i.propagationStopped=!0,i.preventDefault(),zT.next(t))},r.onBlur=function(){Ke.isMobile&&i&&r.compositionEnd(),t._editing=!1,JE=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",r.compositionStart),e.addEventListener("compositionend",r.compositionEnd),e.addEventListener("input",r.onInput),e.addEventListener("keydown",r.onKeydown),e.addEventListener("blur",r.onBlur),e.addEventListener("touchstart",r.onClick)}},i._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}},e}(jE);!function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(YE||(YE={}));var tA,eA,iA,rA,nA,oA,sA,aA,lA,hA,uA,cA,dA,pA,fA,_A,gA,mA,yA,vA,bA,SA,TA,EA,AA,CA,wA,xA,RA,MA,OA,PA,DA,IA,BA,LA,FA,kA,NA,zA,UA,VA,HA,GA,WA,XA,YA,jA,qA,KA,ZA,JA,QA,$A,tC,eC,iC,rC,nC,oC,sC=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((UT=_i("cc.EditBox"),VT=Ni(),HT=zi(110),GT=Ui(),WT=Gr(Dd),XT=Ur(),YT=Vi(),jT=Ur(),qT=Vi(),KT=Di(ff),ZT=Ur(),JT=Vi(),QT=Di(ff),$T=Ur(),tE=Vi(),eE=Di(dc),iE=Ur(),rE=Vi(),nE=Di(kT),oE=Ur(),sE=Vi(),aE=Di(FT),lE=Ur(),hE=Vi(),uE=Di(LT),cE=Ur(),dE=Vi(),pE=Ur(),fE=Vi(),_E=Ur(),gE=Vi(),mE=Di([fn]),yE=Ur(),vE=Vi(),bE=Di([fn]),SE=Ur(),TE=Vi(),EE=Di([fn]),AE=Ur(),CE=Vi(),wE=Di([fn]),xE=Ur(),RE=Vi(),UT(ME=VT(ME=HT(ME=GT(ME=WT(ME=Ii((XE=WE=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"editingDidBegan",PE,Ti(e)),Si(e,"textChanged",DE,Ti(e)),Si(e,"editingDidEnded",IE,Ti(e)),Si(e,"editingReturn",BE,Ti(e)),e._impl=null,e._background=null,Si(e,"_textLabel",LE,Ti(e)),Si(e,"_placeholderLabel",FE,Ti(e)),Si(e,"_returnType",kE,Ti(e)),Si(e,"_string",NE,Ti(e)),Si(e,"_tabIndex",zE,Ti(e)),Si(e,"_backgroundImage",UE,Ti(e)),Si(e,"_inputFlag",VE,Ti(e)),Si(e,"_inputMode",HE,Ti(e)),Si(e,"_maxLength",GE,Ti(e)),e._isLabelVisible=!1,e}He(e,t);var i=e.prototype;return i.__preload=function(){this._init()},i.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},i.update=function(){this._impl&&this._impl.update()},i.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},i.onDestroy=function(){this._impl&&this._impl.clear()},i.setFocus=function(){this._impl&&this._impl.setFocus(!0)},i.focus=function(){this._impl&&this._impl.setFocus(!0)},i.blur=function(){this._impl&&this._impl.setFocus(!1)},i.isFocused=function(){return!!this._impl&&this._impl.isFocused()},i._editBoxEditingDidBegan=function(){fn.emitEvents(this.editingDidBegan,this),this.node.emit(YE.EDITING_DID_BEGAN,this)},i._editBoxEditingDidEnded=function(){fn.emitEvents(this.editingDidEnded,this),this.node.emit(YE.EDITING_DID_ENDED,this)},i._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,fn.emitEvents(this.textChanged,t,this),this.node.emit(YE.TEXT_CHANGED,this)},i._editBoxEditingReturn=function(){fn.emitEvents(this.editingReturn,this),this.node.emit(YE.EDITING_RETURN,this)},i._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},i._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},i._onTouchBegan=function(t){t.propagationStopped=!0},i._onTouchCancel=function(t){t.propagationStopped=!0},i._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},i._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(zr.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},i._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(rm);t||(t=this.node.addComponent(rm)),t!==this._background&&(t.type=rm.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}},i._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||(e=new br("TEXT_LABEL")),(t=e.getComponent(ff))||(t=e.addComponent(ff)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=ff.Overflow.CLAMP,this._inputMode===FT.ANY?(t.verticalAlign=af.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},i._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||(e=new br("PLACEHOLDER_LABEL")),(t=e.getComponent(ff))||(t=e.addComponent(ff)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=ff.Overflow.CLAMP,this._inputMode===FT.ANY?(t.verticalAlign=af.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this.placeholder},i._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var i=this._background.node._uiProps.uiTransformComp;i.anchorPoint=t.anchorPoint,i.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},i._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},i._updateString=function(t){var e=this._textLabel;if(e){var i=t;i&&(i=this._updateLabelStringStyle(i)),e.string=i,this._updateLabels()}},i._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var i,r=this._inputFlag;if(e||r!==kT.PASSWORD)r===kT.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():r===kT.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):r===kT.INITIAL_CAPS_SENTENCE&&(t=(i=t).charAt(0).toUpperCase()+i.slice(1));else{for(var n="",o=t.length,s=0;s<o;++s)n+="●";t=n}return t},i._registerEvent=function(){this.node.on(zr.TOUCH_START,this._onTouchBegan,this),this.node.on(zr.TOUCH_END,this._onTouchEnded,this)},i._unregisterEvent=function(){this.node.off(zr.TOUCH_START,this._onTouchBegan,this),this.node.off(zr.TOUCH_END,this._onTouchEnded,this)},i._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},i._registerBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.on(rm.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},i._unregisterBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.off(rm.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},i._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=-e.anchorX*e.width,r=-e.anchorY*e.height,n=this._placeholderLabel,o=this._textLabel;o&&(o.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),o.node.setPosition(i+2,r+t.height,o.node.position.z),this._inputMode===FT.ANY&&(o.verticalAlign=af.TOP),o.enableWrapText=this._inputMode===FT.ANY),n&&(n.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),n.lineHeight=t.height,n.node.setPosition(i+2,r+t.height,n.node.position.z),this._inputMode===FT.ANY&&(n.verticalAlign=af.TOP),n.enableWrapText=this._inputMode===FT.ANY)},i._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._placeholderLabel&&this._placeholderLabel.node;i&&(i.setPosition(-t.width/2,t.height/2,i.position.z),i._uiProps.uiTransformComp.setContentSize(t.contentSize));var r=this._background&&this._background.node;r&&r._uiProps.uiTransformComp.setContentSize(t.contentSize)},Ge(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string=t,this._updateString(t)}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag=t,this._updateString(this._string)}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}($i),WE._EditBoxImpl=jE,WE.KeyboardReturnType=LT,WE.InputFlag=kT,WE.InputMode=FT,WE.EventType=YE,bi((OE=XE).prototype,"string",[XT,YT],Object.getOwnPropertyDescriptor(OE.prototype,"string"),OE.prototype),bi(OE.prototype,"placeholder",[jT,qT],Object.getOwnPropertyDescriptor(OE.prototype,"placeholder"),OE.prototype),bi(OE.prototype,"textLabel",[KT,ZT,JT],Object.getOwnPropertyDescriptor(OE.prototype,"textLabel"),OE.prototype),bi(OE.prototype,"placeholderLabel",[QT,$T,tE],Object.getOwnPropertyDescriptor(OE.prototype,"placeholderLabel"),OE.prototype),bi(OE.prototype,"backgroundImage",[eE,iE,rE],Object.getOwnPropertyDescriptor(OE.prototype,"backgroundImage"),OE.prototype),bi(OE.prototype,"inputFlag",[nE,oE,sE],Object.getOwnPropertyDescriptor(OE.prototype,"inputFlag"),OE.prototype),bi(OE.prototype,"inputMode",[aE,lE,hE],Object.getOwnPropertyDescriptor(OE.prototype,"inputMode"),OE.prototype),bi(OE.prototype,"returnType",[uE,cE,dE],Object.getOwnPropertyDescriptor(OE.prototype,"returnType"),OE.prototype),bi(OE.prototype,"maxLength",[pE,fE],Object.getOwnPropertyDescriptor(OE.prototype,"maxLength"),OE.prototype),bi(OE.prototype,"tabIndex",[_E,gE],Object.getOwnPropertyDescriptor(OE.prototype,"tabIndex"),OE.prototype),PE=bi(OE.prototype,"editingDidBegan",[mE,Ai,yE,vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DE=bi(OE.prototype,"textChanged",[bE,Ai,SE,TE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IE=bi(OE.prototype,"editingDidEnded",[EE,Ai,AE,CE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BE=bi(OE.prototype,"editingReturn",[wE,Ai,xE,RE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LE=bi(OE.prototype,"_textLabel",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FE=bi(OE.prototype,"_placeholderLabel",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kE=bi(OE.prototype,"_returnType",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LT.DEFAULT}}),NE=bi(OE.prototype,"_string",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),zE=bi(OE.prototype,"_tabIndex",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UE=bi(OE.prototype,"_backgroundImage",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VE=bi(OE.prototype,"_inputFlag",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kT.DEFAULT}}),HE=bi(OE.prototype,"_inputMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FT.ANY}}),GE=bi(OE.prototype,"_maxLength",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),ME=OE))||ME)||ME)||ME)||ME)||ME)||ME));"object"!=typeof window||"object"!=typeof document||bn||Sn||Tn||(sC._EditBoxImpl=$E),function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(tC||(tC={})),Hr(tC),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(eC||(eC={})),Hr(eC),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(iC||(iC={})),Hr(iC),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(rC||(rC={})),Hr(rC),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}(nC||(nC={})),Hr(nC),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(oC||(oC={})),Hr(oC);var aC,lC,hC,uC,cC,dC,pC,fC,_C,gC,mC,yC,vC,bC,SC,TC,EC,AC,CC,wC,xC,RC,MC,OC=new fi,PC=function(e){return t({Layout:e,LayoutComponent:e}),e}((tA=_i("cc.Layout"),eA=Ni(),iA=zi(110),rA=Ui(),nA=Gr(Dd),oA=Hi(),sA=Vi(),aA=Hi(),lA=Vi(),hA=Di(tC),uA=Vi(),cA=Di(eC),dA=Hi(),pA=Vi(),fA=Hi(),_A=Vi(),gA=Di(iC),mA=Vi(),yA=Vi(),vA=Vi(),bA=Vi(),SA=Vi(),TA=Vi(),EA=Vi(),AA=Di(rC),CA=Vi(),wA=Di(nC),xA=Vi(),RA=Di(oC),MA=Hi(),OA=Vi(),PA=Hi(),DA=Vi(),IA=Vi(),tA(BA=eA(BA=iA(BA=rA(BA=nA(BA=Ii(($A=QA=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_resizeMode",FA,Ti(e)),Si(e,"_layoutType",kA,Ti(e)),Si(e,"_cellSize",NA,Ti(e)),Si(e,"_startAxis",zA,Ti(e)),Si(e,"_paddingLeft",UA,Ti(e)),Si(e,"_paddingRight",VA,Ti(e)),Si(e,"_paddingTop",HA,Ti(e)),Si(e,"_paddingBottom",GA,Ti(e)),Si(e,"_spacingX",WA,Ti(e)),Si(e,"_spacingY",XA,Ti(e)),Si(e,"_verticalDirection",YA,Ti(e)),Si(e,"_horizontalDirection",jA,Ti(e)),Si(e,"_constraint",qA,Ti(e)),Si(e,"_constraintNum",KA,Ti(e)),Si(e,"_affectedByScale",ZA,Ti(e)),Si(e,"_isAlign",JA,Ti(e)),e._layoutSize=new Mr(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}He(e,t);var i=e.prototype;return i.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},i.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(Mr.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},i.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},i._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e],r=i._uiProps.uiTransformComp;i.activeInHierarchy&&r&&this._usefulLayoutObj.push(r)}},i._addEventListeners=function(){Fr.on(kr.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(zr.SIZE_CHANGED,this._resized,this),this.node.on(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(zr.CHILD_ADDED,this._childAdded,this),this.node.on(zr.CHILD_REMOVED,this._childRemoved,this),this.node.on(zr.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},i._removeEventListeners=function(){Fr.off(kr.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(zr.SIZE_CHANGED,this._resized,this),this.node.off(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(zr.CHILD_ADDED,this._childAdded,this),this.node.off(zr.CHILD_REMOVED,this._childRemoved,this),this.node.off(zr.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},i._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.on(zr.SIZE_CHANGED,this._doLayoutDirty,this),i.on(zr.TRANSFORM_CHANGED,this._transformDirty,this),i.on(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),i.on("active-in-hierarchy-changed",this._childrenChanged,this)}},i._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var i=t[e];i.off(zr.SIZE_CHANGED,this._doLayoutDirty,this),i.off(zr.TRANSFORM_CHANGED,this._transformDirty,this),i.off(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),i.off("active-in-hierarchy-changed",this._childrenChanged,this)}},i._childAdded=function(t){t.on(zr.SIZE_CHANGED,this._doLayoutDirty,this),t.on(zr.TRANSFORM_CHANGED,this._transformDirty,this),t.on(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._childRemoved=function(t){t.off(zr.SIZE_CHANGED,this._doLayoutDirty,this),t.off(zr.TRANSFORM_CHANGED,this._transformDirty,this),t.off(zr.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._childrenChanged,this),this._childrenChanged()},i._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},i._doLayoutHorizontally=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp.anchorPoint,o=this._getFixedBreakingNum(),s=1,a=this._paddingLeft;this._horizontalDirection===nC.RIGHT_TO_LEFT&&(s=-1,a=this._paddingRight);var l=(this._horizontalDirection-n.x)*t+s*a,h=l-s*this._spacingX,u=0,c=0,d=0,p=0,f=!1,_=this._usefulLayoutObj.length,g=this._cellSize.width,m=this._getPaddingH();this._layoutType!==tC.GRID&&this._resizeMode===eC.CHILDREN&&(g=(t-m-(_-1)*this._spacingX)/_);for(var y=this._usefulLayoutObj,v=0;v<y.length;++v){var b=y[v],S=b.node,T=S.scale,E=this._getUsedScaleValue(T.x),A=this._getUsedScaleValue(T.y);this._resizeMode===eC.CHILDREN&&(b.width=g/E,this._layoutType===tC.GRID&&(b.height=this._cellSize.height/A));var C=Math.abs(this._horizontalDirection-b.anchorX),w=b.width*E,x=b.height*A;x>d&&(p=Math.max(d,p),c=d||x,d=x),h+=s*(C*w+this._spacingX);var R=s*(1-C)*w;if(e){if(o>0)(f=v/o>0&&v%o==0)&&(c=d>x?d:c);else if(w>t-m)h>l+s*C*w&&(f=!0);else{var M=(1-this._horizontalDirection-n.x)*t,O=h+R+s*(s>0?this._paddingRight:this._paddingLeft);f=Math.abs(O)>Math.abs(M)}f&&(h=l+s*C*w,x!==d&&(c=d),u+=c+this._spacingY,c=d=x)}var P=i(S,b,u);r&&S.setPosition(h,P),h+=R}return c=Math.max(c,d),Math.max(p,u+c)+this._getPaddingV()},i._doLayoutVertically=function(t,e,i,r){var n=this.node._uiProps.uiTransformComp.anchorPoint,o=this._getFixedBreakingNum(),s=1,a=this._paddingBottom;this._verticalDirection===rC.TOP_TO_BOTTOM&&(s=-1,a=this._paddingTop);var l=(this._verticalDirection-n.y)*t+s*a,h=l-s*this._spacingY,u=0,c=0,d=0,p=0,f=!1,_=this._usefulLayoutObj.length,g=this._cellSize.height,m=this._getPaddingV();this._layoutType!==tC.GRID&&this._resizeMode===eC.CHILDREN&&(g=(t-m-(_-1)*this._spacingY)/_);for(var y=this._usefulLayoutObj,v=0;v<y.length;++v){var b=y[v],S=b.node,T=S.scale,E=this._getUsedScaleValue(T.x),A=this._getUsedScaleValue(T.y);this._resizeMode===eC.CHILDREN&&(b.height=g/A,this._layoutType===tC.GRID&&(b.width=this._cellSize.width/E));var C=Math.abs(this._verticalDirection-b.anchorY),w=b.width*E,x=b.height*A;w>u&&(c=Math.max(u,c),d=u||w,u=w),h+=s*(C*x+this._spacingY);var R=s*(1-C)*x;if(e){if(o>0)(f=v/o>0&&v%o==0)&&(d=u>x?u:d);else if(x>t-m)h>l+s*C*x&&(f=!0);else{var M=(1-this._verticalDirection-n.y)*t,O=h+R+s*(s>0?this._paddingTop:this._paddingBottom);f=Math.abs(O)>Math.abs(M)}f&&(h=l+s*C*x,w!==u&&(d=u),p+=d+this._spacingX,d=u=w)}var P=i(S,b,p);r&&(S.getPosition(OC),S.setPosition(P,h,OC.z)),h+=R}return d=Math.max(d,u),Math.max(c,p+d)+this._getPaddingH()},i._doLayoutGridAxisHorizontal=function(t,e){var i=this,r=e.width,n=1,o=-t.y*e.height,s=this._paddingBottom;this._verticalDirection===rC.TOP_TO_BOTTOM&&(n=-1,o=(1-t.y)*e.height,s=this._paddingTop);var a=function(t,e,r){return o+n*(r+(1-e.anchorY)*e.height*i._getUsedScaleValue(t.scale.y)+s)},l=0;this._resizeMode===eC.CONTAINER&&(l=this._doLayoutHorizontally(r,!0,a,!1),o=-t.y*l,this._verticalDirection===rC.TOP_TO_BOTTOM&&(n=-1,o=(1-t.y)*l)),this._doLayoutHorizontally(r,!0,a,!0),this._resizeMode===eC.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(r,l)},i._doLayoutGridAxisVertical=function(t,e){var i=this,r=e.height,n=1,o=-t.x*e.width,s=this._paddingLeft;this._horizontalDirection===nC.RIGHT_TO_LEFT&&(n=-1,o=(1-t.x)*e.width,s=this._paddingRight);var a=function(t,e,r){return o+n*(r+(1-e.anchorX)*e.width*i._getUsedScaleValue(t.scale.x)+s)},l=0;this._resizeMode===eC.CONTAINER&&(l=this._doLayoutVertically(r,!0,a,!1),o=-t.x*l,this._horizontalDirection===nC.RIGHT_TO_LEFT&&(n=-1,o=(1-t.x)*l)),this._doLayoutVertically(r,!0,a,!0),this._resizeMode===eC.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(l,r)},i._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,i=t.contentSize;this.startAxis===iC.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,i):this.startAxis===iC.VERTICAL&&this._doLayoutGridAxisVertical(e,i)},i._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===eC.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r],o=n.node.scale;e+=n.width*this._getUsedScaleValue(o.x)}e+=(i-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},i._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,i=t.length;if(this._resizeMode===eC.CONTAINER){for(var r=0;r<t.length;++r){var n=t[r],o=n.node.scale;e+=n.height*this._getUsedScaleValue(o.y)}e+=(i-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},i._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===tC.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?fi.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===tC.VERTICAL){var i=this._getVerticalBaseHeight();this._doLayoutVertically(i,!1,(function(e){return(t._isAlign?fi.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=i}else this._layoutType===tC.GRID&&this._doLayoutGrid()},i._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},i._transformDirty=function(t){t&Bi.SCALE&&t&Bi.POSITION&&this._affectedByScale&&this._doLayoutDirty()},i._doLayoutDirty=function(){this._layoutDirty=!0},i._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},i._getPaddingH=function(){return this._paddingLeft+this._paddingRight},i._getPaddingV=function(){return this._paddingTop+this._paddingBottom},i._getFixedBreakingNum=function(){if(this._layoutType!==tC.GRID||this._constraint===oC.NONE||this._constraintNum<=0)return 0;var t=this._constraint===oC.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===iC.VERTICAL&&(t=this._constraint===oC.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},Ge(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===tC.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===tC.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==tC.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==tC.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==oC.NONE&&this._constraintNum!==t&&(t<=0&&ti("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}($i),QA.Type=tC,QA.VerticalDirection=rC,QA.HorizontalDirection=nC,QA.ResizeMode=eC,QA.AxisDirection=iC,QA.Constraint=oC,bi((LA=$A).prototype,"alignHorizontal",[oA,sA],Object.getOwnPropertyDescriptor(LA.prototype,"alignHorizontal"),LA.prototype),bi(LA.prototype,"alignVertical",[aA,lA],Object.getOwnPropertyDescriptor(LA.prototype,"alignVertical"),LA.prototype),bi(LA.prototype,"type",[hA,uA],Object.getOwnPropertyDescriptor(LA.prototype,"type"),LA.prototype),bi(LA.prototype,"resizeMode",[cA,dA,pA],Object.getOwnPropertyDescriptor(LA.prototype,"resizeMode"),LA.prototype),bi(LA.prototype,"cellSize",[fA,_A],Object.getOwnPropertyDescriptor(LA.prototype,"cellSize"),LA.prototype),bi(LA.prototype,"startAxis",[gA,mA],Object.getOwnPropertyDescriptor(LA.prototype,"startAxis"),LA.prototype),bi(LA.prototype,"paddingLeft",[yA],Object.getOwnPropertyDescriptor(LA.prototype,"paddingLeft"),LA.prototype),bi(LA.prototype,"paddingRight",[vA],Object.getOwnPropertyDescriptor(LA.prototype,"paddingRight"),LA.prototype),bi(LA.prototype,"paddingTop",[bA],Object.getOwnPropertyDescriptor(LA.prototype,"paddingTop"),LA.prototype),bi(LA.prototype,"paddingBottom",[SA],Object.getOwnPropertyDescriptor(LA.prototype,"paddingBottom"),LA.prototype),bi(LA.prototype,"spacingX",[TA],Object.getOwnPropertyDescriptor(LA.prototype,"spacingX"),LA.prototype),bi(LA.prototype,"spacingY",[EA],Object.getOwnPropertyDescriptor(LA.prototype,"spacingY"),LA.prototype),bi(LA.prototype,"verticalDirection",[AA,CA],Object.getOwnPropertyDescriptor(LA.prototype,"verticalDirection"),LA.prototype),bi(LA.prototype,"horizontalDirection",[wA,xA],Object.getOwnPropertyDescriptor(LA.prototype,"horizontalDirection"),LA.prototype),bi(LA.prototype,"constraint",[RA,MA,OA],Object.getOwnPropertyDescriptor(LA.prototype,"constraint"),LA.prototype),bi(LA.prototype,"constraintNum",[PA,DA],Object.getOwnPropertyDescriptor(LA.prototype,"constraintNum"),LA.prototype),bi(LA.prototype,"affectedByScale",[IA],Object.getOwnPropertyDescriptor(LA.prototype,"affectedByScale"),LA.prototype),FA=bi(LA.prototype,"_resizeMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eC.NONE}}),kA=bi(LA.prototype,"_layoutType",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tC.NONE}}),NA=bi(LA.prototype,"_cellSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mr(40,40)}}),zA=bi(LA.prototype,"_startAxis",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iC.HORIZONTAL}}),UA=bi(LA.prototype,"_paddingLeft",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VA=bi(LA.prototype,"_paddingRight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HA=bi(LA.prototype,"_paddingTop",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GA=bi(LA.prototype,"_paddingBottom",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WA=bi(LA.prototype,"_spacingX",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XA=bi(LA.prototype,"_spacingY",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YA=bi(LA.prototype,"_verticalDirection",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rC.TOP_TO_BOTTOM}}),jA=bi(LA.prototype,"_horizontalDirection",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nC.LEFT_TO_RIGHT}}),qA=bi(LA.prototype,"_constraint",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return oC.NONE}}),KA=bi(LA.prototype,"_constraintNum",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),ZA=bi(LA.prototype,"_affectedByScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JA=bi(LA.prototype,"_isAlign",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BA=LA))||BA)||BA)||BA)||BA)||BA)||BA));!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(MC||(MC={})),Mi(MC);var DC,IC,BC,LC,FC,kC,NC,zC,UC,VC,HC,GC,WC,XC,YC,jC,qC,KC,ZC,JC,QC,$C,tw,ew,iw,rw=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((aC=_i("cc.ProgressBar"),lC=Ni(),hC=zi(110),uC=Ui(),cC=Gr(Dd),dC=Di(rm),pC=Vi(),fC=Di(MC),_C=Vi(),gC=Vi(),mC=Ji(),yC=Vi(),vC=Vi(),aC(bC=lC(bC=hC(bC=uC(bC=cC((RC=xC=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_barSprite",TC,Ti(e)),Si(e,"_mode",EC,Ti(e)),Si(e,"_totalLength",AC,Ti(e)),Si(e,"_progress",CC,Ti(e)),Si(e,"_reverse",wC,Ti(e)),e}He(e,t);var i=e.prototype;return i._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint,n=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===rm.FillType.RADIAL&&(this._mode=MC.FILLED),this._mode===MC.HORIZONTAL?this.totalLength=n.width:this._mode===MC.VERTICAL?this.totalLength=n.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var o=-i.width*r.x;t.setPosition(o,0,0)}}},i._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,i=e.anchorPoint,r=e.contentSize,n=t.getPosition(),o=new Cr(0,.5),s=En(this._progress),a=this._totalLength*s,l=r,h=0,u=0;switch(this._mode){case MC.HORIZONTAL:this._reverse&&(o=new Cr(1,.5)),l=new Mr(a,r.height),h=this._totalLength,u=r.height;break;case MC.VERTICAL:o=this._reverse?new Cr(.5,1):new Cr(.5,0),l=new Mr(r.width,a),h=r.width,u=this._totalLength}if(this._mode===MC.FILLED)this._barSprite.type!==rm.Type.FILLED?ti("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(a*=-1),this._barSprite.fillRange=a);else if(this._barSprite.type!==rm.Type.FILLED){var c=o.x-i.x,d=o.y-i.y,p=new fi(h*c,u*d,0);t.setPosition(n.x+p.x,n.y+p.y,n.z),e.setAnchorPoint(o),e.setContentSize(l)}else ti("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},Ge(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var i=e._uiProps.uiTransformComp.contentSize;this._mode===MC.HORIZONTAL?this.totalLength=i.width:this._mode===MC.VERTICAL?this.totalLength=i.height:this._mode===MC.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===MC.FILLED&&(t=En(t)),this._totalLength=t,this._updateBarStatus()}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}($i),xC.Mode=MC,bi((SC=RC).prototype,"barSprite",[dC,pC],Object.getOwnPropertyDescriptor(SC.prototype,"barSprite"),SC.prototype),bi(SC.prototype,"mode",[fC,_C],Object.getOwnPropertyDescriptor(SC.prototype,"mode"),SC.prototype),bi(SC.prototype,"totalLength",[gC],Object.getOwnPropertyDescriptor(SC.prototype,"totalLength"),SC.prototype),bi(SC.prototype,"progress",[mC,Zi,yC],Object.getOwnPropertyDescriptor(SC.prototype,"progress"),SC.prototype),bi(SC.prototype,"reverse",[vC],Object.getOwnPropertyDescriptor(SC.prototype,"reverse"),SC.prototype),TC=bi(SC.prototype,"_barSprite",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EC=bi(SC.prototype,"_mode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MC.HORIZONTAL}}),AC=bi(SC.prototype,"_totalLength",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CC=bi(SC.prototype,"_progress",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),wC=bi(SC.prototype,"_reverse",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bC=SC))||bC)||bC)||bC)||bC)||bC)),nw=new fi,ow=new fi,sw=new fi,aw=new Cr,lw=new tr,hw=new Cr;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(iw||(iw={})),Hr(iw);var uw,cw,dw,pw,fw,_w,gw,mw,yw,vw,bw,Sw,Tw,Ew,Aw,Cw,ww,xw,Rw,Mw,Ow,Pw,Dw,Iw,Bw,Lw,Fw,kw,Nw,zw,Uw,Vw,Hw,Gw,Ww,Xw,Yw,jw,qw,Kw,Zw,Jw,Qw,$w,tx,ex,ix,rx,nx,ox=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((DC=_i("cc.ScrollBar"),IC=Ni(),BC=zi(110),LC=Ui(),FC=Gr(Dd),kC=Di(rm),NC=Ur(),zC=Vi(),UC=Di(iw),VC=Ur(),HC=Vi(),GC=Ur(),WC=Vi(),XC=Ur(),YC=Vi(),DC(jC=IC(jC=BC(jC=LC(jC=FC((ew=tw=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_scrollView",KC,Ti(e)),Si(e,"_handle",ZC,Ti(e)),Si(e,"_direction",JC,Ti(e)),Si(e,"_enableAutoHide",QC,Ti(e)),Si(e,"_autoHideTime",$C,Ti(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}He(e,t);var i=e.prototype;return i.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},i.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},i.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e._uiProps.uiTransformComp.contentSize,r=this._scrollView.node._uiProps.uiTransformComp.contentSize,n=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(i,r)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var o=0,s=0,a=0,l=0,h=0,u=hw;u.set(0,0),this._direction===iw.HORIZONTAL?(o=i.width,s=r.width,h=n.width,a=t.x,this._convertToScrollViewSpace(u,e),l=-u.x):this._direction===iw.VERTICAL&&(o=i.height,s=r.height,h=n.height,a=t.y,this._convertToScrollViewSpace(u,e),l=-u.y);var c=this._calculateLength(o,s,h,a),d=hw;this._calculatePosition(d,o,s,h,l,a,c),this._updateLength(c),this._updateHandlerPosition(d)}}}},i.setScrollView=function(t){this._scrollView=t},i.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},i.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this._autoHideTime}},i.onEnable=function(){var t=this.node.getComponent(rm);t&&(this._opacity=t.color.a)},i.start=function(){this._enableAutoHide&&this._setOpacity(0)},i.update=function(t){this._processAutoHide(t)},i._convertToScrollViewSpace=function(t,e){var i=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,r=e._uiProps.uiTransformComp;if(i&&r){nw.set(-r.anchorX*r.width,-r.anchorY*r.height,0),r.convertToWorldSpaceAR(nw,ow);var n=i.convertToNodeSpaceAR(ow);n.x+=i.anchorX*i.width,n.y+=i.anchorY*i.height,t.set(n.x,n.y)}else t.set(Cr.ZERO)},i._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(rm);e&&(lw.set(e.color),lw.a=t,e.color=lw),(e=this._handle.getComponent(rm))&&(lw.set(e.color),lw.a=t,e.color=lw)}},i._updateHandlerPosition=function(t){if(this._handle){var e=sw;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},i._fixupHandlerPosition=function(t){var e=this.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint,n=this.handle.node._uiProps.uiTransformComp.contentSize,o=this.handle.node.parent;fi.set(nw,-i.width*r.x,-i.height*r.y,0);var s=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR(nw,ow),a=t;a.set(0,0,0),o._uiProps.uiTransformComp.convertToNodeSpaceAR(s,a),this.direction===iw.HORIZONTAL?a.set(a.x,a.y+(i.height-n.height)/2,a.z):this.direction===iw.VERTICAL&&a.set(a.x+(i.width-n.width)/2,a.y,a.z),this.handle.node.setPosition(a)},i._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===iw.HORIZONTAL||t.height<=e.height&&this._direction===iw.VERTICAL},i._calculateLength=function(t,e,i,r){var n=t;return r&&(n+=20*(r>0?r:-r)),i*(e/n)},i._calculatePosition=function(t,e,i,r,n,o,s){var a=e-i;o&&(a+=Math.abs(o));var l=0;a&&(l=En(l=n/a));var h=(r-s)*l;this._direction===iw.VERTICAL?t.set(0,h):t.set(h,0)},i._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,i=e.contentSize,r=e.anchorPoint;r.x===aw.x&&r.y===aw.y||e.setAnchorPoint(aw),this._direction===iw.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},i._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},Ge(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Cr.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(Cr.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}($i),tw.Direction=iw,bi((qC=ew).prototype,"handle",[kC,NC,zC],Object.getOwnPropertyDescriptor(qC.prototype,"handle"),qC.prototype),bi(qC.prototype,"direction",[UC,VC,HC],Object.getOwnPropertyDescriptor(qC.prototype,"direction"),qC.prototype),bi(qC.prototype,"enableAutoHide",[GC,WC],Object.getOwnPropertyDescriptor(qC.prototype,"enableAutoHide"),qC.prototype),bi(qC.prototype,"autoHideTime",[XC,YC],Object.getOwnPropertyDescriptor(qC.prototype,"autoHideTime"),qC.prototype),KC=bi(qC.prototype,"_scrollView",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZC=bi(qC.prototype,"_handle",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JC=bi(qC.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iw.HORIZONTAL}}),QC=bi(qC.prototype,"_enableAutoHide",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$C=bi(qC.prototype,"_autoHideTime",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jC=qC))||jC)||jC)||jC)||jC)||jC)),sx=t("ViewGroup",_i("cc.ViewGroup")(uw=zi(110)(uw=function(t){function e(){return t.apply(this,arguments)||this}return He(e,t),e}($i))||uw)||uw);ei.ViewGroup=sx;var ax,lx=1e-4,hx=new fi,ux=new fi,cx=new Cr,dx=new Cr,px=function(){return(new Date).getMilliseconds()},fx={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(ax||(ax={}));var _x,gx,mx,yx,vx,bx,Sx,Tx,Ex,Ax,Cx,wx,xx,Rx,Mx,Ox,Px,Dx,Ix,Bx,Lx,Fx,kx=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((cw=_i("cc.ScrollView"),dw=Ni(),pw=zi(110),fw=Ui(),_w=Gr(Dd),gw=Ji(),mw=Ur(),yw=Vi(),vw=Ji(),bw=Ur(),Sw=Vi(),Tw=Ur(),Ew=Vi(),Aw=Ur(),Cw=Vi(),ww=Di(br),xw=Ur(),Rw=Vi(),Mw=Ur(),Ow=Vi(),Pw=Di(ox),Dw=Ur(),Iw=Vi(),Bw=Ur(),Lw=Vi(),Fw=Di(ox),kw=Ur(),Nw=Vi(),zw=Ur(),Uw=Vi(),Vw=Di([fn]),Hw=Ur(),Gw=Vi(),cw(Ww=dw(Ww=pw(Ww=fw(Ww=_w((nx=rx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"bounceDuration",Yw,Ti(e)),Si(e,"brake",jw,Ti(e)),Si(e,"elastic",qw,Ti(e)),Si(e,"inertia",Kw,Ti(e)),Si(e,"horizontal",Zw,Ti(e)),Si(e,"vertical",Jw,Ti(e)),Si(e,"cancelInnerEvents",Qw,Ti(e)),Si(e,"scrollEvents",$w,Ti(e)),e._autoScrolling=!1,e._scrolling=!1,Si(e,"_content",tx,Ti(e)),Si(e,"_horizontalScrollBar",ex,Ti(e)),Si(e,"_verticalScrollBar",ix,Ti(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new fi,e._autoScrollTargetDelta=new fi,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new fi,e._outOfBoundaryAmount=new fi,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new fi,e._deltaPos=new fi,e}He(e,t);var i=e.prototype;return i.scrollToBottom=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},i.scrollToTop=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var i=this._calculateMovePercentDelta({anchor:new Cr(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},i.scrollToOffset=function(t,e,i){void 0===i&&(i=!0);var r=this.getMaxScrollOffset(),n=new Cr(0,0);0===r.x?n.x=0:n.x=t.x/r.x,0===r.y?n.y=1:n.y=(r.y-t.y)/r.y,this.scrollTo(n,e,i)},i.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Cr(e,t)},i.getMaxScrollOffset=function(){if(!this._content||!this.view)return Cr.ZERO;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,i=t.height-this.view.height;return new Cr(e=e>=0?e:0,i=i>=0?i:0)},i.scrollToPercentHorizontal=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Cr(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(r,e,!1!==i):this._moveContent(r)},i.scrollTo=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Cr(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.scrollToPercentVertical=function(t,e,i){var r=this._calculateMovePercentDelta({anchor:new Cr(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(r,e,i):this._moveContent(r)},i.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},i.setContentPosition=function(t){this._setContentPosition(t)},i._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<lx&&Math.abs(t.y-e.y)<lx||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},i.getContentPosition=function(){return this._getContentPosition()},i._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):fi.ZERO.clone()},i.isScrolling=function(){return this._scrolling},i.isAutoScrolling=function(){return this._autoScrolling},i.getScrollEndedEventTiming=function(){return lx},i.start=function(){this._calculateBoundary(),this._content&&Fr.once(kr.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},i.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(zr.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(zr.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(zr.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(zr.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},i.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},i.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(zr.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(zr.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(zr.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(zr.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},i._registerEvent=function(){this.node.on(zr.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(zr.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(zr.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(zr.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(zr.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._unregisterEvent=function(){this.node.off(zr.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(zr.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(zr.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(zr.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(zr.MOUSE_WHEEL,this._onMouseWheel,this,!0)},i._onMouseWheel=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=new fi,r=t.getScrollY();this.vertical?i.set(0,-.1*r,0):this.horizontal&&i.set(-.1*r,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},i._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},i._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this._handleMoveLogic(i),this.cancelInnerEvents){var r=i.getUILocation(cx);if(r.subtract(i.getUIStartLocation(dx)),r.length()>7&&!this._touchMoved&&t.target!==this.node){var n=new An(t.getTouches(),t.bubbles,Cn.TOUCH_CANCEL);n.touch=t.touch,n.simulate=!0,t.target.dispatchEvent(n),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},i._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(ax.TOUCH_UP);var i=t.touch;this._handleReleaseLogic(i),this._touchMoved?t.propagationStopped=!0:this._stopPropagationIfTargetIsMe(t)}},i._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var i=t.touch;this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},i._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(PC);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,i=e.width*e.anchorX,r=e.height*e.anchorY;this._leftBoundary=-i,this._bottomBoundary=-r,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},i._hasNestedViewGroup=function(t,e){if(!t||t.eventPhase!==wn.CAPTURING_PHASE)return!1;if(e)for(var i,r=qe(e);!(i=r()).done;){var n=i.value;if(this.node===n)return!(!t.target||!t.target.getComponent(sx));if(n.getComponent(sx))return!0}return!1},i._startInertiaScroll=function(t){var e=new fi(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},i._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},i._startAttenuatingAutoScroll=function(t,e){var i=t.clone();if(i.normalize(),this._content&&this.view){var r=this._content._uiProps.uiTransformComp.contentSize,n=this.view.contentSize,o=r.width-n.width,s=r.height-n.height,a=this._calculateAttenuatedFactor(o),l=this._calculateAttenuatedFactor(s);i.x=i.x*o*(1-this.brake)*a,i.y=i.y*s*l*(1-this.brake),i.z=0}var h=t.length(),u=i.length()/h;if(i.add(t),this.brake>0&&u>7){u=Math.sqrt(u);var c=t.clone();c.multiplyScalar(u),i.set(c),i.add(t)}var d=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&u>3&&(d*=u=3),0===this.brake&&u>1&&(d*=u),this._startAutoScroll(i,d,!0)},i._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},i._startAutoScroll=function(t,e,i){void 0===i&&(i=!1);var r=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=r,this._autoScrollAttenuate=i,fi.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(fi.ZERO,lx)||(this._autoScrollCurrentlyOutOfBoundary=!0)},i._calculateTouchMoveVelocity=function(){var t=new fi,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(fi.ZERO);else{var i=new fi;i=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),i),t.set(i.x*(1-this.brake)/e,i.y*(1-this.brake)/e,i.z)}return t},i._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},i._moveContent=function(t,e){var i=this._flattenVectorByDirection(t);hx.set(this._getContentPosition()),hx.add(i),hx.set(Math.floor(1e4*hx.x)*lx,Math.floor(1e4*hx.y)*lx,hx.z),this._setContentPosition(hx);var r=this._getHowMuchOutOfBoundary();cx.set(r.x,r.y),this._updateScrollBar(cx),this.elastic&&e&&this._startBounceBackIfNeeded()},i._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},i._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},i._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},i._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},i._getHowMuchOutOfBoundary=function(t){if((t=t||new fi).equals(fi.ZERO,lx)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new fi;return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),t.equals(fi.ZERO,lx)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},i._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},i._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},i._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},i._dispatchEvent=function(t){if(t===ax.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===ax.SCROLL_TO_TOP||t===ax.SCROLL_TO_BOTTOM||t===ax.SCROLL_TO_LEFT||t===ax.SCROLL_TO_RIGHT){var e=1<<fx[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}fn.emitEvents(this.scrollEvents,this,fx[t]),this.node.emit(t,this)},i._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();hx.set(this._getContentPosition()),hx.add(t),this._content.setPosition(hx),this._updateScrollBar(Cr.ZERO)}},i._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},i._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},i._stopPropagationIfTargetIsMe=function(t){t.eventPhase===wn.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},i._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},i._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._processDeltaMove(this._deltaPos)},i._handleReleaseLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(ax.SCROLL_ENDED))},i._getLocalAxisAlignDelta=function(t,e){var i=this.node._uiProps.uiTransformComp,r=new fi;i&&(e.getUILocation(cx),e.getUIPreviousLocation(dx),hx.set(cx.x,cx.y,0),ux.set(dx.x,dx.y,0),i.convertToNodeSpaceAR(hx,hx),i.convertToNodeSpaceAR(ux,ux),fi.subtract(r,hx,ux)),t.set(r)},i._scrollChildren=function(t){this._clampDelta(t);var e,i,r=t;if(this.elastic&&(e=this._getHowMuchOutOfBoundary(),r.x*=0===e.x?1:.5,r.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(r),r.add(e)),this._content){var n=this._content._uiProps.uiTransformComp,o=n.anchorX,s=n.anchorY,a=n.width,l=n.height,h=this._content.position||fi.ZERO;r.y>0?h.y-s*l+r.y>=this._bottomBoundary&&(i=ax.SCROLL_TO_BOTTOM):r.y<0&&h.y-s*l+l+r.y<=this._topBoundary&&(i=ax.SCROLL_TO_TOP),r.x<0?h.x-o*a+a+r.x<=this._rightBoundary&&(i=ax.SCROLL_TO_RIGHT):r.x>0&&h.x-o*a+r.x>=this._leftBoundary&&(i=ax.SCROLL_TO_LEFT)}this._moveContent(r,!1),0===r.x&&0===r.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent(ax.SCROLL_BEGAN)),this._dispatchEvent(ax.SCROLLING)),i&&i.length>0&&this._dispatchEvent(i)},i._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(ax.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=px(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},i._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,i=this._content._uiProps.uiTransformComp;i.width<e.width&&(t.x=0),i.height<e.height&&(t.y=0)}},i._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var i=px();this._touchMoveTimeDeltas.push((i-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=i},i._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(this._clampDelta(t),t.equals(fi.ZERO,lx))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(ax.BOUNCE_TOP),t.y<0&&this._dispatchEvent(ax.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(ax.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(ax.BOUNCE_LEFT),this._isBouncing=!0),!0},i._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(hx,lx)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},i._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(fi.ZERO,lx)},i._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this._getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},i._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var r,n=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(r=n,n=(r-=1)*r*r*r*r+1);var o=this._autoScrollTargetDelta.clone();o.multiplyScalar(n);var s=this._autoScrollStartPosition.clone();s.add(o);var a=Math.abs(n-1)<=lx;if(Math.abs(n-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(ax.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var l=s.clone();l.subtract(this._autoScrollBrakingStartPosition),e&&l.multiplyScalar(i),s.set(this._autoScrollBrakingStartPosition),s.add(l)}else{var h=s.clone();h.subtract(this.getContentPosition());var u=this._getHowMuchOutOfBoundary(h);u.equals(fi.ZERO,lx)||(s.add(u),a=!0)}a&&(this._autoScrolling=!1);var c=s.clone();c.subtract(this._getContentPosition()),this._clampDelta(c),this._moveContent(c,a),this._dispatchEvent(ax.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(ax.SCROLL_ENDED))},i._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(fi.ZERO,lx))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(ax.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(ax.SCROLL_ENDED),this._stopMouseWheel=!1)},i._calculateMovePercentDelta=function(t){var e=t.anchor,i=t.applyToHorizontal,r=t.applyToVertical;this._calculateBoundary(),e.clampf(Cr.ZERO,Cr.ONE);var n=this._getContentBottomBoundary()-this._bottomBoundary;n=-n;var o=this._getContentLeftBoundary()-this._leftBoundary;o=-o;var s=new fi;if(this._content&&this.view){var a=0,l=this._content._uiProps.uiTransformComp.contentSize,h=this.view.contentSize;i&&(a=l.width-h.width,s.x=o-a*e.x),r&&(a=l.height-h.height,s.y=n-a*e.y)}return s},i._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var i=new fi,r=0,n=this._getContentLeftBoundary()-this._leftBoundary;if(n=-n,this._content){var o=this._content._uiProps.uiTransformComp.contentSize;o.height<t.height&&(r=o.height-t.height,i.y=e-r),o.width<t.width&&(r=o.width-t.width,i.x=n)}this._updateScrollBarState(),this._moveContent(i),this._adjustContentOutOfBoundary()},i._scaleChanged=function(t){t===Bi.SCALE&&this._calculateBoundary()},Ge(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):hn(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(Cr.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(Cr.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(sx),rx.EventType=ax,Yw=bi((Xw=nx).prototype,"bounceDuration",[Ai,gw,mw,yw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jw=bi(Xw.prototype,"brake",[Ai,vw,bw,Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),qw=bi(Xw.prototype,"elastic",[Ai,Tw,Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kw=bi(Xw.prototype,"inertia",[Ai,Aw,Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bi(Xw.prototype,"content",[ww,xw,Rw],Object.getOwnPropertyDescriptor(Xw.prototype,"content"),Xw.prototype),Zw=bi(Xw.prototype,"horizontal",[Ai,Mw,Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bi(Xw.prototype,"horizontalScrollBar",[Pw,Dw,Iw],Object.getOwnPropertyDescriptor(Xw.prototype,"horizontalScrollBar"),Xw.prototype),Jw=bi(Xw.prototype,"vertical",[Ai,Bw,Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bi(Xw.prototype,"verticalScrollBar",[Fw,kw,Nw],Object.getOwnPropertyDescriptor(Xw.prototype,"verticalScrollBar"),Xw.prototype),Qw=bi(Xw.prototype,"cancelInnerEvents",[Ai,zw,Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$w=bi(Xw.prototype,"scrollEvents",[Vw,Ai,Hw,Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tx=bi(Xw.prototype,"_content",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ex=bi(Xw.prototype,"_horizontalScrollBar",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ix=bi(Xw.prototype,"_verticalScrollBar",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ww=Xw))||Ww)||Ww)||Ww)||Ww)||Ww)),Nx=new fi;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(Fx||(Fx={})),Hr(Fx);var zx,Ux,Vx,Hx,Gx,Wx,Xx,Yx,jx,qx,Kx,Zx,Jx,Qx,$x,tR,eR,iR,rR,nR,oR=function(e){return t({Slider:e,SliderComponent:e}),e}((_x=_i("cc.Slider"),gx=Ni(),mx=zi(110),yx=Ui(),vx=Gr(Dd),bx=Di(rm),Sx=Vi(),Tx=Di(Fx),Ex=Vi(),Ax=Ji(),Cx=Vi(),wx=Di([fn]),xx=Vi(),_x(Rx=gx(Rx=mx(Rx=yx(Rx=vx((Lx=Bx=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"slideEvents",Ox,Ti(e)),Si(e,"_handle",Px,Ti(e)),Si(e,"_direction",Dx,Ti(e)),Si(e,"_progress",Ix,Ti(e)),e._offset=new fi,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new fi,e._touchPos=new fi,e}He(e,t);var i=e.prototype;return i.__preload=function(){this._updateHandlePosition()},i.onEnable=function(){this._updateHandlePosition(),this.node.on(zr.TOUCH_START,this._onTouchBegan,this),this.node.on(zr.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(zr.TOUCH_END,this._onTouchEnded,this),this.node.on(zr.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(zr.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(zr.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(zr.TOUCH_END,this._onTouchEnded,this))},i.onDisable=function(){this.node.off(zr.TOUCH_START,this._onTouchBegan,this),this.node.off(zr.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(zr.TOUCH_END,this._onTouchEnded,this),this.node.off(zr.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(zr.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(zr.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(zr.TOUCH_END,this._onTouchEnded,this))},i._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();fi.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},i._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},i._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new fi,t&&(t.propagationStopped=!0)},i._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},i._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},i._emitSlideEvent=function(){fn.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},i._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();fi.set(this._touchPos,e.x,e.y,0);var i=this.node._uiProps.uiTransformComp,r=i.convertToNodeSpaceAR(this._touchPos,Nx);this.direction===Fx.Horizontal?this.progress=En(.5+(r.x-this._offset.x)/i.width):this.progress=En(.5+(r.y-this._offset.y)/i.height)}},i._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===Fx.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},i._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var i=this._handle.node.position;this._direction===Fx.Horizontal?this._handle.node.setPosition(i.x,0,i.z):this._handle.node.setPosition(0,i.y,i.z),this._updateHandlePosition()}},Ge(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}($i),Bx.Direction=Fx,bi((Mx=Lx).prototype,"handle",[bx,Sx],Object.getOwnPropertyDescriptor(Mx.prototype,"handle"),Mx.prototype),bi(Mx.prototype,"direction",[Tx,Ex],Object.getOwnPropertyDescriptor(Mx.prototype,"direction"),Mx.prototype),bi(Mx.prototype,"progress",[Zi,Ax,Cx],Object.getOwnPropertyDescriptor(Mx.prototype,"progress"),Mx.prototype),Ox=bi(Mx.prototype,"slideEvents",[wx,Ai,xx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Px=bi(Mx.prototype,"_handle",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dx=bi(Mx.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fx.Horizontal}}),Ix=bi(Mx.prototype,"_progress",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Rx=Mx))||Rx)||Rx)||Rx)||Rx)||Rx));function sR(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return Object.assign.apply(Object,[{}].concat(e))}!function(t){t.TOGGLE="toggle"}(nR||(nR={}));var aR,lR,hR,uR,cR,dR,pR,fR,_R,gR,mR,yR,vR,bR,SR,TR,ER,AR,CR,wR,xR,RR,MR,OR,PR,DR,IR,BR,LR,FR,kR,NR,zR,UR,VR,HR,GR,WR,XR,YR,jR,qR,KR,ZR,JR,QR,$R,tM,eM,iM,rM,nM,oM,sM,aM,lM,hM,uM,cM,dM=function(e){return t({Toggle:e,ToggleComponent:e}),e}((zx=_i("cc.Toggle"),Ux=Ni(),Vx=zi(110),Hx=Ui(),Gx=Gr(Dd),Wx=Ur(),Xx=Vi(),Yx=Di(rm),jx=Ur(),qx=Vi(),Kx=Di([fn]),Zx=Vi(),zx(Jx=Ux(Jx=Vx(Jx=Hx(Jx=Gx((rR=iR=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"checkEvents",$x,Ti(e)),Si(e,"_isChecked",tR,Ti(e)),Si(e,"_checkMark",eR,Ti(e)),e}He(e,t);var i=e.prototype;return i._internalToggle=function(){this.isChecked=!this.isChecked},i._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var i=this._toggleContainer;i&&i.enabled&&this.enabled&&(t||!i.anyTogglesChecked()&&!i.allowSwitchOff)&&(this._isChecked=!0,i.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},i.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},i.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},i.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},i.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},i._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&fn.emitEvents(this.checkEvents,this)},Ge(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return ei.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(NT),iR.EventType=sR(nR,IT),bi((Qx=rR).prototype,"isChecked",[Wx,Xx],Object.getOwnPropertyDescriptor(Qx.prototype,"isChecked"),Qx.prototype),bi(Qx.prototype,"checkMark",[Yx,jx,qx],Object.getOwnPropertyDescriptor(Qx.prototype,"checkMark"),Qx.prototype),$x=bi(Qx.prototype,"checkEvents",[Kx,Ai,Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tR=bi(Qx.prototype,"_isChecked",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),eR=bi(Qx.prototype,"_checkMark",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jx=Qx))||Jx)||Jx)||Jx)||Jx)||Jx)),pM=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((aR=_i("cc.ToggleContainer"),lR=Ni(),hR=zi(110),uR=Ui(),cR=Vi(),dR=Di([fn]),pR=Vi(),aR(fR=lR(fR=hR(fR=uR(fR=Ii((yR=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_allowSwitchOff",gR,Ti(e)),Si(e,"checkEvents",mR,Ti(e)),e}He(e,t);var i=e.prototype;return i.onEnable=function(){this.ensureValidState(),this.node.on(zr.CHILD_ADDED,this.ensureValidState,this),this.node.on(zr.CHILD_REMOVED,this.ensureValidState,this)},i.onDisable=function(){this.node.off(zr.CHILD_ADDED,this.ensureValidState,this),this.node.off(zr.CHILD_REMOVED,this.ensureValidState,this)},i.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},i.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},i.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var i=0;i<this.toggleItems.length;i++){var r=this.toggleItems[i];r!==t&&(e?r.isChecked=!1:r.setIsCheckedWithoutNotify(!1))}this.checkEvents&&ei.Component.EventHandler.emitEvents(this.checkEvents,t)}},i.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var i=this.activeToggles();if(i.length>1)for(var r=i[0],n=0;n<i.length;++n){var o=i[n];o!==r&&(o.isChecked=!1)}},Ge(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}($i),gR=bi((_R=yR).prototype,"_allowSwitchOff",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(_R.prototype,"allowSwitchOff",[cR],Object.getOwnPropertyDescriptor(_R.prototype,"allowSwitchOff"),_R.prototype),mR=bi(_R.prototype,"checkEvents",[dR,Ai,pR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fR=_R))||fR)||fR)||fR)||fR)||fR)),fM=new Cr;function _M(t){return t instanceof Rn?Vr:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:Mr.ZERO}function gM(t,e,i,r){t.parent?fM.set(t.parent.getScale().x,t.parent.getScale().y):fM.set(0,0);for(var n=fM.x,o=fM.y,s=0,a=0,l=t.parent;;){if(!l)return i.x=i.y=0,void(r.x=r.y=1);var h=l.getPosition();if(s+=h.x,a+=h.y,(l=l.parent)===e)break;l?fM.set(l.getScale().x,l.getScale().y):fM.set(0,0);var u=fM.x,c=fM.y;s*=u,a*=c,n*=u,o*=c}r.x=0!==n?1/n:1,r.y=0!==o?1/o:1,i.x=-s,i.y=-a}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(uM||(uM={})),Hr(uM),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(cM||(cM={}));var mM,yM,vM,bM,SM,TM,EM,AM,CM,wM,xM,RM,MM,OM,PM,DM,IM,BM,LM,FM=cM.TOP|cM.BOT,kM=cM.LEFT|cM.RIGHT,NM=function(e){return t({Widget:e,WidgetComponent:e}),e}((vR=_i("cc.Widget"),bR=Ni(),SR=zi(110),TR=Ui(),ER=Gr(Dd),AR=Di(br),CR=Vi(),wR=Vi(),xR=Vi(),RR=Vi(),MR=Vi(),OR=Vi(),PR=Vi(),DR=Hi(),IR=Hi(),BR=Vi(),LR=Vi(),FR=Vi(),kR=Vi(),NR=Vi(),zR=Vi(),UR=Di(uM),VR=Vi(),vR(HR=bR(HR=SR(HR=TR(HR=ER(HR=Ii((hM=lM=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._lastPos=new fi,e._lastSize=new Mr,e._dirty=!0,e._hadAlignOnce=!1,Si(e,"_alignFlags",WR,Ti(e)),Si(e,"_target",XR,Ti(e)),Si(e,"_left",YR,Ti(e)),Si(e,"_right",jR,Ti(e)),Si(e,"_top",qR,Ti(e)),Si(e,"_bottom",KR,Ti(e)),Si(e,"_horizontalCenter",ZR,Ti(e)),Si(e,"_verticalCenter",JR,Ti(e)),Si(e,"_isAbsLeft",QR,Ti(e)),Si(e,"_isAbsRight",$R,Ti(e)),Si(e,"_isAbsTop",tM,Ti(e)),Si(e,"_isAbsBottom",eM,Ti(e)),Si(e,"_isAbsHorizontalCenter",iM,Ti(e)),Si(e,"_isAbsVerticalCenter",rM,Ti(e)),Si(e,"_originalWidth",nM,Ti(e)),Si(e,"_originalHeight",oM,Ti(e)),Si(e,"_alignMode",sM,Ti(e)),Si(e,"_lockFlags",aM,Ti(e)),e}He(e,t);var i=e.prototype;return i.updateAlignment=function(){ei._widgetManager.updateAlignment(this.node)},i._validateTargetInDEV=function(){},i.setDirty=function(){this._recursiveDirty()},i.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),ei._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},i.onDisable=function(){ei._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},i.onDestroy=function(){this._removeParentEvent()},i._adjustWidgetToAllowMovingInEditor=function(){},i._adjustWidgetToAllowResizingInEditor=function(){},i._adjustWidgetToAnchorChanged=function(){this.setDirty()},i._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},i._registerEvent=function(){this.node.on(zr.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(zr.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(zr.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(zr.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._unregisterEvent=function(){this.node.off(zr.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(zr.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(zr.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},i._removeParentEvent=function(){this.node.off(zr.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},i._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var i=this.node.parent&&this.node.parent._uiProps,r=i&&i.uiTransformComp,n=r?r.contentSize:Vr;this.isAlignLeft&&t===cM.LEFT?this._left=e?this._left*n.width:this._left/n.width:this.isAlignRight&&t===cM.RIGHT?this._right=e?this._right*n.width:this._right/n.width:this.isAlignHorizontalCenter&&t===cM.CENTER?this._horizontalCenter=e?this._horizontalCenter*n.width:this._horizontalCenter/n.width:this.isAlignTop&&t===cM.TOP?this._top=e?this._top*n.height:this._top/n.height:this.isAlignBottom&&t===cM.BOT?this._bottom=e?this._bottom*n.height:this._bottom/n.height:this.isAbsoluteVerticalCenter&&t===cM.MID&&(this._verticalCenter=this._verticalCenter/n.height),this._recursiveDirty()}},i._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(Dd)&&(t.on(zr.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(zr.SIZE_CHANGED,this._setDirtyByMode,this),t.on(zr.ANCHOR_CHANGED,this._setDirtyByMode,this))},i._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(zr.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(zr.SIZE_CHANGED,this._setDirtyByMode,this),t.off(zr.ANCHOR_CHANGED,this._setDirtyByMode,this))},i._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(zr.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(zr.SIZE_CHANGED,this._setDirtyByMode,this))},i._setDirtyByMode=function(){(this.alignMode===uM.ALWAYS||xn)&&this._recursiveDirty()},i._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var i=(t&kM)>0,r=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=r.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=r.height))):(i?this.isStretchWidth&&(r.width=this._originalWidth):this.isStretchHeight&&(r.height=this._originalHeight),this._alignFlags&=~t)}},i._recursiveDirty=function(){this._dirty||(this._dirty=!0)},Ge(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&cM.TOP)>0},set:function(t){this._setAlign(cM.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&cM.BOT)>0},set:function(t){this._setAlign(cM.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&cM.LEFT)>0},set:function(t){this._setAlign(cM.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&cM.RIGHT)>0},set:function(t){this._setAlign(cM.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&cM.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=cM.MID):this._alignFlags&=~cM.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&cM.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=cM.CENTER):this._alignFlags&=~cM.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&kM)===kM}},{key:"isStretchHeight",get:function(){return(this._alignFlags&FM)===FM}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(cM.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(cM.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(cM.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(cM.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(cM.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(cM.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}($i),lM.AlignMode=uM,bi((GR=hM).prototype,"target",[AR,CR],Object.getOwnPropertyDescriptor(GR.prototype,"target"),GR.prototype),bi(GR.prototype,"isAlignTop",[wR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignTop"),GR.prototype),bi(GR.prototype,"isAlignBottom",[xR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignBottom"),GR.prototype),bi(GR.prototype,"isAlignLeft",[RR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignLeft"),GR.prototype),bi(GR.prototype,"isAlignRight",[MR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignRight"),GR.prototype),bi(GR.prototype,"isAlignVerticalCenter",[OR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignVerticalCenter"),GR.prototype),bi(GR.prototype,"isAlignHorizontalCenter",[PR],Object.getOwnPropertyDescriptor(GR.prototype,"isAlignHorizontalCenter"),GR.prototype),bi(GR.prototype,"isStretchWidth",[DR],Object.getOwnPropertyDescriptor(GR.prototype,"isStretchWidth"),GR.prototype),bi(GR.prototype,"isStretchHeight",[IR],Object.getOwnPropertyDescriptor(GR.prototype,"isStretchHeight"),GR.prototype),bi(GR.prototype,"top",[BR],Object.getOwnPropertyDescriptor(GR.prototype,"top"),GR.prototype),bi(GR.prototype,"editorTop",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorTop"),GR.prototype),bi(GR.prototype,"bottom",[LR],Object.getOwnPropertyDescriptor(GR.prototype,"bottom"),GR.prototype),bi(GR.prototype,"editorBottom",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorBottom"),GR.prototype),bi(GR.prototype,"left",[FR],Object.getOwnPropertyDescriptor(GR.prototype,"left"),GR.prototype),bi(GR.prototype,"editorLeft",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorLeft"),GR.prototype),bi(GR.prototype,"right",[kR],Object.getOwnPropertyDescriptor(GR.prototype,"right"),GR.prototype),bi(GR.prototype,"editorRight",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorRight"),GR.prototype),bi(GR.prototype,"horizontalCenter",[NR],Object.getOwnPropertyDescriptor(GR.prototype,"horizontalCenter"),GR.prototype),bi(GR.prototype,"editorHorizontalCenter",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorHorizontalCenter"),GR.prototype),bi(GR.prototype,"verticalCenter",[zR],Object.getOwnPropertyDescriptor(GR.prototype,"verticalCenter"),GR.prototype),bi(GR.prototype,"editorVerticalCenter",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"editorVerticalCenter"),GR.prototype),bi(GR.prototype,"isAbsoluteTop",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteTop"),GR.prototype),bi(GR.prototype,"isAbsoluteBottom",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteBottom"),GR.prototype),bi(GR.prototype,"isAbsoluteLeft",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteLeft"),GR.prototype),bi(GR.prototype,"isAbsoluteRight",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteRight"),GR.prototype),bi(GR.prototype,"isAbsoluteHorizontalCenter",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteHorizontalCenter"),GR.prototype),bi(GR.prototype,"isAbsoluteVerticalCenter",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"isAbsoluteVerticalCenter"),GR.prototype),bi(GR.prototype,"alignMode",[UR,VR],Object.getOwnPropertyDescriptor(GR.prototype,"alignMode"),GR.prototype),bi(GR.prototype,"alignFlags",[Pi],Object.getOwnPropertyDescriptor(GR.prototype,"alignFlags"),GR.prototype),WR=bi(GR.prototype,"_alignFlags",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XR=bi(GR.prototype,"_target",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YR=bi(GR.prototype,"_left",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jR=bi(GR.prototype,"_right",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qR=bi(GR.prototype,"_top",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KR=bi(GR.prototype,"_bottom",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZR=bi(GR.prototype,"_horizontalCenter",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JR=bi(GR.prototype,"_verticalCenter",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QR=bi(GR.prototype,"_isAbsLeft",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$R=bi(GR.prototype,"_isAbsRight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tM=bi(GR.prototype,"_isAbsTop",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),eM=bi(GR.prototype,"_isAbsBottom",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),iM=bi(GR.prototype,"_isAbsHorizontalCenter",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rM=bi(GR.prototype,"_isAbsVerticalCenter",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nM=bi(GR.prototype,"_originalWidth",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oM=bi(GR.prototype,"_originalHeight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sM=bi(GR.prototype,"_alignMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uM.ON_WINDOW_RESIZE}}),aM=bi(GR.prototype,"_lockFlags",[Ai,Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HR=GR))||HR)||HR)||HR)||HR)||HR)||HR));ei.internal.computeInverseTransForTarget=gM,ei.internal.getReadonlyNodeSize=_M;var zM,UM=new tr;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(zM||(zM={})),Hr(zM);var VM,HM,GM,WM,XM,YM,jM,qM,KM,ZM,JM,QM,$M,tO,eO,iO,rO,nO,oO,sO,aO,lO,hO,uO,cO,dO,pO,fO,_O,gO,mO,yO,vO,bO,SO,TO,EO,AO,CO,wO,xO,RO,MO,OO,PO,DO=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((mM=_i("cc.PageViewIndicator"),yM=Ni(),vM=zi(110),bM=Ui(),SM=Di(dc),TM=Vi(),EM=Di(zM),AM=Vi(),CM=Di(Mr),wM=Vi(),xM=Vi(),mM(RM=yM(RM=vM(RM=bM((LM=BM=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"spacing",OM,Ti(e)),Si(e,"_spriteFrame",PM,Ti(e)),Si(e,"_direction",DM,Ti(e)),Si(e,"_cellSize",IM,Ti(e)),e._layout=null,e._pageView=null,e._indicators=[],e}He(e,t);var i=e.prototype;return i.onLoad=function(){this._updateLayout()},i.setPageView=function(t){this._pageView=t,this._refresh()},i._updateLayout=function(){this._layout=this.getComponent(PC),this._layout||(this._layout=this.addComponent(PC));var t=this._layout;this.direction===zM.HORIZONTAL?(t.type=PC.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===zM.VERTICAL&&(t.type=PC.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=PC.ResizeMode.CONTAINER},i._createIndicator=function(){var t=new br;t.layer=this.node.layer;var e=t.addComponent(rm);return e.spriteFrame=this.spriteFrame,e.sizeMode=rm.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},i._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var r=t[i];if(r._uiProps.uiComp){var n=r._uiProps.uiComp;UM.set(n.color),UM.a=127.5,n.color=UM}}if(t[e]._uiProps.uiComp){var o=t[e]._uiProps.uiComp;UM.set(o.color),UM.a=255,o.color=UM}}}},i._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var i=0;if(e.length>t.length)for(i=0;i<e.length;++i)t[i]||(t[i]=this._createIndicator());else for(i=t.length-e.length;i>0;--i){var r=t[i-1];this.node.removeChild(r),t.splice(i-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},Ge(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}($i),BM.Direction=zM,bi((MM=LM).prototype,"spriteFrame",[SM,TM],Object.getOwnPropertyDescriptor(MM.prototype,"spriteFrame"),MM.prototype),bi(MM.prototype,"direction",[EM,AM],Object.getOwnPropertyDescriptor(MM.prototype,"direction"),MM.prototype),bi(MM.prototype,"cellSize",[CM,wM],Object.getOwnPropertyDescriptor(MM.prototype,"cellSize"),MM.prototype),OM=bi(MM.prototype,"spacing",[Ai,xM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PM=bi(MM.prototype,"_spriteFrame",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DM=bi(MM.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zM.HORIZONTAL}}),IM=bi(MM.prototype,"_cellSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mr(20,20)}}),RM=MM))||RM)||RM)||RM)||RM)),IO=new Cr;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(MO||(MO={})),Hr(MO),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(OO||(OO={})),Hr(OO),function(t){t.PAGE_TURNING="page-turning"}(PO||(PO={}));var BO=function(e){return t({PageView:e,PageViewComponent:e}),e}((VM=_i("cc.PageView"),HM=Ni(),GM=zi(110),WM=Ui(),XM=Di(MO),YM=Vi(),jM=Di(OO),qM=Vi(),KM=Ji(),ZM=Vi(),JM=Ji(),QM=Vi(),$M=Di(DO),tO=Vi(),eO=Vi(),iO=Di(ox),rO=Hi(),nO=Di(ox),oO=Hi(),sO=Hi(),aO=Hi(),lO=Hi(),hO=Di([fn]),uO=Hi(),cO=Di([fn]),dO=Vi(),VM(pO=HM(pO=GM(pO=WM((RO=xO=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"autoPageTurningThreshold",_O,Ti(e)),Si(e,"horizontal",gO,Ti(e)),Si(e,"vertical",mO,Ti(e)),Si(e,"cancelInnerEvents",yO,Ti(e)),Si(e,"scrollEvents",vO,Ti(e)),Si(e,"pageTurningSpeed",bO,Ti(e)),Si(e,"pageEvents",SO,Ti(e)),Si(e,"_sizeMode",TO,Ti(e)),Si(e,"_direction",EO,Ti(e)),Si(e,"_scrollThreshold",AO,Ti(e)),Si(e,"_pageTurningEventTiming",CO,Ti(e)),Si(e,"_indicator",wO,Ti(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new fi,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Cr,e._touchEndPosition=new Cr,e}He(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(zr.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(zr.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},i.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},i.getCurrentPageIndex=function(){return this._curPageIdx},i.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},i.getPages=function(){return this._pages},i.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):hn(4301))},i.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void hn(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},i.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):$e(4300,t.name)}},i.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var i=e[t];i&&this.content&&(this.content.removeChild(i),e.splice(t,1),this._updatePageView())}},i.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,i=t.length;e<i;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},i.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},i.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},i._updatePageView=function(){if(this.content){var t=this.content.getComponent(PC);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var i=this._initContentPos,r=0;r<e;++r){var n=this._pages[r].position;this.direction===OO.Horizontal?this._scrollCenterOffsetX[r]=Math.abs(i.x+n.x):this._scrollCenterOffsetY[r]=Math.abs(i.y+n.y)}this.indicator&&this.indicator._refresh()}},i._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===MO.Unified)for(var e=this._pages,i=t.contentSize,r=0,n=e.length;r<n;r++)e[r]._uiProps.uiTransformComp.setContentSize(i)},i._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},i._onTouchBegan=function(e,i){e.touch.getUILocation(IO),Cr.set(this._touchBeganPosition,IO.x,IO.y),t.prototype._onTouchBegan.call(this,e,i)},i._onTouchMoved=function(e,i){t.prototype._onTouchMoved.call(this,e,i)},i._onTouchEnded=function(e,i){e.touch.getUILocation(IO),Cr.set(this._touchEndPosition,IO.x,IO.y),t.prototype._onTouchEnded.call(this,e,i)},i._onTouchCancelled=function(e,i){e.touch.getUILocation(IO),Cr.set(this._touchEndPosition,IO.x,IO.y),t.prototype._onTouchCancelled.call(this,e,i)},i._onMouseWheel=function(){},i._syncScrollDirection=function(){this.horizontal=this.direction===OO.Horizontal,this.vertical=this.direction===OO.Vertical},i._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(PC);if(e){if(this._sizeMode===MO.Free&&this._pages.length>0){var i=this._pages[0]._uiProps.uiTransformComp,r=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===OO.Horizontal?(e.paddingLeft=(t.width-i.width)/2,e.paddingRight=(t.width-r.width)/2):this.direction===OO.Vertical&&(e.paddingTop=(t.height-i.height)/2,e.paddingBottom=(t.height-r.height)/2)}e.updateLayout()}}},i._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var i=t[e];this._pages.indexOf(i)>=0||this._pages.push(i)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},i._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,fn.emitEvents(this.pageEvents,this,PO.PAGE_TURNING),this.node.emit(PO.PAGE_TURNING,this))},i._isQuicklyScrollable=function(t){if(this.direction===OO.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===OO.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},i._moveOffsetValue=function(t){var e=new Cr;if(this._sizeMode===MO.Free)this.direction===OO.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===OO.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var i=this.view;if(!i)return e;this.direction===OO.Horizontal?e.x=t*i.width:this.direction===OO.Vertical&&(e.y=t*i.height)}return e},i._getDragDirection=function(t){return this._direction===OO.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},i._isScrollable=function(t,e,i){if(this._sizeMode===MO.Free){var r=0,n=0;if(this.direction===OO.Horizontal)return r=this._scrollCenterOffsetX[e],n=this._scrollCenterOffsetX[i],Math.abs(t.x)>=Math.abs(r-n)*this.scrollThreshold;if(this.direction===OO.Vertical)return r=this._scrollCenterOffsetY[e],n=this._scrollCenterOffsetY[i],Math.abs(t.y)>=Math.abs(r-n)*this.scrollThreshold}else{var o=this.view;if(!o)return!1;if(this.direction===OO.Horizontal)return Math.abs(t.x)>=o.width*this.scrollThreshold;if(this.direction===OO.Vertical)return Math.abs(t.y)>=o.height*this.scrollThreshold}return!1},i._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Cr;Cr.subtract(e,this._touchBeganPosition,this._touchEndPosition);var i=this._curPageIdx,r=i+this._getDragDirection(e),n=this.pageTurningSpeed*Math.abs(i-r);if(r<this._pages.length){if(this._isScrollable(e,i,r))return void this.scrollToPage(r,n);var o=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(o))return void this.scrollToPage(r,n)}this.scrollToPage(i,n)}},Ge(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(kx),xO.SizeMode=MO,xO.Direction=OO,xO.EventType=sR(PO,ax),bi((fO=RO).prototype,"sizeMode",[XM,YM],Object.getOwnPropertyDescriptor(fO.prototype,"sizeMode"),fO.prototype),bi(fO.prototype,"direction",[jM,qM],Object.getOwnPropertyDescriptor(fO.prototype,"direction"),fO.prototype),bi(fO.prototype,"scrollThreshold",[Zi,KM,ZM],Object.getOwnPropertyDescriptor(fO.prototype,"scrollThreshold"),fO.prototype),bi(fO.prototype,"pageTurningEventTiming",[Zi,JM,QM],Object.getOwnPropertyDescriptor(fO.prototype,"pageTurningEventTiming"),fO.prototype),bi(fO.prototype,"indicator",[$M,tO],Object.getOwnPropertyDescriptor(fO.prototype,"indicator"),fO.prototype),_O=bi(fO.prototype,"autoPageTurningThreshold",[Ai,eO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),bi(fO.prototype,"verticalScrollBar",[iO,Ar,rO],Object.getOwnPropertyDescriptor(fO.prototype,"verticalScrollBar"),fO.prototype),bi(fO.prototype,"horizontalScrollBar",[nO,Ar,oO],Object.getOwnPropertyDescriptor(fO.prototype,"horizontalScrollBar"),fO.prototype),gO=bi(fO.prototype,"horizontal",[Ar,Ai,sO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),mO=bi(fO.prototype,"vertical",[Ar,Ai,aO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yO=bi(fO.prototype,"cancelInnerEvents",[Ar,Ai,lO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),vO=bi(fO.prototype,"scrollEvents",[hO,Ai,Ar,uO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bO=bi(fO.prototype,"pageTurningSpeed",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),SO=bi(fO.prototype,"pageEvents",[cO,Ai,dO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TO=bi(fO.prototype,"_sizeMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MO.Unified}}),EO=bi(fO.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return OO.Horizontal}}),AO=bi(fO.prototype,"_scrollThreshold",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),CO=bi(fO.prototype,"_pageTurningEventTiming",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),wO=bi(fO.prototype,"_indicator",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pO=fO))||pO)||pO)||pO)||pO)),LO=new fi,FO=new Cr,kO=new Cr,NO=new Cr(1,1),zO=new Cr,UO=new Cr;function VO(t,e){if(!e._hadAlignOnce){e.alignMode===uM.ONCE&&(e._hadAlignOnce=!0);var i,r=e.target,n=kO,o=NO;r?gM(t,i=r,n,o):i=t.parent;var s=_M(i),a=i instanceof Rn||!i.getComponent(Dd),l=a?FO:i.getComponent(Dd).anchorPoint,h=a;t.getPosition(LO);var u=t._uiProps.uiTransformComp,c=LO.x,d=LO.y,p=u.anchorPoint,f=t.getScale();if(e.alignFlags&cM.HORIZONTAL){var _=0,g=0,m=s.width;h?(_=Vr.left.x,g=Vr.right.x):g=(_=-l.x*m)+m,_+=e.isAbsoluteLeft?e.left:e.left*m,g-=e.isAbsoluteRight?e.right:e.right*m,r&&(_+=n.x,_*=o.x,g+=n.x,g*=o.x);var y=0,v=p.x,b=f.x;if(b<0&&(v=1-v,b=-b),e.isStretchWidth)y=g-_,0!==b&&(u.width=y/b),c=_+v*y;else if(y=u.width*b,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*m,T=(.5-l.x)*s.width;r&&(S*=o.x,T+=n.x,T*=o.x),c=T+(v-.5)*y+S}else c=e.isAlignLeft?_+v*y:g+(v-1)*y;e._lastSize.width=y}if(e.alignFlags&cM.VERTICAL){var E=0,A=0,C=s.height;h?(A=Vr.bottom.y,E=Vr.top.y):E=(A=-l.y*C)+C,A+=e.isAbsoluteBottom?e.bottom:e.bottom*C,E-=e.isAbsoluteTop?e.top:e.top*C,r&&(A+=n.y,A*=o.y,E+=n.y,E*=o.y);var w=0,x=p.y,R=f.y;if(R<0&&(x=1-x,R=-R),e.isStretchHeight)w=E-A,0!==R&&(u.height=w/R),d=A+x*w;else if(w=u.height*R,e.isAlignVerticalCenter){var M=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*C,O=(.5-l.y)*s.height;r&&(M*=o.y,O+=n.y,O*=o.y),d=O+(x-.5)*w+M}else d=e.isAlignBottom?A+x*w:E+(x-1)*w;e._lastSize.height=w}t.setPosition(c,d,LO.z),fi.set(e._lastPos,c,d,LO.z)}}function HO(t){var e=t.getComponent(NM);if(e&&e.enabled){if(!ei.isValid(t,!0))return;ZO.push(e)}for(var i,r=t.children,n=qe(r);!(i=n()).done;){var o=i.value;o.active&&HO(o)}}function GO(){var t=Fr.getScene();if(t){JO.isAligning=!0,JO._nodesOrderDirty&&(ZO.length=0,HO(t),JO._nodesOrderDirty=!1);var e=null,i=JO._activeWidgetsIterator;for(i.i=0;i.i<ZO.length;++i.i)(e=ZO[i.i])._dirty&&(VO(e.node,e),e._dirty=!1);JO.isAligning=!1}}var WO,XO,YO,jO,qO,KO,ZO=[],JO=t("widgetManager",ei._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new On.MutableForwardIterator(ZO),animationState:null,init:function(){Fr.on(kr.EVENT_AFTER_SCENE_LAUNCH,GO),Fr.on(kr.EVENT_AFTER_UPDATE,GO),Pn.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);Pn.instance.on("canvas-resize",t),Dn.on("orientation-change",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=Fr.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=br.isNode(t)&&t.getComponent(NM);e&&e.enabled&&(e.alignMode===uM.ON_WINDOW_RESIZE||e.alignMode===uM.ALWAYS)&&e.setDirty();for(var i,r=t.children,n=qe(r);!(i=n()).done;){var o=i.value;this.refreshWidgetOnResized(o)}},updateOffsetsToStayPut:function(t,e){function i(t,e){return Math.abs(t-e)>1e-10?e:t}var r=t.node,n=r.parent;if(n){var o=zO;o.set(0,0);var s=UO;if(s.set(1,1),t.target&&gM(r,n=t.target,o,s),!e)return;var a=n._uiProps&&n._uiProps.uiTransformComp,l=a?a.anchorPoint:FO,h=r._uiProps.uiTransformComp,u=_M(n),c=h.anchorPoint,d=r.getPosition(),p=cM,f=r.getScale(),_=0;if(e&p.LEFT){var g=-l.x*u.width;g+=o.x,g*=s.x,_=d.x-c.x*h.width*f.x-g,t.isAbsoluteLeft||(_/=u.width),_/=s.x,t.left=i(t.left,_)}if(e&p.RIGHT){var m=(1-l.x)*u.width;m+=o.x,_=(m*=s.x)-(d.x+(1-c.x)*h.width*f.x),t.isAbsoluteRight||(_/=u.width),_/=s.x,t.right=i(t.right,_)}if(e&p.TOP){var y=(1-l.y)*u.height;y+=o.y,_=(y*=s.y)-(d.y+(1-c.y)*h.height*f.y),t.isAbsoluteTop||(_/=u.height),_/=s.y,t.top=i(t.top,_)}if(e&p.BOT){var v=-l.y*u.height;v+=o.y,v*=s.y,_=d.y-c.y*h.height*f.y-v,t.isAbsoluteBottom||(_/=u.height),_/=s.y,t.bottom=i(t.bottom,_)}}},updateAlignment:function t(e){var i=e.parent;i&&br.isNode(i)&&t(i);var r=e.getComponent(NM);r&&i&&VO(e,r)},AlignMode:uM,AlignFlags:cM});Fr.on(kr.EVENT_INIT,(function(){JO.init()}));var QO,$O,tP,eP,iP,rP,nP,oP,sP,aP,lP,hP,uP,cP,dP,pP,fP,_P,gP,mP,yP,vP=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}((WO=_i("cc.SafeArea"),XO=Ni(),YO=zi(110),jO=Ui(),qO=Gr(NM),WO(KO=XO(KO=YO(KO=Ii(KO=jO(KO=qO(KO=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.onEnable=function(){this.updateArea(),Dn.on("window-resize",this.updateArea,this),Dn.on("orientation-change",this.updateArea,this)},i.onDisable=function(){Dn.off("window-resize",this.updateArea,this),Dn.off("orientation-change",this.updateArea,this)},i.updateArea=function(){var t=this.node.getComponent(NM),e=this.node.getComponent(Dd);if(t&&e){t.updateAlignment();var i=this.node.position.clone(),r=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var n=en.getVisibleSize(),o=n.width,s=n.height,a=Ke.getSafeAreaRect();t.top=s-a.y-a.height,t.bottom=a.y,t.left=a.x,t.right=o-a.x-a.width,t.updateAlignment();var l=this.node.position.clone(),h=r.x-(l.x-i.x)/e.width,u=r.y-(l.y-i.y)/e.height;e.setAnchorPoint(h,u),JO.add(t)}},e}($i))||KO)||KO)||KO)||KO)||KO)||KO)),bP=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((QO=_i("cc.UICoordinateTracker"),$O=Ni(),tP=Ui(),eP=zi(110),iP=Di(br),rP=Vi(),nP=Di($r),oP=Vi(),sP=Vi(),aP=Vi(),lP=Di([fn]),hP=Vi(),QO(uP=$O(uP=tP(uP=eP((mP=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"syncEvents",dP,Ti(e)),Si(e,"_target",pP,Ti(e)),Si(e,"_camera",fP,Ti(e)),Si(e,"_useScale",_P,Ti(e)),Si(e,"_distance",gP,Ti(e)),e._transformPos=new fi,e._viewPos=new fi,e._canMove=!0,e._lastWPos=new fi,e._lastCameraPos=new fi,e}He(e,t);var i=e.prototype;return i.onEnable=function(){this._checkCanMove()},i.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&fi.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var i=this._distance/Math.abs(this._viewPos.z);fn.emitEvents(this.syncEvents,this._transformPos,i)}},i._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},Ge(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}($i),bi((cP=mP).prototype,"target",[iP,rP],Object.getOwnPropertyDescriptor(cP.prototype,"target"),cP.prototype),bi(cP.prototype,"camera",[nP,oP],Object.getOwnPropertyDescriptor(cP.prototype,"camera"),cP.prototype),bi(cP.prototype,"useScale",[sP],Object.getOwnPropertyDescriptor(cP.prototype,"useScale"),cP.prototype),bi(cP.prototype,"distance",[aP],Object.getOwnPropertyDescriptor(cP.prototype,"distance"),cP.prototype),dP=bi(cP.prototype,"syncEvents",[lP,Ai,hP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pP=bi(cP.prototype,"_target",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fP=bi(cP.prototype,"_camera",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_P=bi(cP.prototype,"_useScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gP=bi(cP.prototype,"_distance",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uP=cP))||uP)||uP)||uP)||uP)),SP=[zr.TOUCH_START,zr.TOUCH_END,zr.TOUCH_MOVE,zr.MOUSE_DOWN,zr.MOUSE_MOVE,zr.MOUSE_UP,zr.MOUSE_ENTER,zr.MOUSE_LEAVE,zr.MOUSE_WHEEL];function TP(t){t.propagationStopped=!0}var EP,AP,CP,wP,xP,RP,MP,OP,PP,DP,IP,BP,LP,FP=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(_i("cc.BlockInputEvents")(yP=Ni()(yP=Ui()(yP=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.onEnable=function(){for(var t=0;t<SP.length;t++)this.node.on(SP[t],TP,this)},i.onDisable=function(){for(var t=0;t<SP.length;t++)this.node.off(SP[t],TP,this)},e}($i))||yP)||yP)||yP),kP={},NP=t("SubContextView",(EP=_i("cc.SubContextView"),AP=Ni(),CP=zi(110),wP=Gr(Dd),xP=Ui(),RP=Vi(),MP=Vi(),EP(OP=AP(OP=CP(OP=wP(OP=xP((BP=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_fps",DP,Ti(e)),e._sprite=void 0,e._imageAsset=void 0,e._texture=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,Si(e,"_designResolutionSize",IP,Ti(e)),e._content=new br("content"),e._content.hideFlags|=jr.Flags.DontSave|jr.Flags.HideInHierarchy,e._sprite=null,e._imageAsset=new oi,e._openDataContext=null,e._updatedTime=performance.now(),e._texture=new si,e}He(e,t);var i=e.prototype;return i.onLoad=function(){kP.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=kP.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},i.onEnable=function(){this._registerNodeEvent()},i.onDisable=function(){this._unregisterNodeEvent()},i._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas;t.width=this._designResolutionSize.width,t.height=this._designResolutionSize.height}},i._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(rm),this._sprite||(this._sprite=this._content.addComponent(rm)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var i=new dc;i.texture=this._texture,this._sprite.spriteFrame=i}this._content.parent=this.node}},i._updateSubContextView=function(){if(this._openDataContext){var t=this.node.getComponent(Dd),e=this._content.getComponent(Dd),i=t.width/e.width,r=t.height/e.height,n=i>r?r:i;e.width*=n,e.height*=n;var o=en.getViewportRect(),s=e.getBoundingBoxToWorld(),a=en.getVisibleSize(),l=en.getDevicePixelRatio(),h=(o.width*(s.x/a.width)+o.x)/l,u=(o.height*(s.y/a.height)+o.y)/l,c=o.width*(s.width/a.width)/l,d=o.height*(s.height/a.height)/l;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:h,y:u,width:c,height:d})}},i._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}},i._registerNodeEvent=function(){this.node.on(zr.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(zr.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(zr.LAYER_CHANGED,this._updateContentLayer,this)},i._unregisterNodeEvent=function(){this.node.off(zr.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(zr.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(zr.LAYER_CHANGED,this._updateContentLayer,this)},i._updateContentLayer=function(){this._content.layer=this.node.layer},i.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},i.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},Ge(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}($i),bi((PP=BP).prototype,"designResolutionSize",[RP],Object.getOwnPropertyDescriptor(PP.prototype,"designResolutionSize"),PP.prototype),bi(PP.prototype,"fps",[MP],Object.getOwnPropertyDescriptor(PP.prototype,"fps"),PP.prototype),DP=bi(PP.prototype,"_fps",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),IP=bi(PP.prototype,"_designResolutionSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mr(640,960)}}),OP=PP))||OP)||OP)||OP)||OP)||OP));ei.SubContextView=NP;var zP,UP,VP,HP,GP,WP,XP,YP,jP,qP,KP,ZP,JP,QP,$P,tD,eD=t("UIReorderComponent",_i("cc.UIReorderComponent")(LP=function(){$e(1408,"UIReorderComponent")})||LP);ei.UIReorderComponent=eD,ei.ButtonComponent=NT,qi.setClassAlias(NT,"cc.ButtonComponent"),ei.EditBoxComponent=sC,qi.setClassAlias(sC,"cc.EditBoxComponent"),ei.LayoutComponent=PC,qi.setClassAlias(PC,"cc.LayoutComponent"),ei.ProgressBarComponent=rw,qi.setClassAlias(rw,"cc.ProgressBarComponent"),ei.ScrollViewComponent=kx,qi.setClassAlias(kx,"cc.ScrollViewComponent"),ei.ScrollBarComponent=ox,qi.setClassAlias(ox,"cc.ScrollBarComponent"),ei.SliderComponent=oR,qi.setClassAlias(oR,"cc.SliderComponent"),ei.ToggleComponent=dM,qi.setClassAlias(dM,"cc.ToggleComponent"),ei.ToggleContainerComponent=pM,qi.setClassAlias(pM,"cc.ToggleContainerComponent"),ei.WidgetComponent=NM,qi.setClassAlias(NM,"cc.WidgetComponent"),ei.PageViewComponent=BO,qi.setClassAlias(BO,"cc.PageViewComponent"),ei.PageViewIndicatorComponent=DO,qi.setClassAlias(DO,"cc.PageViewIndicatorComponent"),ei.SafeAreaComponent=vP,qi.setClassAlias(vP,"cc.SafeAreaComponent"),qi.setClassAlias(bP,"cc.UICoordinateTrackerComponent"),ei.BlockInputEventsComponent=FP,qi.setClassAlias(FP,"cc.BlockInputEventsComponent");var iD,rD,nD,oD,sD,aD,lD,hD,uD,cD,dD,pD,fD,_D,gD,mD,yD,vD,bD,SD,TD,ED,AD,CD,wD,xD,RD,MD,OD,PD,DD,ID,BD=function(e){return t({Billboard:e,BillboardComponent:e}),e}((zP=_i("cc.Billboard"),UP=Ni(),VP=Ui(),HP=Di(si),GP=Di(si),WP=Vi(),XP=Vi(),YP=Vi(),jP=Vi(),zP(qP=UP(qP=VP(qP=Ii((tD=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_texture",ZP,Ti(e)),Si(e,"_height",JP,Ti(e)),Si(e,"_width",QP,Ti(e)),Si(e,"_rotation",$P,Ti(e)),e._model=null,e._mesh=null,e._material=null,e._uniform=new ki(1,1,0,0),e}He(e,t);var i=e.prototype;return i.onLoad=function(){this.createModel()},i.onEnable=function(){this.attachToScene(),this._model.enabled=!0,this.width=this._width,this.height=this._height,this.rotation=this.rotation,this.texture=this.texture},i.onDisable=function(){this.detachFromScene()},i.attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this.detachFromScene(),this._getRenderScene().addModel(this._model))},i.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},i.createModel=function(){this._mesh=ks({primitiveMode:F.TRIANGLE_LIST,positions:[0,0,0,0,0,0,0,0,0,0,0,0],uvs:[0,0,1,0,0,1,1,1],colors:[tr.WHITE.r,tr.WHITE.g,tr.WHITE.b,tr.WHITE.a,tr.WHITE.r,tr.WHITE.g,tr.WHITE.b,tr.WHITE.a,tr.WHITE.r,tr.WHITE.g,tr.WHITE.b,tr.WHITE.a,tr.WHITE.r,tr.WHITE.g,tr.WHITE.b,tr.WHITE.a],attributes:[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RG32F),new Tt(Yt.ATTR_COLOR,d.RGBA8UI,!0)],indices:[0,1,2,1,2,3]},void 0,{calculateBounds:!1});var t=this._model=ei.director.root.createModel(Ri,this.node);t.node=t.transform=this.node,null==this._material&&(this._material=new Sr,this._material.copy(Li.get("default-billboard-material"))),t.initSubModel(0,this._mesh.renderingSubMeshes[0],this._material)},Ge(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._material&&this._material.setProperty("mainTexture",t)}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this._material&&(this._uniform.y=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._material&&(this._uniform.x=t,this._material.setProperty("cc_size_rotation",this._uniform))}},{key:"rotation",get:function(){return Math.round(100*In(this._rotation))/100},set:function(t){this._rotation=sr(t),this._material&&(this._uniform.z=this._rotation,this._material.setProperty("cc_size_rotation",this._uniform))}}]),e}($i),ZP=bi((KP=tD).prototype,"_texture",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(KP.prototype,"texture",[GP,WP],Object.getOwnPropertyDescriptor(KP.prototype,"texture"),KP.prototype),JP=bi(KP.prototype,"_height",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(KP.prototype,"height",[XP],Object.getOwnPropertyDescriptor(KP.prototype,"height"),KP.prototype),QP=bi(KP.prototype,"_width",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(KP.prototype,"width",[YP],Object.getOwnPropertyDescriptor(KP.prototype,"width"),KP.prototype),$P=bi(KP.prototype,"_rotation",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(KP.prototype,"rotation",[jP],Object.getOwnPropertyDescriptor(KP.prototype,"rotation"),KP.prototype),qP=KP))||qP)||qP)||qP)||qP)),LD=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RGBA32F),new Tt(Yt.ATTR_TEX_COORD1,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA8,!0)],FD=new fi,kD=new fi,ND=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=null,e._vertCount=0,e._indexCount=0,e._material=null,e.type=gr.LINE,e._capacity=100,e._iaInfo=new ht([new at]),e._iaInfoBuffer=e._device.createBuffer(new ot(_.INDIRECT,y.HOST|y.DEVICE,Jt,Jt)),e}He(e,t);var i=e.prototype;return i.setCapacity=function(t){this._capacity=t,this.createBuffer()},i.createBuffer=function(){this._vertSize=0;for(var t,e=qe(LD);!(t=e()).done;){var i=t.value;i.offset=this._vertSize,this._vertSize+=jt[i.format].size}this._vertAttrsFloatCount=this._vertSize/4,this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.updateMaterial=function(e){this._material=e,t.prototype.setSubModelMaterial.call(this,0,e)},i.createSubMeshData=function(){this._subMeshData&&this.destroySubMeshData(),this._vertCount=2,this._indexCount=6;var t=this._device.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);t.update(e);for(var i=new Uint16Array((this._capacity-1)*this._indexCount),r=0,n=0;n<this._capacity-1;++n){var o=2*n;i[r++]=o,i[r++]=o+1,i[r++]=o+2,i[r++]=o+3,i[r++]=o+2,i[r++]=o+1}var s=this._device.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,(this._capacity-1)*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return s.update(i),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=(this._capacity-1)*this._indexCount,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new gi([t],LD,F.TRIANGLE_LIST,s,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.addLineVertexData=function(t,e,i){if(t.length>1){var r=0;fi.subtract(FD,t[1],t[0]),this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=0,this._vdataF32[r++]=FD.x,this._vdataF32[r++]=FD.y,this._vdataF32[r++]=FD.z,this._vdataUint32[r++]=i.evaluate(0,1)._val,this._vdataF32[r++]=t[0].x,this._vdataF32[r++]=t[0].y,this._vdataF32[r++]=t[0].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(0,1),this._vdataF32[r++]=0,this._vdataF32[r++]=1,this._vdataF32[r++]=FD.x,this._vdataF32[r++]=FD.y,this._vdataF32[r++]=FD.z,this._vdataUint32[r++]=i.evaluate(0,1)._val;for(var n=1;n<t.length-1;n++){fi.subtract(FD,t[n-1],t[n]),fi.subtract(kD,t[n+1],t[n]),fi.subtract(kD,kD,FD);var o=n/t.length;this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(o,1),this._vdataF32[r++]=o,this._vdataF32[r++]=0,this._vdataF32[r++]=kD.x,this._vdataF32[r++]=kD.y,this._vdataF32[r++]=kD.z,this._vdataUint32[r++]=i.evaluate(o,1)._val,this._vdataF32[r++]=t[n].x,this._vdataF32[r++]=t[n].y,this._vdataF32[r++]=t[n].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(o,1),this._vdataF32[r++]=o,this._vdataF32[r++]=1,this._vdataF32[r++]=kD.x,this._vdataF32[r++]=kD.y,this._vdataF32[r++]=kD.z,this._vdataUint32[r++]=i.evaluate(o,1)._val}fi.subtract(FD,t[t.length-1],t[t.length-2]),this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=0,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=0,this._vdataF32[r++]=FD.x,this._vdataF32[r++]=FD.y,this._vdataF32[r++]=FD.z,this._vdataUint32[r++]=i.evaluate(1,1)._val,this._vdataF32[r++]=t[t.length-1].x,this._vdataF32[r++]=t[t.length-1].y,this._vdataF32[r++]=t[t.length-1].z,this._vdataF32[r++]=1,this._vdataF32[r++]=e.evaluate(1,1),this._vdataF32[r++]=1,this._vdataF32[r++]=1,this._vdataF32[r++]=FD.x,this._vdataF32[r++]=FD.y,this._vdataF32[r++]=FD.z,this._vdataUint32[r++]=i.evaluate(1,1)._val}this.updateIA(Math.max(0,t.length-1))},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},e}(Ri),zD=[["mode","constant","multiplier"],["mode","spline","multiplier"],["mode","splineMin","splineMax","multiplier"],["mode","constantMin","constantMax","multiplier"]],UD=Mi({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),VD=t("CurveRange",(iD=_i("cc.CurveRange"),rD=Di(UD),nD=Di(Bn),oD=Di(Bn),sD=Di(Bn),iD((yD=mD=function(){function t(){Si(this,"mode",hD,this),Si(this,"spline",uD,this),Si(this,"splineMin",cD,this),Si(this,"splineMax",dD,this),Si(this,"constant",pD,this),Si(this,"constantMin",fD,this),Si(this,"constantMax",_D,this),Si(this,"multiplier",gD,this),this._curve=new Ln(this.spline),this._curveMin=new Ln(this.splineMin),this._curveMax=new Ln(this.splineMax)}var e=t.prototype;return e.evaluate=function(t,e){switch(this.mode){default:case UD.Constant:return this.constant;case UD.Curve:return this.spline.evaluate(t)*this.multiplier;case UD.TwoCurves:return _n(this.splineMin.evaluate(t),this.splineMax.evaluate(t),e)*this.multiplier;case UD.TwoConstants:return _n(this.constantMin,this.constantMax,e)}},e.getMax=function(){switch(this.mode){default:case UD.Constant:return this.constant;case UD.Curve:return this.multiplier;case UD.TwoConstants:return this.constantMax;case UD.TwoCurves:return this.multiplier}},e._onBeforeSerialize=function(){return zD[this.mode]},Ge(t,[{key:"curve",get:function(){return this._curve},set:function(t){this._curve=t,this.spline=t._internalCurve}},{key:"curveMin",get:function(){return this._curveMin},set:function(t){this._curveMin=t,this.splineMin=t._internalCurve}},{key:"curveMax",get:function(){return this._curveMax},set:function(t){this._curveMax=t,this.splineMax=t._internalCurve}}]),t}(),mD.Mode=UD,hD=bi((lD=yD).prototype,"mode",[rD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UD.Constant}}),uD=bi(lD.prototype,"spline",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fn()}}),cD=bi(lD.prototype,"splineMin",[oD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fn()}}),dD=bi(lD.prototype,"splineMax",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fn()}}),pD=bi(lD.prototype,"constant",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fD=bi(lD.prototype,"constantMin",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_D=bi(lD.prototype,"constantMax",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gD=bi(lD.prototype,"multiplier",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),aD=lD))||aD));function HD(t,e,i){switch(t.mode){case UD.Constant:return t.constant;case UD.Curve:return t.spline.evaluate(e)*t.multiplier;case UD.TwoCurves:return 0===i?t.splineMin.evaluate(e)*t.multiplier:t.splineMax.evaluate(e)*t.multiplier;case UD.TwoConstants:return 0===i?t.constantMin:t.constantMax;default:return 0}}function GD(t){switch(t.mode){case UD.TwoConstants:case UD.TwoCurves:return 2;default:return 1}}function WD(t,e,i){var r=new oi({width:e,height:i,_data:t,_compressed:!1,format:Er.RGBA32F}),n=new si;return n.setFilters(Tr.NEAREST,Tr.NEAREST),n.setMipFilter(Tr.NONE),n.setWrapMode(kn.CLAMP_TO_EDGE,kn.CLAMP_TO_EDGE,kn.CLAMP_TO_EDGE),n.image=r,n}function XD(t,e,i,r,n){for(var o=Math.max(GD(e),GD(i),GD(r)),s=new Float32Array(t*o*4),a=[e,i,r],l=1/(t-1),h=0;h<o;h++)for(var u=0;u<3;u++)for(var c=a[u],d=0,p=0,f=0;f<t;f++){var _=HD(c,l*f,h);p=n?_:(d+=_)/(f+1),s[4*f+u]=p}return WD(s,t,o)}var YD,jD,qD,KD,ZD,JD,QD,$D,tI,eI,iI,rI,nI,oI,sI,aI,lI,hI,uI,cI,dI,pI,fI,_I,gI,mI,yI,vI,bI,SI,TI,EI,AI,CI,wI,xI,RI,MI,OI,PI,DI,II,BI,LI,FI,kI,NI,zI,UI,VI,HI,GI,WI,XI,YI,jI,qI=Mi({Blend:0,Fixed:1}),KI=(t("ColorKey",_i("cc.ColorKey")((SD=bi((bD=function(){Si(this,"color",SD,this),Si(this,"time",TD,this)}).prototype,"color",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),TD=bi(bD.prototype,"time",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vD=bD))||vD),t("AlphaKey",_i("cc.AlphaKey")((CD=bi((AD=function(){Si(this,"alpha",CD,this),Si(this,"time",wD,this)}).prototype,"alpha",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wD=bi(AD.prototype,"time",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ED=AD))||ED),t("Gradient",_i("cc.Gradient")((ID=DD=function(){function t(){Si(this,"colorKeys",MD,this),Si(this,"alphaKeys",OD,this),Si(this,"mode",PD,this),this._color=void 0,this._color=tr.WHITE.clone()}var e=t.prototype;return e.setKeys=function(t,e){this.colorKeys=t,this.alphaKeys=e},e.sortKeys=function(){this.colorKeys.length>1&&this.colorKeys.sort((function(t,e){return t.time-e.time})),this.alphaKeys.length>1&&this.alphaKeys.sort((function(t,e){return t.time-e.time}))},e.evaluate=function(t){return this.getRGB(t),this._color._set_a_unsafe(this.getAlpha(t)),this._color},e.randomColor=function(){var t=this.colorKeys[Math.trunc(Math.random()*this.colorKeys.length)],e=this.alphaKeys[Math.trunc(Math.random()*this.alphaKeys.length)];return this._color.set(t.color),this._color._set_a_unsafe(e.alpha),this._color},e.getRGB=function(t){if(!(this.colorKeys.length>1))return 1===this.colorKeys.length?(this._color.set(this.colorKeys[0].color),this._color):(this._color.set(tr.WHITE),this._color);t=Nn(t,1);for(var e=1;e<this.colorKeys.length;++e){var i=this.colorKeys[e-1].time,r=this.colorKeys[e].time;if(t>=i&&t<r){if(this.mode===qI.Fixed)return this.colorKeys[e].color;var n=(t-i)/(r-i);return tr.lerp(this._color,this.colorKeys[e-1].color,this.colorKeys[e].color,n),this._color}}var o=this.colorKeys.length-1;t<this.colorKeys[0].time?tr.lerp(this._color,tr.BLACK,this.colorKeys[0].color,t/this.colorKeys[0].time):t>this.colorKeys[o].time&&tr.lerp(this._color,this.colorKeys[o].color,tr.BLACK,(t-this.colorKeys[o].time)/(1-this.colorKeys[o].time))},e.getAlpha=function(t){if(!(this.alphaKeys.length>1))return 1===this.alphaKeys.length?this.alphaKeys[0].alpha:255;t=Nn(t,1);for(var e=1;e<this.alphaKeys.length;++e){var i=this.alphaKeys[e-1].time,r=this.alphaKeys[e].time;if(t>=i&&t<r){if(this.mode===qI.Fixed)return this.alphaKeys[e].alpha;var n=(t-i)/(r-i);return _n(this.alphaKeys[e-1].alpha,this.alphaKeys[e].alpha,n)}}var o=this.alphaKeys.length-1;return t<this.alphaKeys[0].time?_n(0,this.alphaKeys[0].alpha,t/this.alphaKeys[0].time):t>this.alphaKeys[o].time?_n(this.alphaKeys[o].alpha,0,(t-this.alphaKeys[o].time)/(1-this.alphaKeys[o].time)):void 0},t}(),DD.Mode=qI,MD=bi((RD=ID).prototype,"colorKeys",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),OD=bi(RD.prototype,"alphaKeys",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Array}}),PD=bi(RD.prototype,"mode",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qI.Blend}}),xD=RD))||xD)),ZI=xn,JI=Mi({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),QI=t("GradientRange",(YD=_i("cc.GradientRange"),jD=Di(JI),qD=Di(KI),KD=Di(KI),ZD=Di(KI),JD=Di(JI),YD((lI=aI=function(){function t(){Si(this,"color",tI,this),Si(this,"colorMin",eI,this),Si(this,"colorMax",iI,this),Si(this,"gradient",rI,this),Si(this,"gradientMin",nI,this),Si(this,"gradientMax",oI,this),Si(this,"_mode",sI,this),this._color=tr.WHITE.clone()}var e=t.prototype;return e.evaluate=function(t,e){switch(this._mode){case JI.Color:return this.color;case JI.TwoColors:return tr.lerp(this._color,this.colorMin,this.colorMax,e),this._color;case JI.RandomColor:return this.gradient.randomColor();case JI.Gradient:return this.gradient.evaluate(t);case JI.TwoGradients:return tr.lerp(this._color,this.gradientMin.evaluate(t),this.gradientMax.evaluate(t),e),this._color;default:return this.color}},e._onBeforeSerialize=function(){return ZI[this._mode]},Ge(t,[{key:"mode",get:function(){return this._mode},set:function(t){this._mode=t}}]),t}(),aI.Mode=JI,bi(($D=lI).prototype,"mode",[jD],Object.getOwnPropertyDescriptor($D.prototype,"mode"),$D.prototype),tI=bi($D.prototype,"color",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),eI=bi($D.prototype,"colorMin",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),iI=bi($D.prototype,"colorMax",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tr.WHITE.clone()}}),rI=bi($D.prototype,"gradient",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new KI}}),nI=bi($D.prototype,"gradientMin",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new KI}}),oI=bi($D.prototype,"gradientMax",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new KI}}),sI=bi($D.prototype,"_mode",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return JI.Color}}),QD=$D))||QD));function $I(t,e,i){switch(t.mode){case JI.Color:return t.color;case JI.TwoColors:return 0===i?t.colorMin:t.colorMax;case JI.RandomColor:return t.gradient.randomColor();case JI.Gradient:return t.gradient.evaluate(e);case JI.TwoGradients:return 0===i?t.gradientMin.evaluate(e):t.gradientMax.evaluate(e);default:return t.color}}var tB={parent:null,owner:null,subModelIdx:0},eB={CC_USE_WORLD_SPACE:!1},iB=function(e){return t({Line:e,LineComponent:e}),e}((hI=_i("cc.Line"),uI=Ni(),cI=Ui(),dI=Di(si),pI=Di(si),fI=Ur(),_I=Vi(),gI=Ur(),mI=Vi(),yI=Di([fi]),vI=Di([fi]),bI=Ur(),SI=Vi(),TI=Di(VD),EI=Ji(),AI=Di(VD),CI=Ji(),wI=Ur(),xI=Vi(),RI=Di(Cr),MI=Ur(),OI=Vi(),PI=Di(Cr),DI=Ur(),II=Vi(),BI=Di(QI),LI=Di(QI),FI=Ur(),kI=Vi(),hI(NI=uI(NI=cI(NI=Ii((jI=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_texture",UI,Ti(e)),e._material=null,e._materialInstance=null,Si(e,"_worldSpace",VI,Ti(e)),Si(e,"_positions",HI,Ti(e)),Si(e,"_width",GI,Ti(e)),Si(e,"_tile",WI,Ti(e)),Si(e,"_offset",XI,Ti(e)),Si(e,"_color",YI,Ti(e)),e._model=null,e._tile_offset=new ki,e}He(e,t);var i=e.prototype;return i.onLoad=function(){var t=this._model=ei.director.root.createModel(ND);t.node=t.transform=this.node,null===this._material&&(this._material=new Sr,this._material.copy(Li.get("default-trail-material")),eB.CC_USE_WORLD_SPACE=this.worldSpace,tB.parent=this._material,tB.subModelIdx=0,this._materialInstance=new qr(tB),tB.parent=null,tB.subModelIdx=0,this._materialInstance.recompileShaders(eB)),t.updateMaterial(this._materialInstance),t.setCapacity(100)},i.onEnable=function(){this._model&&(this._attachToScene(),this.texture=this._texture,this.tile=this._tile,this.offset=this._offset,this._model.addLineVertexData(this._positions,this._width,this._color))},i.onDisable=function(){this._model&&this._detachFromScene()},i._attachToScene=function(){this._model&&this.node&&this.node.scene&&(this._model.scene&&this._detachFromScene(),this._getRenderScene().addModel(this._model))},i._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},Ge(e,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._materialInstance&&this._materialInstance.setProperty("mainTexture",t)}},{key:"worldSpace",get:function(){return this._worldSpace},set:function(t){this._worldSpace=t,this._materialInstance&&(eB.CC_USE_WORLD_SPACE=this.worldSpace,this._materialInstance.recompileShaders(eB),this._model&&this._model.setSubModelMaterial(0,this._materialInstance))}},{key:"positions",get:function(){return this._positions},set:function(t){this._positions=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}},{key:"tile",get:function(){return this._tile},set:function(t){this._tile.set(t),this._materialInstance&&(this._tile_offset.x=this._tile.x,this._tile_offset.y=this._tile.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t),this._materialInstance&&(this._tile_offset.z=this._offset.x,this._tile_offset.w=this._offset.y,this._materialInstance.setProperty("mainTiling_Offset",this._tile_offset))}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this._model&&this._model.addLineVertexData(this._positions,this._width,this._color)}}]),e}($i),UI=bi((zI=jI).prototype,"_texture",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(zI.prototype,"texture",[pI,fI,_I],Object.getOwnPropertyDescriptor(zI.prototype,"texture"),zI.prototype),VI=bi(zI.prototype,"_worldSpace",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(zI.prototype,"worldSpace",[gI,mI],Object.getOwnPropertyDescriptor(zI.prototype,"worldSpace"),zI.prototype),HI=bi(zI.prototype,"_positions",[yI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bi(zI.prototype,"positions",[vI,bI,SI],Object.getOwnPropertyDescriptor(zI.prototype,"positions"),zI.prototype),GI=bi(zI.prototype,"_width",[TI,EI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),bi(zI.prototype,"width",[AI,CI,wI,xI],Object.getOwnPropertyDescriptor(zI.prototype,"width"),zI.prototype),WI=bi(zI.prototype,"_tile",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(1,1)}}),bi(zI.prototype,"tile",[RI,MI,OI],Object.getOwnPropertyDescriptor(zI.prototype,"tile"),zI.prototype),XI=bi(zI.prototype,"_offset",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cr(0,0)}}),bi(zI.prototype,"offset",[PI,DI,II],Object.getOwnPropertyDescriptor(zI.prototype,"offset"),zI.prototype),YI=bi(zI.prototype,"_color",[BI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QI}}),bi(zI.prototype,"color",[LI,FI,kI],Object.getOwnPropertyDescriptor(zI.prototype,"color"),zI.prototype),NI=zI))||NI)||NI)||NI)||NI)),rB=function(){function t(t){this.particleSystem=void 0,this.position=void 0,this.velocity=void 0,this.animatedVelocity=void 0,this.ultimateVelocity=void 0,this.angularVelocity=void 0,this.axisOfRotation=void 0,this.rotation=void 0,this.startEuler=void 0,this.startRotation=void 0,this.deltaQuat=void 0,this.deltaMat=void 0,this.localMat=void 0,this.startSize=void 0,this.size=void 0,this.startColor=void 0,this.color=void 0,this.randomSeed=void 0,this.remainingLifetime=void 0,this.loopCount=void 0,this.lastLoop=void 0,this.trailDelay=void 0,this.startLifetime=void 0,this.emitAccumulator0=void 0,this.emitAccumulator1=void 0,this.frameIndex=void 0,this.startRow=void 0,this.particleSystem=t,this.position=new fi(0,0,0),this.velocity=new fi(0,0,0),this.animatedVelocity=new fi(0,0,0),this.ultimateVelocity=new fi(0,0,0),this.angularVelocity=new fi(0,0,0),this.axisOfRotation=new fi(0,0,0),this.rotation=new fi(0,0,0),this.startEuler=new fi(0,0,0),this.startRotation=new yi,this.deltaQuat=new yi,this.deltaMat=new Wi,this.localMat=new Wi,this.startSize=new fi(0,0,0),this.size=new fi(0,0,0),this.startColor=tr.WHITE.clone(),this.color=tr.WHITE.clone(),this.randomSeed=0,this.remainingLifetime=0,this.loopCount=0,this.lastLoop=0,this.trailDelay=0,this.startLifetime=0,this.emitAccumulator0=0,this.emitAccumulator1=0,this.frameIndex=0,this.startRow=0}return t.prototype.reset=function(){this.rotation.set(0,0,0),this.startEuler.set(0,0,0),this.startRotation.set(0,0,0,1),this.deltaQuat.set(0,0,0,1),this.deltaMat.identity(),this.localMat.identity()},t}();rB.INDENTIFY_NEG_QUAT=10,rB.R2D=180/Math.PI;var nB,oB,sB,aB,lB,hB,uB,cB,dB,pB,fB,_B,gB,mB,yB,vB,bB,SB,TB,EB,AB,CB,wB,xB,RB,MB,OB,PB,DB,IB,BB,LB,FB,kB,NB="colorModule",zB="rotationModule",UB="sizeModule",VB="textureModule",HB=["sizeModule","colorModule","forceModule","velocityModule","limitModule","rotationModule","textureModule"],GB=["_colorOverLifetimeModule","_shapeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule","_trailModule"],WB=function(){function t(){this.target=null,this.needUpdate=!1,this.needAnimate=!0,this.name=void 0}var e=t.prototype;return e.bindTarget=function(t){this.target=t},e.update=function(){},t}(),XB=Mi({World:0,Local:1,Custom:2}),YB=Mi({Billboard:0,StrecthedBillboard:1,HorizontalBillboard:2,VerticalBillboard:3,Mesh:4}),jB=Mi({Box:0,Circle:1,Cone:2,Sphere:3,Hemisphere:4}),qB=Mi({Base:0,Edge:1,Shell:2,Volume:3}),KB=Mi({Random:0,Loop:1,PingPong:2}),ZB=Mi({Particles:0}),JB=Mi({Stretch:0}),QB=(nB=_i("cc.ColorOvertimeModule"),oB=Ur(),sB=Di(QI),aB=Ur(),nB((dB=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_enable",uB,Ti(e)),Si(e,"color",cB,Ti(e)),e.name=NB,e}return He(e,t),e.prototype.animate=function(t){t.color.set(t.startColor),t.color.multiply(this.color.evaluate(1-t.remainingLifetime/t.startLifetime,zn(t.randomSeed+91041)))},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(WB),uB=bi((hB=dB).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(hB.prototype,"enable",[oB],Object.getOwnPropertyDescriptor(hB.prototype,"enable"),hB.prototype),cB=bi(hB.prototype,"color",[sB,Ai,aB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QI}}),lB=hB))||lB),$B=new fi(0,0,-1);function tL(t,e,i,r){return e!==t?(t===XB.World||Wi.invert(i,i),Wi.getRotation(r,i),!0):(yi.set(r,0,0,0,1),!1)}function eL(t,e){Cr.set(t,Math.cos(e),Math.sin(e))}function iL(t){var e=Vn(-1,1),i=Vn(0,2*Math.PI),r=Math.sqrt(1-e*e),n=r*Math.cos(i),o=r*Math.sin(i);fi.set(t,n,o,e)}function rL(t,e,i){iL(t),fi.multiplyScalar(t,t,e+(i-e)*Un())}function nL(t,e,i,r){eL(t,r),t.z=0,fi.multiplyScalar(t,t,e+(i-e)*Un())}function oL(t){for(var e=0;e<t.length;e++){var i=e+Hn(0,t.length-e),r=t[i];t[i]=t[e],t[e]=r}}function sL(){var t=Vn(-1,1);return 0===t&&t++,Gn(t)}var aL,lL,hL,uL,cL,dL,pL,fL,_L,gL,mL,yL,vL,bL,SL,TL,EL,AL,CL,wL,xL,RL,ML,OL,PL,DL,IL,BL,LL,FL,kL,NL,zL,UL,VL,HL,GL,WL,XL,YL,jL,qL,KL,ZL,JL,QL,$L,tF,eF,iF,rF,nF,oF,sF,aF,lF,hF,uF,cF,dF,pF=212165,fF=new fi,_F=(pB=_i("cc.ForceOvertimeModule"),fB=Ur(),_B=Di(VD),gB=Ji(),mB=Ur(),yB=Vi(),vB=Di(VD),bB=Ji(),SB=Ur(),TB=Vi(),EB=Di(VD),AB=Ji(),CB=Ur(),wB=Vi(),xB=Di(XB),RB=Ur(),MB=Vi(),pB((kB=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_enable",DB,Ti(e)),Si(e,"x",IB,Ti(e)),Si(e,"y",BB,Ti(e)),Si(e,"z",LB,Ti(e)),Si(e,"space",FB,Ti(e)),e.randomized=!1,e.rotation=void 0,e.needTransform=void 0,e.name="forceModule",e.rotation=new yi,e.needTransform=!1,e.needUpdate=!0,e}He(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=tL(t,this.space,e,this.rotation)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=fi.set(fF,this.x.evaluate(i,zn(t.randomSeed+pF)),this.y.evaluate(i,zn(t.randomSeed+pF)),this.z.evaluate(i,zn(t.randomSeed+pF)));this.needTransform&&fi.transformQuat(r,r,this.rotation),fi.scaleAndAdd(t.velocity,t.velocity,r,e),fi.copy(t.ultimateVelocity,t.velocity)},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(WB),DB=bi((PB=kB).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(PB.prototype,"enable",[fB],Object.getOwnPropertyDescriptor(PB.prototype,"enable"),PB.prototype),IB=bi(PB.prototype,"x",[_B,Ai,gB,mB,yB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),BB=bi(PB.prototype,"y",[vB,Ai,bB,SB,TB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),LB=bi(PB.prototype,"z",[EB,Ai,AB,CB,wB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),FB=bi(PB.prototype,"space",[xB,Ai,RB,MB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.Local}}),OB=PB))||OB),gF=23541,mF=new fi,yF=new fi,vF=(aL=_i("cc.LimitVelocityOvertimeModule"),lL=Ur(),hL=Di(VD),uL=Ji(),cL=Ur(),dL=Vi(),pL=Di(VD),fL=Ji(),_L=Ur(),gL=Vi(),mL=Di(VD),yL=Ji(),vL=Ur(),bL=Vi(),SL=Di(VD),TL=Ji(),EL=Ur(),AL=Vi(),CL=Ur(),wL=Vi(),xL=Ur(),RL=Vi(),ML=Di(XB),OL=Ur(),PL=Vi(),aL((HL=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_enable",BL,Ti(e)),Si(e,"limitX",LL,Ti(e)),Si(e,"limitY",FL,Ti(e)),Si(e,"limitZ",kL,Ti(e)),Si(e,"limit",NL,Ti(e)),Si(e,"dampen",zL,Ti(e)),Si(e,"separateAxes",UL,Ti(e)),Si(e,"space",VL,Ti(e)),e.drag=null,e.multiplyDragByParticleSize=!1,e.multiplyDragByParticleVelocity=!1,e.name="limitModule",e.rotation=void 0,e.needTransform=void 0,e.rotation=new yi,e.needTransform=!1,e.needUpdate=!0,e}He(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=tL(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=mF;this.separateAxes?(fi.set(yF,this.limitX.evaluate(e,zn(t.randomSeed+gF)),this.limitY.evaluate(e,zn(t.randomSeed+gF)),this.limitZ.evaluate(e,zn(t.randomSeed+gF))),this.needTransform&&fi.transformQuat(yF,yF,this.rotation),fi.set(i,bF(t.ultimateVelocity.x,yF.x,this.dampen),bF(t.ultimateVelocity.y,yF.y,this.dampen),bF(t.ultimateVelocity.z,yF.z,this.dampen))):(fi.normalize(i,t.ultimateVelocity),fi.multiplyScalar(i,i,bF(t.ultimateVelocity.length(),this.limit.evaluate(e,zn(t.randomSeed+gF)),this.dampen))),fi.copy(t.ultimateVelocity,i)},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(WB),BL=bi((IL=HL).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(IL.prototype,"enable",[lL],Object.getOwnPropertyDescriptor(IL.prototype,"enable"),IL.prototype),LL=bi(IL.prototype,"limitX",[hL,Ai,uL,cL,dL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),FL=bi(IL.prototype,"limitY",[pL,Ai,fL,_L,gL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),kL=bi(IL.prototype,"limitZ",[mL,Ai,yL,vL,bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),NL=bi(IL.prototype,"limit",[SL,Ai,TL,EL,AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),zL=bi(IL.prototype,"dampen",[Ai,CL,wL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),UL=bi(IL.prototype,"separateAxes",[Ai,xL,RL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),VL=bi(IL.prototype,"space",[ML,Ai,OL,PL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.Local}}),DL=IL))||DL);function bF(t,e,i){var r=Math.sign(t),n=Math.abs(t);return n>e&&(n=_n(n,e,i)),n*r}var SF,TF,EF,AF,CF,wF,xF,RF,MF,OF,PF,DF,IF,BF,LF,FF,kF,NF,zF,UF,VF,HF,GF,WF,XF,YF,jF,qF,KF,ZF,JF,QF,$F,tk,ek,ik,rk,nk,ok,sk,ak,lk,hk,uk,ck,dk,pk,fk,_k,gk,mk,yk,vk,bk,Sk,Tk,Ek,Ak,Ck,wk,xk,Rk,Mk,Ok,Pk,Dk,Ik,Bk,Lk,Fk,kk,Nk,zk,Uk,Vk,Hk,Gk,Wk,Xk,Yk,jk,qk,Kk,Zk,Jk,Qk,$k,tN,eN,iN,rN,nN,oN,sN,aN,lN,hN,uN,cN,dN,pN,fN,_N,gN,mN,yN,vN,bN,SN,TN,EN,AN,CN,wN,xN,RN,MN,ON,PN,DN,IN,BN,LN,FN,kN,NN,zN,UN,VN,HN,GN,WN,XN,YN,jN,qN,KN,ZN,JN,QN,$N,tz,ez,iz,rz,nz,oz,sz,az,lz,hz,uz,cz,dz,pz,fz,_z,gz,mz,yz,vz,bz,Sz,Tz,Ez,Az,Cz,wz,xz,Rz,Mz,Oz,Pz,Dz,Iz,Bz,Lz,Fz,kz,Nz,zz,Uz,Vz,Hz=(GL=_i("cc.RotationOvertimeModule"),WL=Ur(),XL=Ur(),YL=Vi(),jL=Di(VD),qL=Ji(),KL=Ur(),ZL=Vi(),JL=Di(VD),QL=Ji(),$L=Ur(),tF=Vi(),eF=Di(VD),iF=Ji(),rF=Ur(),nF=Vi(),GL((dF=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_enable",aF,Ti(e)),Si(e,"_separateAxes",lF,Ti(e)),Si(e,"x",hF,Ti(e)),Si(e,"y",uF,Ti(e)),Si(e,"z",cF,Ti(e)),e.name=zB,e._startMat=new Wi,e._matRot=new Wi,e._quatRot=new yi,e._otherEuler=new fi,e}He(e,t);var i=e.prototype;return i._processRotation=function(t){var e=t.particleSystem.processor.getInfo().renderMode;e!==YB.Mesh&&e===YB.StrecthedBillboard&&this._quatRot.set(0,0,0,1),yi.normalize(this._quatRot,this._quatRot),this._quatRot.w<0&&(this._quatRot.x+=rB.INDENTIFY_NEG_QUAT)},i.animate=function(t,e){var i=1-t.remainingLifetime/t.startLifetime,r=zn(t.randomSeed+125292),n=t.particleSystem.processor.getInfo().renderMode;this._separateAxes&&n!==YB.VerticalBillboard&&n!==YB.HorizontalBillboard?yi.fromEuler(t.deltaQuat,this.x.evaluate(i,r)*e*rB.R2D,this.y.evaluate(i,r)*e*rB.R2D,this.z.evaluate(i,r)*e*rB.R2D):yi.fromEuler(t.deltaQuat,0,0,this.z.evaluate(i,r)*e*rB.R2D),t.deltaMat=Wi.fromQuat(t.deltaMat,t.deltaQuat),t.localMat=t.localMat.multiply(t.deltaMat),this._startMat=Wi.fromQuat(this._startMat,t.startRotation),this._matRot=this._startMat.multiply(t.localMat),Wi.getRotation(this._quatRot,this._matRot),this._processRotation(t,rB.R2D),t.rotation.set(this._quatRot.x,this._quatRot.y,this._quatRot.z)},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}},{key:"separateAxes",get:function(){return this._separateAxes},set:function(t){this._separateAxes=t}}]),e}(WB),aF=bi((sF=dF).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(sF.prototype,"enable",[WL],Object.getOwnPropertyDescriptor(sF.prototype,"enable"),sF.prototype),lF=bi(sF.prototype,"_separateAxes",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(sF.prototype,"separateAxes",[XL,YL],Object.getOwnPropertyDescriptor(sF.prototype,"separateAxes"),sF.prototype),hF=bi(sF.prototype,"x",[jL,Ai,qL,Wn,KL,ZL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),uF=bi(sF.prototype,"y",[JL,Ai,QL,Wn,$L,tF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),cF=bi(sF.prototype,"z",[eF,Ai,iF,Wn,rF,nF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),oF=sF))||oF),Gz=(SF=_i("cc.SizeOvertimeModule"),TF=Ur(),EF=Ur(),AF=Vi(),CF=Di(VD),wF=Ji(),xF=Ur(),RF=Vi(),MF=Di(VD),OF=Ji(),PF=Ur(),DF=Vi(),IF=Di(VD),BF=Ji(),LF=Ur(),FF=Vi(),kF=Di(VD),NF=Ji(),zF=Ur(),UF=Vi(),SF((KF=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_enable",GF,Ti(e)),Si(e,"separateAxes",WF,Ti(e)),Si(e,"size",XF,Ti(e)),Si(e,"x",YF,Ti(e)),Si(e,"y",jF,Ti(e)),Si(e,"z",qF,Ti(e)),e.name=UB,e}return He(e,t),e.prototype.animate=function(t){if(this.separateAxes){var e=1-t.remainingLifetime/t.startLifetime,i=zn(t.randomSeed+39825);t.size.x=t.startSize.x*this.x.evaluate(e,i),t.size.y=t.startSize.y*this.y.evaluate(e,i),t.size.z=t.startSize.z*this.z.evaluate(e,i)}else fi.multiplyScalar(t.size,t.startSize,this.size.evaluate(1-t.remainingLifetime/t.startLifetime,zn(t.randomSeed+39825)))},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(WB),GF=bi((HF=KF).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(HF.prototype,"enable",[TF],Object.getOwnPropertyDescriptor(HF.prototype,"enable"),HF.prototype),WF=bi(HF.prototype,"separateAxes",[Ai,EF,AF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),XF=bi(HF.prototype,"size",[CF,Ai,wF,xF,RF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),YF=bi(HF.prototype,"x",[MF,Ai,OF,PF,DF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),jF=bi(HF.prototype,"y",[IF,Ai,BF,LF,FF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),qF=bi(HF.prototype,"z",[kF,Ai,NF,zF,UF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),VF=HF))||VF),Wz=90794,Xz=Mi({Grid:0}),Yz=Mi({WholeSheet:0,SingleRow:1}),jz=(ZF=_i("cc.TextureAnimationModule"),JF=Oi("numTilesX"),QF=Oi("numTilesY"),$F=Ur(),tk=Di(Xz),ek=Di(Xz),ik=Ur(),rk=Vi(),nk=Ur(),ok=Vi(),sk=Ur(),ak=Vi(),lk=Di(Yz),hk=Ur(),uk=Vi(),ck=Di(VD),dk=Ji(),pk=Ur(),fk=Vi(),_k=Di(VD),gk=Ji(),mk=Ur(),yk=Vi(),vk=Ur(),bk=Vi(),Sk=Ur(),Tk=Vi(),Ek=Ur(),Ak=Vi(),ZF((Uk=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_enable",xk,Ti(e)),Si(e,"_numTilesX",Rk,Ti(e)),Si(e,"_numTilesY",Mk,Ti(e)),Si(e,"_mode",Ok,Ti(e)),Si(e,"animation",Pk,Ti(e)),Si(e,"frameOverTime",Dk,Ti(e)),Si(e,"startFrame",Ik,Ti(e)),Si(e,"cycleCount",Bk,Ti(e)),Si(e,"_flipU",Lk,Ti(e)),Si(e,"_flipV",Fk,Ti(e)),Si(e,"_uvChannelMask",kk,Ti(e)),Si(e,"randomRow",Nk,Ti(e)),Si(e,"rowIndex",zk,Ti(e)),e.name=VB,e}He(e,t);var i=e.prototype;return i.init=function(t){t.startRow=Math.floor(Math.random()*this.numTilesY)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=this.startFrame.evaluate(e,zn(t.randomSeed+Wz))/(this.numTilesX*this.numTilesY);if(this.animation===Yz.WholeSheet)t.frameIndex=Nn(this.cycleCount*(this.frameOverTime.evaluate(e,zn(t.randomSeed+Wz))+i),1);else if(this.animation===Yz.SingleRow){var r=1/this.numTilesY;if(this.randomRow){var n=Nn(this.cycleCount*(this.frameOverTime.evaluate(e,zn(t.randomSeed+Wz))+i),1),o=t.startRow*r,s=o+r;t.frameIndex=_n(o,s,n)}else{var a=this.rowIndex*r,l=a+r;t.frameIndex=_n(a,l,Nn(this.cycleCount*(this.frameOverTime.evaluate(e,zn(t.randomSeed+Wz))+i),1))}}},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&(this.target.updateMaterialParams(),this.target.enableModule(this.name,t,this)))}},{key:"mode",get:function(){return this._mode},set:function(t){t!==Xz.Grid&&console.error("particle texture animation's sprites is not supported!")}},{key:"numTilesX",get:function(){return this._numTilesX},set:function(t){this._numTilesX!==t&&(this._numTilesX=t,this.target.updateMaterialParams())}},{key:"numTilesY",get:function(){return this._numTilesY},set:function(t){this._numTilesY!==t&&(this._numTilesY=t,this.target.updateMaterialParams())}},{key:"flipU",get:function(){return this._flipU},set:function(){console.error("particle texture animation's flipU is not supported!")}},{key:"flipV",get:function(){return this._flipV},set:function(){console.error("particle texture animation's flipV is not supported!")}},{key:"uvChannelMask",get:function(){return this._uvChannelMask},set:function(){console.error("particle texture animation's uvChannelMask is not supported!")}}]),e}(WB),xk=bi((wk=Uk).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rk=bi(wk.prototype,"_numTilesX",[JF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mk=bi(wk.prototype,"_numTilesY",[QF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(wk.prototype,"enable",[$F],Object.getOwnPropertyDescriptor(wk.prototype,"enable"),wk.prototype),Ok=bi(wk.prototype,"_mode",[tk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Xz.Grid}}),bi(wk.prototype,"mode",[ek,ik,rk],Object.getOwnPropertyDescriptor(wk.prototype,"mode"),wk.prototype),bi(wk.prototype,"numTilesX",[nk,ok],Object.getOwnPropertyDescriptor(wk.prototype,"numTilesX"),wk.prototype),bi(wk.prototype,"numTilesY",[sk,ak],Object.getOwnPropertyDescriptor(wk.prototype,"numTilesY"),wk.prototype),Pk=bi(wk.prototype,"animation",[lk,Ai,hk,uk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Yz.WholeSheet}}),Dk=bi(wk.prototype,"frameOverTime",[ck,Ai,dk,pk,fk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),Ik=bi(wk.prototype,"startFrame",[_k,Ai,gk,mk,yk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),Bk=bi(wk.prototype,"cycleCount",[Ai,vk,bk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lk=bi(wk.prototype,"_flipU",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fk=bi(wk.prototype,"_flipV",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kk=bi(wk.prototype,"_uvChannelMask",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),Nk=bi(wk.prototype,"randomRow",[Ai,Sk,Tk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zk=bi(wk.prototype,"rowIndex",[Ai,Ek,Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ck=wk))||Ck),qz=197866,Kz=new fi,Zz=(Vk=_i("cc.VelocityOvertimeModule"),Hk=Ur(),Gk=Di(VD),Wk=Ji(),Xk=Ur(),Yk=Vi(),jk=Di(VD),qk=Ji(),Kk=Ur(),Zk=Vi(),Jk=Di(VD),Qk=Ji(),$k=Ur(),tN=Vi(),eN=Di(VD),iN=Ji(),rN=Ur(),nN=Vi(),oN=Di(XB),sN=Ur(),aN=Vi(),Vk((gN=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_enable",uN,Ti(e)),Si(e,"x",cN,Ti(e)),Si(e,"y",dN,Ti(e)),Si(e,"z",pN,Ti(e)),Si(e,"speedModifier",fN,Ti(e)),Si(e,"space",_N,Ti(e)),e.rotation=void 0,e.needTransform=void 0,e.name="velocityModule",e.rotation=new yi,e.speedModifier.constant=1,e.needTransform=!1,e.needUpdate=!0,e}He(e,t);var i=e.prototype;return i.update=function(t,e){this.needTransform=tL(t,this.space,e,this.rotation)},i.animate=function(t){var e=1-t.remainingLifetime/t.startLifetime,i=fi.set(Kz,this.x.evaluate(e,zn(t.randomSeed^qz)),this.y.evaluate(e,zn(156497^t.randomSeed)),this.z.evaluate(e,zn(984136^t.randomSeed)));this.needTransform&&fi.transformQuat(i,i,this.rotation),fi.add(t.animatedVelocity,t.animatedVelocity,i),fi.add(t.ultimateVelocity,t.velocity,t.animatedVelocity),fi.multiplyScalar(t.ultimateVelocity,t.ultimateVelocity,this.speedModifier.evaluate(1-t.remainingLifetime/t.startLifetime,zn(t.randomSeed+qz)))},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this.target&&this.target.enableModule(this.name,t,this))}}]),e}(WB),uN=bi((hN=gN).prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(hN.prototype,"enable",[Hk],Object.getOwnPropertyDescriptor(hN.prototype,"enable"),hN.prototype),cN=bi(hN.prototype,"x",[Gk,Ai,Wk,Xk,Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),dN=bi(hN.prototype,"y",[jk,Ai,qk,Kk,Zk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),pN=bi(hN.prototype,"z",[Jk,Ai,Qk,$k,tN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),fN=bi(hN.prototype,"speedModifier",[eN,Ai,iN,rN,nN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),_N=bi(hN.prototype,"space",[oN,Ai,sN,aN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.Local}}),lN=hN))||lN),Jz=t("Burst",(mN=_i("cc.Burst"),yN=Di(VD),vN=Ji(),mN((wN=function(){function t(){Si(this,"_time",TN,this),Si(this,"_repeatCount",EN,this),Si(this,"repeatInterval",AN,this),Si(this,"count",CN,this),this._remainingCount=void 0,this._curTime=void 0,this._remainingCount=0,this._curTime=0}var e=t.prototype;return e.update=function(t,e){if(0===this._remainingCount&&(this._remainingCount=this._repeatCount,this._curTime=this._time),this._remainingCount>0){var i=Nn(t._time-t.startDelay.evaluate(0,1),t.duration)-e;i=i>0?i:0;var r=Nn(t.time-t.startDelay.evaluate(0,1),t.duration);this._curTime>=i&&this._curTime<r&&(t.emit(this.count.evaluate(this._curTime/t.duration,1),e-(r-this._curTime)),this._curTime+=this.repeatInterval,--this._remainingCount)}},e.getMaxCount=function(t){return this.count.getMax()*Math.min(Math.ceil(t.duration/this.repeatInterval),this.repeatCount)},Ge(t,[{key:"time",get:function(){return this._time},set:function(t){this._time=t,this._curTime=t}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t,this._remainingCount=t}}]),t}(),TN=bi((SN=wN).prototype,"_time",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(SN.prototype,"time",[Pi],Object.getOwnPropertyDescriptor(SN.prototype,"time"),SN.prototype),EN=bi(SN.prototype,"_repeatCount",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bi(SN.prototype,"repeatCount",[Pi],Object.getOwnPropertyDescriptor(SN.prototype,"repeatCount"),SN.prototype),AN=bi(SN.prototype,"repeatInterval",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CN=bi(SN.prototype,"count",[yN,Ai,vN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),bN=SN))||bN)),Qz=new fi(0,0,0),$z=[],tU=new fi(.5,.5,.5),eU=(xN=_i("cc.ShapeModule"),RN=Ur(),MN=Vi(),ON=Ur(),PN=Vi(),DN=Ur(),IN=Vi(),BN=Ur(),LN=Vi(),FN=Ur(),kN=Vi(),NN=Ur(),zN=Di(jB),UN=Oi("shapeType"),VN=Ur(),HN=Di(jB),GN=Vi(),WN=Di(qB),XN=Ur(),YN=Vi(),jN=Ur(),qN=Vi(),KN=Ur(),ZN=Vi(),JN=Ur(),QN=Vi(),$N=Ur(),tz=Vi(),ez=Ur(),iz=Vi(),rz=Ur(),nz=Vi(),oz=Di(KB),sz=Ur(),az=Vi(),lz=Hi(),hz=Ur(),uz=Vi(),cz=Di(VD),dz=Hi(),pz=Ji(),fz=Ur(),_z=Vi(),gz=Ur(),mz=Vi(),yz=Ur(),vz=Vi(),xN((Vz=function(){function t(){Si(this,"_enable",Tz,this),Si(this,"_shapeType",Ez,this),Si(this,"emitFrom",Az,this),Si(this,"alignToDirection",Cz,this),Si(this,"randomDirectionAmount",wz,this),Si(this,"sphericalDirectionAmount",xz,this),Si(this,"randomPositionAmount",Rz,this),Si(this,"radius",Mz,this),Si(this,"radiusThickness",Oz,this),Si(this,"arcMode",Pz,this),Si(this,"arcSpread",Dz,this),Si(this,"arcSpeed",Iz,this),Si(this,"length",Bz,this),Si(this,"boxThickness",Lz,this),Si(this,"_position",Fz,this),Si(this,"_rotation",kz,this),Si(this,"_scale",Nz,this),Si(this,"_arc",zz,this),Si(this,"_angle",Uz,this),this.mat=void 0,this.quat=void 0,this.particleSystem=void 0,this.lastTime=void 0,this.totalAngle=void 0,this.mat=new Wi,this.quat=new yi,this.particleSystem=null,this.lastTime=0,this.totalAngle=0}var e=t.prototype;return e.onInit=function(t){this.particleSystem=t,this.constructMat(),this.lastTime=this.particleSystem._time},e.emit=function(t){switch(this.shapeType){case jB.Box:!function(t,e,i,r){switch(t){case qB.Volume:n=i,o=tU,fi.set(n,Vn(-o.x,o.x),Vn(-o.y,o.y),Vn(-o.z,o.z));break;case qB.Shell:$z.splice(0,$z.length),$z.push(Vn(-.5,.5)),$z.push(Vn(-.5,.5)),$z.push(.5*sL()),oL($z),iU($z,e),fi.set(i,$z[0],$z[1],$z[2]);break;case qB.Edge:$z.splice(0,$z.length),$z.push(Vn(-.5,.5)),$z.push(.5*sL()),$z.push(.5*sL()),oL($z),iU($z,e),fi.set(i,$z[0],$z[1],$z[2]);break;default:console.warn(t+" is not supported for box emitter.")}var n,o;fi.copy(r,$B)}(this.emitFrom,this.boxThickness,t.position,t.velocity);break;case jB.Circle:e=this.radius,i=this.radiusThickness,r=this.generateArcAngle(),n=t.position,o=t.velocity,nL(n,e*(1-i),e,r),fi.normalize(o,n);break;case jB.Cone:!function(t,e,i,r,n,o,s,a){switch(t){case qB.Base:nL(s,e*(1-i),e,r),Cr.multiplyScalar(a,s,Math.sin(n)),a.z=-Math.cos(n)*e,fi.normalize(a,a),s.z=0;break;case qB.Shell:eL(s,r),Cr.multiplyScalar(a,s,Math.sin(n)),a.z=-Math.cos(n),fi.normalize(a,a),Cr.multiplyScalar(s,s,e),s.z=0;break;case qB.Volume:nL(s,e*(1-i),e,r),Cr.multiplyScalar(a,s,Math.sin(n)),a.z=-Math.cos(n)*e,fi.normalize(a,a),s.z=0,fi.add(s,s,fi.multiplyScalar(Qz,a,o*Un()/-a.z));break;default:console.warn(t+" is not supported for cone emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,this.generateArcAngle(),this._angle,this.length,t.position,t.velocity);break;case jB.Sphere:!function(t,e,i,r,n){switch(t){case qB.Volume:rL(r,e*(1-i),e),fi.normalize(n,r);break;case qB.Shell:iL(r),fi.multiplyScalar(r,r,e),fi.normalize(n,r);break;default:console.warn(t+" is not supported for sphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;case jB.Hemisphere:!function(t,e,i,r,n){switch(t){case qB.Volume:rL(r,e*(1-i),e),r.z>0&&(r.z*=-1),fi.normalize(n,r);break;case qB.Shell:iL(r),fi.multiplyScalar(r,r,e),r.z>0&&(r.z*=-1),fi.normalize(n,r);break;default:console.warn(t+" is not supported for hemisphere emitter.")}}(this.emitFrom,this.radius,this.radiusThickness,t.position,t.velocity);break;default:console.warn(this.shapeType+" shapeType is not supported by ShapeModule.")}var e,i,r,n,o;if(this.randomPositionAmount>0&&(t.position.x+=Vn(-this.randomPositionAmount,this.randomPositionAmount),t.position.y+=Vn(-this.randomPositionAmount,this.randomPositionAmount),t.position.z+=Vn(-this.randomPositionAmount,this.randomPositionAmount)),fi.transformQuat(t.velocity,t.velocity,this.quat),fi.transformMat4(t.position,t.position,this.mat),this.sphericalDirectionAmount>0){var s=fi.normalize(Qz,t.position);fi.lerp(t.velocity,t.velocity,s,this.sphericalDirectionAmount)}this.lastTime=this.particleSystem._time},e.constructMat=function(){yi.fromEuler(this.quat,this._rotation.x,this._rotation.y,this._rotation.z),Wi.fromRTS(this.mat,this.quat,this._position,this._scale)},e.generateArcAngle=function(){if(this.arcMode===KB.Random)return Vn(0,this._arc);var t=this.totalAngle+2*Math.PI*this.arcSpeed.evaluate(this.particleSystem._time,1)*(this.particleSystem._time-this.lastTime);switch(this.totalAngle=t,0!==this.arcSpread&&(t=Math.floor(t/(this._arc*this.arcSpread))*this._arc*this.arcSpread),this.arcMode){case KB.Loop:return Nn(t,this._arc);case KB.PingPong:return Xn(t,this._arc);default:return Nn(t,this._arc)}},Ge(t,[{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.constructMat()}},{key:"rotation",get:function(){return this._rotation},set:function(t){this._rotation=t,this.constructMat()}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t,this.constructMat()}},{key:"arc",get:function(){return In(this._arc)},set:function(t){this._arc=sr(t)}},{key:"angle",get:function(){return Math.round(100*In(this._angle))/100},set:function(t){this._angle=sr(t)}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"shapeType",get:function(){return this._shapeType},set:function(t){switch(this._shapeType=t,this._shapeType){case jB.Box:this.emitFrom===qB.Base&&(this.emitFrom=qB.Volume);break;case jB.Cone:this.emitFrom===qB.Edge&&(this.emitFrom=qB.Base);break;case jB.Sphere:case jB.Hemisphere:this.emitFrom!==qB.Base&&this.emitFrom!==qB.Edge||(this.emitFrom=qB.Volume)}}}]),t}(),bi((Sz=Vz).prototype,"position",[RN,MN],Object.getOwnPropertyDescriptor(Sz.prototype,"position"),Sz.prototype),bi(Sz.prototype,"rotation",[ON,PN],Object.getOwnPropertyDescriptor(Sz.prototype,"rotation"),Sz.prototype),bi(Sz.prototype,"scale",[DN,IN],Object.getOwnPropertyDescriptor(Sz.prototype,"scale"),Sz.prototype),bi(Sz.prototype,"arc",[BN,LN],Object.getOwnPropertyDescriptor(Sz.prototype,"arc"),Sz.prototype),bi(Sz.prototype,"angle",[FN,kN],Object.getOwnPropertyDescriptor(Sz.prototype,"angle"),Sz.prototype),Tz=bi(Sz.prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(Sz.prototype,"enable",[NN],Object.getOwnPropertyDescriptor(Sz.prototype,"enable"),Sz.prototype),Ez=bi(Sz.prototype,"_shapeType",[zN,UN,VN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return jB.Cone}}),bi(Sz.prototype,"shapeType",[HN,GN],Object.getOwnPropertyDescriptor(Sz.prototype,"shapeType"),Sz.prototype),Az=bi(Sz.prototype,"emitFrom",[WN,Ai,XN,YN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qB.Volume}}),Cz=bi(Sz.prototype,"alignToDirection",[Ai,jN,qN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wz=bi(Sz.prototype,"randomDirectionAmount",[Ai,KN,ZN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xz=bi(Sz.prototype,"sphericalDirectionAmount",[Ai,JN,QN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rz=bi(Sz.prototype,"randomPositionAmount",[Ai,$N,tz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mz=bi(Sz.prototype,"radius",[Ai,ez,iz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Oz=bi(Sz.prototype,"radiusThickness",[Ai,rz,nz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Pz=bi(Sz.prototype,"arcMode",[oz,Ai,sz,az],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return KB.Random}}),Dz=bi(Sz.prototype,"arcSpread",[lz,Ai,hz,uz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iz=bi(Sz.prototype,"arcSpeed",[cz,dz,pz,Ai,fz,_z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),Bz=bi(Sz.prototype,"length",[Ai,gz,mz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Lz=bi(Sz.prototype,"boxThickness",[Ai,yz,vz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(0,0,0)}}),Fz=bi(Sz.prototype,"_position",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(0,0,0)}}),kz=bi(Sz.prototype,"_rotation",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(0,0,0)}}),Nz=bi(Sz.prototype,"_scale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(1,1,1)}}),zz=bi(Sz.prototype,"_arc",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sr(360)}}),Uz=bi(Sz.prototype,"_angle",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sr(25)}}),bz=Sz))||bz);function iU(t,e){e.x>0&&(t[0]+=.5*Vn(-e.x,e.x),t[0]=Zr(t[0],-.5,.5)),e.y>0&&(t[1]+=.5*Vn(-e.y,e.y),t[1]=Zr(t[1],-.5,.5)),e.z>0&&(t[2]+=.5*Vn(-e.z,e.z),t[2]=Zr(t[2],-.5,.5))}var rU,nU,oU,sU,aU,lU,hU,uU,cU,dU,pU,fU,_U,gU,mU,yU,vU,bU,SU,TU,EU,AU,CU,wU,xU,RU,MU,OU,PU,DU=[0,0,1,0,0,1,1,1],IU=function(t){function e(){var e;return(e=t.call(this)||this)._capacity=void 0,e._vertAttrs=void 0,e._vertSize=void 0,e._vBuffer=void 0,e._vertAttrsFloatCount=void 0,e._vdataF32=void 0,e._vdataUint32=void 0,e._iaInfo=void 0,e._iaInfoBuffer=void 0,e._subMeshData=void 0,e._mesh=void 0,e._vertCount=0,e._indexCount=0,e._startTimeOffset=0,e._lifeTimeOffset=0,e._material=null,e.type=gr.PARTICLE_BATCH,e._capacity=0,e._vertAttrs=null,e._vertSize=0,e._vBuffer=null,e._vertAttrsFloatCount=0,e._vdataF32=null,e._vdataUint32=null,e._iaInfo=new ht([new at]),e._iaInfoBuffer=e._device.createBuffer(new ot(_.INDIRECT,y.HOST|y.DEVICE,Jt,Jt)),e._subMeshData=null,e._mesh=null,e}He(e,t);var i=e.prototype;return i.setCapacity=function(t){var e=this._capacity!==t;this._capacity=t,this._subMeshData&&e&&this.rebuild()},i.setVertexAttributes=function(t,e){if(this._mesh!==t||this._vertAttrs!==e){this._mesh=t,this._vertAttrs=e,this._vertSize=0;for(var i,r=qe(this._vertAttrs);!(i=r()).done;){var n=i.value;n.offset=this._vertSize,this._vertSize+=jt[n.format].size}this._vertAttrsFloatCount=this._vertSize/4,this.rebuild()}},i.createSubMeshData=function(){this.destroySubMeshData(),this._vertCount=4,this._indexCount=6,this._mesh&&(this._vertCount=this._mesh.struct.vertexBundles[this._mesh.struct.primitives[0].vertexBundelIndices[0]].view.count,this._indexCount=this._mesh.struct.primitives[0].indexView.count);var t=this._device.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*this._capacity*this._vertCount,this._vertSize)),e=new ArrayBuffer(this._vertSize*this._capacity*this._vertCount);if(this._mesh){var i=this._vertAttrs[this._vertAttrs.findIndex((function(t){return t.name===Yt.ATTR_TEX_COORD}))].offset;this._mesh.copyAttribute(0,Yt.ATTR_TEX_COORD,e,this._vertSize,i);var r=this._vertAttrs.findIndex((function(t){return t.name===Yt.ATTR_TEX_COORD3}));if(i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,Yt.ATTR_POSITION,e,this._vertSize,i),i=this._vertAttrs[r++].offset,this._mesh.copyAttribute(0,Yt.ATTR_NORMAL,e,this._vertSize,i),i=this._vertAttrs[r++].offset,!this._mesh.copyAttribute(0,Yt.ATTR_COLOR,e,this._vertSize,i))for(var n=new Uint32Array(e),o=0;o<this._vertCount;++o)n[o*this._vertAttrsFloatCount+i/4]=tr.WHITE._val;for(var s=new Float32Array(e),a=1;a<this._capacity;a++)s.copyWithin(a*this._vertSize*this._vertCount/4,0,this._vertSize*this._vertCount/4)}t.update(e);var l=new Uint16Array(this._capacity*this._indexCount);if(this._mesh){this._mesh.copyIndices(0,l);for(var h=1;h<this._capacity;h++)for(var u=0;u<this._indexCount;u++)l[h*this._indexCount+u]=l[u]+h*this._vertCount}else for(var c=0,d=0;d<this._capacity;++d){var p=4*d;l[c++]=p,l[c++]=p+1,l[c++]=p+2,l[c++]=p+3,l[c++]=p+2,l[c++]=p+1}var f=this._device.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._capacity*this._indexCount*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));return f.update(l),this._iaInfo.drawInfos[0].vertexCount=this._capacity*this._vertCount,this._iaInfo.drawInfos[0].indexCount=this._capacity*this._indexCount,this._iaInfoBuffer||(this._iaInfoBuffer=this._device.createBuffer(new ot(_.INDIRECT,y.HOST|y.DEVICE,Jt,Jt))),this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new gi([t],this._vertAttrs,F.TRIANGLE_LIST,f,this._iaInfoBuffer),this.initSubModel(0,this._subMeshData,this._material),e},i.updateMaterial=function(t){this._material=t,this.setSubModelMaterial(0,t)},i.addParticleVertexData=function(t,e){if(this._mesh)for(var i=0;i<this._vertCount;i++){var r=(t*this._vertCount+i)*this._vertAttrsFloatCount;this._vdataF32[r++]=e[0].x,this._vdataF32[r++]=e[0].y,this._vdataF32[r++]=e[0].z,r+=2,this._vdataF32[r++]=e[1].z,this._vdataF32[r++]=e[2].x,this._vdataF32[r++]=e[2].y,this._vdataF32[r++]=e[2].z,this._vdataF32[r++]=e[3].x,this._vdataF32[r++]=e[3].y,this._vdataF32[r++]=e[3].z,this._vdataUint32[r++]=e[4]}else{var n=t*this._vertAttrsFloatCount;this._vdataF32[n++]=e[0].x,this._vdataF32[n++]=e[0].y,this._vdataF32[n++]=e[0].z,this._vdataF32[n++]=e[1].x,this._vdataF32[n++]=e[1].y,this._vdataF32[n++]=e[1].z,this._vdataF32[n++]=e[2].x,this._vdataF32[n++]=e[2].y,this._vdataF32[n++]=e[2].z,this._vdataF32[n++]=e[3].x,this._vdataF32[n++]=e[3].y,this._vdataF32[n++]=e[3].z,this._vdataUint32[n++]=e[4],e[5]&&(this._vdataF32[n++]=e[5].x,this._vdataF32[n++]=e[5].y,this._vdataF32[n++]=e[5].z)}},i.addGPUParticleVertexData=function(t,e,i){for(var r=e*this._vertAttrsFloatCount*this._vertCount,n=0;n<this._vertCount;n++){var o=r;this._vdataF32[o++]=t.position.x,this._vdataF32[o++]=t.position.y,this._vdataF32[o++]=t.position.z,this._vdataF32[o++]=i,this._vdataF32[o++]=t.startSize.x,this._vdataF32[o++]=t.startSize.y,this._vdataF32[o++]=t.startSize.z,this._vdataF32[o++]=DU[2*n],this._vdataF32[o++]=t.rotation.x,this._vdataF32[o++]=t.rotation.y,this._vdataF32[o++]=t.rotation.z,this._vdataF32[o++]=DU[2*n+1],this._vdataF32[o++]=t.startColor.r/255,this._vdataF32[o++]=t.startColor.g/255,this._vdataF32[o++]=t.startColor.b/255,this._vdataF32[o++]=t.startColor.a/255,this._vdataF32[o++]=t.velocity.x,this._vdataF32[o++]=t.velocity.y,this._vdataF32[o++]=t.velocity.z,this._vdataF32[o++]=t.startLifetime,this._vdataF32[o++]=t.randomSeed,r+=this._vertAttrsFloatCount}},i.updateGPUParticles=function(t,e,i){for(var r=this._vertAttrsFloatCount*this._vertCount,n=0,o=0,s=0,a=0;a<t;++a)n=a*r,o=this._vdataF32[n+this._startTimeOffset],this._vdataF32[n+this._lifeTimeOffset]-(e-o)<i&&(s=--t*r,this._vdataF32.copyWithin(n,s,s+r),a--);return t},i.constructAttributeIndex=function(){if(this._vertAttrs){var t=this._vertAttrs.findIndex((function(t){return"a_position_starttime"===t.name})),e=this._vertAttrs[t].offset;this._startTimeOffset=e/4+3,t=this._vertAttrs.findIndex((function(t){return"a_dir_life"===t.name})),e=this._vertAttrs[t].offset,this._lifeTimeOffset=e/4+3}},i.updateIA=function(t){this._subModels[0].inputAssembler.vertexBuffers[0].update(this._vdataF32),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=this._indexCount*t,this._iaInfoBuffer.update(this._iaInfo)},i.clear=function(){this._subModels[0].inputAssembler.indexCount=0},i.destroy=function(){t.prototype.destroy.call(this),this._vBuffer=null,this._vdataF32=null,this.destroySubMeshData(),this._iaInfoBuffer&&(this._iaInfoBuffer.destroy(),this._iaInfoBuffer=null)},i.rebuild=function(){this._vBuffer=this.createSubMeshData(),this._vdataF32=new Float32Array(this._vBuffer),this._vdataUint32=new Uint32Array(this._vBuffer)},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null,this._iaInfoBuffer=null)},e}(Ri),BU=function(){function t(t){this._particleSystem=null,this._model=null,this._renderInfo=null,this._vertAttrs=[],this._renderInfo=t}var e=t.prototype;return e.getInfo=function(){return this._renderInfo},e.onInit=function(t){this._particleSystem=t},e.onEnable=function(){if(this._particleSystem){this.attachToScene();var t=this._model;t&&(t.node=t.transform=this._particleSystem.node,t.enabled=this._particleSystem.enabledInHierarchy)}},e.onDisable=function(){this.detachFromScene()},e.onDestroy=function(){this._model&&(ei.director.root.destroyModel(this._model),this._model=null)},e.attachToScene=function(){this._model&&(this._model.scene&&this.detachFromScene(),this._particleSystem._getRenderScene().addModel(this._model))},e.detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},e.setVertexAttributes=function(){this._model&&this._model.setVertexAttributes(this._renderInfo.renderMode===YB.Mesh?this._renderInfo.mesh:null,this._vertAttrs)},e.clear=function(){this._model&&(this._model.enabled=!1)},e._initModel=function(){this._model||(this._model=ei.director.root.createModel(IU),this._model.setCapacity(this._particleSystem.capacity),this._model.visFlags=this._particleSystem.visibility)},e.updateTrailMaterial=function(){},e.getDefaultTrailMaterial=function(){return null},t}(),LU=new fi,FU=new Wi,kU=["_colorOverLifetimeModule","_sizeOvertimeModule","_velocityOvertimeModule","_forceOvertimeModule","_limitVelocityOvertimeModule","_rotationOvertimeModule","_textureAnimationModule"],NU=[0,0,1,0,0,1,1,1],zU=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD1,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD2,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA8,!0)],UU=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD1,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD2,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA8,!0),new Tt(Yt.ATTR_COLOR1,d.RGB32F)],VU=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD1,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD2,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA8,!0),new Tt(Yt.ATTR_TEX_COORD3,d.RGB32F),new Tt(Yt.ATTR_NORMAL,d.RGB32F),new Tt(Yt.ATTR_COLOR1,d.RGBA8,!0)],HU={parent:null,owner:null,subModelIdx:0},GU=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._trailDefines=void 0,i._frameTile_velLenScale=void 0,i._tmp_velLenScale=void 0,i._defaultMat=null,i._node_scale=void 0,i._attrs=void 0,i._particles=null,i._defaultTrailMat=null,i._updateList=new Map,i._animateList=new Map,i._runAnimateList=new Array,i._fillDataFunc=null,i._uScaleHandle=0,i._uLenHandle=0,i._inited=!1,i._localMat=new Wi,i._gravity=new ki,i._model=null,i._frameTile_velLenScale=new ki(1,1,0,0),i._tmp_velLenScale=i._frameTile_velLenScale.clone(),i._node_scale=new ki,i._attrs=new Array(5),i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1},i._trailDefines={CC_USE_WORLD_SPACE:!0},i}He(e,t);var r=e.prototype;return r.onInit=function(e){var r=this;t.prototype.onInit.call(this,e),this._particles=new i((function(){return new rB(r)}),16),this._setVertexAttrib(),this._setFillFunc(),this._initModuleList(),this._initModel(),this.updateMaterialParams(),this.updateTrailMaterial(),this.setVertexAttributes(),this._inited=!0},r.clear=function(){t.prototype.clear.call(this),this._particles.reset(),this._particleSystem._trailModule&&this._particleSystem._trailModule.clear(),this.updateRenderData(),this._model.enabled=!1},r.updateRenderMode=function(){this._setVertexAttrib(),this._setFillFunc(),this.updateMaterialParams(),this.setVertexAttributes()},r.getFreeParticle=function(){return this._particles.length>=this._particleSystem.capacity?null:this._particles.add()},r.getDefaultTrailMaterial=function(){return this._defaultTrailMat},r.setNewParticle=function(){},r._initModuleList=function(){var t=this;kU.forEach((function(e){var i=t._particleSystem[e];i&&i.enable&&(i.needUpdate&&(t._updateList[i.name]=i),i.needAnimate&&(t._animateList[i.name]=i))})),this._runAnimateList.length=0;for(var e=0,i=HB.length;e<i;e++){var r=this._animateList[HB[e]];r&&this._runAnimateList.push(r)}},r.enableModule=function(t,e,i){e?(i.needUpdate&&(this._updateList[i.name]=i),i.needAnimate&&(this._animateList[i.name]=i)):(delete this._animateList[t],delete this._updateList[t]),this._runAnimateList.length=0;for(var r=0,n=HB.length;r<n;r++){var o=this._animateList[HB[r]];o&&this._runAnimateList.push(o)}},r.updateParticles=function(t){var e=this,i=this._particleSystem;if(!i)return this._particles.length;switch(i.node.getWorldMatrix(FU),i.scaleSpace){case XB.Local:i.node.getScale(this._node_scale);break;case XB.World:i.node.getWorldScale(this._node_scale)}(i.getMaterialInstance(0)||this._defaultMat).passes[0].setUniform(this._uScaleHandle,this._node_scale),this._updateList.forEach((function(t){t.update(i._simulationSpace,FU)}));var r=i._trailModule,n=r&&r.enable;if(n&&r.update(),i.simulationSpace===XB.Local){var o=i.node.getRotation();Wi.fromQuat(this._localMat,o),this._localMat.transpose()}for(var s=function(o){var s=e._particles.data[o];if(s.remainingLifetime-=t,fi.set(s.animatedVelocity,0,0,0),s.remainingLifetime<0)return n&&r.removeParticle(s),e._particles.removeAt(o),--o,a=o,"continue";if(i.simulationSpace===XB.Local){var l=9.8*-i.gravityModifier.evaluate(1-s.remainingLifetime/s.startLifetime,zn(s.randomSeed))*t;e._gravity.x=0,e._gravity.y=l,e._gravity.z=0,e._gravity.w=1,e._gravity=e._gravity.transformMat4(e._localMat),s.velocity.x+=e._gravity.x,s.velocity.y+=e._gravity.y,s.velocity.z+=e._gravity.z}else s.velocity.y-=9.8*i.gravityModifier.evaluate(1-s.remainingLifetime/s.startLifetime,zn(s.randomSeed))*t;fi.copy(s.ultimateVelocity,s.velocity),e._runAnimateList.forEach((function(e){e.animate(s,t)})),fi.scaleAndAdd(s.position,s.position,s.ultimateVelocity,t),n&&r.animate(s,t),a=o},a=0;a<this._particles.length;++a)s(a);return this._model.enabled=this._particles.length>0,this._particles.length},r.updateRenderData=function(){for(var t=0,e=0;e<this._particles.length;++e){var i=this._particles.data[e],r=0,n=this._particleSystem._textureAnimationModule;n&&n.enable&&(r=i.frameIndex),t=4*e,this._fillDataFunc(i,t,r)}},r.beforeRender=function(){this._model.updateIA(this._particles.length)},r.getParticleCount=function(){return this._particles.length},r.onMaterialModified=function(t){this._inited&&(0===t?this.updateMaterialParams():this.updateTrailMaterial())},r.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e);var i=this._particleSystem._trailModule;i&&i._trailModel&&1===t&&i._trailModel.setSubModelMaterial(0,e)},r._setFillFunc=function(){this._renderInfo.renderMode===YB.Mesh?this._fillDataFunc=this._fillMeshData:this._renderInfo.renderMode===YB.StrecthedBillboard?this._fillDataFunc=this._fillStrecthedData:this._fillDataFunc=this._fillNormalData},r._fillMeshData=function(t,e,i){var r=e/4;this._attrs[0]=t.position,LU.z=i,this._attrs[1]=LU,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._model.addParticleVertexData(r,this._attrs)},r._fillStrecthedData=function(t,e,i){for(var r=0;r<4;++r)this._attrs[0]=t.position,LU.x=NU[2*r],LU.y=NU[2*r+1],LU.z=i,this._attrs[1]=LU,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._attrs[5]=t.ultimateVelocity,this._attrs[6]=null,this._model.addParticleVertexData(e++,this._attrs)},r._fillNormalData=function(t,e,i){for(var r=0;r<4;++r)this._attrs[0]=t.position,LU.x=NU[2*r],LU.y=NU[2*r+1],LU.z=i,this._attrs[1]=LU,this._attrs[2]=t.size,this._attrs[3]=t.rotation,this._attrs[4]=t.color._val,this._attrs[5]=null,this._model.addParticleVertexData(e++,this._attrs)},r._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case YB.StrecthedBillboard:this._vertAttrs=UU.slice();break;case YB.Mesh:this._vertAttrs=VU.slice();break;default:this._vertAttrs=zU.slice()}},r.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!=e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1!==i.indexOf("particle")&&-1===i.indexOf("particle-gpu")||t.setMaterial(null,0)}null==t.sharedMaterial&&null==this._defaultMat&&(HU.parent=Li.get("default-particle-material"),HU.owner=this._particleSystem,HU.subModelIdx=0,this._defaultMat=new qr(HU),HU.parent=null,HU.owner=null,HU.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;t._simulationSpace===XB.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=r.passes[0];this._uScaleHandle=n.getHandle("scale"),this._uLenHandle=n.getHandle("frameTile_velLenScale");var o=this._renderInfo.renderMode,s=this._frameTile_velLenScale;o===YB.Billboard?this._defines.CC_RENDER_MODE=0:o===YB.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,s.z=this._renderInfo.velocityScale,s.w=this._renderInfo.lengthScale):o===YB.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:o===YB.VerticalBillboard?this._defines.CC_RENDER_MODE=3:o===YB.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+o+" not support.");var a=t._textureAnimationModule;a&&a.enable?(ki.copy(this._tmp_velLenScale,s),Cr.set(this._tmp_velLenScale,a.numTilesX,a.numTilesY),n.setUniform(this._uLenHandle,this._tmp_velLenScale)):n.setUniform(this._uLenHandle,s),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},r.updateTrailMaterial=function(){if(this._particleSystem){var t=this._particleSystem,e=t._trailModule;if(e&&e.enable){t.simulationSpace===XB.World||e.space===XB.World?this._trailDefines.CC_USE_WORLD_SPACE=!0:this._trailDefines.CC_USE_WORLD_SPACE=!1;var i=t.getMaterialInstance(1);null===i&&null===this._defaultTrailMat&&(HU.parent=Li.get("default-trail-material"),HU.owner=this._particleSystem,HU.subModelIdx=1,this._defaultTrailMat=new qr(HU),HU.parent=null,HU.owner=null,HU.subModelIdx=0),(i=i||this._defaultTrailMat).recompileShaders(this._trailDefines),e.updateMaterial()}}},e}(BU),WU=new Wi,XU=new ki,YU=new yi,jU=32,qU="a_position_starttime",KU="a_size_uv",ZU="a_rotation_uv",JU="a_color",QU="a_dir_life",$U="a_rndSeed",tV=[new Tt(qU,d.RGBA32F),new Tt(KU,d.RGBA32F),new Tt(ZU,d.RGBA32F),new Tt(JU,d.RGBA32F),new Tt(QU,d.RGBA32F),new Tt($U,d.R32F)],eV=[new Tt(qU,d.RGBA32F),new Tt(KU,d.RGBA32F),new Tt(ZU,d.RGBA32F),new Tt(JU,d.RGBA32F),new Tt(QU,d.RGBA32F),new Tt($U,d.R32F),new Tt(Yt.ATTR_TEX_COORD,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD3,d.RGB32F),new Tt(Yt.ATTR_NORMAL,d.RGB32F),new Tt(Yt.ATTR_COLOR1,d.RGBA8,!0)],iV={parent:null,owner:null,subModelIdx:0},rV=function(t){function e(e){var i;return(i=t.call(this,e)||this)._defines=void 0,i._frameTile_velLenScale=void 0,i._unifrom_velLenScale=void 0,i._tmp_velLenScale=void 0,i._node_scale=void 0,i._vertAttrs=[],i._defaultMat=null,i._particleNum=0,i._tempParticle=null,i._colorTexture=null,i._forceTexture=null,i._velocityTexture=null,i._rotationTexture=null,i._sizeTexture=null,i._animTexture=null,i._uTimeHandle=0,i._uRotHandle=0,i._inited=!1,i._frameTile_velLenScale=new ki(1,1,0,0),i._unifrom_velLenScale=i._frameTile_velLenScale.clone(),i._tmp_velLenScale=i._frameTile_velLenScale.clone(),i._node_scale=new ki,i._defines={CC_USE_WORLD_SPACE:!0,CC_USE_BILLBOARD:!0,CC_USE_STRETCHED_BILLBOARD:!1,CC_USE_HORIZONTAL_BILLBOARD:!1,CC_USE_VERTICAL_BILLBOARD:!1,COLOR_OVER_TIME_MODULE_ENABLE:!1},i._tempParticle=new rB(null),i._particleNum=0,i}He(e,t);var i=e.prototype;return i.onInit=function(e){t.prototype.onInit.call(this,e),this._setVertexAttrib(),this._initModel(),this.updateMaterialParams(),this.setVertexAttributes(),this._inited=!0},i.updateRenderMode=function(){this._setVertexAttrib(),this.updateMaterialParams(),this.setVertexAttributes()},i.setVertexAttributes=function(){t.prototype.setVertexAttributes.call(this),this._model.constructAttributeIndex()},i.clear=function(){t.prototype.clear.call(this),this._particleNum=0,this.updateRenderData()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this._forceTexture&&this._forceTexture.destroy(),this._velocityTexture&&this._velocityTexture.destroy(),this._colorTexture&&this._colorTexture.destroy(),this._sizeTexture&&this._sizeTexture.destroy(),this._rotationTexture&&this._rotationTexture.destroy(),this._animTexture&&this._animTexture.destroy()},i.enableModule=function(){var t=this._particleSystem.getMaterialInstance(0)||this._defaultMat;t&&(this.initShaderUniform(t),t.recompileShaders(this._defines),this._model&&this._model.setSubModelMaterial(0,t))},i.getFreeParticle=function(){return this._particleNum>=this._particleSystem._capacity?null:this._tempParticle},i.setNewParticle=function(t){this._model.addGPUParticleVertexData(t,this._particleNum,this._particleSystem._time),this._particleNum++},i.updateParticles=function(t){return this._particleNum=this._model.updateGPUParticles(this._particleNum,this._particleSystem._time,t),this.updateShaderUniform(t),this._model.enabled=this._particleNum>0,this._particleNum},i.updateRenderData=function(){},i.beforeRender=function(){this._model.updateIA(this._particleNum)},i.updateShaderUniform=function(t){var e=this._particleSystem.getMaterialInstance(0)||this._defaultMat;if(e){var i=e.passes[0];XU.x=this._particleSystem._time,XU.y=t,i.setUniform(this._uTimeHandle,XU),this._particleSystem.node.getWorldRotation(YU),i.setUniform(this._uRotHandle,YU)}},i.initShaderUniform=function(t){var e=t.passes[0];this._uTimeHandle=e.getHandle("u_timeDelta"),this._uRotHandle=e.getHandle("u_worldRot"),e.setUniform(e.getHandle("scale"),this._node_scale),e.setUniform(e.getHandle("frameTile_velLenScale"),this._unifrom_velLenScale),XU.x=jU,XU.y=.03125,e.setUniform(e.getHandle("u_sampleInfo"),XU);var i=!1,r=this._particleSystem._forceOvertimeModule;if(i=r&&r.enable,this._defines.FORCE_OVER_TIME_MODULE_ENABLE=i,i){this._forceTexture&&this._forceTexture.destroy(),this._forceTexture=XD(jU,r.x,r.y,r.z);var n=e.getHandle("force_over_time_tex0"),o=sn.getBindingFromHandle(n);e.bindSampler(o,this._forceTexture.getGFXSampler()),e.bindTexture(o,this._forceTexture.getGFXTexture());var s=e.getHandle("u_force_space");e.setUniform(s,r.space);var a=e.getHandle("u_force_mode");e.setUniform(a,this._forceTexture.height)}var l=this._particleSystem._velocityOvertimeModule;if(i=l&&l.enable,this._defines.VELOCITY_OVER_TIME_MODULE_ENABLE=i,i){this._velocityTexture&&this._velocityTexture.destroy(),this._velocityTexture=function(t,e,i,r,n){for(var o=Math.max(GD(e),GD(i),GD(r),GD(n)),s=new Float32Array(128*o),a=[e,i,r,n],l=0;l<o;l++)for(var h=0;h<4;h++)for(var u=a[h],c=0,d=0,p=0;p<32;p++){var f=HD(u,.03225806451612903*p,l);d=(c+=f)/(p+1),s[4*p+h]=d}return WD(s,32,o)}(0,l.x,l.y,l.z,l.speedModifier);var h=e.getHandle("velocity_over_time_tex0"),u=sn.getBindingFromHandle(h);e.bindSampler(u,this._velocityTexture.getGFXSampler()),e.bindTexture(u,this._velocityTexture.getGFXTexture());var c=e.getHandle("u_velocity_space");e.setUniform(c,l.space);var d=e.getHandle("u_velocity_mode");e.setUniform(d,this._velocityTexture.height)}var p=this._particleSystem._colorOverLifetimeModule;if(i=p&&p.enable,this._defines.COLOR_OVER_TIME_MODULE_ENABLE=i,i){this._colorTexture&&this._colorTexture.destroy(),this._colorTexture=function(t,e){for(var i=function(t){switch(t.mode){case JI.TwoColors:case JI.TwoGradients:return 2;default:return 1}}(e),r=new Uint8Array(t*i*4),n=1/(t-1),o=0,s=0;s<i;s++)for(var a=0;a<t;a++){var l=$I(e,n*a,s);r[o]=l.r,r[o+1]=l.g,r[o+2]=l.b,r[o+3]=l.a,o+=4}var h=new si;return h.create(t,i,Er.RGBA8888),h.setFilters(Tr.LINEAR,Tr.LINEAR),h.setWrapMode(kn.CLAMP_TO_EDGE,kn.CLAMP_TO_EDGE),h.uploadData(r),h}(jU,p.color);var f=e.getHandle("color_over_time_tex0"),_=sn.getBindingFromHandle(f);e.bindSampler(_,this._colorTexture.getGFXSampler()),e.bindTexture(_,this._colorTexture.getGFXTexture());var g=e.getHandle("u_color_mode");e.setUniform(g,this._colorTexture.height)}var m=this._particleSystem._rotationOvertimeModule;if(i=m&&m.enable,this._defines.ROTATION_OVER_TIME_MODULE_ENABLE=i,i){this._rotationTexture&&this._rotationTexture.destroy(),m.separateAxes?this._rotationTexture=XD(jU,m.x,m.y,m.z):this._rotationTexture=function(t,e){for(var i=GD(e),r=new Float32Array(128*i),n=0,o=0;o<i;o++)for(var s=0;s<32;s++){var a=HD(e,.03225806451612903*s,o);r[n+2]=a,n+=4}return WD(r,32,i)}(0,m.z);var y=e.getHandle("rotation_over_time_tex0"),v=sn.getBindingFromHandle(y);e.bindSampler(v,this._rotationTexture.getGFXSampler()),e.bindTexture(v,this._rotationTexture.getGFXTexture());var b=e.getHandle("u_rotation_mode");e.setUniform(b,this._rotationTexture.height)}var S=this._particleSystem._sizeOvertimeModule;if(i=S&&S.enable,this._defines.SIZE_OVER_TIME_MODULE_ENABLE=i,i){this._sizeTexture&&this._sizeTexture.destroy(),S.separateAxes?this._sizeTexture=XD(jU,S.x,S.y,S.z,!0):this._sizeTexture=function(t,e){for(var i=GD(e),r=new Float32Array(128*i),n=0,o=0,s=0;s<i;s++){0;for(var a=0;a<32;a++){var l=HD(e,.03225806451612903*a,s);n=l,r[o]=n,r[o+1]=n,r[o+2]=n,o+=4}}return WD(r,32,i)}(0,S.size);var T=e.getHandle("size_over_time_tex0"),E=sn.getBindingFromHandle(T);e.bindSampler(E,this._sizeTexture.getGFXSampler()),e.bindTexture(E,this._sizeTexture.getGFXTexture());var A=e.getHandle("u_size_mode");e.setUniform(A,this._sizeTexture.height)}var C=this._particleSystem._textureAnimationModule;if(i=C&&C.enable,this._defines.TEXTURE_ANIMATION_MODULE_ENABLE=i,i){this._animTexture&&this._animTexture.destroy(),this._animTexture=function(t,e,i){for(var r=Math.max(GD(e),GD(i)),n=new Float32Array(128*r),o=[e,i],s=0;s<r;s++)for(var a=0;a<2;a++)for(var l=o[a],h=0,u=0,c=0;c<32;c++){var d=HD(l,.03225806451612903*c,s);u=(h+=d)/(c+1),n[4*c+a]=u}return WD(n,32,r)}(0,C.startFrame,C.frameOverTime);var w=e.getHandle("texture_animation_tex0"),x=sn.getBindingFromHandle(w);e.bindSampler(x,this._animTexture.getGFXSampler()),e.bindTexture(x,this._animTexture.getGFXTexture());var R=e.getHandle("u_anim_info");XU.x=this._animTexture.height,XU.y=C.numTilesX*C.numTilesY,XU.z=C.cycleCount,e.setUniform(R,XU)}},i.getParticleCount=function(){return this._particleNum},i.onMaterialModified=function(){this._inited&&this.updateMaterialParams()},i.onRebuildPSO=function(t,e){this._model&&0===t&&this._model.setSubModelMaterial(0,e)},i._setVertexAttrib=function(){switch(this._renderInfo.renderMode){case YB.StrecthedBillboard:this._vertAttrs=tV.slice();break;case YB.Mesh:this._vertAttrs=eV.slice();break;default:this._vertAttrs=tV.slice()}},i.updateMaterialParams=function(){if(this._particleSystem){var t=this._particleSystem,e=t.sharedMaterial;if(null!==e){var i=e._effectAsset._name;this._renderInfo.mainTexture=e.getProperty("mainTexture",0),-1===i.indexOf("particle-gpu")&&(this._renderInfo.mainTexture=e.getProperty("mainTexture",0),this._particleSystem.setMaterial(null,0))}null==t.sharedMaterial&&null==this._defaultMat&&(iV.parent=Li.get("default-particle-gpu-material"),iV.owner=t,iV.subModelIdx=0,this._defaultMat=new qr(iV),iV.parent=null,iV.owner=null,iV.subModelIdx=0,null!==this._renderInfo.mainTexture&&this._defaultMat.setProperty("mainTexture",this._renderInfo.mainTexture));var r=t.getMaterialInstance(0)||this._defaultMat;switch(t.node.getWorldMatrix(WU),t.scaleSpace){case XB.Local:t.node.getScale(this._node_scale);break;case XB.World:t.node.getWorldScale(this._node_scale)}t._simulationSpace===XB.World?this._defines.CC_USE_WORLD_SPACE=!0:this._defines.CC_USE_WORLD_SPACE=!1;var n=this._renderInfo.renderMode;n===YB.Billboard?this._defines.CC_RENDER_MODE=0:n===YB.StrecthedBillboard?(this._defines.CC_RENDER_MODE=1,this._frameTile_velLenScale.z=this._renderInfo.velocityScale,this._frameTile_velLenScale.w=this._renderInfo.lengthScale):n===YB.HorizontalBillboard?this._defines.CC_RENDER_MODE=2:n===YB.VerticalBillboard?this._defines.CC_RENDER_MODE=3:n===YB.Mesh?this._defines.CC_RENDER_MODE=4:console.warn("particle system renderMode "+n+" not support.");var o=t._textureAnimationModule;o&&o.enable?(Cr.set(this._frameTile_velLenScale,o.numTilesX,o.numTilesY),ki.copy(this._unifrom_velLenScale,this._frameTile_velLenScale)):(this._tmp_velLenScale.z=this._frameTile_velLenScale.z,this._tmp_velLenScale.w=this._frameTile_velLenScale.w,ki.copy(this._unifrom_velLenScale,this._tmp_velLenScale)),this.initShaderUniform(r),r.recompileShaders(this._defines),this._model&&this._model.updateMaterial(r)}},e}(BU);function nV(){var t=Fr.root.device;return!!(t.capabilities.maxVertexTextureUnits>=8&&t.hasFeature(c.TEXTURE_FLOAT))||(ei.warn("Maybe the device has restrictions on vertex textures or does not support float textures."),!1)}var oV,sV,aV,lV,hV,uV,cV,dV,pV,fV,_V,gV,mV,yV,vV,bV,SV,TV,EV,AV,CV,wV,xV,RV,MV,OV,PV,DV,IV,BV,LV,FV,kV,NV,zV,UV,VV,HV,GV,WV,XV,YV,jV,qV,KV,ZV,JV,QV,$V,tH,eH,iH,rH,nH,oH,sH,aH,lH,hH,uH,cH,dH,pH,fH,_H,gH,mH,yH,vH,bH,SH,TH,EH,AH,CH,wH,xH,RH,MH,OH,PH,DH,IH,BH,LH,FH,kH,NH,zH,UH,VH,HH,GH,WH,XH,YH,jH,qH,KH,ZH,JH,QH,$H,tG,eG,iG,rG,nG,oG,sG,aG,lG,hG,uG,cG,dG,pG,fG,_G,gG,mG,yG,vG,bG,SG,TG,EG,AG,CG,wG,xG,RG,MG,OG,PG,DG,IG,BG,LG,FG,kG,NG,zG,UG,VG,HG,GG,WG,XG,YG,jG,qG,KG,ZG,JG,QG,$G,tW,eW,iW,rW,nW,oW,sW,aW,lW,hW,uW,cW,dW,pW,fW,_W,gW,mW,yW,vW,bW,SW,TW,EW,AW,CW,wW,xW,RW,MW,OW,PW,DW,IW,BW,LW,FW,kW,NW,zW,UW,VW,HW,GW,WW,XW,YW,jW,qW,KW,ZW,JW,QW,$W,tX,eX,iX,rX,nX,oX,sX,aX,lX=(rU=_i("cc.ParticleSystemRenderer"),nU=Di(YB),oU=Ur(),sU=Vi(),aU=Ur(),lU=Vi(),hU=Ur(),uU=Vi(),cU=Di(YB),dU=Di(Ms),pU=Ur(),fU=Vi(),_U=Di(Sr),gU=Ur(),mU=Vi(),yU=Di(Sr),vU=Ur(),bU=Vi(),SU=Ur(),TU=Vi(),rU((PU=function(){function t(){Si(this,"_renderMode",CU,this),Si(this,"_velocityScale",wU,this),Si(this,"_lengthScale",xU,this),Si(this,"_mesh",RU,this),Si(this,"_mainTexture",MU,this),Si(this,"_useGPU",OU,this),this._particleSystem=null}var e=t.prototype;return e.create=function(t){null===this._particleSystem?this._particleSystem=t:this._particleSystem!==t&&We(6033)},e.onInit=function(t){if(this.create(t),this._particleSystem.processor)We(6034);else{var e=this._useGPU&&nV();this._particleSystem.processor=e?new rV(this):new GU(this),this._particleSystem.processor.onInit(t)}},e._switchProcessor=function(){this._particleSystem&&(this._particleSystem.processor&&(this._particleSystem.processor.detachFromScene(),this._particleSystem.processor.clear(),this._particleSystem.processor=null),this._particleSystem.processor=this._useGPU?new rV(this):new GU(this),this._particleSystem.processor.onInit(this._particleSystem),this._particleSystem.processor.onEnable(),this._particleSystem.bindModule())},Ge(t,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode!==t&&(this._renderMode=t,this._particleSystem&&this._particleSystem.processor.updateRenderMode())}},{key:"velocityScale",get:function(){return this._velocityScale},set:function(t){this._velocityScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"lengthScale",get:function(){return this._lengthScale},set:function(t){this._lengthScale=t,this._particleSystem&&this._particleSystem.processor.updateMaterialParams()}},{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh=t,this._particleSystem&&this._particleSystem.processor.setVertexAttributes()}},{key:"particleMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(0):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,0)}},{key:"trailMaterial",get:function(){return this._particleSystem?this._particleSystem.getMaterial(1):null},set:function(t){this._particleSystem&&this._particleSystem.setMaterial(t,1)}},{key:"mainTexture",get:function(){return this._mainTexture},set:function(t){this._mainTexture=t}},{key:"useGPU",get:function(){return this._useGPU},set:function(t){this._useGPU!==t&&(nV()?this._useGPU=t:this._useGPU=!1,this._switchProcessor())}}]),t}(),bi((AU=PU).prototype,"renderMode",[nU,oU,sU],Object.getOwnPropertyDescriptor(AU.prototype,"renderMode"),AU.prototype),bi(AU.prototype,"velocityScale",[aU,lU],Object.getOwnPropertyDescriptor(AU.prototype,"velocityScale"),AU.prototype),bi(AU.prototype,"lengthScale",[hU,uU],Object.getOwnPropertyDescriptor(AU.prototype,"lengthScale"),AU.prototype),CU=bi(AU.prototype,"_renderMode",[cU,Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return YB.Billboard}}),wU=bi(AU.prototype,"_velocityScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xU=bi(AU.prototype,"_lengthScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),RU=bi(AU.prototype,"_mesh",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(AU.prototype,"mesh",[dU,pU,fU],Object.getOwnPropertyDescriptor(AU.prototype,"mesh"),AU.prototype),bi(AU.prototype,"particleMaterial",[_U,gU,mU],Object.getOwnPropertyDescriptor(AU.prototype,"particleMaterial"),AU.prototype),bi(AU.prototype,"trailMaterial",[yU,vU,bU],Object.getOwnPropertyDescriptor(AU.prototype,"trailMaterial"),AU.prototype),MU=bi(AU.prototype,"_mainTexture",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OU=bi(AU.prototype,"_useGPU",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(AU.prototype,"useGPU",[SU,TU],Object.getOwnPropertyDescriptor(AU.prototype,"useGPU"),AU.prototype),EU=AU))||EU),hX=Math.cos(sr(100)),uX={position:new fi,velocity:new fi},cX=new yi,dX=new Wi,pX=new fi,fX=new fi,_X=new tr,gX=function(){function t(t){for(this.start=void 0,this.end=void 0,this.trailElements=void 0,this.start=-1,this.end=-1,this.trailElements=[];t--;)this.trailElements.push({position:new fi,lifetime:0,width:0,velocity:new fi,direction:0,color:new tr})}var e=t.prototype;return e.getElement=function(t){return-1===this.start?null:(t<0&&(t=(t+this.trailElements.length)%this.trailElements.length),t>=this.trailElements.length&&(t%=this.trailElements.length),this.trailElements[t])},e.addElement=function(){if(0===this.trailElements.length)return null;if(-1===this.start)return this.start=0,this.end=1,this.trailElements[0];this.start===this.end&&(this.trailElements.splice(this.end,0,{position:new fi,lifetime:0,width:0,velocity:new fi,direction:0,color:new tr}),this.start++,this.start%=this.trailElements.length);var t=this.end++;return this.end%=this.trailElements.length,this.trailElements[t]},e.iterateElement=function(t,e,i,r){for(var n=this.start>=this.end?this.end+this.trailElements.length:this.end,o=this.start;o<n;o++)e(t,this.trailElements[o%this.trailElements.length],i,r)&&(this.start++,this.start%=this.trailElements.length);this.start===n&&(this.start=-1,this.end=-1)},e.count=function(){return this.start<this.end?this.end-this.start:this.trailElements.length+this.end-this.start},e.clear=function(){this.start=-1,this.end=-1},t}(),mX=(oV=_i("cc.TrailModule"),sV=Ur(),aV=Di(ZB),lV=Ur(),hV=Vi(),uV=Di(VD),cV=Ji(),dV=Ur(),pV=Vi(),fV=Ur(),_V=Vi(),gV=Di(XB),mV=Ur(),yV=Vi(),vV=Di(JB),bV=Ur(),SV=Vi(),TV=Ur(),EV=Vi(),AV=Di(VD),CV=Ji(),wV=Ur(),xV=Vi(),RV=Ur(),MV=Vi(),OV=Di(QI),PV=Ur(),DV=Vi(),IV=Di(QI),BV=Ur(),LV=Vi(),FV=Di(XB),oV((QV=function(){function t(){Si(this,"_enable",zV,this),Si(this,"mode",UV,this),Si(this,"lifeTime",VV,this),Si(this,"_minParticleDistance",HV,this),Si(this,"existWithParticles",GV,this),Si(this,"textureMode",WV,this),Si(this,"widthFromParticle",XV,this),Si(this,"widthRatio",YV,this),Si(this,"colorFromParticle",jV,this),Si(this,"colorOverTrail",qV,this),Si(this,"colorOvertime",KV,this),Si(this,"_space",ZV,this),Si(this,"_particleSystem",JV,this),this._minSquaredDistance=0,this._vertSize=void 0,this._trailNum=0,this._trailLifetime=0,this.vbOffset=0,this.ibOffset=0,this._trailSegments=null,this._particleTrail=void 0,this._trailModel=null,this._iaInfo=void 0,this._iaInfoBuffer=null,this._subMeshData=null,this._vertAttrs=void 0,this._vbF32=null,this._vbUint32=null,this._iBuffer=null,this._needTransform=!1,this._material=null,this._iaInfo=new ht([new at]),this._vertAttrs=[new Tt(Yt.ATTR_POSITION,d.RGB32F),new Tt(Yt.ATTR_TEX_COORD,d.RGBA32F),new Tt(Yt.ATTR_TEX_COORD1,d.RGB32F),new Tt(Yt.ATTR_COLOR,d.RGBA8,!0)],this._vertSize=0;for(var t,e=qe(this._vertAttrs);!(t=e()).done;){var i=t.value;this._vertSize+=jt[i.format].size}this._particleTrail=new Map}var i=t.prototype;return i.onInit=function(t){this._particleSystem=t,this.minParticleDistance=this._minParticleDistance;for(var i=0,r=t.startLifetime.getMax(),n=t.rateOverTime.getMax(),o=t.duration,s=0,a=t.bursts.length;s<a;s++)i+=t.bursts[s].getMaxCount(t)*Math.ceil(r/o);this._trailNum=Math.ceil(r*this.lifeTime.getMax()*60*(n*o+i)),this._trailSegments=new e((function(){return new gX(10)}),Math.ceil(n*o)),this._enable&&(this.enable=this._enable)},i.onEnable=function(){this._attachToScene()},i.onDisable=function(){this._particleTrail.clear(),this._detachFromScene()},i._attachToScene=function(){this._trailModel&&(this._trailModel.scene&&this._detachFromScene(),this._particleSystem._getRenderScene().addModel(this._trailModel))},i._detachFromScene=function(){this._trailModel&&this._trailModel.scene&&this._trailModel.scene.removeModel(this._trailModel)},i.destroy=function(){this.destroySubMeshData(),this._trailModel&&(Fr.root.destroyModel(this._trailModel),this._trailModel=null),this._trailSegments&&(this._trailSegments.destroy((function(t){t.trailElements.length=0})),this._trailSegments=null)},i.play=function(){this._trailModel&&this._enable&&(this._trailModel.enabled=!0)},i.clear=function(){if(this.enable){for(var t=this._particleTrail.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this._particleTrail.clear(),this.updateRenderData(),this._trailModel&&(this._trailModel.enabled=!1)}},i.updateMaterial=function(){this._particleSystem&&(this._material=this._particleSystem.getMaterialInstance(1)||this._particleSystem.processor._defaultTrailMat,this._trailModel&&this._trailModel.setSubModelMaterial(0,this._material))},i.update=function(){this._trailLifetime=this.lifeTime.evaluate(this._particleSystem._time,1),this.space===XB.World&&this._particleSystem._simulationSpace===XB.Local?(this._needTransform=!0,this._particleSystem.node.getWorldMatrix(dX),this._particleSystem.node.getWorldRotation(cX)):this._needTransform=!1},i.animate=function(t,e){if(this._trailSegments)if(t.loopCount>t.lastLoop)t.trailDelay>1?(t.lastLoop=t.loopCount,t.trailDelay=0):t.trailDelay++;else{var i=this._particleTrail.get(t);if(!i)return i=this._trailSegments.alloc(),void this._particleTrail.set(t,i);var r=i.getElement(i.end-1);if(this._needTransform?fi.transformMat4(pX,t.position,dX):fi.copy(pX,t.position),!(r&&(i.iterateElement(this,this._updateTrailElement,t,e),fi.squaredDistance(r.position,pX)<this._minSquaredDistance))&&(r=i.addElement())){fi.copy(r.position,pX),r.lifetime=0,this.widthFromParticle?r.width=t.size.x*this.widthRatio.evaluate(0,1):r.width=this.widthRatio.evaluate(0,1);var n=i.count();if(2===n){var o=i.getElement(i.end-2);fi.subtract(o.velocity,r.position,o.position)}else if(n>2){var s=i.getElement(i.end-2),a=i.getElement(i.end-3);fi.subtract(pX,a.position,s.position),fi.subtract(fX,r.position,s.position),fi.subtract(s.velocity,fX,pX),fi.equals(fi.ZERO,s.velocity)&&fi.copy(s.velocity,pX),fi.normalize(s.velocity,s.velocity),this._checkDirectionReverse(s,a)}this.colorFromParticle?r.color.set(t.color):r.color.set(this.colorOvertime.evaluate(0,1))}}},i.removeParticle=function(t){var e=this._particleTrail.get(t);e&&this._trailSegments&&(e.clear(),this._trailSegments.free(e),this._particleTrail.delete(t))},i.updateRenderData=function(){this.vbOffset=0,this.ibOffset=0;for(var t,e=qe(this._particleTrail.keys());!(t=e()).done;){var i=t.value,r=this._particleTrail.get(i);if(-1!==r.start){var n=4*this.vbOffset/this._vertSize,o=r.start>=r.end?r.end+r.trailElements.length:r.end,s=o-r.start,a=1/s,l=r.trailElements[r.start];this._fillVertexBuffer(l,this.colorOverTrail.evaluate(1,1),n,1,0,4);for(var h=r.start+1;h<o;h++){var u=r.trailElements[h%r.trailElements.length],c=h-r.start;this._fillVertexBuffer(u,this.colorOverTrail.evaluate(1-c/s,1),n,1-c*a,c,5)}this._needTransform?fi.transformMat4(uX.position,i.position,dX):fi.copy(uX.position,i.position);var d=this._trailModel;if(d&&d.node.invalidateChildren(Bi.POSITION),1===s||2===s){var p=r.getElement(r.end-1);fi.subtract(p.velocity,uX.position,p.position),this._vbF32[this.vbOffset-this._vertSize/4-4]=p.velocity.x,this._vbF32[this.vbOffset-this._vertSize/4-3]=p.velocity.y,this._vbF32[this.vbOffset-this._vertSize/4-2]=p.velocity.z,this._vbF32[this.vbOffset-4]=p.velocity.x,this._vbF32[this.vbOffset-3]=p.velocity.y,this._vbF32[this.vbOffset-2]=p.velocity.z,fi.subtract(uX.velocity,uX.position,p.position),this._checkDirectionReverse(uX,p)}else if(s>2){var f=r.getElement(r.end-1),_=r.getElement(r.end-2);fi.subtract(pX,_.position,f.position),fi.subtract(fX,uX.position,f.position),fi.normalize(pX,pX),fi.normalize(fX,fX),fi.subtract(f.velocity,fX,pX),fi.normalize(f.velocity,f.velocity),this._checkDirectionReverse(f,_),this.vbOffset-=this._vertSize/4*2,this.ibOffset-=6,this._fillVertexBuffer(f,this.colorOverTrail.evaluate(a,1),n,a,s-1,5),fi.subtract(uX.velocity,uX.position,f.position),fi.normalize(uX.velocity,uX.velocity),this._checkDirectionReverse(uX,f)}this.widthFromParticle?uX.width=i.size.x*this.widthRatio.evaluate(0,1):uX.width=this.widthRatio.evaluate(0,1),uX.color=i.color,fi.equals(uX.velocity,fi.ZERO)?this.ibOffset-=3:this._fillVertexBuffer(uX,this.colorOverTrail.evaluate(0,1),n,0,s,1)}}this._trailModel.enabled=this.ibOffset>0},i.updateIA=function(t){var e=this._trailModel&&this._trailModel.subModels;if(e&&e.length>0){var i=e[0];i.inputAssembler.vertexBuffers[0].update(this._vbF32),i.inputAssembler.indexBuffer.update(this._iBuffer),this._iaInfo.drawInfos[0].firstIndex=0,this._iaInfo.drawInfos[0].indexCount=t,this._iaInfoBuffer.update(this._iaInfo)}},i.beforeRender=function(){this.updateIA(this.ibOffset)},i._createModel=function(){this._trailModel||(this._trailModel=ei.director.root.createModel(Ri))},i.rebuild=function(){var t=Fr.root.device,e=t.createBuffer(new ot(_.VERTEX|_.TRANSFER_DST,y.HOST|y.DEVICE,this._vertSize*(this._trailNum+1)*2,this._vertSize)),i=new ArrayBuffer(this._vertSize*(this._trailNum+1)*2);this._vbF32=new Float32Array(i),this._vbUint32=new Uint32Array(i),e.update(i);var r=t.createBuffer(new ot(_.INDEX|_.TRANSFER_DST,y.HOST|y.DEVICE,6*this._trailNum*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT));this._iBuffer=new Uint16Array(6*this._trailNum),r.update(this._iBuffer),this._iaInfoBuffer=t.createBuffer(new ot(_.INDIRECT,y.HOST|y.DEVICE,Jt,Jt)),this._iaInfo.drawInfos[0].vertexCount=2*(this._trailNum+1),this._iaInfo.drawInfos[0].indexCount=6*this._trailNum,this._iaInfoBuffer.update(this._iaInfo),this._subMeshData=new gi([e],this._vertAttrs,F.TRIANGLE_LIST,r,this._iaInfoBuffer);var n=this._trailModel;n&&(n.node=n.transform=this._particleSystem.node,n.visFlags=this._particleSystem.visibility,n.initSubModel(0,this._subMeshData,this._material),n.enabled=!0)},i._updateTrailElement=function(t,e,i,r){return e.lifetime+=r,t.colorFromParticle?(e.color.set(i.color),e.color.multiply(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1))):e.color.set(t.colorOvertime.evaluate(1-i.remainingLifetime/i.startLifetime,1)),t.widthFromParticle?e.width=i.size.x*t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1):e.width=t.widthRatio.evaluate(e.lifetime/t._trailLifetime,1),e.lifetime>t._trailLifetime},i._fillVertexBuffer=function(t,e,i,r,n,o){this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=0,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,_X.set(t.color),_X.multiply(e),this._vbUint32[this.vbOffset++]=_X._val,this._vbF32[this.vbOffset++]=t.position.x,this._vbF32[this.vbOffset++]=t.position.y,this._vbF32[this.vbOffset++]=t.position.z,this._vbF32[this.vbOffset++]=1-t.direction,this._vbF32[this.vbOffset++]=t.width,this._vbF32[this.vbOffset++]=r,this._vbF32[this.vbOffset++]=1,this._vbF32[this.vbOffset++]=t.velocity.x,this._vbF32[this.vbOffset++]=t.velocity.y,this._vbF32[this.vbOffset++]=t.velocity.z,this._vbUint32[this.vbOffset++]=_X._val,1&o&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n-1,this._iBuffer[this.ibOffset++]=i+2*n+1),4&o&&(this._iBuffer[this.ibOffset++]=i+2*n,this._iBuffer[this.ibOffset++]=i+2*n+1,this._iBuffer[this.ibOffset++]=i+2*n+2)},i._checkDirectionReverse=function(t,e){fi.dot(t.velocity,e.velocity)<hX?t.direction=1-e.direction:t.direction=e.direction},i.destroySubMeshData=function(){this._subMeshData&&(this._subMeshData.destroy(),this._subMeshData=null)},Ge(t,[{key:"enable",get:function(){return this._enable},set:function(t){t===this._enable&&this._trailModel||(t&&!this._enable&&(this._enable=t,this._particleSystem.processor&&this._particleSystem.processor.updateTrailMaterial()),t&&!this._trailModel&&(this._createModel(),this.rebuild()),this._enable=t,this._trailModel&&(this._trailModel.enabled=t),t?this.onEnable():this.onDisable())}},{key:"minParticleDistance",get:function(){return this._minParticleDistance},set:function(t){this._minParticleDistance=t,this._minSquaredDistance=t*t}},{key:"space",get:function(){return this._space},set:function(t){this._space=t;var e=this._particleSystem;e&&e.processor&&e.processor.updateTrailMaterial()}}]),t}(),bi((NV=QV).prototype,"enable",[sV],Object.getOwnPropertyDescriptor(NV.prototype,"enable"),NV.prototype),zV=bi(NV.prototype,"_enable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),UV=bi(NV.prototype,"mode",[aV,Ai,lV,hV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ZB.Particles}}),VV=bi(NV.prototype,"lifeTime",[uV,Ai,cV,dV,pV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),HV=bi(NV.prototype,"_minParticleDistance",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),bi(NV.prototype,"minParticleDistance",[fV,_V],Object.getOwnPropertyDescriptor(NV.prototype,"minParticleDistance"),NV.prototype),bi(NV.prototype,"space",[gV,mV,yV],Object.getOwnPropertyDescriptor(NV.prototype,"space"),NV.prototype),GV=bi(NV.prototype,"existWithParticles",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),WV=bi(NV.prototype,"textureMode",[vV,Ai,bV,SV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return JB.Stretch}}),XV=bi(NV.prototype,"widthFromParticle",[Ai,TV,EV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YV=bi(NV.prototype,"widthRatio",[AV,Ai,CV,wV,xV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),jV=bi(NV.prototype,"colorFromParticle",[Ai,RV,MV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qV=bi(NV.prototype,"colorOverTrail",[OV,Ai,PV,DV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QI}}),KV=bi(NV.prototype,"colorOvertime",[IV,Ai,BV,LV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QI}}),ZV=bi(NV.prototype,"_space",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.World}}),JV=bi(NV.prototype,"_particleSystem",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kV=NV))||kV),yX=new Wi,vX=new yi,bX=Object.getOwnPropertyDescriptor(Gi.prototype,"sharedMaterials"),SX=function(e){return t({ParticleSystem:e,ParticleSystemComponent:e}),e}(($V=_i("cc.ParticleSystem"),tH=Ni(),eH=Ui(),iH=zi(99),rH=Ur(),nH=Vi(),oH=Di(QI),sH=Ur(),aH=Vi(),lH=Di(XB),hH=Ur(),uH=Vi(),cH=Ur(),dH=Vi(),pH=Oi("startSize"),fH=Ji(),_H=Di(VD),gH=Ur(),mH=Vi(),yH=Di(VD),vH=Ji(),bH=Ur(),SH=Vi(),TH=Di(VD),EH=Ji(),AH=Ur(),CH=Vi(),wH=Di(VD),xH=Ji(),RH=Ur(),MH=Vi(),OH=Ur(),PH=Vi(),DH=Di(VD),IH=Ji(),BH=Ur(),LH=Vi(),FH=Di(VD),kH=Ji(),NH=Ur(),zH=Vi(),UH=Di(VD),VH=Oi("startRotation"),HH=Ji(),GH=Ur(),WH=Vi(),XH=Di(VD),YH=Ji(),jH=Ur(),qH=Vi(),KH=Di(VD),ZH=Ji(),JH=Ur(),QH=Vi(),$H=Ur(),tG=Vi(),eG=Ur(),iG=Vi(),rG=Ur(),nG=Vi(),oG=Di(XB),sG=Ur(),aG=Vi(),lG=Ur(),hG=Vi(),uG=Ur(),cG=Vi(),dG=Di(VD),pG=Ji(),fG=Ur(),_G=Vi(),gG=Di(VD),mG=Ji(),yG=Ur(),vG=Vi(),bG=Di(VD),SG=Ji(),TG=Ur(),EG=Vi(),AG=Di([Jz]),CG=Ur(),wG=Vi(),xG=Hi(),RG=Di(Sr),MG=Wr(),OG=Di(QB),PG=Di(QB),DG=Ur(),IG=Vi(),BG=Di(eU),LG=Di(eU),FG=Ur(),kG=Vi(),NG=Di(Gz),zG=Di(Gz),UG=Ur(),VG=Vi(),HG=Di(Zz),GG=Di(Zz),WG=Ur(),XG=Vi(),YG=Di(_F),jG=Di(_F),qG=Ur(),KG=Vi(),ZG=Di(vF),JG=Di(vF),QG=Ur(),$G=Vi(),tW=Di(Hz),eW=Di(Hz),iW=Ur(),rW=Vi(),nW=Di(jz),oW=Di(jz),sW=Ur(),aW=Vi(),lW=Di(mX),hW=Di(mX),uW=Ur(),cW=Vi(),dW=Di(lX),pW=Ur(),fW=Vi(),_W=Ur(),gW=Vi(),$V(mW=tH(mW=eH(mW=iH(mW=Ii((tX=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"startColor",vW,Ti(e)),Si(e,"scaleSpace",bW,Ti(e)),Si(e,"startSize3D",SW,Ti(e)),Si(e,"startSizeX",TW,Ti(e)),Si(e,"startSizeY",EW,Ti(e)),Si(e,"startSizeZ",AW,Ti(e)),Si(e,"startSpeed",CW,Ti(e)),Si(e,"startRotation3D",wW,Ti(e)),Si(e,"startRotationX",xW,Ti(e)),Si(e,"startRotationY",RW,Ti(e)),Si(e,"startRotationZ",MW,Ti(e)),Si(e,"startDelay",OW,Ti(e)),Si(e,"startLifetime",PW,Ti(e)),Si(e,"duration",DW,Ti(e)),Si(e,"loop",IW,Ti(e)),Si(e,"simulationSpeed",BW,Ti(e)),Si(e,"playOnAwake",LW,Ti(e)),Si(e,"gravityModifier",FW,Ti(e)),Si(e,"rateOverTime",kW,Ti(e)),Si(e,"rateOverDistance",NW,Ti(e)),Si(e,"bursts",zW,Ti(e)),Si(e,"_colorOverLifetimeModule",UW,Ti(e)),Si(e,"_shapeModule",VW,Ti(e)),Si(e,"_sizeOvertimeModule",HW,Ti(e)),Si(e,"_velocityOvertimeModule",GW,Ti(e)),Si(e,"_forceOvertimeModule",WW,Ti(e)),Si(e,"_limitVelocityOvertimeModule",XW,Ti(e)),Si(e,"_rotationOvertimeModule",YW,Ti(e)),Si(e,"_textureAnimationModule",jW,Ti(e)),Si(e,"_trailModule",qW,Ti(e)),Si(e,"renderer",KW,Ti(e)),Si(e,"enableCulling",ZW,Ti(e)),e._isPlaying=void 0,e._isPaused=void 0,e._isStopped=void 0,e._isEmitting=void 0,e._needRefresh=void 0,e._time=void 0,e._emitRateTimeCounter=void 0,e._emitRateDistanceCounter=void 0,e._oldWPos=void 0,e._curWPos=void 0,e._customData1=void 0,e._customData2=void 0,e._subEmitters=void 0,Si(e,"_prewarm",JW,Ti(e)),Si(e,"_capacity",QW,Ti(e)),Si(e,"_simulationSpace",$W,Ti(e)),e.processor=null,e.rateOverTime.constant=10,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e._isPlaying=!1,e._isPaused=!1,e._isStopped=!0,e._isEmitting=!1,e._needRefresh=!0,e._time=0,e._emitRateTimeCounter=0,e._emitRateDistanceCounter=0,e._oldWPos=new fi,e._curWPos=new fi,e._customData1=new Cr,e._customData2=new Cr,e._subEmitters=[],e}He(e,t);var i=e.prototype;return i.onFocusInEditor=function(){this.renderer.create(this)},i.onLoad=function(){this.renderer.onInit(this),this._shapeModule&&this._shapeModule.onInit(this),this._trailModule&&this._trailModule.onInit(this),this.bindModule(),this._resetPosition()},i._onMaterialModified=function(t,e){null!==this.processor&&this.processor.onMaterialModified(t,e)},i._onRebuildPSO=function(t,e){this.processor.onRebuildPSO(t,e)},i._collectModels=function(){return this._models.length=0,this._models.push(this.processor._model),this._trailModule&&this._trailModule.enable&&this._trailModule._trailModel&&this._models.push(this._trailModule._trailModel),this._models},i._attachToScene=function(){this.processor.attachToScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._attachToScene()},i._detachFromScene=function(){this.processor.detachFromScene(),this._trailModule&&this._trailModule.enable&&this._trailModule._detachFromScene()},i.bindModule=function(){this._colorOverLifetimeModule&&this._colorOverLifetimeModule.bindTarget(this.processor),this._sizeOvertimeModule&&this._sizeOvertimeModule.bindTarget(this.processor),this._rotationOvertimeModule&&this._rotationOvertimeModule.bindTarget(this.processor),this._forceOvertimeModule&&this._forceOvertimeModule.bindTarget(this.processor),this._limitVelocityOvertimeModule&&this._limitVelocityOvertimeModule.bindTarget(this.processor),this._velocityOvertimeModule&&this._velocityOvertimeModule.bindTarget(this.processor),this._textureAnimationModule&&this._textureAnimationModule.bindTarget(this.processor)},i.play=function(){this._isPaused&&(this._isPaused=!1),this._isStopped&&(this._isStopped=!1),this._isPlaying=!0,this._isEmitting=!0,this._resetPosition(),this._prewarm&&this._prewarmSystem(),this._trailModule&&this._trailModule.play()},i.pause=function(){this._isStopped?console.warn("pause(): particle system is already stopped."):(this._isPlaying&&(this._isPlaying=!1),this._isPaused=!0)},i.stop=function(){(this._isPlaying||this._isPaused)&&this.clear(),this._isPlaying&&(this._isPlaying=!1),this._isPaused&&(this._isPaused=!1),this._time=0,this._emitRateTimeCounter=0,this._emitRateDistanceCounter=0,this._isStopped=!0,this._needRefresh=!0},i.clear=function(){this.enabledInHierarchy&&(this.processor.clear(),this._trailModule&&this._trailModule.clear())},i.getParticleCount=function(){return this.processor.getParticleCount()},i.setCustomData1=function(t,e){Cr.set(this._customData1,t,e)},i.setCustomData2=function(t,e){Cr.set(this._customData2,t,e)},i.onDestroy=function(){ei.director.off(ei.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDestroy(),this._trailModule&&this._trailModule.destroy()},i.onEnable=function(){ei.director.on(ei.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.playOnAwake&&this.play(),this.processor.onEnable(),this._trailModule&&this._trailModule.onEnable()},i.onDisable=function(){ei.director.off(ei.Director.EVENT_BEFORE_COMMIT,this.beforeRender,this),this.processor.onDisable(),this._trailModule&&this._trailModule.onDisable()},i.update=function(t){var e=t*this.simulationSpeed;this._isPlaying&&(this._time+=e,this._emit(e),0!==this.processor.updateParticles(e)||this._isEmitting||this.stop()),this.processor.updateRenderData(),this._trailModule&&this._trailModule.enable&&this._trailModule.updateRenderData()},i.beforeRender=function(){this._isPlaying&&(this.processor.beforeRender(),this._trailModule&&this._trailModule.enable&&this._trailModule.beforeRender())},i._onVisibilityChange=function(t){this.processor._model&&(this.processor._model.visFlags=t)},i._processRotation=function(t){var e=this.processor.getInfo().renderMode;e!==YB.Mesh&&(e===YB.StrecthedBillboard?t.startEuler.set(0,0,0):e!==YB.Billboard&&t.startEuler.set(0,0,t.startEuler.z)),yi.fromEuler(t.startRotation,t.startEuler.x*rB.R2D,t.startEuler.y*rB.R2D,t.startEuler.z*rB.R2D),t.startRotation=yi.normalize(t.startRotation,t.startRotation),t.startRotation.w<0&&(t.startRotation.x+=rB.INDENTIFY_NEG_QUAT)},i.emit=function(t,e){var i=this._time%this.duration/this.duration;this._needRefresh&&(this.node.invalidateChildren(Bi.POSITION),this._needRefresh=!1),this._simulationSpace===XB.World&&(this.node.getWorldMatrix(yX),this.node.getWorldRotation(vX));for(var r=0;r<t;++r){var n=this.processor.getFreeParticle();if(null===n)return;n.particleSystem=this,n.reset();var o=zn(Hn(0,Yn));this._shapeModule&&this._shapeModule.enable?this._shapeModule.emit(n):(fi.set(n.position,0,0,0),fi.copy(n.velocity,$B)),this._textureAnimationModule&&this._textureAnimationModule.enable&&this._textureAnimationModule.init(n);var s=this.startSpeed.evaluate(i,o);fi.multiplyScalar(n.velocity,n.velocity,s),this._simulationSpace===XB.World&&(fi.transformMat4(n.position,n.position,yX),fi.transformQuat(n.velocity,n.velocity,vX)),fi.copy(n.ultimateVelocity,n.velocity),this.startRotation3D?n.startEuler.set(this.startRotationX.evaluate(i,o),this.startRotationY.evaluate(i,o),this.startRotationZ.evaluate(i,o)):n.startEuler.set(0,0,this.startRotationZ.evaluate(i,o)),this._processRotation(n),fi.set(n.rotation,n.startRotation.x,n.startRotation.y,n.startRotation.z),this.startSize3D?fi.set(n.startSize,this.startSizeX.evaluate(i,o),this.startSizeY.evaluate(i,o),this.startSizeZ.evaluate(i,o)):(fi.set(n.startSize,this.startSizeX.evaluate(i,o),1,1),n.startSize.y=n.startSize.x),fi.copy(n.size,n.startSize),n.startColor.set(this.startColor.evaluate(i,o)),n.color.set(n.startColor),n.startLifetime=this.startLifetime.evaluate(i,o)+e,n.remainingLifetime=n.startLifetime,n.randomSeed=Hn(0,233280),n.loopCount++,this.processor.setNewParticle(n)}},i._prewarmSystem=function(){this.startDelay.mode=UD.Constant,this.startDelay.constant=0;for(var t=this.duration/1,e=0;e<t;++e)this._time+=1,this._emit(1),this.processor.updateParticles(1)},i._emit=function(t){var e=this.startDelay.evaluate(0,1);if(this._time>e){if(this._time>this.duration+e&&!this.loop)return void(this._isEmitting=!1);if(this._emitRateTimeCounter+=this.rateOverTime.evaluate(this._time/this.duration,1)*t,this._emitRateTimeCounter>1&&this._isEmitting){var i=Math.floor(this._emitRateTimeCounter);this._emitRateTimeCounter-=i,this.emit(i,t)}this.node.getWorldPosition(this._curWPos);var r=fi.distance(this._curWPos,this._oldWPos);if(fi.copy(this._oldWPos,this._curWPos),this._emitRateDistanceCounter+=r*this.rateOverDistance.evaluate(this._time/this.duration,1),this._emitRateDistanceCounter>1&&this._isEmitting){var n=Math.floor(this._emitRateDistanceCounter);this._emitRateDistanceCounter-=n,this.emit(n,t)}for(var o,s=qe(this.bursts);!(o=s()).done;)o.value.update(this,t)}},i._resetPosition=function(){this.node.getWorldPosition(this._oldWPos),fi.copy(this._curWPos,this._oldWPos)},i.addSubEmitter=function(t){this._subEmitters.push(t)},i.removeSubEmitter=function(t){this._subEmitters.splice(this._subEmitters.indexOf(t),1)},i.addBurst=function(t){this.bursts.push(t)},i.removeBurst=function(t){this.bursts.splice(this.bursts.indexOf(t),1)},i._onBeforeSerialize=function(t){var e=this;return this.enableCulling?t.filter((function(t){return!GB.includes(t)||e[t]&&e[t].enable})):t},Ge(e,[{key:"capacity",get:function(){return this._capacity},set:function(t){this._capacity=Math.floor(t),this.processor&&this.processor._model&&this.processor._model.setCapacity(this._capacity)}},{key:"prewarm",get:function(){return this._prewarm},set:function(t){!0===t&&this.loop,this._prewarm=t}},{key:"simulationSpace",get:function(){return this._simulationSpace},set:function(t){t!==this._simulationSpace&&(this._simulationSpace=t,this.processor&&(this.processor.updateMaterialParams(),this.processor.updateTrailMaterial()))}},{key:"sharedMaterials",get:function(){return bX.get.call(this)},set:function(t){bX.set.call(this,t)}},{key:"colorOverLifetimeModule",get:function(){return this._colorOverLifetimeModule},set:function(t){t&&(this._colorOverLifetimeModule=t)}},{key:"shapeModule",get:function(){return this._shapeModule},set:function(t){t&&(this._shapeModule=t)}},{key:"sizeOvertimeModule",get:function(){return this._sizeOvertimeModule},set:function(t){t&&(this._sizeOvertimeModule=t)}},{key:"velocityOvertimeModule",get:function(){return this._velocityOvertimeModule},set:function(t){t&&(this._velocityOvertimeModule=t)}},{key:"forceOvertimeModule",get:function(){return this._forceOvertimeModule},set:function(t){t&&(this._forceOvertimeModule=t)}},{key:"limitVelocityOvertimeModule",get:function(){return this._limitVelocityOvertimeModule},set:function(t){t&&(this._limitVelocityOvertimeModule=t)}},{key:"rotationOvertimeModule",get:function(){return this._rotationOvertimeModule},set:function(t){t&&(this._rotationOvertimeModule=t)}},{key:"textureAnimationModule",get:function(){return this._textureAnimationModule},set:function(t){t&&(this._textureAnimationModule=t)}},{key:"trailModule",get:function(){return this._trailModule},set:function(t){t&&(this._trailModule=t)}},{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isStopped",get:function(){return this._isStopped}},{key:"isEmitting",get:function(){return this._isEmitting}},{key:"time",get:function(){return this._time}}]),e}(Gi),bi((yW=tX).prototype,"capacity",[rH,nH],Object.getOwnPropertyDescriptor(yW.prototype,"capacity"),yW.prototype),vW=bi(yW.prototype,"startColor",[oH,Ai,sH,aH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new QI}}),bW=bi(yW.prototype,"scaleSpace",[lH,Ai,hH,uH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.Local}}),SW=bi(yW.prototype,"startSize3D",[Ai,cH,dH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),TW=bi(yW.prototype,"startSizeX",[pH,fH,_H,gH,mH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),EW=bi(yW.prototype,"startSizeY",[yH,Ai,vH,bH,SH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),AW=bi(yW.prototype,"startSizeZ",[TH,Ai,EH,AH,CH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),CW=bi(yW.prototype,"startSpeed",[wH,Ai,xH,RH,MH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),wW=bi(yW.prototype,"startRotation3D",[Ai,OH,PH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xW=bi(yW.prototype,"startRotationX",[DH,Ai,IH,Wn,BH,LH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),RW=bi(yW.prototype,"startRotationY",[FH,Ai,kH,Wn,NH,zH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),MW=bi(yW.prototype,"startRotationZ",[UH,VH,HH,Wn,GH,WH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),OW=bi(yW.prototype,"startDelay",[XH,Ai,YH,jH,qH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),PW=bi(yW.prototype,"startLifetime",[KH,Ai,ZH,JH,QH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),DW=bi(yW.prototype,"duration",[Ai,$H,tG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),IW=bi(yW.prototype,"loop",[Ai,eG,iG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bi(yW.prototype,"prewarm",[rG,nG],Object.getOwnPropertyDescriptor(yW.prototype,"prewarm"),yW.prototype),bi(yW.prototype,"simulationSpace",[oG,Ai,sG,aG],Object.getOwnPropertyDescriptor(yW.prototype,"simulationSpace"),yW.prototype),BW=bi(yW.prototype,"simulationSpeed",[Ai,lG,hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),LW=bi(yW.prototype,"playOnAwake",[Ai,uG,cG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),FW=bi(yW.prototype,"gravityModifier",[dG,Ai,pG,fG,_G],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),kW=bi(yW.prototype,"rateOverTime",[gG,Ai,mG,yG,vG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),NW=bi(yW.prototype,"rateOverDistance",[bG,Ai,SG,TG,EG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new VD}}),zW=bi(yW.prototype,"bursts",[AG,Ai,CG,wG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bi(yW.prototype,"sharedMaterials",[Ar,xG,RG,Ai,MG],Object.getOwnPropertyDescriptor(yW.prototype,"sharedMaterials"),yW.prototype),UW=bi(yW.prototype,"_colorOverLifetimeModule",[OG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"colorOverLifetimeModule",[PG,DG,IG],Object.getOwnPropertyDescriptor(yW.prototype,"colorOverLifetimeModule"),yW.prototype),VW=bi(yW.prototype,"_shapeModule",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"shapeModule",[LG,FG,kG],Object.getOwnPropertyDescriptor(yW.prototype,"shapeModule"),yW.prototype),HW=bi(yW.prototype,"_sizeOvertimeModule",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"sizeOvertimeModule",[zG,UG,VG],Object.getOwnPropertyDescriptor(yW.prototype,"sizeOvertimeModule"),yW.prototype),GW=bi(yW.prototype,"_velocityOvertimeModule",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"velocityOvertimeModule",[GG,WG,XG],Object.getOwnPropertyDescriptor(yW.prototype,"velocityOvertimeModule"),yW.prototype),WW=bi(yW.prototype,"_forceOvertimeModule",[YG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"forceOvertimeModule",[jG,qG,KG],Object.getOwnPropertyDescriptor(yW.prototype,"forceOvertimeModule"),yW.prototype),XW=bi(yW.prototype,"_limitVelocityOvertimeModule",[ZG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"limitVelocityOvertimeModule",[JG,QG,$G],Object.getOwnPropertyDescriptor(yW.prototype,"limitVelocityOvertimeModule"),yW.prototype),YW=bi(yW.prototype,"_rotationOvertimeModule",[tW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"rotationOvertimeModule",[eW,iW,rW],Object.getOwnPropertyDescriptor(yW.prototype,"rotationOvertimeModule"),yW.prototype),jW=bi(yW.prototype,"_textureAnimationModule",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"textureAnimationModule",[oW,sW,aW],Object.getOwnPropertyDescriptor(yW.prototype,"textureAnimationModule"),yW.prototype),qW=bi(yW.prototype,"_trailModule",[lW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bi(yW.prototype,"trailModule",[hW,uW,cW],Object.getOwnPropertyDescriptor(yW.prototype,"trailModule"),yW.prototype),KW=bi(yW.prototype,"renderer",[dW,Ai,pW,fW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lX}}),ZW=bi(yW.prototype,"enableCulling",[Ai,_W,gW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JW=bi(yW.prototype,"_prewarm",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),QW=bi(yW.prototype,"_capacity",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),$W=bi(yW.prototype,"_simulationSpace",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XB.Local}}),mW=yW))||mW)||mW)||mW)||mW)||mW)),TX=t("ParticleUtils",function(){function t(){}return t.instantiate=function(t){return this.registeredSceneEvent||(Fr.on(kr.EVENT_BEFORE_SCENE_LAUNCH,this.onSceneUnload,this),this.registeredSceneEvent=!0),this.particleSystemPool.has(t._uuid)||this.particleSystemPool.set(t._uuid,new e((function(){return jn(t)||new br}),1)),this.particleSystemPool.get(t._uuid).alloc()},t.destroy=function(t){this.particleSystemPool.has(t._prefab.asset._uuid)&&(this.stop(t),this.particleSystemPool.get(t._prefab.asset._uuid).free(t))},t.play=function(t){for(var e,i=qe(t.getComponentsInChildren(SX));!(e=i()).done;)e.value.play()},t.stop=function(t){for(var e,i=qe(t.getComponentsInChildren(SX));!(e=i()).done;)e.value.stop()},t.onSceneUnload=function(){this.particleSystemPool.forEach((function(t){t.destroy((function(t){t.destroy()}))})),this.particleSystemPool.clear()},t}());function EX(t){ei._global.CC_PHYSICS_BUILTIN="builtin"===t,ei._global.CC_PHYSICS_CANNON="cannon.js"===t,ei._global.CC_PHYSICS_AMMO="ammo.js"===t}TX.particleSystemPool=new Map,TX.registeredSceneEvent=!1,Yi(Jz.prototype,"Burst.prototype",[{name:"minCount"},{name:"maxCount"}]),ei.ParticleSystemComponent=SX,qi.setClassAlias(SX,"cc.ParticleSystemComponent"),ei.BillboardComponent=BD,qi.setClassAlias(BD,"cc.BillboardComponent"),ei.LineComponent=iB,qi.setClassAlias(iB,"cc.LineComponent"),ei.ParticleUtils=TX,function(t){t[t.DYNAMIC=1]="DYNAMIC",t[t.STATIC=2]="STATIC",t[t.KINEMATIC=4]="KINEMATIC"}(eX||(eX=t("ERigidBodyType",{}))),Mi(eX),function(t){t[t.X_AXIS=0]="X_AXIS",t[t.Y_AXIS=1]="Y_AXIS",t[t.Z_AXIS=2]="Z_AXIS"}(iX||(iX=t("EAxisDirection",{}))),Mi(iX),function(t){t[t.VERTEX=1]="VERTEX",t[t.LINE=2]="LINE",t[t.TRIANGLE=3]="TRIANGLE",t[t.TETRAHEDRON=4]="TETRAHEDRON"}(rX||(rX={})),Mi(rX),function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.MESH=5]="MESH",t[t.PLANE=6]="PLANE",t[t.SIMPLEX=7]="SIMPLEX",t[t.TERRAIN=8]="TERRAIN"}(nX||(nX={})),Mi(nX),function(t){t[t.POINT_TO_POINT=0]="POINT_TO_POINT",t[t.HINGE=1]="HINGE",t[t.CONE_TWIST=2]="CONE_TWIST"}(oX||(oX={})),Mi(oX),function(t){t[t.DEFAULT=1]="DEFAULT"}(sX||(sX={})),Mi(sX);var AX,CX={id:"",switchTo:function(t){if(CX.runInEditor){var e=CX;if(CX.physicsWorld&&t!==CX.id&&null!=CX.backend[t]?(CX.physicsWorld.destroy(),console.info("[PHYSICS]: switch from "+CX.id+" to "+t+"."),EX(t),e.id=t,e.wrapper=CX.backend[t],e.physicsWorld=MX()):(console.info("[PHYSICS]: using "+t+"."),e.physicsWorld=MX()),aX){var i=e.physicsWorld;i.setGravity(aX.gravity),i.setAllowSleep(aX.allowSleep),i.setDefaultMaterial(aX.defaultMaterial)}}},register:function(t,e){if(console.info("[PHYSICS]: register "+t+"."),CX.backend[t]=e,!CX.physicsWorld||CX.id===t){EX(t);var i=CX;i.id=t,i.wrapper=e}},wrapper:{},backend:{},physicsWorld:null,runInEditor:!xn},wX=function(){return 0},xX={impl:null,setGravity:wX,setAllowSleep:wX,setDefaultMaterial:wX,step:wX,syncAfterEvents:wX,syncSceneToPhysics:wX,raycast:wX,raycastClosest:wX,emitEvents:wX,destroy:wX};function RX(t,e){return null==t&&(CX.id?ti(CX.id+" physics does not support "+AX[e]):We(9600),!0)}function MX(){return RX(CX.wrapper.PhysicsWorld,AX.World)?xX:new CX.wrapper.PhysicsWorld}!function(t){t[t.World=0]="World",t[t.RigidBody=1]="RigidBody",t[t.BoxCollider=2]="BoxCollider",t[t.SphereCollider=3]="SphereCollider",t[t.CapsuleCollider=4]="CapsuleCollider",t[t.MeshCollider=5]="MeshCollider",t[t.CylinderCollider=6]="CylinderCollider",t[t.ConeCollider=7]="ConeCollider",t[t.TerrainCollider=8]="TerrainCollider",t[t.SimplexCollider=9]="SimplexCollider",t[t.PlaneCollider=10]="PlaneCollider",t[t.PointToPointConstraint=11]="PointToPointConstraint",t[t.HingeConstraint=12]="HingeConstraint",t[t.ConeTwistConstraint=13]="ConeTwistConstraint"}(AX||(AX={}));var OX={impl:null,rigidBody:null,isAwake:!1,isSleepy:!1,isSleeping:!1,initialize:wX,onEnable:wX,onDisable:wX,onDestroy:wX,setType:wX,setMass:wX,setLinearDamping:wX,setAngularDamping:wX,useGravity:wX,setLinearFactor:wX,setAngularFactor:wX,setAllowSleep:wX,wakeUp:wX,sleep:wX,clearState:wX,clearForces:wX,clearVelocity:wX,setSleepThreshold:wX,getSleepThreshold:wX,getLinearVelocity:wX,setLinearVelocity:wX,getAngularVelocity:wX,setAngularVelocity:wX,applyForce:wX,applyLocalForce:wX,applyImpulse:wX,applyLocalImpulse:wX,applyTorque:wX,applyLocalTorque:wX,setGroup:wX,getGroup:wX,addGroup:wX,removeGroup:wX,setMask:wX,getMask:wX,addMask:wX,removeMask:wX,isUsingCCD:wX,useCCD:wX},PX={INITED:!1},DX={impl:null,collider:null,attachedRigidBody:null,initialize:wX,onLoad:wX,onEnable:wX,onDisable:wX,onDestroy:wX,setGroup:wX,getGroup:wX,addGroup:wX,removeGroup:wX,setMask:wX,getMask:wX,addMask:wX,removeMask:wX,setMaterial:wX,setAsTrigger:wX,setCenter:wX,getAABB:wX,getBoundingSphere:wX,updateSize:wX,updateRadius:wX,setRadius:wX,setCylinderHeight:wX,setDirection:wX,setHeight:wX,setShapeType:wX,setVertices:wX,setMesh:wX,setTerrain:wX,setNormal:wX,setConstant:wX,updateEventListener:wX};var IX,BX,LX,FX,kX,NX,zX,UX,VX={INITED:!1},HX={impl:null,initialize:wX,onLoad:wX,onEnable:wX,onDisable:wX,onDestroy:wX,setEnableCollision:wX,setConnectedBody:wX,setPivotA:wX,setPivotB:wX,setAxis:wX};function GX(t,e){return t.setValue(e.x,e.y,e.z),t}function WX(t,e){return t.x=e.x(),t.y=e.y(),t.z=e.z(),t}function XX(t,e){return t.setValue(e.x,e.y,e.z,e.w),t}function YX(t,e){return t.x=e.x(),t.y=e.y(),t.z=e.z(),t.w=e.w(),t}function jX(t,e){delete qn.getCache(e)[qn.getPointer(t)]}function qX(t,e){for(var i=e.renderingSubMeshes.length,r=0;r<i;r++){var n=e.renderingSubMeshes[r],o=n.geometricInfo;if(o){var s=n.primitiveMode,a=o.positions,l=o.indices,h=new qn.btVector3,u=new qn.btVector3,c=new qn.btVector3;if(s===F.TRIANGLE_LIST)for(var d=l.length,p=0;p<d;p+=3){var f=3*l[p],_=3*l[p+1],g=3*l[p+2];h.setValue(a[f],a[f+1],a[f+2]),u.setValue(a[_],a[_+1],a[_+2]),c.setValue(a[g],a[g+1],a[g+2]),t.addTriangle(h,u,c)}else if(s===F.TRIANGLE_STRIP)for(var m=l.length-2,y=0,v=0;v<m;v+=1){var b=3*l[v-y],S=3*l[v+y+1],T=3*l[v+2];y=~y,h.setValue(a[b],a[b+1],a[b+2]),u.setValue(a[S],a[S+1],a[S+2]),c.setValue(a[T],a[T+1],a[T+2]),t.addTriangle(h,u,c)}else if(s===F.TRIANGLE_FAN){var E=l.length-1,A=3*l[0];h.setValue(a[A],a[A+1],a[A+2]);for(var C=1;C<E;C+=1){var w=3*l[C],x=3*l[C+1];u.setValue(a[w],a[w+1],a[w+2]),c.setValue(a[x],a[x+1],a[x+2]),t.addTriangle(h,u,c)}}qn.destroy(h),qn.destroy(u),qn.destroy(c)}}return t}var KX=function(e){return t({PhysicsMaterial:e,PhysicMaterial:e}),e}(_i("cc.PhysicsMaterial")((UX=zX=function(t){function e(){var i;return(i=t.call(this)||this).id=void 0,Si(i,"_friction",LX,Ti(i)),Si(i,"_rollingFriction",FX,Ti(i)),Si(i,"_spinningFriction",kX,Ti(i)),Si(i,"_restitution",NX,Ti(i)),e.allMaterials.push(Ti(i)),i.id=e._idCounter++,i._uuid||(i._uuid="pm_"+i.id),i}He(e,t);var i=e.prototype;return i.clone=function(){var t=new e;return t._friction=this._friction,t._restitution=this._restitution,t._rollingFriction=this._rollingFriction,t._spinningFriction=this._spinningFriction,t},i.destroy=function(){if(t.prototype.destroy.call(this)){var i=e.allMaterials.indexOf(this);return i>=0&&e.allMaterials.splice(i,1),!0}return!1},i.setValues=function(t,i,r,n){var o=this._friction!==t||this._rollingFriction!==i||this._spinningFriction!==r||this._restitution!==n;this._friction=t,this._rollingFriction=i,this._spinningFriction=r,this._restitution=n,o&&this.emit(e.EVENT_UPDATE)},Ge(e,[{key:"friction",get:function(){return this._friction},set:function(t){Kn(this._friction,t)||(this._friction=t,this.emit(e.EVENT_UPDATE))}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){Kn(this._rollingFriction,t)||(this._rollingFriction=t,this.emit(e.EVENT_UPDATE))}},{key:"spinningFriction",get:function(){return this._spinningFriction},set:function(t){Kn(this._spinningFriction,t)||(this._spinningFriction=t,this.emit(e.EVENT_UPDATE))}},{key:"restitution",get:function(){return this._restitution},set:function(t){Kn(this._restitution,t)||(this._restitution=t,this.emit(e.EVENT_UPDATE))}}]),e}(vi),zX.allMaterials=[],zX.EVENT_UPDATE="event_update",zX._idCounter=0,bi((BX=UX).prototype,"friction",[Pi],Object.getOwnPropertyDescriptor(BX.prototype,"friction"),BX.prototype),bi(BX.prototype,"rollingFriction",[Pi],Object.getOwnPropertyDescriptor(BX.prototype,"rollingFriction"),BX.prototype),bi(BX.prototype,"spinningFriction",[Pi],Object.getOwnPropertyDescriptor(BX.prototype,"spinningFriction"),BX.prototype),bi(BX.prototype,"restitution",[Pi],Object.getOwnPropertyDescriptor(BX.prototype,"restitution"),BX.prototype),LX=bi(BX.prototype,"_friction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.6}}),FX=bi(BX.prototype,"_rollingFriction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),kX=bi(BX.prototype,"_spinningFriction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),NX=bi(BX.prototype,"_restitution",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),IX=BX))||IX),ZX=t("PhysicsRayResult",function(){function t(){this._hitPoint=new fi,this._hitNormal=new fi,this._distance=0,this._collider=null}var e=t.prototype;return e._assign=function(t,e,i,r){fi.copy(this._hitPoint,t),fi.copy(this._hitNormal,r),this._distance=e,this._collider=i},e.clone=function(){var e=new t;return fi.copy(e._hitPoint,this._hitPoint),fi.copy(e._hitNormal,this._hitNormal),e._distance=this._distance,e._collider=this._collider,e},Ge(t,[{key:"hitPoint",get:function(){return this._hitPoint}},{key:"distance",get:function(){return this._distance}},{key:"collider",get:function(){return this._collider}},{key:"hitNormal",get:function(){return this._hitNormal}}]),t}()),JX=function(t){if(1===t){for(var e=this,i=function(t){var i="_"+(1<<t);e[i]=0,e.updateArray=[],Object.defineProperty(e,1<<t,{get:function(){return this[i]},set:function(e){this[i]!==e&&(this[i]=e,this.updateArray.indexOf(t)<0&&this.updateArray.push(t))}})},r=0;r<32;r++)i(r);this._1=sX.DEFAULT}else{for(var n=0;n<32;n++)this[""+(1<<n)]=0;this[1]=sX.DEFAULT}};ei.internal.PhysicsGroup=sX;var QX,$X,tY,eY,iY,rY,nY,oY,sY,aY,lY,hY,uY,cY,dY,pY,fY,_Y,gY,mY,yY,vY,bY,SY,TY,EY,AY,CY,wY,xY,RY,MY,OY,PY,DY,IY,BY,LY,FY,kY,NY,zY,UY,VY,HY=t("PhysicsSystem",function(t){function e(){var e;return(e=t.call(this)||this).raycastClosestResult=new ZX,e.raycastResults=[],e.collisionMatrix=new JX(1),e.minVolumeSize=1e-5,e.useNodeChains=!1,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._subStepCount=0,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._sleepThreshold=.1,e._gravity=new fi(0,-10,0),e._material=new KX,e.raycastOptions={group:-1,mask:-1,queryTrigger:!0,maxDistance:1e7},e.raycastResultPool=new i((function(){return new ZX}),1),e._material.on(KX.EVENT_UPDATE,e._updateMaterial,Ti(e)),e}He(e,t);var r=e.prototype;return r.postUpdate=function(t){if(this.physicsWorld)if(this._enable){if(this._autoSimulation){for(this._subStepCount=0,this._accumulator+=t,Fr.emit(kr.EVENT_BEFORE_PHYSICS);this._subStepCount<this._maxSubSteps;){if(!(this._accumulator>=this._fixedTimeStep)){this.physicsWorld.syncSceneToPhysics();break}this.physicsWorld.syncSceneToPhysics(),this.physicsWorld.step(this._fixedTimeStep),this.physicsWorld.emitEvents(),this.physicsWorld.syncAfterEvents(),this._accumulator-=this._fixedTimeStep,this._subStepCount++}Fr.emit(kr.EVENT_AFTER_PHYSICS)}}else this.physicsWorld.syncSceneToPhysics()},r.resetConfiguration=function(t){var e=t||(tn.config?tn.config.physics:null);if(e){if("boolean"==typeof e.allowSleep&&(this._allowSleep=e.allowSleep),"number"==typeof e.fixedTimeStep&&(this._fixedTimeStep=e.fixedTimeStep),"number"==typeof e.maxSubSteps&&(this._maxSubSteps=e.maxSubSteps),"number"==typeof e.sleepThreshold&&(this._sleepThreshold=e.sleepThreshold),"boolean"==typeof e.autoSimulation&&(this.autoSimulation=e.autoSimulation),e.gravity&&fi.copy(this._gravity,e.gravity),e.defaultMaterial&&this._material.setValues(e.defaultMaterial.friction,e.defaultMaterial.rollingFriction,e.defaultMaterial.spinningFriction,e.defaultMaterial.restitution),e.collisionMatrix)for(var i in e.collisionMatrix)this.collisionMatrix[""+(1<<parseInt(i))]=e.collisionMatrix[i];if(e.collisionGroups){var r=e.collisionGroups;r instanceof Array&&(r.forEach((function(t){sX[t.name]=1<<t.index})),Mi.update(sX))}}this.physicsWorld&&(this.physicsWorld.setGravity(this._gravity),this.physicsWorld.setAllowSleep(this._allowSleep),this.physicsWorld.setDefaultMaterial(this._material))},r.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},r.step=function(t,e,i){this.physicsWorld&&this.physicsWorld.step(t,e,i)},r.syncSceneToPhysics=function(){this.physicsWorld&&this.physicsWorld.syncSceneToPhysics()},r.emitEvents=function(){this.physicsWorld&&this.physicsWorld.emitEvents()},r.raycast=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),!!this.physicsWorld&&(this.raycastResultPool.reset(),this.raycastResults.length=0,this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycast(t,this.raycastOptions,this.raycastResultPool,this.raycastResults))},r.raycastClosest=function(t,e,i,r){return void 0===e&&(e=4294967295),void 0===i&&(i=1e7),void 0===r&&(r=!0),!!this.physicsWorld&&(this.raycastOptions.mask=e>>>0,this.raycastOptions.maxDistance=i,this.raycastOptions.queryTrigger=r,this.physicsWorld.raycastClosest(t,this.raycastOptions,this.raycastClosestResult))},r._updateMaterial=function(){this.physicsWorld&&this.physicsWorld.setDefaultMaterial(this._material)},e.constructAndRegister=function(){if(!e._instance){var t=new e;t.resetConfiguration(),function(t){if(aX||(aX=t),CX.runInEditor&&!CX.physicsWorld){console.info("[PHYSICS]: using "+CX.id+".");var e=CX.physicsWorld=MX();e.setGravity(aX.gravity),e.setAllowSleep(aX.allowSleep),e.setDefaultMaterial(aX.defaultMaterial)}}(t),e._instance=t,Fr.registerSystem(e.ID,t,t.priority)}},Ge(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld&&this.physicsWorld.setAllowSleep(t)}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld&&this.physicsWorld.setGravity(t)}},{key:"sleepThreshold",get:function(){return this._sleepThreshold},set:function(t){this._sleepThreshold=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"defaultMaterial",get:function(){return this._material}},{key:"physicsWorld",get:function(){return CX.physicsWorld}}],[{key:"PHYSICS_NONE",get:function(){return!CX.id}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===CX.id}},{key:"PHYSICS_CANNON",get:function(){return"cannon.js"===CX.id}},{key:"PHYSICS_AMMO",get:function(){return"ammo.js"===CX.id}},{key:"PHYSICS_PHYSX",get:function(){return"physx"===CX.id}},{key:"PhysicsGroup",get:function(){return sX}},{key:"instance",get:function(){return e._instance}}]),e}(Zn));HY.ID="PHYSICS",HY._instance=null,Fr.once(kr.EVENT_INIT,(function(){HY.constructAndRegister()}));var GY,WY,XY,YY,jY,qY,KY,ZY,JY,QY,$Y,tj,ej,ij,rj,nj,oj,sj,aj,lj,hj,uj,cj=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}((QX=_i("cc.RigidBody"),$X=Ni(),tY=Ui(),eY=zi(-1),iY=Di(HY.PhysicsGroup),rY=Ur(),nY=Vi(),oY=Di(eX),sY=Ur(),aY=Vi(),lY=Hi(),hY=Ur(),uY=Vi(),cY=Hi(),dY=Ur(),pY=Vi(),fY=Hi(),_Y=Ur(),gY=Vi(),mY=Hi(),yY=Ur(),vY=Vi(),bY=Hi(),SY=Ur(),TY=Vi(),EY=Hi(),AY=Ur(),CY=Vi(),wY=Hi(),xY=Ur(),RY=Vi(),QX(MY=$X(MY=tY(MY=Ii(MY=Nr(MY=eY((VY=UY=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._body=null,Si(e,"_group",PY,Ti(e)),Si(e,"_type",DY,Ti(e)),Si(e,"_mass",IY,Ti(e)),Si(e,"_allowSleep",BY,Ti(e)),Si(e,"_linearDamping",LY,Ti(e)),Si(e,"_angularDamping",FY,Ti(e)),Si(e,"_useGravity",kY,Ti(e)),Si(e,"_linearFactor",NY,Ti(e)),Si(e,"_angularFactor",zY,Ti(e)),e}He(e,t);var i=e.prototype;return i.onLoad=function(){CX.runInEditor&&(this._body=RX(CX.wrapper.RigidBody,AX.RigidBody)?OX:new CX.wrapper.RigidBody,this._body.initialize(this))},i.onEnable=function(){this._body&&this._body.onEnable()},i.onDisable=function(){this._body&&this._body.onDisable()},i.onDestroy=function(){this._body&&this._body.onDestroy()},i.applyForce=function(t,e){this._isInitialized&&this._body.applyForce(t,e)},i.applyLocalForce=function(t,e){this._isInitialized&&this._body.applyLocalForce(t,e)},i.applyImpulse=function(t,e){this._isInitialized&&this._body.applyImpulse(t,e)},i.applyLocalImpulse=function(t,e){this._isInitialized&&this._body.applyLocalImpulse(t,e)},i.applyTorque=function(t){this._isInitialized&&this._body.applyTorque(t)},i.applyLocalTorque=function(t){this._isInitialized&&this._body.applyLocalTorque(t)},i.wakeUp=function(){this._isInitialized&&this._body.wakeUp()},i.sleep=function(){this._isInitialized&&this._body.sleep()},i.clearState=function(){this._isInitialized&&this._body.clearState()},i.clearForces=function(){this._isInitialized&&this._body.clearForces()},i.clearVelocity=function(){this._isInitialized&&this._body.clearVelocity()},i.getLinearVelocity=function(t){this._isInitialized&&this._body.getLinearVelocity(t)},i.setLinearVelocity=function(t){this._isInitialized&&this._body.setLinearVelocity(t)},i.getAngularVelocity=function(t){this._isInitialized&&this._body.getAngularVelocity(t)},i.setAngularVelocity=function(t){this._isInitialized&&this._body.setAngularVelocity(t)},i.getGroup=function(){return this._isInitialized?this._body.getGroup():0},i.setGroup=function(t){this._isInitialized&&this._body.setGroup(t)},i.addGroup=function(t){this._isInitialized&&this._body.addGroup(t)},i.removeGroup=function(t){this._isInitialized&&this._body.removeGroup(t)},i.getMask=function(){return this._isInitialized?this._body.getMask():0},i.setMask=function(t){this._isInitialized&&this._body.setMask(t)},i.addMask=function(t){this._isInitialized&&this._body.addMask(t)},i.removeMask=function(t){this._isInitialized&&this._body.removeMask(t)},Ge(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t,this._body&&this._body.getGroup()!==t&&this._body.setGroup(t)}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._body&&this._body.setType(t))}},{key:"mass",get:function(){return this._mass},set:function(t){this._mass!==t&&(t=t<=0?1e-4:t,this._mass=t,this._body&&this._body.setMass(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"useGravity",get:function(){return this._useGravity},set:function(t){this._useGravity=t,this._body&&this._body.useGravity(t)}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){fi.copy(this._linearFactor,t),this._body&&this._body.setLinearFactor(this._linearFactor)}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){fi.copy(this._angularFactor,t),this._body&&this._body.setAngularFactor(this._angularFactor)}},{key:"sleepThreshold",get:function(){return this._isInitialized?this._body.getSleepThreshold():.1},set:function(t){this._isInitialized&&this._body.setSleepThreshold(t)}},{key:"useCCD",get:function(){return!!this._isInitialized&&this._body.isUsingCCD()},set:function(t){this._isInitialized&&this._body.useCCD(t)}},{key:"isAwake",get:function(){return!!this._isInitialized&&this._body.isAwake}},{key:"isSleepy",get:function(){return!!this._isInitialized&&this._body.isSleepy}},{key:"isSleeping",get:function(){return!!this._isInitialized&&this._body.isSleeping}},{key:"isStatic",get:function(){return this._type===eX.STATIC},set:function(t){t&&this.isStatic||!t&&!this.isStatic||(this.type=t?eX.STATIC:eX.DYNAMIC)}},{key:"isDynamic",get:function(){return this._type===eX.DYNAMIC},set:function(t){t&&this.isDynamic||!t&&!this.isDynamic||(this.type=t?eX.DYNAMIC:eX.KINEMATIC)}},{key:"isKinematic",get:function(){return this._type===eX.KINEMATIC},set:function(t){t&&this.isKinematic||!t&&!this.isKinematic||(this.type=t?eX.KINEMATIC:eX.DYNAMIC)}},{key:"body",get:function(){return this._body}},{key:"_isInitialized",get:function(){var t=null===this._body;return t&&Ye("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!t}}]),e}($i),UY.Type=eX,bi((OY=VY).prototype,"group",[iY,rY,nY],Object.getOwnPropertyDescriptor(OY.prototype,"group"),OY.prototype),bi(OY.prototype,"type",[oY,sY,aY],Object.getOwnPropertyDescriptor(OY.prototype,"type"),OY.prototype),bi(OY.prototype,"mass",[lY,hY,uY],Object.getOwnPropertyDescriptor(OY.prototype,"mass"),OY.prototype),bi(OY.prototype,"allowSleep",[cY,dY,pY],Object.getOwnPropertyDescriptor(OY.prototype,"allowSleep"),OY.prototype),bi(OY.prototype,"linearDamping",[fY,_Y,gY],Object.getOwnPropertyDescriptor(OY.prototype,"linearDamping"),OY.prototype),bi(OY.prototype,"angularDamping",[mY,yY,vY],Object.getOwnPropertyDescriptor(OY.prototype,"angularDamping"),OY.prototype),bi(OY.prototype,"useGravity",[bY,SY,TY],Object.getOwnPropertyDescriptor(OY.prototype,"useGravity"),OY.prototype),bi(OY.prototype,"linearFactor",[EY,AY,CY],Object.getOwnPropertyDescriptor(OY.prototype,"linearFactor"),OY.prototype),bi(OY.prototype,"angularFactor",[wY,xY,RY],Object.getOwnPropertyDescriptor(OY.prototype,"angularFactor"),OY.prototype),PY=bi(OY.prototype,"_group",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return HY.PhysicsGroup.DEFAULT}}),DY=bi(OY.prototype,"_type",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eX.DYNAMIC}}),IY=bi(OY.prototype,"_mass",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),BY=bi(OY.prototype,"_allowSleep",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),LY=bi(OY.prototype,"_linearDamping",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),FY=bi(OY.prototype,"_angularDamping",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),kY=bi(OY.prototype,"_useGravity",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),NY=bi(OY.prototype,"_linearFactor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(1,1,1)}}),zY=bi(OY.prototype,"_angularFactor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(1,1,1)}}),MY=OY))||MY)||MY)||MY)||MY)||MY)||MY));cj||(cj=function(e){return t({RigidBody:e,RigidBodyComponent:e}),e}({}));var dj=function(e){return t({Collider:e,ColliderComponent:e}),e}((GY=_i("cc.Collider"),WY=Di(cj),XY=Wr(),YY=Ur(),jY=Vi(),qY=Di(KX),KY=Wr(),ZY=Ur(),JY=Vi(),QY=Ur(),$Y=Vi(),tj=Di(fi),ej=Ur(),ij=Vi(),rj=Di(KX),GY((uj=hj=function(t){function e(e){var i;return(i=t.call(this)||this).type=void 0,i._shape=null,i._aabb=null,i._boundingSphere=null,i._isSharedMaterial=!0,i._needTriggerEvent=!1,i._needCollisionEvent=!1,Si(i,"_material",sj,Ti(i)),Si(i,"_isTrigger",aj,Ti(i)),Si(i,"_center",lj,Ti(i)),i.type=e,i}He(e,t);var i=e.prototype;return i.on=function(e,i,r,n){var o=t.prototype.on.call(this,e,i,r,n);return this._updateNeedEvent(e),o},i.off=function(e,i,r){t.prototype.off.call(this,e,i,r),this._updateNeedEvent()},i.once=function(e,i,r){var n=t.prototype.once.call(this,e,i,r);return this._updateNeedEvent(e),n},i.removeAll=function(e){t.prototype.removeAll.call(this,e),this._updateNeedEvent()},i.getGroup=function(){return this._isInitialized?this._shape.getGroup():0},i.setGroup=function(t){this._isInitialized&&this._shape.setGroup(t)},i.addGroup=function(t){this._isInitialized&&this._shape.addGroup(t)},i.removeGroup=function(t){this._isInitialized&&this._shape.removeGroup(t)},i.getMask=function(){return this._isInitialized?this._shape.getMask():0},i.setMask=function(t){this._isInitialized&&this._shape.setMask(t)},i.addMask=function(t){this._isInitialized&&this._shape.addMask(t)},i.removeMask=function(t){this._isInitialized&&this._shape.removeMask(t)},i.onLoad=function(){CX.runInEditor&&(this.sharedMaterial=null==this._material?HY.instance.defaultMaterial:this._material,this._shape=function(t){return PX.INITED||(PX.INITED=!0,PX[nX.BOX]=function(){return RX(CX.wrapper.BoxShape,AX.BoxCollider)?DX:new CX.wrapper.BoxShape},PX[nX.SPHERE]=function(){return RX(CX.wrapper.SphereShape,AX.SphereCollider)?DX:new CX.wrapper.SphereShape},PX[nX.CAPSULE]=function(){return RX(CX.wrapper.CapsuleShape,AX.CapsuleCollider)?DX:new CX.wrapper.CapsuleShape},PX[nX.CYLINDER]=function(){return RX(CX.wrapper.CylinderShape,AX.CylinderCollider)?DX:new CX.wrapper.CylinderShape},PX[nX.CONE]=function(){return RX(CX.wrapper.ConeShape,AX.ConeCollider)?DX:new CX.wrapper.ConeShape},PX[nX.MESH]=function(){return RX(CX.wrapper.TrimeshShape,AX.MeshCollider)?DX:new CX.wrapper.TrimeshShape},PX[nX.TERRAIN]=function(){return RX(CX.wrapper.TerrainShape,AX.TerrainCollider)?DX:new CX.wrapper.TerrainShape},PX[nX.SIMPLEX]=function(){return RX(CX.wrapper.SimplexShape,AX.SimplexCollider)?DX:new CX.wrapper.SimplexShape},PX[nX.PLANE]=function(){return RX(CX.wrapper.PlaneShape,AX.PlaneCollider)?DX:new CX.wrapper.PlaneShape}),PX[t]()}(this.type),this._shape.initialize(this),this._shape.onLoad())},i.onEnable=function(){this._shape&&this._shape.onEnable()},i.onDisable=function(){this._shape&&this._shape.onDisable()},i.onDestroy=function(){this._shape&&(this._material&&this._material.off(KX.EVENT_UPDATE,this._updateMaterial,this),this._shape.onDestroy()),this._boundingSphere&&this._boundingSphere.destroy()},i._updateMaterial=function(){this._shape&&this._shape.setMaterial(this._material)},i._updateNeedEvent=function(t){this.isValid&&(void 0!==t?("onCollisionEnter"!==t&&"onCollisionStay"!==t&&"onCollisionExit"!==t||(this._needCollisionEvent=!0),"onTriggerEnter"!==t&&"onTriggerStay"!==t&&"onTriggerExit"!==t||(this._needTriggerEvent=!0)):(this.hasEventListener("onTriggerEnter")||this.hasEventListener("onTriggerStay")||this.hasEventListener("onTriggerExit")||(this._needTriggerEvent=!1),this.hasEventListener("onCollisionEnter")||this.hasEventListener("onCollisionStay")||this.hasEventListener("onCollisionExit")||(this._needCollisionEvent=!1)),this._shape&&this._shape.updateEventListener())},Ge(e,[{key:"attachedRigidBody",get:function(){return t=this.node,(e=t.getComponent(cj))&&e.isValid?e:null;var t,e}},{key:"sharedMaterial",get:function(){return this._material},set:function(t){this.material=t}},{key:"material",get:function(){return this._isSharedMaterial&&this._material&&(this._material.off(KX.EVENT_UPDATE,this._updateMaterial,this),this._material=this._material.clone(),this._material.on(KX.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1),this._material},set:function(t){this._shape?(t&&this._material?this._material.id!==t.id&&(this._material.off(KX.EVENT_UPDATE,this._updateMaterial,this),t.on(KX.EVENT_UPDATE,this._updateMaterial,this),this._isSharedMaterial=!1,this._material=t):t&&!this._material?(t.on(KX.EVENT_UPDATE,this._updateMaterial,this),this._material=t):!t&&this._material&&(this._material.off(KX.EVENT_UPDATE,this._updateMaterial,this),this._material=t),this._updateMaterial()):this._material=t}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t,this._shape&&this._shape.setAsTrigger(this._isTrigger)}},{key:"center",get:function(){return this._center},set:function(t){fi.copy(this._center,t),this._shape&&this._shape.setCenter(this._center)}},{key:"shape",get:function(){return this._shape}},{key:"worldBounds",get:function(){return null==this._aabb&&(this._aabb=new mi),this._shape&&this._shape.getAABB(this._aabb),this._aabb}},{key:"boundingSphere",get:function(){return null==this._boundingSphere&&(this._boundingSphere=new $n),this._shape&&this._shape.getBoundingSphere(this._boundingSphere),this._boundingSphere}},{key:"needTriggerEvent",get:function(){return this._needTriggerEvent}},{key:"needCollisionEvent",get:function(){return this._needCollisionEvent}},{key:"_isInitialized",get:function(){var t=null===this._shape;return t&&Ye("[Physics]: This component has not been call onLoad yet, please make sure the node has been added to the scene."),!t}}]),e}(Jn($i)),hj.Type=nX,hj.Axis=iX,bi((oj=uj).prototype,"attachedRigidBody",[WY,Qn,XY,YY,jY],Object.getOwnPropertyDescriptor(oj.prototype,"attachedRigidBody"),oj.prototype),bi(oj.prototype,"sharedMaterial",[qY,KY,ZY,JY],Object.getOwnPropertyDescriptor(oj.prototype,"sharedMaterial"),oj.prototype),bi(oj.prototype,"isTrigger",[QY,$Y],Object.getOwnPropertyDescriptor(oj.prototype,"isTrigger"),oj.prototype),bi(oj.prototype,"center",[tj,ej,ij],Object.getOwnPropertyDescriptor(oj.prototype,"center"),oj.prototype),sj=bi(oj.prototype,"_material",[rj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aj=bi(oj.prototype,"_isTrigger",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lj=bi(oj.prototype,"_center",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),nj=oj))||nj));function pj(t){return void 0===(t=t||{}).includeNormal&&(t.includeNormal=!0),void 0===t.includeUV&&(t.includeUV=!0),t}dj||(dj=function(e){return t({Collider:e,ColliderComponent:e}),e}({}));var fj=new fi,_j=new fi,gj=new fi,mj=new fi,yj=new fi,vj=new fi,bj=new fi,Sj=new fi,Tj=new fi,Ej=new fi,Aj=new fi,Cj=new fi,wj=new fi(0,0,0),xj=new fi(0,0,0);function Rj(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r={});var n=.5*i,o=r.radialSegments||32,s=r.heightSegments||1,a=void 0===r.capped||r.capped,l=r.arc||2*Math.PI,h=0;a||(t>0&&h++,e>0&&h++);var u=(o+1)*(s+1);a&&(u+=(o+1)*h+o*h);var c=o*s*6;a&&(c+=o*h*3);var d=new Array(c),p=new Array(3*u),f=new Array(3*u),_=new Array(2*u),g=Math.max(t,e),m=new fi(-g,-n,-g),y=new fi(g,n,g),v=Math.sqrt(g*g+n*n),b=0,S=0;return function(){for(var r=[],a=t-e,h=a*a/i*Math.sign(a),u=0;u<=s;u++){for(var c=[],g=u/s,m=g*a+e,y=0;y<=o;++y){var v=y/o,T=v*l,E=Math.sin(T),A=Math.cos(T);p[3*b]=m*E,p[3*b+1]=g*i-n,p[3*b+2]=m*A,fi.normalize(wj,fi.set(xj,E,-h,A)),f[3*b]=wj.x,f[3*b+1]=wj.y,f[3*b+2]=wj.z,_[2*b]=2*(1-v)%1,_[2*b+1]=g,c.push(b),++b}r.push(c)}for(var C=0;C<s;++C)for(var w=0;w<o;++w){var x=r[C][w],R=r[C+1][w],M=r[C+1][w+1],O=r[C][w+1];d[S]=x,++S,d[S]=O,++S,d[S]=R,++S,d[S]=O,++S,d[S]=M,++S,d[S]=R,++S}}(),a&&(e>0&&T(!1),t>0&&T(!0)),{positions:p,normals:f,uvs:_,indices:d,minPos:m,maxPos:y,boundingRadius:v};function T(i){for(var r=i?t:e,s=i?1:-1,a=b,h=1;h<=o;++h)p[3*b]=0,p[3*b+1]=n*s,p[3*b+2]=0,f[3*b]=0,f[3*b+1]=s,f[3*b+2]=0,_[2*b]=.5,_[2*b+1]=.5,++b;for(var u=b,c=0;c<=o;++c){var g=c/o*l,m=Math.cos(g),y=Math.sin(g);p[3*b]=r*y,p[3*b+1]=n*s,p[3*b+2]=r*m,f[3*b]=0,f[3*b+1]=s,f[3*b+2]=0,_[2*b]=.5-.5*y*s,_[2*b+1]=.5+.5*m,++b}for(var v=0;v<o;++v){var T=a+v,E=u+v;i?(d[S]=E+1,++S,d[S]=T,++S,d[S]=E,++S):(d[S]=T,++S,d[S]=E+1,++S,d[S]=E,++S)}}}var Mj=new fi(0,0,0),Oj=new fi(0,0,0),Pj=new fi(0,0,0),Dj=new fi(0,0,0),Ij=new fi(0,0,0),Bj=new fi(0,0,0),Lj=new fi(0,0,0),Fj=new fi(0,0,0),kj=new fi(0,0,0),Nj=Object.freeze({__proto__:null,box:function(t){var e=(t=t||{}).widthSegments||1,i=t.heightSegments||1,r=t.lengthSegments||1,n=(t.width||1)/2,o=(t.height||1)/2,s=(t.length||1)/2,a=[fi.set(yj,-n,-o,s),fi.set(vj,n,-o,s),fi.set(bj,n,o,s),fi.set(Sj,-n,o,s),fi.set(Tj,n,-o,-s),fi.set(Ej,-n,-o,-s),fi.set(Aj,-n,o,-s),fi.set(Cj,n,o,-s)],l=[[2,3,1],[4,5,7],[7,6,2],[1,0,4],[1,4,2],[5,0,6]],h=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],u=[[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[-1,0,0,1],[0,0,-1,1],[0,0,1,1]],c=[],d=[],p=[],f=[],_=[],g=new fi(-n,-o,-s),m=new fi(n,o,s),y=Math.sqrt(n*n+o*o+s*s);function v(t,e,i){var r,n,o,s,g=c.length/3,m=l[t],y=h[t],v=u[t];for(s=0;s<=i;s++)for(o=0;o<=e;o++)if(r=o/e,n=s/i,fi.lerp(fj,a[m[0]],a[m[1]],r),fi.lerp(_j,a[m[0]],a[m[2]],n),fi.subtract(gj,_j,a[m[0]]),fi.add(mj,fj,gj),c.push(mj.x,mj.y,mj.z),d.push(y[0],y[1],y[2]),p.push(r,n),f.push(v[0],v[1],v[2],v[3]),o<e&&s<i){var b=e+1,S=o+s*b,T=o+(s+1)*b,E=o+1+(s+1)*b,A=o+1+s*b;_.push(g+S,g+A,g+T),_.push(g+T,g+A,g+E)}}return v(0,e,i),v(4,r,i),v(1,e,i),v(5,r,i),v(3,e,r),v(2,e,r),{positions:c,normals:d,uvs:p,tangents:f,indices:_,minPos:g,maxPos:m,boundingRadius:y}},cone:function(t,e,i){return void 0===t&&(t=.5),void 0===e&&(e=1),void 0===i&&(i={}),Rj(0,t,e,i)},cylinder:Rj,plane:function(t){var e=function(t){return(t=pj(t)).width=t.width||10,t.length=t.length||10,t.widthSegments=t.widthSegments||10,t.lengthSegments=t.lengthSegments||10,t}(t),i=e.width,r=e.length,n=e.widthSegments,o=e.lengthSegments,s=.5*i,a=.5*r,l=[],h=[],u=[],c=new fi(-s,0,-a),d=new fi(s,0,a),p=Math.sqrt(i*i+r*r);fi.set(Ij,-s,0,a),fi.set(Bj,s,0,a),fi.set(Lj,-s,0,-a);for(var f=0;f<=o;f++)for(var _=0;_<=n;_++){var g=_/n,m=f/o;if(fi.lerp(Mj,Ij,Bj,g),fi.lerp(Oj,Ij,Lj,m),fi.subtract(Pj,Oj,Ij),fi.add(Dj,Mj,Pj),l.push(Dj.x,Dj.y,Dj.z),e.includeUV&&h.push(g,m),_<n&&f<o){var y=n+1,v=_+f*y,b=_+(f+1)*y,S=_+1+(f+1)*y,T=_+1+f*y;u.push(v,T,b),u.push(T,S,b)}}var E={positions:l,indices:u,minPos:c,maxPos:d,boundingRadius:p};if(e.includeNormal){var A=(o+1)*(n+1),C=new Array(3*A);E.normals=C;for(var w=0;w<A;++w)C[3*w+0]=0,C[3*w+1]=1,C[3*w+2]=0}return e.includeUV&&(E.uvs=h),E},quad:function(t){var e=pj(t),i={positions:[-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0],indices:[0,3,1,3,2,1],minPos:{x:-.5,y:-.5,z:0},maxPos:{x:.5,y:.5,z:0},boundingRadius:Math.sqrt(.5)};return!1!==e.includeNormal&&(i.normals=[0,0,1,0,0,1,0,0,1,0,0,1]),!1!==e.includeUV&&(i.uvs=[0,0,0,1,1,1,1,0]),i},sphere:function(t,e){void 0===t&&(t=.5),void 0===e&&(e={});for(var i=void 0!==e.segments?e.segments:32,r=[],n=[],o=[],s=[],a=new fi(-t,-t,-t),l=new fi(t,t,t),h=t,u=0;u<=i;++u)for(var c=u*Math.PI/i,d=Math.sin(c),p=-Math.cos(c),f=0;f<=i;++f){var _=2*f*Math.PI/i-Math.PI/2,g=Math.sin(_)*d,m=p,y=Math.cos(_)*d,v=f/i,b=u/i;if(r.push(g*t,m*t,y*t),n.push(g,m,y),o.push(v,b),u<i&&f<i){var S=i+1,T=S*u+f,E=S*(u+1)+f,A=S*(u+1)+f+1,C=S*u+f+1;s.push(T,C,E),s.push(C,A,E)}}return{positions:r,indices:s,normals:n,uvs:o,minPos:a,maxPos:l,boundingRadius:h}},torus:function(t,e,i){void 0===t&&(t=.4),void 0===e&&(e=.1),void 0===i&&(i={});for(var r=i.radialSegments||32,n=i.tubularSegments||32,o=i.arc||2*Math.PI,s=[],a=[],l=[],h=[],u=new fi(-t-e,-e,-t-e),c=new fi(t+e,e,t+e),d=t+e,p=0;p<=r;p++)for(var f=0;f<=n;f++){var _=f/n,g=p/r,m=_*o,y=g*Math.PI*2,v=(t+e*Math.cos(y))*Math.sin(m),b=e*Math.sin(y),S=(t+e*Math.cos(y))*Math.cos(m),T=Math.sin(m)*Math.cos(y),E=Math.sin(y),A=Math.cos(m)*Math.cos(y);if(s.push(v,b,S),a.push(T,E,A),l.push(_,g),f<n&&p<r){var C=n+1,w=C*p+f,x=C*(p+1)+f,R=C*(p+1)+f+1,M=C*p+f+1;h.push(w,M,x),h.push(M,R,x)}}return{positions:s,normals:a,uvs:l,indices:h,minPos:u,maxPos:c,boundingRadius:d}},capsule:function(t,e,i,r){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===i&&(i=2),void 0===r&&(r={});var n=i-t-e,o=r.sides||32,s=r.heightSegments||32,a=e/i,l=n/i,h=t/i,u=Math.floor(s*a),c=Math.floor(s*h),d=Math.floor(s*l),p=n+e-i/2,f=e-i/2,_=e-i/2,g=r.arc||2*Math.PI,m=[],y=[],v=[],b=[],S=Math.max(t,e),T=new fi(-S,-i/2,-S),E=new fi(S,i/2,S),A=i/2,C=0,w=[];return function(){for(var t=0;t<=u;++t)for(var i=t*Math.PI/u/2,r=Math.sin(i),n=-Math.cos(i),a=0;a<=o;++a){var l=2*a*Math.PI/o-Math.PI/2,h=Math.sin(l)*r,c=n,d=Math.cos(l)*r,p=a/o,f=t/s;if(m.push(h*e,c*e+_,d*e),y.push(h,c,d),v.push(p,f),t<u&&a<o){var g=o+1,S=g*t+a,T=g*(t+1)+a,E=g*(t+1)+a+1,A=g*t+a+1;b.push(S,A,T),b.push(A,E,T)}++C}}(),function(){for(var i=(t-e)/n,r=0;r<=d;r++){for(var s=[],h=r/d,u=h*(t-e)+e,c=0;c<=o;++c){var p=c/o,_=h*l+a,S=p*g-g/4,T=Math.sin(S),E=Math.cos(S);m.push(u*T),m.push(h*n+f),m.push(u*E),fi.normalize(Fj,fi.set(kj,T,-i,E)),y.push(Fj.x),y.push(Fj.y),y.push(Fj.z),v.push(p,_),s.push(C),++C}w.push(s)}for(var A=0;A<d;++A)for(var x=0;x<o;++x){var R=w[A][x],M=w[A+1][x],O=w[A+1][x+1],P=w[A][x+1];b.push(R),b.push(P),b.push(M),b.push(P),b.push(O),b.push(M)}}(),function(){for(var e=0;e<=c;++e)for(var i=e*Math.PI/c/2+Math.PI/2,r=Math.sin(i),n=-Math.cos(i),a=0;a<=o;++a){var l=2*a*Math.PI/o-Math.PI/2,u=Math.sin(l)*r,f=n,_=Math.cos(l)*r,g=a/o,S=e/s+(1-h);if(m.push(u*t,f*t+p,_*t),y.push(u,f,_),v.push(g,S),e<c&&a<o){var T=o+1,E=T*e+a+w[d][o]+1,A=T*(e+1)+a+w[d][o]+1,C=T*(e+1)+a+1+w[d][o]+1,x=T*e+a+1+w[d][o]+1;b.push(E,x,A),b.push(x,C,A)}}}(),{positions:m,normals:y,uvs:v,indices:b,minPos:T,maxPos:E,boundingRadius:A}},circle:function(t){var e=function(t){return(t=pj(t)).segments=64,t}(t).segments,i=new Array(3*(e+1));i[0]=0,i[1]=0,i[2]=0;var r=new Array(1+2*e);r[0]=0;for(var n=2*Math.PI/e,o=0;o<e;++o){var s=n*o,a=Math.cos(s),l=Math.sin(s),h=3*(o+1);i[h+0]=a,i[h+1]=l,i[h+2]=0;var u=2*o;r[1+u]=o+1,r[1+(u+1)]=o+2}return e>0&&(r[r.length-1]=1),{positions:i,indices:r,minPos:{x:1,y:1,z:0},maxPos:{x:-1,y:-1,z:0},boundingRadius:1,primitiveMode:F.TRIANGLE_FAN}},translate:function(t,e){for(var i=e.x||0,r=e.y||0,n=e.z||0,o=Math.floor(t.positions.length/3),s=0;s<o;++s){var a=3*s,l=3*s+1,h=3*s+2;t.positions[a]+=i,t.positions[l]+=r,t.positions[h]+=n}return t.minPos&&(t.minPos.x+=i,t.minPos.y+=r,t.minPos.z+=n),t.maxPos&&(t.maxPos.x+=i,t.maxPos.y+=r,t.maxPos.z+=n),t},scale:function(t,e){for(var i=e.x||0,r=e.y||0,n=e.z||0,o=Math.floor(t.positions.length/3),s=0;s<o;++s){var a=3*s,l=3*s+1,h=3*s+2;t.positions[a]*=i,t.positions[l]*=r,t.positions[h]*=n}return t.minPos&&(t.minPos.x*=i,t.minPos.y*=r,t.minPos.z*=n),t.maxPos&&(t.maxPos.x*=i,t.maxPos.y*=r,t.maxPos.z*=n),t.boundingRadius=Math.max(Math.max(i,r),n),t},wireframed:function(t){var e=t.indices;if(!e)return t;if(t.primitiveMode&&t.primitiveMode!==F.TRIANGLE_LIST)return t;for(var i=[[0,1],[1,2],[2,0]],r=[],n={},o=0;o<e.length;o+=3)for(var s=0;s<3;++s){var a=e[o+i[s][0]],l=e[o+i[s][1]],h=a>l?l<<16|a:a<<16|l;void 0===n[h]&&(n[h]=0,r.push(a,l))}return t.indices=r,t.primitiveMode=F.LINE_LIST,t},wireframe:function(t){for(var e=[[0,1],[1,2],[2,0]],i=[],r={},n=0;n<t.length;n+=3)for(var o=0;o<3;++o){var s=t[n+e[o][0]],a=t[n+e[o][1]],l=s>a?a<<16|s:s<<16|a;void 0===r[l]&&(r[l]=0,i.push(s,a))}return i},invWinding:function(t){for(var e=[],i=0;i<t.length;i+=3)e.push(t[i],t[i+2],t[i+1]);return e},toWavefrontOBJ:function(t,e){if(void 0===e&&(e=1),!t.indices||!t.uvs||!t.normals||void 0!==t.primitiveMode&&t.primitiveMode!==F.TRIANGLE_LIST)return"";for(var i=t.positions,r=t.uvs,n=t.normals,o=t.indices,s=function(t){return o[t]+1+"/"+(o[t]+1)+"/"+(o[t]+1)},a="",l=0;l<i.length;l+=3)a+="v "+i[l]*e+" "+i[l+1]*e+" "+i[l+2]*e+"\n";for(var h=0;h<r.length;h+=2)a+="vt "+r[h]+" "+r[h+1]+"\n";for(var u=0;u<n.length;u+=3)a+="vn "+n[u]+" "+n[u+1]+" "+n[u+2]+"\n";for(var c=0;c<o.length;c+=3)a+="f "+s(c)+" "+s(c+1)+" "+s(c+2)+"\n";return a},normals:function(t,e,i){void 0===i&&(i=1);for(var r=new Array(2*t.length),n=0;n<t.length/3;++n){var o=3*n,s=6*n;r[s+0]=t[o+0],r[s+1]=t[o+1],r[s+2]=t[o+2],r[s+3]=t[o+0]+e[o+0]*i,r[s+4]=t[o+1]+e[o+1]*i,r[s+5]=t[o+2]+e[o+2]*i}return r},applyDefaultGeometryOptions:pj});t("primitives",Nj);var zj=new fi;function Uj(t){return t.x=Math.abs(t.x),t.y=Math.abs(t.y),t.z=Math.abs(t.z),t}var Vj,Hj,Gj,Wj,Xj,Yj,jj,qj,Kj,Zj,Jj,Qj,$j,tq,eq,iq,rq,nq,oq,sq,aq,lq,hq,uq,cq,dq,pq,fq,_q,gq,mq,yq,vq,bq,Sq,Tq,Eq,Aq,Cq,wq,xq,Rq,Mq,Oq,Pq,Dq,Iq,Bq,Lq,Fq,kq,Nq,zq,Uq,Vq,Hq,Gq,Wq,Xq,Yq,jq,qq,Kq,Zq,Jq,Qq,$q,tK,eK,iK,rK,nK,oK,sK,aK,lK,hK,uK,cK,dK,pK,fK,_K,gK,mK,yK,vK,bK,SK,TK,EK,AK,CK,wK,xK,RK,MK,OK,PK,DK,IK,BK,LK,FK,kK,NK,zK,UK,VK,HK,GK,WK,XK,YK,jK,qK,KK,ZK,JK,QK,$K,tZ,eZ,iZ,rZ,nZ,oZ,sZ,aZ,lZ,hZ,uZ,cZ,dZ,pZ,fZ,_Z=Object.freeze({__proto__:null,setWrap:function(t,e){t.__cc_wrapper__=e},getWrap:function(t){return t.__cc_wrapper__},maxComponent:function(t){return Math.max(t.x,Math.max(t.y,t.z))},VEC3_0:zj,TriggerEventObject:{type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},CollisionEventObject:{type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},shrinkPositions:function(t){var e=[];if(t.length>=3){e[0]=t[0],e[1]=t[1],e[2]=t[2];for(var i=t.length,r=3;r<i;r+=3){for(var n=t[r],o=t[r+1],s=t[r+2],a=e.length,l=!0,h=0;h<a;h+=3)if(Kn(n,e[h])&&Kn(o,e[h+1])&&Kn(s,e[h+2])){l=!1;break}l&&(e.push(n),e.push(o),e.push(s))}}return e},absolute:Uj,cylinder:Rj}),gZ=function(e){return t({BoxCollider:e,BoxColliderComponent:e}),e}((Vj=_i("cc.BoxCollider"),Hj=Ni(),Gj=Ui(),Wj=Di(fi),Xj=Vi(),Vj(Yj=Hj(Yj=Gj(Yj=Ii((Kj=function(t){function e(){var e;return e=t.call(this,nX.BOX)||this,Si(e,"_size",qj,Ti(e)),e}return He(e,t),Ge(e,[{key:"size",get:function(){return this._size},set:function(t){fi.strictEquals(this._size,t)||(fi.copy(this._size,t),Uj(this._size),this._shape&&this.shape.updateSize())}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((jj=Kj).prototype,"size",[Wj,Xj],Object.getOwnPropertyDescriptor(jj.prototype,"size"),jj.prototype),qj=bi(jj.prototype,"_size",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(1,1,1)}}),Yj=jj))||Yj)||Yj)||Yj)||Yj)),mZ=function(e){return t({SphereCollider:e,SphereColliderComponent:e}),e}((Zj=_i("cc.SphereCollider"),Jj=Ni(),Qj=Ui(),$j=Vi(),Zj(tq=Jj(tq=Qj(tq=Ii((rq=function(t){function e(){var e;return e=t.call(this,nX.SPHERE)||this,Si(e,"_radius",iq,Ti(e)),e}return He(e,t),Ge(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.updateRadius())}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((eq=rq).prototype,"radius",[$j],Object.getOwnPropertyDescriptor(eq.prototype,"radius"),eq.prototype),iq=bi(eq.prototype,"_radius",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),tq=eq))||tq)||tq)||tq)||tq)),yZ=function(e){return t({CapsuleCollider:e,CapsuleColliderComponent:e}),e}((nq=_i("cc.CapsuleCollider"),oq=Ni(),sq=Ui(),aq=Vi(),lq=Vi(),hq=Di(iX),uq=Vi(),nq(cq=oq(cq=sq(cq=Ii((gq=function(t){function e(){var e;return e=t.call(this,nX.CAPSULE)||this,Si(e,"_radius",pq,Ti(e)),Si(e,"_cylinderHeight",fq,Ti(e)),Si(e,"_direction",_q,Ti(e)),e}He(e,t);var i=e.prototype;return i._getRadiusScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction===iX.Y_AXIS?Math.abs(to(t.x,t.z)):this._direction===iX.X_AXIS?Math.abs(to(t.y,t.z)):Math.abs(to(t.x,t.y))},i._getHeightScale=function(){if(null==this.node)return 1;var t=this.node.worldScale;return this._direction===iX.Y_AXIS?Math.abs(t.y):this._direction===iX.X_AXIS?Math.abs(t.x):Math.abs(t.z)},Ge(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}},{key:"cylinderHeight",get:function(){return this._cylinderHeight},set:function(t){this._cylinderHeight!==t&&(this._cylinderHeight=Math.abs(t),this._shape&&this.shape.setCylinderHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){(t=Math.floor(t))<iX.X_AXIS||t>iX.Z_AXIS||this._direction!==t&&(this._direction=t,this._shape&&this.shape.setDirection(t))}},{key:"height",get:function(){return 2*this._radius+this._cylinderHeight},set:function(t){var e=t-2*this._radius;e<0&&(e=0),this.cylinderHeight=e}},{key:"worldHeight",get:function(){return 2*this._radius*this._getRadiusScale()+this._cylinderHeight*this._getHeightScale()}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((dq=gq).prototype,"radius",[aq],Object.getOwnPropertyDescriptor(dq.prototype,"radius"),dq.prototype),bi(dq.prototype,"cylinderHeight",[lq],Object.getOwnPropertyDescriptor(dq.prototype,"cylinderHeight"),dq.prototype),bi(dq.prototype,"direction",[hq,uq],Object.getOwnPropertyDescriptor(dq.prototype,"direction"),dq.prototype),pq=bi(dq.prototype,"_radius",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),fq=bi(dq.prototype,"_cylinderHeight",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_q=bi(dq.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iX.Y_AXIS}}),cq=dq))||cq)||cq)||cq)||cq)),vZ=function(e){return t({CylinderCollider:e,CylinderColliderComponent:e}),e}((mq=_i("cc.CylinderCollider"),yq=Ni(),vq=Ui(),bq=Vi(),Sq=Vi(),Tq=Di(iX),Eq=Vi(),mq(Aq=yq(Aq=vq(Aq=Ii((Mq=function(t){function e(){var e;return e=t.call(this,nX.CYLINDER)||this,Si(e,"_radius",wq,Ti(e)),Si(e,"_height",xq,Ti(e)),Si(e,"_direction",Rq,Ti(e)),e}return He(e,t),Ge(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(this._height=Math.abs(t),this._shape&&this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(t<iX.X_AXIS||t>iX.Z_AXIS||(this._direction=t,this._shape&&this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((Cq=Mq).prototype,"radius",[bq],Object.getOwnPropertyDescriptor(Cq.prototype,"radius"),Cq.prototype),bi(Cq.prototype,"height",[Sq],Object.getOwnPropertyDescriptor(Cq.prototype,"height"),Cq.prototype),bi(Cq.prototype,"direction",[Tq,Eq],Object.getOwnPropertyDescriptor(Cq.prototype,"direction"),Cq.prototype),wq=bi(Cq.prototype,"_radius",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),xq=bi(Cq.prototype,"_height",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Rq=bi(Cq.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iX.Y_AXIS}}),Aq=Cq))||Aq)||Aq)||Aq)||Aq)),bZ=t("ConeCollider",(Oq=_i("cc.ConeCollider"),Pq=Ni(),Dq=Ui(),Iq=Vi(),Bq=Vi(),Lq=Di(iX),Fq=Vi(),Oq(kq=Pq(kq=Dq(kq=Ii((Hq=function(t){function e(){var e;return e=t.call(this,nX.CONE)||this,Si(e,"_radius",zq,Ti(e)),Si(e,"_height",Uq,Ti(e)),Si(e,"_direction",Vq,Ti(e)),e}return He(e,t),Ge(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius!==t&&(this._radius=Math.abs(t),this._shape&&this.shape.setRadius(t))}},{key:"height",get:function(){return this._height},set:function(t){this._height!==t&&(t<0&&(t=0),this._height=t,this._shape&&this.shape.setHeight(t))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(t<iX.X_AXIS||t>iX.Z_AXIS||(this._direction=t,this._shape&&this.shape.setDirection(t)))}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((Nq=Hq).prototype,"radius",[Iq],Object.getOwnPropertyDescriptor(Nq.prototype,"radius"),Nq.prototype),bi(Nq.prototype,"height",[Bq],Object.getOwnPropertyDescriptor(Nq.prototype,"height"),Nq.prototype),bi(Nq.prototype,"direction",[Lq,Fq],Object.getOwnPropertyDescriptor(Nq.prototype,"direction"),Nq.prototype),zq=bi(Nq.prototype,"_radius",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Uq=bi(Nq.prototype,"_height",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vq=bi(Nq.prototype,"_direction",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iX.Y_AXIS}}),kq=Nq))||kq)||kq)||kq)||kq)),SZ=function(e){return t({MeshCollider:e,MeshColliderComponent:e}),e}((Gq=_i("cc.MeshCollider"),Wq=Ni(),Xq=Ui(),Yq=Di(Ms),jq=Vi(),qq=Vi(),Gq(Kq=Wq(Kq=Xq(Kq=Ii(($q=function(t){function e(){var e;return e=t.call(this,nX.MESH)||this,Si(e,"_mesh",Jq,Ti(e)),Si(e,"_convex",Qq,Ti(e)),e}return He(e,t),Ge(e,[{key:"mesh",get:function(){return this._mesh},set:function(t){this._mesh!==t&&(this._mesh=t,this._shape&&this.shape.setMesh(this._mesh))}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex!==t&&(this._convex=t)}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((Zq=$q).prototype,"mesh",[Yq,jq],Object.getOwnPropertyDescriptor(Zq.prototype,"mesh"),Zq.prototype),bi(Zq.prototype,"convex",[Pi,qq],Object.getOwnPropertyDescriptor(Zq.prototype,"convex"),Zq.prototype),Jq=bi(Zq.prototype,"_mesh",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qq=bi(Zq.prototype,"_convex",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kq=Zq))||Kq)||Kq)||Kq)||Kq)),TZ=t("ConstantForce",(tK=_i("cc.ConstantForce"),eK=Ni(),iK=Gr(cj),rK=Ui(),nK=Ur(),oK=Vi(),sK=Ur(),aK=Vi(),lK=Ur(),hK=Vi(),uK=Ur(),cK=Vi(),tK(dK=eK(dK=iK(dK=rK(dK=Nr(dK=Ii((yK=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._rigidBody=null,Si(e,"_force",fK,Ti(e)),Si(e,"_localForce",_K,Ti(e)),Si(e,"_torque",gK,Ti(e)),Si(e,"_localTorque",mK,Ti(e)),e._mask=0,e}He(e,t);var i=e.prototype;return i.onLoad=function(){this._rigidBody=this.node.getComponent(cj),this._maskUpdate(this._force,1),this._maskUpdate(this._localForce,2),this._maskUpdate(this._torque,4),this._maskUpdate(this._localTorque,8)},i.lateUpdate=function(){null!=this._rigidBody&&0!==this._mask&&(1&this._mask&&this._rigidBody.applyForce(this._force),2&this._mask&&this._rigidBody.applyLocalForce(this.localForce),4&this._mask&&this._rigidBody.applyTorque(this._torque),8&this._mask&&this._rigidBody.applyLocalTorque(this._localTorque))},i._maskUpdate=function(t,e){t.strictEquals(fi.ZERO)?this._mask&=~e:this._mask|=e},Ge(e,[{key:"force",get:function(){return this._force},set:function(t){fi.copy(this._force,t),this._maskUpdate(this._force,1)}},{key:"localForce",get:function(){return this._localForce},set:function(t){fi.copy(this._localForce,t),this._maskUpdate(this.localForce,2)}},{key:"torque",get:function(){return this._torque},set:function(t){fi.copy(this._torque,t),this._maskUpdate(this._torque,4)}},{key:"localTorque",get:function(){return this._localTorque},set:function(t){fi.copy(this._localTorque,t),this._maskUpdate(this._localTorque,8)}}]),e}($i),fK=bi((pK=yK).prototype,"_force",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),_K=bi(pK.prototype,"_localForce",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),gK=bi(pK.prototype,"_torque",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),mK=bi(pK.prototype,"_localTorque",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),bi(pK.prototype,"force",[nK,oK],Object.getOwnPropertyDescriptor(pK.prototype,"force"),pK.prototype),bi(pK.prototype,"localForce",[sK,aK],Object.getOwnPropertyDescriptor(pK.prototype,"localForce"),pK.prototype),bi(pK.prototype,"torque",[lK,hK],Object.getOwnPropertyDescriptor(pK.prototype,"torque"),pK.prototype),bi(pK.prototype,"localTorque",[uK,cK],Object.getOwnPropertyDescriptor(pK.prototype,"localTorque"),pK.prototype),dK=pK))||dK)||dK)||dK)||dK)||dK)||dK)),EZ=16842754,AZ=16842755,CZ=16842756,wZ=16842757,xZ=16843025,RZ=function(){function t(){this.length=0,this.buffer=new Uint8Array(2048),this._buffView=new DataView(this.buffer.buffer),this._seekPos=0}var e=t.prototype;return e.reserve=function(t){if(!(this.buffer.byteLength>t)){for(var e=this.buffer.byteLength;e<t;)e+=e;for(var i=new Uint8Array(e),r=0;r<this.length;++r)i[r]=this.buffer[r];this.buffer=i,this._buffView=new DataView(this.buffer.buffer)}},e.assign=function(t){this.buffer=t,this.length=t.length,this._seekPos=t.byteOffset,this._buffView=new DataView(t.buffer)},e.writeInt8=function(t){this.reserve(this.length+1),this._buffView.setInt8(this.length,t),this.length+=1},e.writeInt16=function(t){this.reserve(this.length+2),this._buffView.setInt16(this.length,t,!0),this.length+=2},e.writeInt32=function(t){this.reserve(this.length+4),this._buffView.setInt32(this.length,t,!0),this.length+=4},e.writeIntArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setInt32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeFloat=function(t){this.reserve(this.length+4),this._buffView.setFloat32(this.length,t,!0),this.length+=4},e.writeFloatArray=function(t){this.reserve(this.length+4*t.length);for(var e=0;e<t.length;++e)this._buffView.setFloat32(this.length+4*e,t[e],!0);this.length+=4*t.length},e.writeString=function(t){this.reserve(this.length+t.length+4),this._buffView.setInt32(this.length,t.length,!0);for(var e=0;e<t.length;++e)this._buffView.setInt8(this.length+4+e,t.charCodeAt(e));this.length+=t.length+4},e.readInt8=function(){var t=this._buffView.getInt8(this._seekPos);return this._seekPos+=1,t},e.readInt16=function(){var t=this._buffView.getInt16(this._seekPos,!0);return this._seekPos+=2,t},e.readInt=function(){var t=this._buffView.getInt32(this._seekPos,!0);return this._seekPos+=4,t},e.readIntArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getInt32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readFloat=function(){var t=this._buffView.getFloat32(this._seekPos,!0);return this._seekPos+=4,t},e.readFloatArray=function(t){for(var e=0;e<t.length;++e)t[e]=this._buffView.getFloat32(this._seekPos+4*e,!0);return this._seekPos+=4*t.length,t},e.readString=function(){for(var t=this.readInt(),e="",i=0;i<t;++i)e+=String.fromCharCode(this.readInt8());return e},t}(),MZ=(_i("cc.TerrainLayerInfo")((bK=bi((vK=function(){Si(this,"slot",bK,this),Si(this,"tileSize",SK,this),Si(this,"detailMap",TK,this),Si(this,"normalMap",EK,this),Si(this,"roughness",AK,this),Si(this,"metallic",CK,this)}).prototype,"slot",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),SK=bi(vK.prototype,"tileSize",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),TK=bi(vK.prototype,"detailMap",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EK=bi(vK.prototype,"normalMap",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AK=bi(vK.prototype,"roughness",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),CK=bi(vK.prototype,"metallic",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vK)),_i("cc.TerrainLayerBinaryInfo")(wK=function(){this.slot=0,this.tileSize=1,this.roughness=1,this.metallic=0,this.detailMapId="",this.normalMapId=""})||wK),OZ=_i("cc.TerrainAsset")((OK=function(t){function e(){var e;return(e=t.call(this)||this)._version=0,e._data=null,e._tileSize=1,e._blockCount=[1,1],e._weightMapSize=128,e._lightMapSize=128,e._heights=new Uint16Array,e._weights=new Uint8Array,e._layerBuffer=[-1,-1,-1,-1],e._layerBinaryInfos=[],Si(e,"_layerInfos",MK,Ti(e)),e}He(e,t);var i=e.prototype;return i.getLayer=function(t,e,i){var r=4*(e*this.blockCount[0]+t)+i;return t<this.blockCount[0]&&e<this.blockCount[1]&&r<this._layerBuffer.length?this._layerBuffer[r]:-1},i.getHeight=function(t,e){var i=32*this._blockCount[0]+1;return.001953125*(this._heights[e*i+t]-32768)},i.getVertexCountI=function(){return this._blockCount.length<1?0:32*this._blockCount[0]+1},i.getVertexCountJ=function(){return this._blockCount.length<2?0:32*this._blockCount[1]+1},i._setNativeData=function(t){this._data=t},i._loadNativeData=function(t){if(!t||0===t.length)return!1;var e=new RZ;if(e.assign(t),this._version=e.readInt(),this._version===xZ)return!0;if(16842753!==this._version&&this._version!==EZ&&this._version!==AZ&&this._version!==CZ&&this._version!==wZ)return!1;this.tileSize=e.readFloat(),e.readIntArray(this._blockCount),this.weightMapSize=e.readInt16(),this.lightMapSize=e.readInt16();var i=e.readInt();this.heights=new Uint16Array(i);for(var r=0;r<this.heights.length;++r)this.heights[r]=e.readInt16();var n=e.readInt();this.weights=new Uint8Array(n);for(var o=0;o<this.weights.length;++o)this.weights[o]=e.readInt8();if(this._version>=EZ){var s=e.readInt();this.layerBuffer=new Array(s);for(var a=0;a<this.layerBuffer.length;++a)this.layerBuffer[a]=e.readInt16()}if(this._version>=AZ){var l=e.readInt();this._layerBinaryInfos=new Array(l);for(var h=0;h<this._layerBinaryInfos.length;++h)this._layerBinaryInfos[h]=new MZ,this._layerBinaryInfos[h].slot=e.readInt(),this._layerBinaryInfos[h].tileSize=e.readFloat(),this._layerBinaryInfos[h].detailMapId=e.readString(),this._version>=CZ&&(this._layerBinaryInfos[h].normalMapId=e.readString(),this._layerBinaryInfos[h].roughness=e.readFloat(),this._layerBinaryInfos[h].metallic=e.readFloat())}return!0},i._exportNativeData=function(){var t=new RZ;t.writeInt32(wZ),t.writeFloat(this.tileSize),t.writeIntArray(this._blockCount),t.writeInt16(this.weightMapSize),t.writeInt16(this.lightMapSize),t.writeInt32(this.heights.length);for(var e=0;e<this.heights.length;++e)t.writeInt16(this.heights[e]);t.writeInt32(this.weights.length);for(var i=0;i<this.weights.length;++i)t.writeInt8(this.weights[i]);t.writeInt32(this.layerBuffer.length);for(var r=0;r<this.layerBuffer.length;++r)t.writeInt16(this.layerBuffer[r]);var n=[];n.length=this.layerInfos.length;for(var o=0;o<n.length;++o){var s=this.layerInfos[o],a=new MZ;a.slot=o,a.tileSize=s.tileSize,a.detailMapId=s.detailMap?s.detailMap._uuid:"",a.normalMapId=s.normalMap?s.normalMap._uuid:"",a.metallic=s.metallic,a.roughness=s.roughness,n[o]=a}t.writeInt32(n.length);for(var l=0;l<n.length;++l)t.writeInt32(n[l].slot),t.writeFloat(n[l].tileSize),t.writeString(n[l].detailMapId),t.writeString(n[l].normalMapId),t.writeFloat(n[l].roughness),t.writeFloat(n[l].metallic);return t.buffer},i._exportDefaultNativeData=function(){var t=new RZ;return t.writeInt32(xZ),t.buffer},Ge(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data&&this._data.byteLength===t.byteLength?this._data.set(new Uint8Array(t)):this._data=new Uint8Array(t),this._loadNativeData(this._data)}},{key:"version",get:function(){return this._version}},{key:"tileSize",get:function(){return this._tileSize},set:function(t){this._tileSize=t}},{key:"blockCount",get:function(){return this._blockCount},set:function(t){this._blockCount=t}},{key:"lightMapSize",get:function(){return this._lightMapSize},set:function(t){this._lightMapSize=t}},{key:"weightMapSize",get:function(){return this._weightMapSize},set:function(t){this._weightMapSize=t}},{key:"heights",get:function(){return this._heights},set:function(t){this._heights=t}},{key:"weights",get:function(){return this._weights},set:function(t){this._weights=t}},{key:"layerBuffer",get:function(){return this._layerBuffer},set:function(t){this._layerBuffer=t}},{key:"layerInfos",get:function(){return this._layerInfos},set:function(t){this._layerInfos=t}},{key:"layerBinaryInfos",get:function(){return this._layerBinaryInfos}}]),e}(vi),MK=bi((RK=OK).prototype,"_layerInfos",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xK=RK))||xK,PZ=t("TerrainCollider",(PK=_i("cc.TerrainCollider"),DK=Ni(),IK=Ui(),BK=Di(OZ),LK=Vi(),PK(FK=DK(FK=IK(FK=Ii((zK=function(t){function e(){var e;return e=t.call(this,nX.TERRAIN)||this,Si(e,"_terrain",NK,Ti(e)),e}return He(e,t),Ge(e,[{key:"terrain",get:function(){return this._terrain},set:function(t){this._terrain=t,this._shape&&this.shape.setTerrain(this._terrain)}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((kK=zK).prototype,"terrain",[BK,LK],Object.getOwnPropertyDescriptor(kK.prototype,"terrain"),kK.prototype),NK=bi(kK.prototype,"_terrain",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FK=kK))||FK)||FK)||FK)||FK)),DZ=t("SimplexCollider",(UK=_i("cc.SimplexCollider"),VK=Ni(),HK=Ui(),GK=Di(rX),WK=Vi(),XK=Vi(),YK=Hi(),jK=Vi(),qK=Hi(),KK=Vi(),ZK=Hi(),JK=Vi(),UK(QK=VK(QK=HK(QK=Ii((rZ=iZ=function(t){function e(){var e;return e=t.call(this,nX.SIMPLEX)||this,Si(e,"_shapeType",tZ,Ti(e)),Si(e,"_vertices",eZ,Ti(e)),e}return He(e,t),e.prototype.updateVertices=function(){this._shape&&this.shape.setVertices(this._vertices)},Ge(e,[{key:"shapeType",get:function(){return this._shapeType},set:function(t){this._shapeType=t,this._shape&&this.shape.setShapeType(t)}},{key:"vertex0",get:function(){return this._vertices[0]},set:function(t){fi.copy(this._vertices[0],t),this.updateVertices()}},{key:"vertex1",get:function(){return this._vertices[1]},set:function(t){fi.copy(this._vertices[1],t),this.updateVertices()}},{key:"vertex2",get:function(){return this._vertices[2]},set:function(t){fi.copy(this._vertices[2],t),this.updateVertices()}},{key:"vertex3",get:function(){return this._vertices[3]},set:function(t){fi.copy(this._vertices[3],t),this.updateVertices()}},{key:"shape",get:function(){return this._shape}},{key:"vertices",get:function(){return this._vertices}}]),e}(dj),iZ.ESimplexType=rX,bi(($K=rZ).prototype,"shapeType",[GK,WK],Object.getOwnPropertyDescriptor($K.prototype,"shapeType"),$K.prototype),bi($K.prototype,"vertex0",[Pi,XK],Object.getOwnPropertyDescriptor($K.prototype,"vertex0"),$K.prototype),bi($K.prototype,"vertex1",[YK,jK],Object.getOwnPropertyDescriptor($K.prototype,"vertex1"),$K.prototype),bi($K.prototype,"vertex2",[qK,KK],Object.getOwnPropertyDescriptor($K.prototype,"vertex2"),$K.prototype),bi($K.prototype,"vertex3",[ZK,JK],Object.getOwnPropertyDescriptor($K.prototype,"vertex3"),$K.prototype),tZ=bi($K.prototype,"_shapeType",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rX.TETRAHEDRON}}),eZ=bi($K.prototype,"_vertices",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new fi(0,0,0),new fi(0,0,1),new fi(1,0,0),new fi(0,1,0)]}}),QK=$K))||QK)||QK)||QK)||QK));DZ||(DZ=t("SimplexCollider",{}));var IZ,BZ,LZ,FZ,kZ,NZ,zZ,UZ,VZ,HZ,GZ,WZ,XZ,YZ,jZ,qZ,KZ,ZZ,JZ,QZ,$Z,tJ,eJ,iJ,rJ,nJ,oJ,sJ,aJ,lJ=t("PlaneCollider",(nZ=_i("cc.PlaneCollider"),oZ=Ni(),sZ=Ui(),aZ=Di(fi),lZ=Vi(),hZ=Vi(),nZ(uZ=oZ(uZ=sZ(uZ=Ii((fZ=function(t){function e(){var e;return e=t.call(this,nX.PLANE)||this,Si(e,"_normal",dZ,Ti(e)),Si(e,"_constant",pZ,Ti(e)),e}return He(e,t),Ge(e,[{key:"normal",get:function(){return this._normal},set:function(t){fi.strictEquals(this._normal,t)||(fi.copy(this._normal,t),this._shape&&this.shape.setNormal(this._normal))}},{key:"constant",get:function(){return this._constant},set:function(t){this._constant!==t&&(this._constant=t,this._shape&&this.shape.setConstant(this._constant))}},{key:"shape",get:function(){return this._shape}}]),e}(dj),bi((cZ=fZ).prototype,"normal",[aZ,lZ],Object.getOwnPropertyDescriptor(cZ.prototype,"normal"),cZ.prototype),bi(cZ.prototype,"constant",[Pi,hZ],Object.getOwnPropertyDescriptor(cZ.prototype,"constant"),cZ.prototype),dZ=bi(cZ.prototype,"_normal",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi(0,1,0)}}),pZ=bi(cZ.prototype,"_constant",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uZ=cZ))||uZ)||uZ)||uZ)||uZ)),hJ=t("Constraint",(IZ=_i("cc.Constraint"),BZ=Gr(cj),LZ=Di(cj),FZ=Ur(),kZ=Di(cj),NZ=Ur(),zZ=Ur(),UZ=Di(cj),IZ(VZ=BZ((YZ=XZ=function(t){function e(e){var i;return(i=t.call(this)||this).TYPE=void 0,Si(i,"_enableCollision",GZ,Ti(i)),Si(i,"_connectedBody",WZ,Ti(i)),i._constraint=null,i.TYPE=e,i}He(e,t);var i=e.prototype;return i.onLoad=function(){CX.runInEditor&&(this._constraint=function(t){return VX.INITED||(VX.INITED=!0,VX[oX.POINT_TO_POINT]=function(){return RX(CX.wrapper.PointToPointConstraint,AX.PointToPointConstraint)?HX:new CX.wrapper.PointToPointConstraint},VX[oX.HINGE]=function(){return RX(CX.wrapper.HingeConstraint,AX.HingeConstraint)?HX:new CX.wrapper.HingeConstraint},VX[oX.CONE_TWIST]=function(){return RX(CX.wrapper.ConeTwistConstraint,AX.ConeTwistConstraint)?HX:new CX.wrapper.ConeTwistConstraint}),VX[t]()}(this.TYPE),this._constraint.initialize(this))},i.onEnable=function(){this._constraint&&this._constraint.onEnable()},i.onDisable=function(){this._constraint&&this._constraint.onDisable()},i.onDestroy=function(){this._constraint&&this._constraint.onDestroy()},Ge(e,[{key:"attachedBody",get:function(){return this.getComponent(cj)}},{key:"connectedBody",get:function(){return this._connectedBody},set:function(t){this._connectedBody=t,this._constraint&&this._constraint.setConnectedBody(t)}},{key:"enableCollision",get:function(){return this._enableCollision},set:function(t){this._enableCollision=t,this._constraint&&this._constraint.setEnableCollision(t)}}]),e}(Jn($i)),XZ.Type=oX,bi((HZ=YZ).prototype,"attachedBody",[LZ,Qn,FZ],Object.getOwnPropertyDescriptor(HZ.prototype,"attachedBody"),HZ.prototype),bi(HZ.prototype,"connectedBody",[kZ,NZ],Object.getOwnPropertyDescriptor(HZ.prototype,"connectedBody"),HZ.prototype),bi(HZ.prototype,"enableCollision",[zZ],Object.getOwnPropertyDescriptor(HZ.prototype,"enableCollision"),HZ.prototype),GZ=bi(HZ.prototype,"_enableCollision",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),WZ=bi(HZ.prototype,"_connectedBody",[UZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VZ=HZ))||VZ)||VZ));hJ||(hJ=t("Constraint",{}));var uJ,cJ,dJ,pJ,fJ,_J,gJ,mJ,yJ,vJ,bJ=t("HingeConstraint",(jZ=_i("cc.HingeConstraint"),qZ=Ni(),KZ=Ui(),ZZ=Di(fi),JZ=Di(fi),QZ=Di(fi),$Z=Oi("axisA"),tJ=Oi("pivotA"),eJ=Oi("pivotB"),jZ(iJ=qZ(iJ=KZ((aJ=function(t){function e(){var e;return e=t.call(this,oX.HINGE)||this,Si(e,"_axis",nJ,Ti(e)),Si(e,"_pivotA",oJ,Ti(e)),Si(e,"_pivotB",sJ,Ti(e)),e}return He(e,t),Ge(e,[{key:"pivotA",get:function(){return this._pivotA},set:function(t){fi.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}},{key:"pivotB",get:function(){return this._pivotB},set:function(t){fi.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}},{key:"axis",get:function(){return this._axis},set:function(t){fi.copy(this._axis,t),this.constraint.setAxis(this._axis)}},{key:"constraint",get:function(){return this._constraint}}]),e}(hJ),bi((rJ=aJ).prototype,"pivotA",[ZZ],Object.getOwnPropertyDescriptor(rJ.prototype,"pivotA"),rJ.prototype),bi(rJ.prototype,"pivotB",[JZ],Object.getOwnPropertyDescriptor(rJ.prototype,"pivotB"),rJ.prototype),bi(rJ.prototype,"axis",[QZ],Object.getOwnPropertyDescriptor(rJ.prototype,"axis"),rJ.prototype),nJ=bi(rJ.prototype,"_axis",[Ai,$Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),oJ=bi(rJ.prototype,"_pivotA",[Ai,tJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),sJ=bi(rJ.prototype,"_pivotB",[Ai,eJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),iJ=rJ))||iJ)||iJ)||iJ)),SJ=t("PointToPointConstraint",(uJ=_i("cc.PointToPointConstraint"),cJ=Ni(),dJ=Ui(),pJ=Di(fi),fJ=Di(fi),uJ(_J=cJ(_J=dJ((vJ=function(t){function e(){var e;return e=t.call(this,oX.POINT_TO_POINT)||this,Si(e,"_pivotA",mJ,Ti(e)),Si(e,"_pivotB",yJ,Ti(e)),e}return He(e,t),Ge(e,[{key:"pivotA",get:function(){return this._pivotA},set:function(t){fi.copy(this._pivotA,t),this.constraint.setPivotA(this._pivotA)}},{key:"pivotB",get:function(){return this._pivotB},set:function(t){fi.copy(this._pivotB,t),this.constraint.setPivotB(this._pivotB)}},{key:"constraint",get:function(){return this._constraint}}]),e}(hJ),bi((gJ=vJ).prototype,"pivotA",[pJ],Object.getOwnPropertyDescriptor(gJ.prototype,"pivotA"),gJ.prototype),bi(gJ.prototype,"pivotB",[fJ],Object.getOwnPropertyDescriptor(gJ.prototype,"pivotB"),gJ.prototype),mJ=bi(gJ.prototype,"_pivotA",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),yJ=bi(gJ.prototype,"_pivotB",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),_J=gJ))||_J)||_J)||_J));ei.PhysicsSystem=HY,ei.PhysicsMaterial=KX,ei.PhysicsRayResult=ZX,ei.ConstantForce=TZ;var TJ,EJ,AJ,CJ,wJ,xJ,RJ,MJ,OJ,PJ=Object.freeze({__proto__:null,PhysicsSystem:HY,PhysicsRayResult:ZX,get Collider(){return dj},BoxCollider:gZ,SphereCollider:mZ,CapsuleCollider:yZ,MeshCollider:SZ,CylinderCollider:vZ,ConeCollider:bZ,TerrainCollider:PZ,get SimplexCollider(){return DZ},PlaneCollider:lJ,get Constraint(){return hJ},HingeConstraint:bJ,PointToPointConstraint:SJ,get RigidBody(){return cj},PhysicsMaterial:KX,ConstantForce:TZ,selector:CX,utils:_Z,get ERigidBodyType(){return eX},get EAxisDirection(){return iX},get ESimplexType(){return rX},get EColliderType(){return nX},get EConstraintType(){return oX},get PhysicsGroup(){return sX}});t("physics",PJ),Xi(HY,"PhysicsSystem",[{name:"ins",newName:"instance"}]),Xi(HY.prototype,"PhysicsSystem.prototype",[{name:"deltaTime",newName:"fixedTimeStep"},{name:"maxSubStep",newName:"maxSubSteps"}]),Yi(HY.prototype,"PhysicsSystem.prototype",[{name:"useFixedTime"},{name:"useCollisionMatrix"},{name:"updateCollisionMatrix"},{name:"resetCollisionMatrix"},{name:"isCollisionGroup"},{name:"setCollisionGroup"}]),Xi(dj.prototype,"Collider.prototype",[{name:"attachedRigidbody",newName:"attachedRigidBody"},{name:"TYPE",newName:"type"}]),Xi(dj,"Collider",[{name:"EColliderType",newName:"Type"},{name:"EAxisDirection",newName:"Axis"}]),Xi(hJ,"Constraint",[{name:"EConstraintType",newName:"Type"}]),Xi(gZ.prototype,"BoxCollider.prototype",[{name:"boxShape",newName:"shape"}]),Xi(mZ.prototype,"SphereCollider.prototype",[{name:"sphereShape",newName:"shape"}]),Xi(yZ.prototype,"CapsuleCollider.prototype",[{name:"capsuleShape",newName:"shape"}]),Xi(cj.prototype,"RigidBody.prototype",[{name:"rigidBody",newName:"body"}]),Xi(cj,"RigidBody",[{name:"ERigidBodyType",newName:"Type"}]),Yi(cj.prototype,"RigidBody.prototype",[{name:"fixedRotation"}]),ei.RigidBodyComponent=cj,qi.setClassAlias(cj,"cc.RigidBodyComponent"),ei.ColliderComponent=dj,qi.setClassAlias(dj,"cc.ColliderComponent"),ei.BoxColliderComponent=gZ,qi.setClassAlias(gZ,"cc.BoxColliderComponent"),ei.SphereColliderComponent=mZ,qi.setClassAlias(mZ,"cc.SphereColliderComponent"),qi.setClassAlias(yZ,"cc.CapsuleColliderComponent"),qi.setClassAlias(SZ,"cc.MeshColliderComponent"),qi.setClassAlias(vZ,"cc.CylinderColliderComponent"),ei.PhysicMaterial=KX,qi.setClassAlias(KX,"cc.PhysicMaterial"),ei.physics=PJ,function(t){t[t.BODY_RE_ADD=1]="BODY_RE_ADD",t[t.GHOST_RE_ADD=2]="GHOST_RE_ADD"}(TJ||(TJ={})),function(t){t[t.CF_STATIC_OBJECT=1]="CF_STATIC_OBJECT",t[t.CF_KINEMATIC_OBJECT=2]="CF_KINEMATIC_OBJECT",t[t.CF_NO_CONTACT_RESPONSE=4]="CF_NO_CONTACT_RESPONSE",t[t.CF_CUSTOM_MATERIAL_CALLBACK=8]="CF_CUSTOM_MATERIAL_CALLBACK",t[t.CF_CHARACTER_OBJECT=16]="CF_CHARACTER_OBJECT",t[t.CF_DISABLE_VISUALIZE_OBJECT=32]="CF_DISABLE_VISUALIZE_OBJECT",t[t.CF_DISABLE_SPU_COLLISION_PROCESSING=64]="CF_DISABLE_SPU_COLLISION_PROCESSING"}(EJ||(EJ={})),qn.AmmoCollisionFlags=EJ,function(t){t[t.CO_COLLISION_OBJECT=1]="CO_COLLISION_OBJECT",t[t.CO_RIGID_BODY=2]="CO_RIGID_BODY",t[t.CO_GHOST_OBJECT=4]="CO_GHOST_OBJECT",t[t.CO_SOFT_BODY=8]="CO_SOFT_BODY",t[t.CO_HF_FLUID=16]="CO_HF_FLUID",t[t.CO_USER_TYPE=32]="CO_USER_TYPE",t[t.CO_FEATHERSTONE_LINK=64]="CO_FEATHERSTONE_LINK"}(AJ||(AJ={})),qn.AmmoCollisionObjectTypes=AJ,function(t){t[t.ACTIVE_TAG=1]="ACTIVE_TAG",t[t.ISLAND_SLEEPING=2]="ISLAND_SLEEPING",t[t.WANTS_DEACTIVATION=3]="WANTS_DEACTIVATION",t[t.DISABLE_DEACTIVATION=4]="DISABLE_DEACTIVATION",t[t.DISABLE_SIMULATION=5]="DISABLE_SIMULATION"}(CJ||(CJ={})),function(t){t[t.CF_ANISOTROPIC_FRICTION_DISABLED=0]="CF_ANISOTROPIC_FRICTION_DISABLED",t[t.CF_ANISOTROPIC_FRICTION=1]="CF_ANISOTROPIC_FRICTION",t[t.CF_ANISOTROPIC_ROLLING_FRICTION=2]="CF_ANISOTROPIC_ROLLING_FRICTION"}(wJ||(wJ={})),qn.AmmoAnisotropicFrictionFlags=wJ,function(t){t[t.BT_DISABLE_WORLD_GRAVITY=1]="BT_DISABLE_WORLD_GRAVITY",t[t.BT_ENABLE_GYROPSCOPIC_FORCE=2]="BT_ENABLE_GYROPSCOPIC_FORCE"}(xJ||(xJ={})),qn.AmmoRigidBodyFlags=xJ,function(t){t[t.BOX_SHAPE_PROXYTYPE=0]="BOX_SHAPE_PROXYTYPE",t[t.TRIANGLE_SHAPE_PROXYTYPE=1]="TRIANGLE_SHAPE_PROXYTYPE",t[t.TETRAHEDRAL_SHAPE_PROXYTYPE=2]="TETRAHEDRAL_SHAPE_PROXYTYPE",t[t.CONVEX_TRIANGLEMESH_SHAPE_PROXYTYPE=3]="CONVEX_TRIANGLEMESH_SHAPE_PROXYTYPE",t[t.CONVEX_HULL_SHAPE_PROXYTYPE=4]="CONVEX_HULL_SHAPE_PROXYTYPE",t[t.CONVEX_POINT_CLOUD_SHAPE_PROXYTYPE=5]="CONVEX_POINT_CLOUD_SHAPE_PROXYTYPE",t[t.CUSTOM_POLYHEDRAL_SHAPE_TYPE=6]="CUSTOM_POLYHEDRAL_SHAPE_TYPE",t[t.IMPLICIT_CONVEX_SHAPES_START_HERE=7]="IMPLICIT_CONVEX_SHAPES_START_HERE",t[t.SPHERE_SHAPE_PROXYTYPE=8]="SPHERE_SHAPE_PROXYTYPE",t[t.MULTI_SPHERE_SHAPE_PROXYTYPE=9]="MULTI_SPHERE_SHAPE_PROXYTYPE",t[t.CAPSULE_SHAPE_PROXYTYPE=10]="CAPSULE_SHAPE_PROXYTYPE",t[t.CONE_SHAPE_PROXYTYPE=11]="CONE_SHAPE_PROXYTYPE",t[t.CONVEX_SHAPE_PROXYTYPE=12]="CONVEX_SHAPE_PROXYTYPE",t[t.CYLINDER_SHAPE_PROXYTYPE=13]="CYLINDER_SHAPE_PROXYTYPE",t[t.UNIFORM_SCALING_SHAPE_PROXYTYPE=14]="UNIFORM_SCALING_SHAPE_PROXYTYPE",t[t.MINKOWSKI_SUM_SHAPE_PROXYTYPE=15]="MINKOWSKI_SUM_SHAPE_PROXYTYPE",t[t.MINKOWSKI_DIFFERENCE_SHAPE_PROXYTYPE=16]="MINKOWSKI_DIFFERENCE_SHAPE_PROXYTYPE",t[t.BOX_2D_SHAPE_PROXYTYPE=17]="BOX_2D_SHAPE_PROXYTYPE",t[t.CONVEX_2D_SHAPE_PROXYTYPE=18]="CONVEX_2D_SHAPE_PROXYTYPE",t[t.CUSTOM_CONVEX_SHAPE_TYPE=19]="CUSTOM_CONVEX_SHAPE_TYPE",t[t.CONCAVE_SHAPES_START_HERE=20]="CONCAVE_SHAPES_START_HERE",t[t.TRIANGLE_MESH_SHAPE_PROXYTYPE=21]="TRIANGLE_MESH_SHAPE_PROXYTYPE",t[t.SCALED_TRIANGLE_MESH_SHAPE_PROXYTYPE=22]="SCALED_TRIANGLE_MESH_SHAPE_PROXYTYPE",t[t.FAST_CONCAVE_MESH_PROXYTYPE=23]="FAST_CONCAVE_MESH_PROXYTYPE",t[t.TERRAIN_SHAPE_PROXYTYPE=24]="TERRAIN_SHAPE_PROXYTYPE",t[t.GIMPACT_SHAPE_PROXYTYPE=25]="GIMPACT_SHAPE_PROXYTYPE",t[t.MULTIMATERIAL_TRIANGLE_MESH_PROXYTYPE=26]="MULTIMATERIAL_TRIANGLE_MESH_PROXYTYPE",t[t.EMPTY_SHAPE_PROXYTYPE=27]="EMPTY_SHAPE_PROXYTYPE",t[t.STATIC_PLANE_PROXYTYPE=28]="STATIC_PLANE_PROXYTYPE",t[t.CUSTOM_CONCAVE_SHAPE_TYPE=29]="CUSTOM_CONCAVE_SHAPE_TYPE",t[t.CONCAVE_SHAPES_END_HERE=30]="CONCAVE_SHAPES_END_HERE",t[t.COMPOUND_SHAPE_PROXYTYPE=31]="COMPOUND_SHAPE_PROXYTYPE",t[t.SOFTBODY_SHAPE_PROXYTYPE=32]="SOFTBODY_SHAPE_PROXYTYPE",t[t.HFFLUID_SHAPE_PROXYTYPE=33]="HFFLUID_SHAPE_PROXYTYPE",t[t.HFFLUID_BUOYANT_CONVEX_SHAPE_PROXYTYPE=34]="HFFLUID_BUOYANT_CONVEX_SHAPE_PROXYTYPE",t[t.INVALID_SHAPE_PROXYTYPE=35]="INVALID_SHAPE_PROXYTYPE",t[t.MAX_BROADPHASE_COLLISION_TYPES=36]="MAX_BROADPHASE_COLLISION_TYPES"}(RJ||(RJ={})),qn.AmmoBroadphaseNativeTypes=RJ,function(t){t[t.DefaultFilter=1]="DefaultFilter",t[t.StaticFilter=2]="StaticFilter",t[t.KinematicFilter=4]="KinematicFilter",t[t.DebrisFilter=8]="DebrisFilter",t[t.SensorTrigger=16]="SensorTrigger",t[t.CharacterFilter=32]="CharacterFilter",t[t.AllFilter=-1]="AllFilter"}(MJ||(MJ={})),qn.AmmoCollisionFilterGroups=MJ,function(t){t[t.CD_STATIC_STATIC_REPORTED=1]="CD_STATIC_STATIC_REPORTED",t[t.CD_USE_RELATIVE_CONTACT_BREAKING_THRESHOLD=2]="CD_USE_RELATIVE_CONTACT_BREAKING_THRESHOLD",t[t.CD_DISABLE_CONTACTPOOL_DYNAMIC_ALLOCATION=4]="CD_DISABLE_CONTACTPOOL_DYNAMIC_ALLOCATION"}(OJ||(OJ={})),qn.AmmoDispatcherFlags=OJ;var DJ={type:"onTriggerEnter",selfCollider:null,otherCollider:null,impl:null},IJ={type:"onCollisionEnter",selfCollider:null,otherCollider:null,contacts:[],impl:null},BJ=function(){function t(){this.EMPTY_SHAPE=new qn.btEmptyShape,this.TRANSFORM=new qn.btTransform,this.TRANSFORM_1=new qn.btTransform,this.VECTOR3_0=new qn.btVector3,this.VECTOR3_1=new qn.btVector3,this.QUAT_0=new qn.btQuaternion}return t.isNotEmptyShape=function(t){return t!==this.instance.EMPTY_SHAPE},Ge(t,null,[{key:"instance",get:function(){return null==t._instance&&(t._instance=new t),t._instance}}]),t}();BJ._instance=void 0;var LJ=new fi,FJ=new fi,kJ=new yi,NJ=LJ,zJ=FJ,UJ=function(){var t=e.prototype;function e(){this.id=void 0,this._isEnabled=!1,this._isUsingCCD=!1,this.id=e.idCounter++}return t.setMass=function(t){if(this._rigidBody.isDynamic){var e=this._sharedBody.bodyStruct.localInertia;e.setValue(1.6666666269302368,1.6666666269302368,1.6666666269302368);var i=this.impl.getCollisionShape();i.isCompound()?this._sharedBody.bodyCompoundShape.getNumChildShapes()>0&&i.calculateLocalInertia(this._rigidBody.mass,e):i.calculateLocalInertia(this._rigidBody.mass,e),this.impl.setMassProps(t,e),this._wakeUpIfSleep(),this._sharedBody.dirty|=TJ.BODY_RE_ADD}},t.setType=function(t){this._sharedBody.setType(t)},t.setLinearDamping=function(){this.impl.setDamping(this._rigidBody.linearDamping,this._rigidBody.angularDamping)},t.setAngularDamping=function(){this.impl.setDamping(this._rigidBody.linearDamping,this._rigidBody.angularDamping)},t.useGravity=function(t){if(this._rigidBody.isDynamic){var e=this.impl.getFlags();t?e&=~xJ.BT_DISABLE_WORLD_GRAVITY:(this.impl.setGravity(GX(BJ.instance.VECTOR3_0,fi.ZERO)),e|=xJ.BT_DISABLE_WORLD_GRAVITY),this.impl.setFlags(e),this._wakeUpIfSleep(),this._sharedBody.dirty|=TJ.BODY_RE_ADD}},t.useCCD=function(t){this.impl.setCcdMotionThreshold(t?.01:0),this.impl.setCcdSweptSphereRadius(t?.1:0),this._isUsingCCD=t},t.isUsingCCD=function(){return this._isUsingCCD},t.setLinearFactor=function(t){this.impl.setLinearFactor(GX(BJ.instance.VECTOR3_0,t)),this._wakeUpIfSleep()},t.setAngularFactor=function(t){this.impl.setAngularFactor(GX(BJ.instance.VECTOR3_0,t)),this._wakeUpIfSleep()},t.setAllowSleep=function(t){this._rigidBody.isDynamic&&(t?this.impl.forceActivationState(CJ.ACTIVE_TAG):this.impl.forceActivationState(CJ.DISABLE_DEACTIVATION),this._wakeUpIfSleep())},t.clearState=function(){this.impl.clearState()},t.clearVelocity=function(){this.setLinearVelocity(fi.ZERO),this.setAngularVelocity(fi.ZERO)},t.clearForces=function(){this.impl.clearForces()},t.initialize=function(t){this._rigidBody=t,this._sharedBody=HY.instance.physicsWorld.getSharedBody(this._rigidBody.node,this),this._sharedBody.reference=!0},t.onEnable=function(){this._isEnabled=!0,this.setMass(this._rigidBody.mass),this.setAllowSleep(this._rigidBody.allowSleep),this.setLinearDamping(this._rigidBody.linearDamping),this.setAngularDamping(this._rigidBody.angularDamping),this.setLinearFactor(this._rigidBody.linearFactor),this.setAngularFactor(this._rigidBody.angularFactor),this.useGravity(this._rigidBody.useGravity),this._sharedBody.bodyEnabled=!0},t.onDisable=function(){this._isEnabled=!1,this._sharedBody.bodyEnabled=!1},t.onDestroy=function(){this._sharedBody.reference=!1,this._rigidBody=null,this._sharedBody=null},t.wakeUp=function(t){void 0===t&&(t=!0),this.impl.activate(t)},t.sleep=function(){return this.impl.wantsSleeping()},t.setSleepThreshold=function(t){this._wakeUpIfSleep(),this.impl.setSleepingThresholds(t,t)},t.getSleepThreshold=function(){return this.impl.getLinearSleepingThreshold()},t.getLinearVelocity=function(t){return WX(t,this.impl.getLinearVelocity())},t.setLinearVelocity=function(t){this._wakeUpIfSleep(),GX(this.impl.getLinearVelocity(),t)},t.getAngularVelocity=function(t){return WX(t,this.impl.getAngularVelocity())},t.setAngularVelocity=function(t){this._wakeUpIfSleep(),GX(this.impl.getAngularVelocity(),t)},t.applyLocalForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=this._sharedBody.node.worldRotation,r=fi.transformQuat(NJ,t,i),n=e?fi.transformQuat(zJ,e,i):fi.ZERO;this.impl.applyForce(GX(BJ.instance.VECTOR3_0,r),GX(BJ.instance.VECTOR3_1,n))},t.applyLocalTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),fi.transformQuat(NJ,t,this._sharedBody.node.worldRotation),this.impl.applyTorque(GX(BJ.instance.VECTOR3_0,NJ))},t.applyLocalImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=this._sharedBody.node.worldRotation,r=fi.transformQuat(NJ,t,i),n=e?fi.transformQuat(zJ,e,i):fi.ZERO;this.impl.applyImpulse(GX(BJ.instance.VECTOR3_0,r),GX(BJ.instance.VECTOR3_1,n))},t.applyForce=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=e||fi.ZERO;this.impl.applyForce(GX(BJ.instance.VECTOR3_0,t),GX(BJ.instance.VECTOR3_1,i))},t.applyTorque=function(t){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep(),this.impl.applyTorque(GX(BJ.instance.VECTOR3_0,t))},t.applyImpulse=function(t,e){this._sharedBody.syncSceneToPhysics(),this._wakeUpIfSleep();var i=e||fi.ZERO;this.impl.applyImpulse(GX(BJ.instance.VECTOR3_0,t),GX(BJ.instance.VECTOR3_1,i))},t.getGroup=function(){return this._sharedBody.collisionFilterGroup},t.setGroup=function(t){this._sharedBody.collisionFilterGroup=t},t.addGroup=function(t){this._sharedBody.collisionFilterGroup|=t},t.removeGroup=function(t){this._sharedBody.collisionFilterGroup&=~t},t.getMask=function(){return this._sharedBody.collisionFilterMask},t.setMask=function(t){this._sharedBody.collisionFilterMask=t},t.addMask=function(t){this._sharedBody.collisionFilterMask|=t},t.removeMask=function(t){this._sharedBody.collisionFilterMask&=~t},t._wakeUpIfSleep=function(){this.isAwake||this.impl.activate(!0)},Ge(e,[{key:"isAwake",get:function(){var t=this.impl.getActivationState();return t===CJ.ACTIVE_TAG||t===CJ.DISABLE_DEACTIVATION}},{key:"isSleepy",get:function(){return this.impl.getActivationState()===CJ.WANTS_DEACTIVATION}},{key:"isSleeping",get:function(){return this.impl.getActivationState()===CJ.ISLAND_SLEEPING}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"impl",get:function(){return this._sharedBody.body}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"sharedBody",get:function(){return this._sharedBody}}]),e}();UJ.idCounter=0;var VJ=function(){function t(){}return t.setWrapper=function(t){this.ptr2WrapObj[qn.getPointer(t.impl)]=t},t.delWrapper=function(t){delete this.ptr2WrapObj[qn.getPointer(t.impl)]},t.getWrapperByPtr=function(t){return this.ptr2WrapObj[t]},Ge(t,null,[{key:"bodyStructs",get:function(){return this.bodyAndGhosts}},{key:"ghostStructs",get:function(){return this.bodyAndGhosts}}]),t}();VJ.bodyAndGhosts={},VJ.ptr2WrapObj={};var HJ=LJ,GJ=kJ,WJ=0,XJ=function(){function t(e,i){this.id=void 0,this.node=void 0,this.wrappedWorld=void 0,this.wrappedJoints0=[],this.wrappedJoints1=[],this.dirty=0,this._collisionFilterGroup=HY.PhysicsGroup.DEFAULT,this._collisionFilterMask=-1,this.ref=0,this.bodyIndex=-1,this.ghostIndex=-1,this._wrappedBody=null,this.id=t.idCounter++,this.wrappedWorld=i,this.node=e}t.getSharedBody=function(e,i,r){var n,o=e.uuid;if(t.sharedBodesMap.has(o))n=t.sharedBodesMap.get(o);else{n=new t(e,i);var s=sX.DEFAULT,a=HY.instance.collisionMatrix[s];n._collisionFilterGroup=s,n._collisionFilterMask=a,t.sharedBodesMap.set(e.uuid,n)}if(r){n._wrappedBody=r;var l=r.rigidBody.group,h=HY.instance.collisionMatrix[l];n._collisionFilterGroup=l,n._collisionFilterMask=h}return n};var e=t.prototype;return e._instantiateBodyStruct=function(){if(!this._bodyStruct){var t=new qn.btTransform;t.setIdentity(),GX(t.getOrigin(),this.node.worldPosition);var e=new qn.btQuaternion;XX(e,this.node.worldRotation),t.setRotation(e);var i=new qn.btDefaultMotionState(t),r=new qn.btVector3(1.6666666269302368,1.6666666269302368,1.6666666269302368),n=new qn.btCompoundShape,o=0;this._wrappedBody&&this._wrappedBody.rigidBody.enabled&&this._wrappedBody.rigidBody.isDynamic&&(o=this._wrappedBody.rigidBody.mass),0===o&&r.setValue(0,0,0);var s=new qn.btRigidBodyConstructionInfo(o,i,BJ.instance.EMPTY_SHAPE,r),a=new qn.btRigidBody(s),l=HY.instance.sleepThreshold;a.setSleepingThresholds(l,l),this._bodyStruct={id:WJ++,body:a,localInertia:r,motionState:i,startTransform:t,shape:n,rbInfo:s,worldQuat:e,wrappedShapes:[],useCompound:!1},VJ.bodyStructs[this._bodyStruct.id]=this._bodyStruct,this.body.setUserIndex2(2),this.body.setUserIndex(this._bodyStruct.id),qn.CC_CONFIG.ignoreSelfBody&&this._ghostStruct&&this.ghost.setIgnoreCollisionCheck(this.body,!0),this.wrappedBody&&this.setBodyType(this.wrappedBody.rigidBody.type)}},e._instantiateGhostStruct=function(){if(!this._ghostStruct){var t=new qn.btCollisionObject,e=new qn.btCompoundShape;t.setCollisionShape(e),t.setCollisionFlags(EJ.CF_STATIC_OBJECT|EJ.CF_NO_CONTACT_RESPONSE),this._ghostStruct={id:WJ++,ghost:t,shape:e,worldQuat:new qn.btQuaternion,wrappedShapes:[]},VJ.ghostStructs[this._ghostStruct.id]=this._ghostStruct,this.ghost.setUserIndex2(2),this.ghost.setUserIndex(this._ghostStruct.id),qn.CC_CONFIG.ignoreSelfBody&&this._bodyStruct&&this.ghost.setIgnoreCollisionCheck(this.body,!0),this.wrappedBody&&this.setGhostType(this.wrappedBody.rigidBody.type)}},e.setType=function(t){this.setBodyType(t),this.setGhostType(t)},e.setBodyType=function(t){if(this._bodyStruct&&this._wrappedBody){var e=this._bodyStruct.body,i=this._wrappedBody,r=i.rigidBody,n=e.getCollisionFlags(),o=BJ.instance.VECTOR3_0;switch(t){case eX.DYNAMIC:n&=~EJ.CF_KINEMATIC_OBJECT,n&=~EJ.CF_STATIC_OBJECT,e.setCollisionFlags(n),i.setMass(r.mass),i.useGravity(r.useGravity),i.setAllowSleep(r.allowSleep);break;case eX.KINEMATIC:o.setValue(0,0,0),e.setMassProps(0,o),n|=EJ.CF_KINEMATIC_OBJECT,n&=~EJ.CF_STATIC_OBJECT,e.setCollisionFlags(n),e.forceActivationState(CJ.DISABLE_DEACTIVATION);break;case eX.STATIC:default:o.setValue(0,0,0),e.setMassProps(0,o),n|=EJ.CF_STATIC_OBJECT,n&=~EJ.CF_KINEMATIC_OBJECT,e.setCollisionFlags(n),e.forceActivationState(CJ.ISLAND_SLEEPING)}this.dirty|=TJ.BODY_RE_ADD}},e.setGhostType=function(t){if(this._ghostStruct){var e=this._ghostStruct.ghost,i=e.getCollisionFlags();switch(t){case eX.DYNAMIC:case eX.KINEMATIC:i&=~EJ.CF_STATIC_OBJECT,i|=EJ.CF_KINEMATIC_OBJECT,e.setCollisionFlags(i),e.forceActivationState(CJ.DISABLE_DEACTIVATION);break;case eX.STATIC:default:i&=~EJ.CF_KINEMATIC_OBJECT,i|=EJ.CF_STATIC_OBJECT,e.setCollisionFlags(i),e.forceActivationState(CJ.ISLAND_SLEEPING)}this.dirty|=TJ.GHOST_RE_ADD}},e.addShape=function(t,e){function i(t,e){t.body.setCollisionShape(e),t.dirty|=TJ.BODY_RE_ADD,t._wrappedBody&&t._wrappedBody.isEnabled&&t._wrappedBody.setMass(t._wrappedBody.rigidBody.mass)}if(e)this.ghostStruct.wrappedShapes.indexOf(t)<0&&(this.ghostStruct.wrappedShapes.push(t),t.setCompound(this.ghostCompoundShape),this.ghostEnabled=!0);else if(this.bodyStruct.wrappedShapes.indexOf(t)<0){if(this.bodyStruct.wrappedShapes.push(t),this.bodyStruct.useCompound)t.setCompound(this.bodyCompoundShape);else{var r=this.bodyStruct.wrappedShapes.length;if(1!==r||t.needCompound()){this.bodyStruct.useCompound=!0;for(var n=0;n<r;n++)this.bodyStruct.wrappedShapes[n].setCompound(this.bodyCompoundShape);i(this,this.bodyStruct.shape)}else i(this,t.impl)}this.bodyEnabled=!0}},e.removeShape=function(t,e){if(e){var i=this.ghostStruct.wrappedShapes.indexOf(t);i>=0&&(eo(this.ghostStruct.wrappedShapes,i),t.setCompound(null),this.ghostEnabled=!1)}else{var r=this.bodyStruct.wrappedShapes.indexOf(t);r>=0&&(this.bodyStruct.useCompound?t.setCompound(null):this.body.setCollisionShape(BJ.instance.EMPTY_SHAPE),this.body.activate(!0),this.dirty|=TJ.BODY_RE_ADD,eo(this.bodyStruct.wrappedShapes,r),this.bodyEnabled=!1)}},e.addJoint=function(t,e){e?this.wrappedJoints1.indexOf(t)<0&&this.wrappedJoints1.push(t):this.wrappedJoints0.indexOf(t)<0&&this.wrappedJoints0.push(t)},e.removeJoint=function(t,e){if(e){var i=this.wrappedJoints1.indexOf(t);i>=0&&eo(this.wrappedJoints1,i)}else{var r=this.wrappedJoints0.indexOf(t);r>=0&&eo(this.wrappedJoints0,r)}},e.updateDirty=function(){this.dirty&&(this.bodyIndex>=0&&this.dirty&TJ.BODY_RE_ADD&&this.updateBodyByReAdd(),this.ghostIndex>=0&&this.dirty&TJ.GHOST_RE_ADD&&this.updateGhostByReAdd(),this.dirty=0)},e.syncSceneToPhysics=function(){if(this.node.hasChangedFlags){var t=this.body.getWorldTransform();if(GX(t.getOrigin(),this.node.worldPosition),XX(this.bodyStruct.worldQuat,this.node.worldRotation),t.setRotation(this.bodyStruct.worldQuat),this.node.hasChangedFlags&Bi.SCALE&&this.syncBodyScale(),this.body.isKinematicObject()){var e=this.body.getMotionState();e&&e.setWorldTransform(t)}else this.isBodySleeping()&&this.body.activate()}},e.syncPhysicsToScene=function(){if(!this.body.isStaticOrKinematicObject()&&!this.isBodySleeping()){var t=this.bodyStruct.startTransform;if(this.body.getMotionState().getWorldTransform(t),this.node.worldPosition=WX(HJ,t.getOrigin()),t.getBasis().getRotation(this.bodyStruct.worldQuat),this.node.worldRotation=YX(GJ,this.bodyStruct.worldQuat),this._ghostStruct){var e=this.ghost.getWorldTransform();GX(e.getOrigin(),this.node.worldPosition),XX(this.ghostStruct.worldQuat,this.node.worldRotation),e.setRotation(this.ghostStruct.worldQuat)}}},e.syncSceneToGhost=function(){if(this.node.hasChangedFlags){var t=this.ghost.getWorldTransform();GX(t.getOrigin(),this.node.worldPosition),XX(this.ghostStruct.worldQuat,this.node.worldRotation),t.setRotation(this.ghostStruct.worldQuat),this.node.hasChangedFlags&Bi.SCALE&&this.syncGhostScale(),this.ghost.activate()}},e.syncInitialBody=function(){var t=this.body.getWorldTransform();GX(t.getOrigin(),this.node.worldPosition),XX(this.bodyStruct.worldQuat,this.node.worldRotation),t.setRotation(this.bodyStruct.worldQuat),this.syncBodyScale(),this.body.activate()},e.syncInitialGhost=function(){var t=this.ghost.getWorldTransform();GX(t.getOrigin(),this.node.worldPosition),XX(this.ghostStruct.worldQuat,this.node.worldRotation),t.setRotation(this.ghostStruct.worldQuat),this.syncGhostScale(),this.ghost.activate()},e.syncBodyScale=function(){for(var t=0;t<this.bodyStruct.wrappedShapes.length;t++)this.bodyStruct.wrappedShapes[t].updateScale();for(var e=0;e<this.wrappedJoints0.length;e++)this.wrappedJoints0[e].updateScale0();for(var i=0;i<this.wrappedJoints1.length;i++)this.wrappedJoints1[i].updateScale1()},e.syncGhostScale=function(){for(var t=0;t<this.ghostStruct.wrappedShapes.length;t++)this.ghostStruct.wrappedShapes[t].updateScale()},e.updateBodyByReAdd=function(){this.bodyIndex>=0&&(this.wrappedWorld.removeSharedBody(this),this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this))},e.updateGhostByReAdd=function(){this.ghostIndex>=0&&(this.wrappedWorld.removeGhostObject(this),this.ghostIndex=this.wrappedWorld.ghosts.length,this.wrappedWorld.addGhostObject(this))},e.destroy=function(){if(t.sharedBodesMap.delete(this.node.uuid),this.node=null,this.wrappedWorld=null,this._bodyStruct){var e=this._bodyStruct;qn.destroy(e.localInertia),qn.destroy(e.worldQuat),qn.destroy(e.startTransform),qn.destroy(e.motionState),qn.destroy(e.rbInfo),qn.destroy(e.shape),jX(e.shape,qn.btCollisionShape),qn.castObject(e.body,qn.btRigidBody).wrapped=null,jX(e.body,qn.btRigidBody),jX(e.body,qn.btCollisionObject),delete VJ.bodyStructs[e.id],this._bodyStruct=null}if(this._ghostStruct){var i=this._ghostStruct;qn.destroy(i.worldQuat),qn.destroy(i.shape),jX(i.shape,qn.btCollisionShape),qn.destroy(i.ghost),delete VJ.bodyStructs[i.id],this._ghostStruct=null}},e.isBodySleeping=function(){return this.body.getActivationState()===CJ.ISLAND_SLEEPING},Ge(t,[{key:"wrappedBody",get:function(){return this._wrappedBody}},{key:"bodyCompoundShape",get:function(){return this.bodyStruct.shape}},{key:"ghostCompoundShape",get:function(){return this.ghostStruct.shape}},{key:"body",get:function(){return this.bodyStruct.body}},{key:"ghost",get:function(){return this.ghostStruct.ghost}},{key:"collisionFilterGroup",get:function(){return this._collisionFilterGroup},set:function(t){t!==this._collisionFilterGroup&&(this._collisionFilterGroup=t,this.dirty|=TJ.BODY_RE_ADD,this.dirty|=TJ.GHOST_RE_ADD)}},{key:"collisionFilterMask",get:function(){return this._collisionFilterMask},set:function(t){t!==this._collisionFilterMask&&(this._collisionFilterMask=t,this.dirty|=TJ.BODY_RE_ADD,this.dirty|=TJ.GHOST_RE_ADD)}},{key:"bodyStruct",get:function(){return this._instantiateBodyStruct(),this._bodyStruct}},{key:"ghostStruct",get:function(){return this._instantiateGhostStruct(),this._ghostStruct}},{key:"bodyEnabled",set:function(t){if(t){if(this.bodyIndex<0){if(0===this.bodyStruct.wrappedShapes.length){if(!this.wrappedBody)return;if(!this.wrappedBody.rigidBody.isDynamic)return}this.bodyIndex=this.wrappedWorld.bodies.length,this.wrappedWorld.addSharedBody(this),this.syncInitialBody()}}else this.bodyIndex>=0&&(0===this.bodyStruct.wrappedShapes.length&&null==this.wrappedBody||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.isEnabled||0===this.bodyStruct.wrappedShapes.length&&null!=this.wrappedBody&&!this.wrappedBody.rigidBody.enabledInHierarchy)&&(this.body.clearState(),this.bodyIndex=-1,this.wrappedWorld.removeSharedBody(this))}},{key:"ghostEnabled",set:function(t){t?this.ghostIndex<0&&this.ghostStruct.wrappedShapes.length>0&&(this.ghostIndex=1,this.wrappedWorld.addGhostObject(this),this.syncInitialGhost()):this.ghostIndex>=0&&0===this.ghostStruct.wrappedShapes.length&&this.ghost&&(this.ghostIndex=-1,this.wrappedWorld.removeGhostObject(this))}},{key:"reference",set:function(t){t?this.ref++:this.ref--,0===this.ref&&this.destroy()}}]),t}();XJ.idCounter=0,XJ.sharedBodesMap=new Map;var YJ=function(){function t(){this.matrix=[]}var e=t.prototype;return e.get=function(t,e){if(e>t){var i=e;e=t,t=i}return this.matrix[(t*(t+1)>>1)+e-1]},e.set=function(t,e,i){if(e>t){var r=e;e=t,t=r}this.matrix[(t*(t+1)>>1)+e-1]=i?1:0},e.reset=function(){this.matrix.length=0},e.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1},t}(),jJ=function(){function t(){this.data=void 0,this.data={keys:[]}}var e=t.prototype;return e.get=function(t,e){if(t>e){var i=e;e=t,t=i}return this.data[t+"-"+e]},e.set=function(t,e,i){if(t>e){var r=e;e=t,t=r}var n=t+"-"+e;if(null==i){var o=this.data.keys.indexOf(n);if(-1!==o)return this.data.keys.splice(o,1),delete this.data[n],i}return this.get(t,e)||this.data.keys.push(n),this.data[n]=i,this.data[n]},e.reset=function(){this.data={keys:[]}},e.getLength=function(){return this.data.keys.length},e.getKeyByIndex=function(t){return this.data.keys[t]},e.getDataByKey=function(t){return this.data[t]},t}(),qJ=function(){function t(t){this.impl=null,this.event=void 0,this.event=t}var e=t.prototype;return e.getLocalPointOnA=function(t){this.impl&&WX(t,this.impl.m_localPointA)},e.getLocalPointOnB=function(t){this.impl&&WX(t,this.impl.m_localPointB)},e.getWorldPointOnA=function(t){this.impl&&WX(t,this.impl.m_positionWorldOnA)},e.getWorldPointOnB=function(t){this.impl&&WX(t,this.impl.m_positionWorldOnB)},e.getLocalNormalOnA=function(t){if(this.impl){WX(t,this.impl.m_normalWorldOnB),this.isBodyA||fi.negate(t,t);var e=kJ,i=BJ.instance.QUAT_0;this.event.impl.getBody0().getWorldTransform().getBasis().getRotation(i),YX(e,i),yi.conjugate(e,e),fi.transformQuat(t,t,e)}},e.getLocalNormalOnB=function(t){if(this.impl){var e=kJ,i=BJ.instance.QUAT_0;this.event.impl.getBody1().getWorldTransform().getBasis().getRotation(i),YX(e,i),yi.conjugate(e,e),WX(t,this.impl.m_normalWorldOnB),fi.transformQuat(t,t,e)}},e.getWorldNormalOnA=function(t){this.impl&&(WX(t,this.impl.m_normalWorldOnB),this.isBodyA||fi.negate(t,t))},e.getWorldNormalOnB=function(t){this.impl&&WX(t,this.impl.m_normalWorldOnB)},Ge(t,[{key:"isBodyA",get:function(){var t=this.event.selfCollider.shape.sharedBody.body,e=this.event.impl.getBody0();return Ammo.compare(e,t)}}]),t}(),KJ=[],ZJ=LJ,JJ=FJ,QJ=function(){var t=e.prototype;function e(){this._btWorld=void 0,this._btBroadphase=void 0,this._btSolver=void 0,this._btDispatcher=void 0,this._btCollisionConfiguration=void 0,this.bodies=[],this.ghosts=[],this.constraints=[],this.triggerArrayMat=new YJ,this.collisionArrayMat=new YJ,this.contactsDic=new jJ,this.oldContactsDic=new jJ,this._btCollisionConfiguration=new qn.btDefaultCollisionConfiguration,this._btDispatcher=new qn.btCollisionDispatcher(this._btCollisionConfiguration),this._btBroadphase=new qn.btDbvtBroadphase,this._btSolver=new qn.btSequentialImpulseConstraintSolver,this._btWorld=new qn.ccDiscreteDynamicsWorld(this._btDispatcher,this._btBroadphase,this._btSolver,this._btCollisionConfiguration);var t=BJ.instance.VECTOR3_0;t.setValue(0,-10,0),this._btWorld.setGravity(t),e.closeHitCB||(e.closeHitCB=new qn.ccClosestRayResultCallback(t,t)),e.allHitsCB||(e.allHitsCB=new qn.ccAllHitsRayResultCallback(t,t))}return t.setAllowSleep=function(t){this._btWorld.setAllowSleep(t)},t.setDefaultMaterial=function(){},t.setGravity=function(t){var e=BJ.instance.VECTOR3_0;GX(e,t),this._btWorld.setGravity(e)},t.destroy=function(){(this.constraints.length||this.bodies.length)&&Ye("You should destroy all physics component first."),qn.destroy(this._btWorld),qn.destroy(this._btSolver),qn.destroy(this._btBroadphase),qn.destroy(this._btDispatcher),qn.destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null,this._btDispatcher=null,this._btBroadphase=null,this._btSolver=null,this._btWorld=null,this.bodies=null,this.ghosts=null,this.constraints=null,this.triggerArrayMat=null,this.collisionArrayMat=null,this.contactsDic=null,this.oldContactsDic=null,KJ.length=0},t.step=function(t,e,i){if(void 0===i&&(i=0),0!==this.bodies.length||0!==this.ghosts.length){void 0===e&&(e=t),this._btWorld.stepSimulation(e,i,t);for(var r=0;r<this.bodies.length;r++)this.bodies[r].syncPhysicsToScene()}},t.syncSceneToPhysics=function(){for(var t=0;t<this.ghosts.length;t++)this.ghosts[t].updateDirty(),this.ghosts[t].syncSceneToGhost();for(var e=0;e<this.bodies.length;e++)this.bodies[e].updateDirty(),this.bodies[e].syncSceneToPhysics()},t.syncAfterEvents=function(){this.syncSceneToPhysics()},t.raycast=function(t,i,r,n){var o=e.allHitsCB,s=GX(o.m_rayFromWorld,t.o);t.computeHit(ZJ,i.maxDistance);var a=GX(o.m_rayToWorld,ZJ);if(o.reset(i.mask,i.queryTrigger),this._btWorld.rayTest(s,a,o),o.hasHit()){for(var l=o.getCollisionShapePtrs(),h=o.getHitPointWorld(),u=o.getHitNormalWorld(),c=0,d=l.size();c<d;c++){var p=VJ.getWrapperByPtr(l.at(c));WX(ZJ,h.at(c)),WX(JJ,u.at(c));var f=r.add();f._assign(ZJ,fi.distance(t.o,ZJ),p.collider,JJ),n.push(f)}return!0}return!1},t.raycastClosest=function(t,i,r){var n=e.closeHitCB,o=GX(n.m_rayFromWorld,t.o);t.computeHit(ZJ,i.maxDistance);var s=GX(n.m_rayToWorld,ZJ);if(n.reset(i.mask,i.queryTrigger),this._btWorld.rayTest(o,s,n),n.hasHit()){var a=VJ.getWrapperByPtr(n.getCollisionShapePtr());return WX(ZJ,n.getHitPointWorld()),WX(JJ,n.getHitNormalWorld()),r._assign(ZJ,fi.distance(t.o,ZJ),a.collider,JJ),!0}return!1},t.getSharedBody=function(t,e){return XJ.getSharedBody(t,this,e)},t.addSharedBody=function(t){this.bodies.indexOf(t)<0&&(this.bodies.push(t),this._btWorld.addRigidBody(t.body,t.collisionFilterGroup,t.collisionFilterMask))},t.removeSharedBody=function(t){var e=this.bodies.indexOf(t);e>=0&&(eo(this.bodies,e),this._btWorld.removeRigidBody(t.body))},t.addGhostObject=function(t){this.ghosts.indexOf(t)<0&&(this.ghosts.push(t),this._btWorld.addCollisionObject(t.ghost,t.collisionFilterGroup,t.collisionFilterMask))},t.removeGhostObject=function(t){var e=this.ghosts.indexOf(t);e>=0&&(eo(this.ghosts,e),this._btWorld.removeCollisionObject(t.ghost))},t.addConstraint=function(t){var e=this.constraints.indexOf(t);e<0&&(this.constraints.push(t),this._btWorld.addConstraint(t.impl,!t.constraint.enableCollision),t.index=e)},t.removeConstraint=function(t){var e=this.constraints.indexOf(t);e>=0&&(this.constraints.splice(e,1),this._btWorld.removeConstraint(t.impl),t.index=-1)},t.emitEvents=function(){for(var t=this._btWorld.getCcdTriggerRecorder(),e=t.size(),i=0,r=0;r<e;r+=i){for(var n=t.at(i),o=VJ.getWrapperByPtr(t.at(i+1)),s=0;s<n;s++){var a=VJ.getWrapperByPtr(t.at(i+s+2));if(o.collider.needTriggerEvent||a.collider.needTriggerEvent){var l=this.contactsDic.get(o.id,a.id);null==l&&(l=this.contactsDic.set(o.id,a.id,{shape0:o,shape1:a,contacts:[],impl:t}))}}i+=n+2}for(var h=this._btDispatcher.getNumManifolds(),u=0;u<h;u++){var c=this._btDispatcher.getManifoldByIndexInternal(u),d=c.getBody0(),p=c.getBody1();if(!d.useCharacter&&!p.useCharacter)for(var f=c.getNumContacts(),_=0;_<f;_++){var g=c.getContactPoint(_),m=d.getCollisionShape(),y=p.getCollisionShape(),v=void 0,b=void 0;if(v=m.isCompound()?qn.castObject(m,qn.btCompoundShape).getChildShape(g.m_index0).wrapped:m.wrapped,b=y.isCompound()?qn.castObject(y,qn.btCompoundShape).getChildShape(g.m_index1).wrapped:y.wrapped,v&&b&&(v.collider.needTriggerEvent||b.collider.needTriggerEvent||v.collider.needCollisionEvent||b.collider.needCollisionEvent)){var S=this.contactsDic.get(v.id,b.id);null==S&&(S=this.contactsDic.set(v.id,b.id,{shape0:v,shape1:b,contacts:[],impl:c})),S.contacts.push(g)}}}for(var T=this.contactsDic.getLength();T--;){KJ.push.apply(KJ,IJ.contacts),IJ.contacts.length=0;var E=this.contactsDic.getKeyByIndex(T),A=this.contactsDic.getDataByKey(E),C=A.shape0,w=A.shape1;this.oldContactsDic.set(C.id,w.id,A);var x=C.collider,R=w.collider;if(x&&R){if(x.isTrigger||R.isTrigger)this.triggerArrayMat.get(C.id,w.id)?DJ.type="onTriggerStay":(DJ.type="onTriggerEnter",this.triggerArrayMat.set(C.id,w.id,!0)),DJ.impl=A.impl,DJ.selfCollider=x,DJ.otherCollider=R,x.emit(DJ.type,DJ),DJ.selfCollider=R,DJ.otherCollider=x,R.emit(DJ.type,DJ);else{var M=x.attachedRigidBody,O=R.attachedRigidBody;if(M&&O){if(M.isSleeping&&O.isSleeping)continue}else if(null==M&&O){if(O.isSleeping)continue}else if(null==O&&M&&M.isSleeping)continue;this.collisionArrayMat.get(C.id,w.id)?IJ.type="onCollisionStay":(IJ.type="onCollisionEnter",this.collisionArrayMat.set(C.id,w.id,!0));for(var P=0;P<A.contacts.length;P++){var D=A.contacts[P];if(KJ.length>0){var I=KJ.pop();I.impl=D,IJ.contacts.push(I)}else{var B=new qJ(IJ);B.impl=D,IJ.contacts.push(B)}}IJ.impl=A.impl,IJ.selfCollider=x,IJ.otherCollider=R,x.emit(IJ.type,IJ),IJ.selfCollider=R,IJ.otherCollider=x,R.emit(IJ.type,IJ)}null==this.oldContactsDic.get(C.id,w.id)&&this.oldContactsDic.set(C.id,w.id,A)}}for(var L=this.oldContactsDic.getLength();L--;){var F=this.oldContactsDic.getKeyByIndex(L),k=this.oldContactsDic.getDataByKey(F),N=k.shape0,z=k.shape1,U=N.collider,V=z.collider;if(U&&V){var H=U.isTrigger||V.isTrigger;null==this.contactsDic.getDataByKey(F)&&(H?this.triggerArrayMat.get(N.id,z.id)&&(DJ.type="onTriggerExit",DJ.selfCollider=U,DJ.otherCollider=V,U.emit(DJ.type,DJ),DJ.selfCollider=V,DJ.otherCollider=U,V.emit(DJ.type,DJ),this.triggerArrayMat.set(N.id,z.id,!1),this.oldContactsDic.set(N.id,z.id,null)):this.collisionArrayMat.get(N.id,z.id)&&(KJ.push.apply(KJ,IJ.contacts),IJ.contacts.length=0,IJ.type="onCollisionExit",IJ.selfCollider=U,IJ.otherCollider=V,U.emit(IJ.type,IJ),IJ.selfCollider=V,IJ.otherCollider=U,V.emit(IJ.type,IJ),this.collisionArrayMat.set(N.id,z.id,!1),this.oldContactsDic.set(N.id,z.id,null)))}}this.contactsDic.reset()},Ge(e,[{key:"impl",get:function(){return this._btWorld}}]),e}();QJ.closeHitCB=void 0,QJ.allHitsCB=void 0;var $J=LJ,tQ=function(){var t=e.prototype;function e(t){this.id=void 0,this.type=void 0,this._index=-1,this._isEnabled=!1,this._isBinding=!1,this._isTrigger=!1,this._btCompound=null,this.transform=void 0,this.quat=void 0,this.scale=void 0,this.type=t,this.id=e.idCounter++,this.quat=new qn.btQuaternion,this.transform=new qn.btTransform,this.transform.setIdentity(),this.scale=new qn.btVector3(1,1,1)}return t.updateEventListener=function(){},t.setMaterial=function(t){!this._isTrigger&&this._isEnabled&&t&&(this._btCompound?this._btCompound.setMaterial(this._index,t.friction,t.restitution,t.rollingFriction,t.spinningFriction,2):(this._sharedBody.body.setFriction(t.friction),this._sharedBody.body.setRestitution(t.restitution),this._sharedBody.body.setRollingFriction(t.rollingFriction),this._sharedBody.body.setSpinningFriction(t.spinningFriction),this._sharedBody.body.setUserIndex2(2)))},t.setCenter=function(t){fi.copy($J,t),$J.multiply(this._collider.node.worldScale),GX(this.transform.getOrigin(),$J),this.updateCompoundTransform()},t.setAsTrigger=function(t){this._isTrigger!==t&&(this._isEnabled&&(this._sharedBody.removeShape(this,!t),this._sharedBody.addShape(this,t)),this._isTrigger=t)},t.getAABB=function(t){var e=BJ.instance.TRANSFORM;e.setIdentity(),e.setRotation(XX(BJ.instance.QUAT_0,this._collider.node.worldRotation));var i=BJ.instance.VECTOR3_0,r=BJ.instance.VECTOR3_1;this._btShape.getAabb(e,i,r),t.halfExtents.set((r.x()-i.x())/2,(r.y()-i.y())/2,(r.z()-i.z())/2),fi.add(t.center,this._collider.node.worldPosition,this._collider.center)},t.getBoundingSphere=function(t){t.radius=this._btShape.getLocalBoundingSphere(),fi.add(t.center,this._collider.node.worldPosition,this._collider.center)},t.initialize=function(t){this._collider=t,this._isBinding=!0,this._sharedBody=HY.instance.physicsWorld.getSharedBody(this._collider.node),this._sharedBody.reference=!0,this.onComponentSet(),this.setWrapper()},t.setWrapper=function(){BJ.isNotEmptyShape(this._btShape)&&(VJ.setWrapper(this),this._btShape.setUserPointerAsInt(qn.getPointer(this._btShape)),qn.castObject(this._btShape,qn.btCollisionShape).wrapped=this)},t.onComponentSet=function(){},t.onLoad=function(){this.setCenter(this._collider.center),this.setAsTrigger(this._collider.isTrigger)},t.onEnable=function(){this._isEnabled=!0,this._sharedBody.addShape(this,this._isTrigger),this.setMaterial(this.collider.sharedMaterial)},t.onDisable=function(){this._isEnabled=!1,this._sharedBody.removeShape(this,this._isTrigger)},t.onDestroy=function(){this._sharedBody.reference=!1,this._btCompound=null,this._collider=null,qn.castObject(this._btShape,qn.btCollisionShape).wrapped=null,qn.destroy(this.quat),qn.destroy(this.scale),qn.destroy(this.transform),BJ.isNotEmptyShape(this._btShape)&&(VJ.delWrapper(this),qn.destroy(this._btShape),jX(this._btShape,qn.btCollisionShape)),this._btShape=null,this.transform=null,this.quat=null,this.scale=null},t.updateByReAdd=function(){this._isEnabled&&(this._sharedBody.removeShape(this,this._isTrigger),this._sharedBody.addShape(this,this._isTrigger))},t.getGroup=function(){return this._sharedBody.collisionFilterGroup},t.setGroup=function(t){this._sharedBody.collisionFilterGroup=t},t.addGroup=function(t){this._sharedBody.collisionFilterGroup|=t},t.removeGroup=function(t){this._sharedBody.collisionFilterGroup&=~t},t.getMask=function(){return this._sharedBody.collisionFilterMask},t.setMask=function(t){this._sharedBody.collisionFilterMask=t},t.addMask=function(t){this._sharedBody.collisionFilterMask|=t},t.removeMask=function(t){this._sharedBody.collisionFilterMask&=~t},t.setCompound=function(t){this._btCompound&&(this._btCompound.removeChildShape(this._btShape),this._index=-1),t&&(this._index=t.getNumChildShapes(),t.addChildShape(this.transform,this._btShape)),this._btCompound=t},t.updateScale=function(){this.setCenter(this._collider.center)},t.updateCompoundTransform=function(){this._btCompound?this._btCompound.updateChildTransform(this.index,this.transform,!0):this._isEnabled&&!this._isTrigger&&this._sharedBody&&!this._sharedBody.bodyStruct.useCompound&&(this._sharedBody.dirty|=TJ.BODY_RE_ADD)},t.needCompound=function(){return this.type===RJ.TERRAIN_SHAPE_PROXYTYPE||!this._collider.center.equals(fi.ZERO)},Ge(e,[{key:"attachedRigidBody",get:function(){return this._sharedBody.wrappedBody?this._sharedBody.wrappedBody.rigidBody:null}},{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}},{key:"sharedBody",get:function(){return this._sharedBody}},{key:"index",get:function(){return this._index}}]),e}();tQ.idCounter=0;var eQ,iQ,rQ,nQ,oQ,sQ,aQ,lQ,hQ,uQ=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.BOX_SHAPE_PROXYTYPE)||this}return e.updateSize=function(){var t=BJ.instance.VECTOR3_0;GX(t,this.getMinUnscaledHalfExtents(zj)),this.impl.setUnscaledHalfExtents(t),this.updateCompoundTransform()},e.onComponentSet=function(){var t=BJ.instance.VECTOR3_0;GX(t,this.getMinUnscaledHalfExtents(zj)),this._btShape=new qn.btBoxShape(t),this.updateScale()},e.updateScale=function(){t.prototype.updateScale.call(this),GX(this.scale,this.getMinScale(zj)),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e.getMinUnscaledHalfExtents=function(t){var e=this.collider.size,i=Uj(zj.set(this._collider.node.worldScale)),r=HY.instance.minVolumeSize,n=e.x/2,o=e.y/2,s=e.z/2,a=n*i.x<r?r/i.x:n,l=o*i.y<r?r/i.y:o,h=s*i.z<r?r/i.z:s;return t.set(a,l,h),t},e.getMinScale=function(t){var e=this.collider.size,i=Uj(zj.set(this._collider.node.worldScale)),r=HY.instance.minVolumeSize,n=e.x/2,o=e.y/2,s=e.z/2,a=n*i.x<r?r/n:i.x,l=o*i.y<r?r/o:i.y,h=s*i.z<r?r/s:i.z;return t.set(a,l,h),t},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),cQ=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.SPHERE_SHAPE_PROXYTYPE)||this}return e.updateRadius=function(){this.impl.setUnscaledRadius(this.getMinUnscaledRadius()),this.updateCompoundTransform()},e.onComponentSet=function(){var t=Math.abs(io(this._collider.node.worldScale)),e=this.collider.radius,i=HY.instance.minVolumeSize,r=t*e<i?i/t:e;this._btShape=new qn.btSphereShape(r),this.updateScale()},e.updateScale=function(){t.prototype.updateScale.call(this);var e=this.getMinScale();zj.set(e,e,e),GX(this.scale,zj),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e.getMinUnscaledRadius=function(){var t=this.collider.radius,e=Math.abs(io(this._collider.node.worldScale)),i=HY.instance.minVolumeSize;return e*t<i?i/e:t},e.getMinScale=function(){var t=this.collider.radius,e=Math.abs(io(this._collider.node.worldScale)),i=HY.instance.minVolumeSize;return e*t<i?i/t:e},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),dQ=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.CAPSULE_SHAPE_PROXYTYPE)||this}return e.setCylinderHeight=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.cylinderHeight,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){this._btShape=new qn.btCapsuleShape(.5,1),this.setRadius(this.collider.radius)},e.updateScale=function(){t.prototype.updateScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,o=i;if(1===o){var s=t*Math.abs(to(n.x,n.z)),a=e/2*Math.abs(n.y);this.impl.updateProp(s,a,o)}else if(0===o){var l=t*Math.abs(to(n.y,n.z)),h=e/2*Math.abs(n.x);this.impl.updateProp(l,h,o)}else{var u=t*Math.abs(to(n.x,n.y)),c=e/2*Math.abs(n.z);this.impl.updateProp(u,c,o)}this.updateCompoundTransform()},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),pQ=function(t){He(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,RJ.TRIANGLE_MESH_SHAPE_PROXYTYPE)||this).refBtTriangleMesh=null,e}return e.setMesh=function(t){if(this._isBinding)if(null!=this._btShape&&BJ.isNotEmptyShape(this._btShape))$e(9620);else{var e=t;if(e&&e.renderingSubMeshes.length>0){var i=this._getBtTriangleMesh(e);this.collider.convex?this._btShape=new qn.btConvexTriangleMeshShape(i,!0):this._btShape=new qn.btBvhTriangleMeshShape(i,!0,!0),GX(this.scale,this._collider.node.worldScale),this._btShape.setMargin(.01),this._btShape.setLocalScaling(this.scale),this.setWrapper(),this.setCompound(this._btCompound),this.updateByReAdd()}else this._btShape=BJ.instance.EMPTY_SHAPE}},e.onComponentSet=function(){this.setMesh(this.collider.mesh)},e.onDestroy=function(){this.refBtTriangleMesh&&qn.destroy(this.refBtTriangleMesh),t.prototype.onDestroy.call(this)},e.setCompound=function(e){t.prototype.setCompound.call(this,e),this.impl.setUserIndex(this._index)},e.updateScale=function(){t.prototype.updateScale.call(this),GX(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e._getBtTriangleMesh=function(t){var e,i=qn.CC_CACHE;if(i.btTriangleMesh.enable){if(null==i.btTriangleMesh[t._uuid]){var r=new qn.btTriangleMesh;i.btTriangleMesh[t._uuid]=r,qX(r,t)}e=i.btTriangleMesh[t._uuid]}else this.refBtTriangleMesh=e=new qn.btTriangleMesh,qX(e,t);return e},Ge(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._btShape}}]),i}(tQ),fQ=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.CYLINDER_SHAPE_PROXYTYPE)||this}return e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){var t=BJ.instance.VECTOR3_0;t.setValue(.5,1,.5),this._btShape=new qn.btCylinderShape(t),this.setRadius(this.collider.radius)},e.updateScale=function(){t.prototype.updateScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,o=i;if(1===o){var s=e*Math.abs(n.y),a=t*Math.abs(to(n.x,n.z)),l=s/2;this.impl.updateProp(a,l,o)}else if(0===o){var h=e*Math.abs(n.x),u=t*Math.abs(to(n.y,n.z)),c=h/2;this.impl.updateProp(u,c,o)}else{var d=e*Math.abs(n.z),p=t*Math.abs(to(n.x,n.y)),f=d/2;this.impl.updateProp(p,f,o)}this.updateCompoundTransform()},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),_Q=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.CONE_SHAPE_PROXYTYPE)||this}return e.setHeight=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setDirection=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.setRadius=function(){this.updateProperties(this.collider.radius,this.collider.height,this.collider.direction,this._collider.node.worldScale)},e.onComponentSet=function(){this._btShape=new qn.btConeShape(.5,1),this.setRadius(this.collider.radius)},e.updateScale=function(){t.prototype.updateScale.call(this),this.setRadius(this.collider.radius)},e.updateProperties=function(t,e,i,r){var n=r,o=i;if(1===o){var s=e*Math.abs(n.y),a=t*Math.abs(to(n.x,n.z));this.impl.setRadius(a),this.impl.setHeight(s)}else if(0===o){var l=e*Math.abs(n.x),h=t*Math.abs(to(n.y,n.z));this.impl.setRadius(h),this.impl.setHeight(l)}else{var u=e*Math.abs(n.z),c=t*Math.abs(to(n.x,n.y));this.impl.setRadius(c),this.impl.setHeight(u)}this.impl.setConeUpIndex(o),this.scale.setValue(1,1,1),this.impl.setLocalScaling(this.scale),this.updateCompoundTransform()},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),gQ=function(t){He(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,RJ.TERRAIN_SHAPE_PROXYTYPE)||this)._buffPtr=void 0,e._tileSize=void 0,e._localOffset=void 0,e._buffPtr=0,e._tileSize=0,e._localOffset=new fi,e}return e.setTerrain=function(t){if(this._isBinding)if(null!=this._btShape&&BJ.isNotEmptyShape(this._btShape))ti("[Physics] Ammo change the terrain asset after initialization is not support.");else{var e=t;if(e){this._tileSize=e.tileSize;var i=e.getVertexCountI(),r=e.getVertexCountJ();this._buffPtr=qn._malloc(4*i*r);for(var n=0,o=Number.MIN_VALUE,s=Number.MAX_VALUE,a=0;a<r;a++)for(var l=0;l<i;l++){var h=e.getHeight(l,a);qn.HEAPF32[this._buffPtr+n>>2]=h,o=o<h?h:o,s=s>h?h:s,n+=4}o+=.1,s-=.1,this._localOffset.set((i-1)/2*this._tileSize,(o+s)/2,(r-1)/2*this._tileSize),this._btShape=new qn.btHeightfieldTerrainShape(i,r,this._buffPtr,1,s,o,1,"PHY_FLOAT",!1),this.scale.setValue(this._tileSize,1,this._tileSize),this._btShape.setLocalScaling(this.scale),this.setCompound(this._btCompound),this.updateByReAdd()}else this._btShape=BJ.instance.EMPTY_SHAPE}},e.onComponentSet=function(){this.setTerrain(this.collider.terrain)},e.onDestroy=function(){this._buffPtr&&qn._free(this._buffPtr),t.prototype.onDestroy.call(this)},e.setCompound=function(e){t.prototype.setCompound.call(this,e),this.impl.setUserIndex(this._index)},e.setCenter=function(t){fi.copy(LJ,t),LJ.add(this._localOffset),GX(this.transform.getOrigin(),LJ),this.updateCompoundTransform()},Ge(i,[{key:"collider",get:function(){return this._collider}},{key:"impl",get:function(){return this._btShape}}]),i}(tQ),mQ=function(t){He(i,t);var e=i.prototype;function i(){var e;return(e=t.call(this,RJ.TETRAHEDRAL_SHAPE_PROXYTYPE)||this).VERTICES=[],e}return e.setShapeType=function(){this._isBinding},e.setVertices=function(t){for(var e=this.VERTICES.length,i=0;i<e;i++)GX(this.VERTICES[i],t[i]);GX(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this._btCompound&&this._btCompound.updateChildTransform(this.index,this.transform,!0)},e.onComponentSet=function(){this._btShape=new qn.btBU_Simplex1to4;for(var t=this.collider.shapeType,e=this.collider.vertices,i=0;i<t;i++)this.VERTICES[i]=new qn.btVector3,GX(this.VERTICES[i],e[i]),this.impl.addVertex(this.VERTICES[i]);GX(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale)},e.onLoad=function(){t.prototype.onLoad.call(this),this.collider.updateVertices()},e.onDestroy=function(){for(var e=this.VERTICES.length,i=0;i<e;i++)qn.destroy(this.VERTICES[i]);this.VERTICES=null,t.prototype.onDestroy.call(this)},e.updateScale=function(){t.prototype.updateScale.call(this),GX(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this._btCompound&&this._btCompound.updateChildTransform(this.index,this.transform,!0)},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),yQ=function(t){He(i,t);var e=i.prototype;function i(){return t.call(this,RJ.STATIC_PLANE_PROXYTYPE)||this}return e.setNormal=function(t){GX(this.impl.getPlaneNormal(),t),this.updateCompoundTransform()},e.setConstant=function(t){this.impl.setPlaneConstant(t),this.updateCompoundTransform()},e.updateScale=function(){t.prototype.updateScale.call(this),GX(this.scale,this._collider.node.worldScale),this._btShape.setLocalScaling(this.scale),this.updateCompoundTransform()},e.onComponentSet=function(){var t=BJ.instance.VECTOR3_0;GX(t,this.collider.normal),this._btShape=new qn.btStaticPlaneShape(t,this.collider.constant),this.updateScale()},Ge(i,[{key:"impl",get:function(){return this._btShape}},{key:"collider",get:function(){return this._collider}}]),i}(tQ),vQ=function(){function t(){this.dirty=0,this.index=-1,this._collided=!1}var e=t.prototype;return e.setConnectedBody=function(){},e.setEnableCollision=function(t){this._collided!==t&&(this._collided=t,this.updateByReAdd())},e.updateByReAdd=function(){if(this._rigidBody&&this.index>=0){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.wrappedWorld.addConstraint(this)}},e.initialize=function(t){this._com=t,this._rigidBody=t.attachedBody,this._collided=t.enableCollision,this.onComponentSet()},e.onComponentSet=function(){},e.updateScale0=function(){},e.updateScale1=function(){},e.onEnable=function(){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.addConstraint(this),t.addJoint(this,0);var e=this.constraint.connectedBody;e&&e.body.sharedBody.addJoint(this,1)},e.onDisable=function(){var t=this._rigidBody.body.sharedBody;t.wrappedWorld.removeConstraint(this),t.removeJoint(this,0);var e=this.constraint.connectedBody;e&&e.body.sharedBody.removeJoint(this,1)},e.onDestroy=function(){qn.destroy(this._impl),this._com=null,this._rigidBody=null,this._impl=null},Ge(t,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),t}(),bQ=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.setPivotA=function(){var t=BJ.instance.VECTOR3_0,e=this.constraint;fi.multiply(LJ,e.node.worldScale,e.pivotA),GX(t,LJ),this.impl.setPivotA(t),e.connectedBody||this.setPivotB(e.pivotB)},i.setPivotB=function(){var t=this.constraint,e=this._rigidBody.node,i=BJ.instance.VECTOR3_0,r=t.connectedBody;r?(fi.multiply(LJ,r.node.worldScale,t.pivotB),GX(i,LJ)):(fi.multiply(LJ,e.worldScale,t.pivotA),fi.add(LJ,LJ,e.worldPosition),fi.add(LJ,LJ,t.pivotB),GX(i,LJ)),this.impl.setPivotB(i)},i.onComponentSet=function(){var t,e=this._rigidBody.body.impl,i=this.constraint.connectedBody;i&&(t=i.body.impl);var r=BJ.instance.VECTOR3_0;if(t){var n=BJ.instance.VECTOR3_1;this._impl=new qn.btPoint2PointConstraint(e,t,r,n)}else this._impl=new qn.btPoint2PointConstraint(e,r);this.setPivotA(this.constraint.pivotA),this.setPivotB(this.constraint.pivotB)},i.updateScale0=function(){this.setPivotA(this.constraint.pivotA)},i.updateScale1=function(){this.setPivotB(this.constraint.pivotB)},Ge(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(vQ),SQ=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.setPivotA=function(){this.updateFrames()},i.setPivotB=function(){this.updateFrames()},i.setAxis=function(){this.updateFrames()},i.onComponentSet=function(){var t=this._rigidBody.body.sharedBody,e=this.constraint.connectedBody,i=e?e.body.impl:t.wrappedWorld.impl.getFixedBody(),r=BJ.instance.TRANSFORM,n=BJ.instance.TRANSFORM_1;this._impl=new qn.btHingeConstraint(t.body,i,r,n),this.updateFrames()},i.updateFrames=function(){var t=this.constraint,e=t.node,i=LJ,r=kJ,n=BJ.instance.TRANSFORM;fi.multiply(i,e.worldScale,t.pivotA),GX(n.getOrigin(),i);var o=BJ.instance.QUAT_0;yi.rotationTo(r,fi.UNIT_Z,t.axis),n.setRotation(XX(o,r));var s=BJ.instance.TRANSFORM_1,a=this.constraint.connectedBody;a?fi.multiply(i,a.node.worldScale,t.pivotB):(fi.multiply(i,e.worldScale,t.pivotA),fi.add(i,i,e.worldPosition),fi.add(i,i,t.pivotB),yi.multiply(r,r,e.worldRotation)),GX(s.getOrigin(),i),s.setRotation(XX(o,r)),this.impl.setFrames(n,s)},i.updateScale0=function(){this.updateFrames()},i.updateScale1=function(){this.updateFrames()},Ge(e,[{key:"impl",get:function(){return this._impl}},{key:"constraint",get:function(){return this._com}}]),e}(vQ);CX.register("ammo.js",{PhysicsWorld:QJ,RigidBody:UJ,BoxShape:uQ,SphereShape:cQ,CapsuleShape:dQ,TrimeshShape:pQ,CylinderShape:fQ,ConeShape:_Q,TerrainShape:gQ,SimplexShape:mQ,PlaneShape:yQ,PointToPointConstraint:bQ,HingeConstraint:SQ}),window.Ammo=qn,qn.CC_CONFIG={ignoreSelfBody:!0},qn.CC_CACHE={btTriangleMesh:{enable:!1}},function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CYLINDER=2]="CYLINDER",t[t.CONE=3]="CONE",t[t.CAPSULE=4]="CAPSULE",t[t.TORUS=5]="TORUS",t[t.PLANE=6]="PLANE",t[t.QUAD=7]="QUAD"}(hQ||(hQ={})),Hr(hQ);var TQ=t("Primitive",(eQ=_i("cc.Primitive"),iQ=Di(hQ),eQ((lQ=aQ=function(t){function e(e){var i;return void 0===e&&(e=hQ.BOX),i=t.call(this)||this,Si(i,"type",oQ,Ti(i)),Si(i,"info",sQ,Ti(i)),i.type=e,i}return He(e,t),e.prototype.onLoaded=function(){ks(Nj[hQ[this.type].toLowerCase()](this.info),this)},e}(Ms),aQ.PrimitiveType=hQ,oQ=bi((nQ=lQ).prototype,"type",[iQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hQ.BOX}}),sQ=bi(nQ.prototype,"info",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),rQ=nQ))||rQ));ei.Primitive=TQ,ei.primitives=Nj;var EQ,AQ=function(){function t(t,e,i){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=i}var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,i=t.isInteger,r=e?this._averageValue:this._value;return i?Math.round(r):Math.round(100*r)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var i=e;i-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=i,this._accumSamples=0)}},Ge(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),CQ=_i("cc.PerfCounter")(EQ=function(t){function e(e,i,r){var n;return(n=t.call(this,e,i,r)||this)._time=void 0,n._time=r,n}He(e,t);var i=e.prototype;return i.start=function(t){void 0===t&&(t=0),this._time=t},i.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},i.tick=function(){this.end(),this.start()},i.frame=function(t){var e=t,i=e-this._time;this._total++,i>(this._opts.average||1e3)&&(this._value=1e3*this._total/i,this._total=0,this._time=e,this._average(this._value))},e}(AQ))||EQ,wQ="0123456789. ",xQ=500,RQ={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},MQ={fps:{desc:"Framerate (FPS)",below:30,average:xQ,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:xQ},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:xQ,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:xQ},render:{desc:"Renderer (ms)",min:0,max:50,average:xQ,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},OQ=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new et,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(MQ).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),ei.game.off(ei.Game.EVENT_RESTART,this.generateNode,this),ei.director.off(ei.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),ei.director.off(ei.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),ei.director.off(ei.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),ei.director.off(ei.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),ei.director.off(ei.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),ei.director.off(ei.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1,ei.game.config.showFPS=!1)},e.showStats=function(){this._showFPS||(this._device||(this._device=ei.director.root.device),this.generateCanvas(),this.generateStats(),ei.game.once(ei.Game.EVENT_ENGINE_INITED,this.generateNode,this),ei.game.on(ei.Game.EVENT_RESTART,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),ei.director.on(ei.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),ei.director.on(ei.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),ei.director.on(ei.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),ei.director.on(ei.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),ei.director.on(ei.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),ei.director.on(ei.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0,ei.game.config.showFPS=!0)},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new ut(v.TEX2D,b.SAMPLED|b.TRANSFER_DST,d.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var i in MQ){var r=MQ[i];this._ctx.fillText(r.desc,0,e*this._lineHeight),r.counter=new CQ(i,r,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var n=0;n<wQ.length;++n){var o=this._ctx.measureText(wQ[n]).width;this._eachNumWidth=Math.max(this._eachNumWidth,o)}for(var s=0;s<wQ.length;++s)this._ctx.fillText(wQ[s],s*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=MQ,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new br("PROFILER_NODE"),ei.game.addPersistRootNode(this._rootNode);var t=new br("Profiler_Camera");t.setPosition(0,0,1.5),t.parent=this._rootNode;var e=t.addComponent("cc.Camera");e.projection=$r.ProjectionType.ORTHO,e.orthoHeight=1,e.near=1,e.far=2,e.visibility=on.BitMask.PROFILER,e.clearFlags=X.NONE,e.priority=4294967295;var i=new br("Profiler_Root");i.parent=this._rootNode;for(var r=.4,n=r/this._totalLines,o=r/this._wordHeight,s=n/23,a=this._eachNumWidth*this._canvas.width*s,l=[0,r,0,o,r,0,o,0,0,0,0,0],h=[0,2,1,0,3,2],u=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],c=0,d=0;d<this._totalLines;d++)for(var p=0;p<8;p++){l.push(o+p*a,r-d*n,0),l.push(o+(p+1)*a,r-d*n,0),l.push(o+(p+1)*a,r-(d+1)*n,0),l.push(o+p*a,r-(d+1)*n,0),c=4*(8*d+p+1),h.push(0+c,2+c,1+c,0+c,3+c,2+c);var f=8*d+p,_=Math.floor(f/4),g=f-4*_;u.push(0,this._wordHeight,_,g),u.push(this._eachNumWidth,this._wordHeight,_,g),u.push(this._eachNumWidth,1,_,g),u.push(0,1,_,g)}var m=i.addComponent(Oa);m.mesh=ks({positions:l,indices:h,colors:u});var y=new Sr;y.initialize({effectName:"profiler"});var v=this.pass=y.passes[0],b=v.getBinding("mainTexture"),S=v.getBinding("digits"),T=v.getBinding("offset");v.bindTexture(b,this._texture),this.digitsData=v.blocks[S],this.offsetData=v.blocks[T],this.offsetData[3]=-1,m.material=y,m.node.layer=on.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();ei.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats){var t=this._device.surfaceTransform,e=this._device.capabilities.clipSpaceSignY;if(t!==this.offsetData[3]){var i=ro[t],r=-.9*e;this.offsetData[0]=-.9*i[0]+r*i[2],this.offsetData[1]=-.9*i[1]+r*i[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=t}this.pass._setRootBufferDirty(!0);var n=performance.now();this._stats.render.counter.start(n)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.frame.counter.end(t),this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<xQ)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var i=0,r=this.digitsData;for(var n in this._stats){var o=this._stats[n];o.counter.sample(t);for(var s=o.counter.human().toString(),a=7;a>=0;a--){var l=8*i+a,h=s[s.length-(8-a)],u=RQ[h];void 0===u&&(u=11),r[l]=u}i++}}}},t}()),PQ=t("profiler",new OQ);ei.profiler=PQ;var DQ,IQ,BQ,LQ,FQ=Mi({GRAVITY:0,RADIUS:1}),kQ=Mi({FREE:0,RELATIVE:1,GROUPED:2}),NQ=new Cr(0,0),zQ=new Cr,UQ=new Cr,VQ=new Cr,HQ=new Cr,GQ=t_(Qf),WQ=function(){this.pos=new Cr(0,0),this.startPos=new Cr(0,0),this.color=new tr(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Cr(0,0),this.aspectRatio=1,this.dir=new Cr(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},XQ=new(function(t){function e(){return t.apply(this,arguments)||this}return He(e,t),e.prototype.get=function(){return this._get()||new WQ},e}(Lr))((function(t){t.pos.set(NQ),t.startPos.set(NQ),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(NQ),t.aspectRatio=1,t.dir.set(NQ),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),YQ=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)XQ.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,i=XQ.get();this.particles.push(i),i.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var r=i.timeToLive=Math.max(0,i.timeToLive);i.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,i.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var n,o,s,a,l=e.startColor,h=e.startColorVar,u=e.endColor,c=e.endColorVar;i.color.r=n=an(l.r+h.r*(Math.random()-.5)*2,0,255),i.color.g=o=an(l.g+h.g*(Math.random()-.5)*2,0,255),i.color.b=s=an(l.b+h.b*(Math.random()-.5)*2,0,255),i.color.a=a=an(l.a+h.a*(Math.random()-.5)*2,0,255),i.deltaColor.r=(an(u.r+c.r*(Math.random()-.5)*2,0,255)-n)/r,i.deltaColor.g=(an(u.g+c.g*(Math.random()-.5)*2,0,255)-o)/r,i.deltaColor.b=(an(u.b+c.b*(Math.random()-.5)*2,0,255)-s)/r,i.deltaColor.a=(an(u.a+c.a*(Math.random()-.5)*2,0,255)-a)/r;var d=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(d=Math.max(0,d),i.size=d,-1===e.endSize)i.deltaSize=0;else{var p=e.endSize+e.endSizeVar*(Math.random()-.5)*2;p=Math.max(0,p),i.deltaSize=(p-d)/r}var f=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,_=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;i.rotation=f,i.deltaRotation=(_-f)/r,i.startPos.x=t.x,i.startPos.y=t.y,i.aspectRatio=e.aspectRatio||1;var g=no(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===FQ.GRAVITY){var m=e.speed+e.speedVar*(Math.random()-.5)*2;i.dir.x=Math.cos(g),i.dir.y=Math.sin(g),i.dir.multiplyScalar(m),i.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,i.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(i.rotation=-oo(Math.atan2(i.dir.y,i.dir.x)))}else{var y=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,v=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;i.radius=y,i.deltaRadius=-1===e.endRadius?0:(v-y)/r,i.angle=g,i.degreesPerSecond=no(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var i=e.vData,r=this.sys._renderSpriteFrame.uv,n=t?0:this.uvFilled,o=this.particles.length,s=n;s<o;s++){var a=s*GQ*4;i[a+3]=r[0],i[a+4]=r[1],i[a+12]=r[2],i[a+13]=r[3],i[a+21]=r[4],i[a+22]=r[5],i[a+30]=r[6],i[a+31]=r[7]}this.uvFilled=o}},e.updateParticleBuffer=function(t,e,i,r){var n=i.vData,o=e.x,s=e.y,a=t.size,l=a,h=t.aspectRatio;h>1?l=a/h:a=l*h;var u=a/2,c=l/2;if(t.rotation){var d=-u,p=-c,f=u,_=c,g=-no(t.rotation),m=Math.cos(g),y=Math.sin(g);n[r]=d*m-p*y+o,n[r+1]=d*y+p*m+s,n[r+2]=0,n[r+9]=f*m-p*y+o,n[r+10]=f*y+p*m+s,n[r+11]=0,n[r+18]=d*m-_*y+o,n[r+19]=d*y+_*m+s,n[r+20]=0,n[r+27]=f*m-_*y+o,n[r+28]=f*y+_*m+s,n[r+29]=0}else n[r]=o-u,n[r+1]=s-c,n[r+2]=0,n[r+9]=o+u,n[r+10]=s-c,n[r+11]=0,n[r+18]=o-u,n[r+19]=s+c,n[r+20]=0,n[r+27]=o+u,n[r+28]=s+c,n[r+29]=0;tr.toArray(n,t.color,r+5),tr.toArray(n,t.color,r+14),tr.toArray(n,t.color,r+23),tr.toArray(n,t.color,r+32)},e.step=function(t){var e=this.sys.assembler,i=this.sys,r=i.node,n=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,r.updateWorldTransform(),i.positionType===kQ.FREE){this._worldRotation=function(t){for(var e=0,i=t;i;)e+=i.eulerAngles.z,i=i.parent;return e}(r);var o=r.worldMatrix;zQ.x=o.m12,zQ.y=o.m13}else i.positionType===kQ.RELATIVE?(this._worldRotation=r.eulerAngles.z,zQ.x=r.position.x,zQ.y=r.position.y):this._worldRotation=0;if(this.active&&i.emissionRate){var s=1/i.emissionRate;for(n.length<i.totalParticles&&(this.emitCounter+=t);n.length<i.totalParticles&&this.emitCounter>s;)this.emitParticle(zQ),this.emitCounter-=s;this.elapsed+=t,-1!==i.duration&&i.duration<this.elapsed&&i.stopSystem()}var a=this.renderData,l=n.length;a.reset(),this.requestData(4*l,6*l),l>this.uvFilled&&this.updateUVs();for(var h=0;h<n.length;){UQ.x=UQ.y=VQ.x=VQ.y=HQ.x=HQ.y=0;var u=n[h];if(u.timeToLive-=t,u.timeToLive>0){if(i.emitterMode===FQ.GRAVITY){var c=HQ,d=UQ,p=VQ;(u.pos.x||u.pos.y)&&(d.set(u.pos),d.normalize()),p.set(d),d.multiplyScalar(u.radialAccel);var f=p.x;p.x=-p.y,p.y=f,p.multiplyScalar(u.tangentialAccel),c.set(d),c.add(p),c.add(i.gravity),c.multiplyScalar(t),u.dir.add(c),c.set(u.dir),c.multiplyScalar(t),u.pos.add(c)}else u.angle+=u.degreesPerSecond*t,u.radius+=u.deltaRadius*t,u.pos.x=-Math.cos(u.angle)*u.radius,u.pos.y=-Math.sin(u.angle)*u.radius;u.color.r+=u.deltaColor.r*t,u.color.g+=u.deltaColor.g*t,u.color.b+=u.deltaColor.b*t,u.color.a+=u.deltaColor.a*t,u.size+=u.deltaSize*t,u.size<0&&(u.size=0),u.rotation+=u.deltaRotation*t;var _=UQ;_.set(u.pos),i.positionType!==kQ.GROUPED&&_.add(u.startPos);var g=GQ*h*4;this.updateParticleBuffer(u,_,a,g),++h}else{var m=n[h];h!==n.length-1&&(n[h]=n[n.length-1]),XQ.put(m),n.length--,a.indicesCount-=6,a.vertexCount-=4}}0!==n.length||this.active||this.readyToPlay||(this.finished=!0,i._finishedSimulation())},e.requestData=function(t,e){var i=this.renderData.indicesCount;this.renderData.request(t,e);for(var r=this.renderData.indicesCount/6,n=this.renderData.iData,o=i;o<r;o++){var s=4*o;n[i++]=s,n[i++]=s+1,n[i++]=s+2,n[i++]=s+1,n[i++]=s+3,n[i++]=s+2}},t}(),jQ=t("ParticleAsset",_i("cc.ParticleAsset")((LQ=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"spriteFrame",BQ,Ti(e)),e}return He(e,t),e}(vi),BQ=bi((IQ=LQ).prototype,"spriteFrame",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DQ=IQ))||DQ);ei.ParticleAsset=jQ;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var qQ={};(function(){function t(t){throw t}var e=void 0,i=!0,r=this;function n(t,i){var n,o=t.split("."),s=r;!(o[0]in s)&&s.execScript&&s.execScript("var "+o[0]);for(;o.length&&(n=o.shift());)o.length||i===e?s=s[n]?s[n]:s[n]={}:s[n]=i}var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function s(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,o=1,s=0,a=t.length,l=0;0<a;){a-=n=1024<a?1024:a;do{s+=o+=t[l++]}while(--n);o%=65521,s%=65521}return(s<<16|o)>>>0}function a(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(o?Uint8Array:Array)?e:new(o?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(o?Uint8Array:Array)(i<<1);if(o)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},a.prototype.d=function(t,e,i){var r,n=this.buffer,o=this.index,s=this.i,a=n[o];if(i&&1<e&&(t=8<e?(p[255&t]<<24|p[t>>>8&255]<<16|p[t>>>16&255]<<8|p[t>>>24&255])>>32-e:p[t]>>8-e),8>e+s)a=a<<e|t,s+=e;else for(r=0;r<e;++r)a=a<<1|t>>e-r-1&1,8==++s&&(s=0,n[o++]=p[a],a=0,o===n.length&&(n=this.f()));n[o]=a,this.buffer=n,this.i=s,this.index=o},a.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=p[e[i]],i++),o?t=e.subarray(0,i):(e.length=i,t=e),t};var l,h=new(o?Uint8Array:Array)(256);for(l=0;256>l;++l){for(var u=d=l,c=7,d=d>>>1;d;d>>>=1)u<<=1,u|=1&d,--c;h[l]=(u<<c&255)>>>0}var p=h;function f(t){this.buffer=new(o?Uint16Array:Array)(2*t),this.length=0}function _(t){var e,i,r,n,s,a,l,h,u,c=t.length,d=0,p=Number.POSITIVE_INFINITY;for(h=0;h<c;++h)t[h]>d&&(d=t[h]),t[h]<p&&(p=t[h]);for(e=1<<d,i=new(o?Uint32Array:Array)(e),r=1,n=0,s=2;r<=d;){for(h=0;h<c;++h)if(t[h]===r){for(a=0,l=n,u=0;u<r;++u)a=a<<1|1&l,l>>=1;for(u=a;u<e;u+=s)i[u]=r<<16|h;++n}++r,n<<=1,s<<=1}return[i,d,p]}function g(t,e){this.h=y,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=o&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(o?Uint8Array:Array)(32768))}f.prototype.getParent=function(t){return 2*((t-2)/4|0)},f.prototype.push=function(t,e){var i,r,n,o=this.buffer;for(i=this.length,o[this.length++]=e,o[this.length++]=t;0<i&&(r=this.getParent(i),o[i]>o[r]);)n=o[i],o[i]=o[r],o[r]=n,n=o[i+1],o[i+1]=o[r+1],o[r+1]=n,i=r;return this.length},f.prototype.pop=function(){var t,e,i,r,n,o=this.buffer;for(e=o[0],t=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&o[r+2]>o[r]&&(r+=2),o[r]>o[n]);)i=o[n],o[n]=o[r],o[r]=i,i=o[n+1],o[n+1]=o[r+1],o[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var m,y=2,v={NONE:0,r:1,j:y,N:3},b=[];for(m=0;288>m;m++)switch(i){case 143>=m:b.push([m+48,8]);break;case 255>=m:b.push([m-144+400,9]);break;case 279>=m:b.push([m-256+0,7]);break;case 287>=m:b.push([m-280+192,8]);break;default:t("invalid literal: "+m)}function S(t,e){this.length=t,this.G=e}function T(){var e=E;switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}g.prototype.n=function(){var r,n,s,l,h=this.input;switch(this.h){case 0:for(s=0,l=h.length;s<l;){var u,c,d,p=n=o?h.subarray(s,s+65535):h.slice(s,s+65535),f=(s+=n.length)===l,_=e,g=e,m=this.a,v=this.b;if(o){for(m=new Uint8Array(this.a.buffer);m.length<=v+p.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(u=f?1:0,m[v++]=0|u,d=65536+~(c=p.length)&65535,m[v++]=255&c,m[v++]=c>>>8&255,m[v++]=255&d,m[v++]=d>>>8&255,o)m.set(p,v),v+=p.length,m=m.subarray(0,v);else{for(_=0,g=p.length;_<g;++_)m[v++]=p[_];m.length=v}this.b=v,this.a=m}break;case 1:var S=new a(new Uint8Array(this.a.buffer),this.b);S.d(1,1,i),S.d(1,2,i);var T,E,A,C=x(this,h);for(T=0,E=C.length;T<E;T++)if(A=C[T],a.prototype.d.apply(S,b[A]),256<A)S.d(C[++T],C[++T],i),S.d(C[++T],5),S.d(C[++T],C[++T],i);else if(256===A)break;this.a=S.finish(),this.b=this.a.length;break;case y:var w,O,P,D,I,B,L,F,k,N,z,U,V,H,G,W=new a(new Uint8Array(this.a),this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=Array(19);for(w=y,W.d(1,1,i),W.d(w,2,i),O=x(this,h),L=M(B=R(this.L,15)),k=M(F=R(this.K,7)),P=286;257<P&&0===B[P-1];P--);for(D=30;1<D&&0===F[D-1];D--);var j,q,K,Z,J,Q,$=P,tt=D,et=new(o?Uint32Array:Array)($+tt),it=new(o?Uint32Array:Array)(316),rt=new(o?Uint8Array:Array)(19);for(j=q=0;j<$;j++)et[q++]=B[j];for(j=0;j<tt;j++)et[q++]=F[j];if(!o)for(j=0,Z=rt.length;j<Z;++j)rt[j]=0;for(j=J=0,Z=et.length;j<Z;j+=q){for(q=1;j+q<Z&&et[j+q]===et[j];++q);if(K=q,0===et[j])if(3>K)for(;0<K--;)it[J++]=0,rt[0]++;else for(;0<K;)(Q=138>K?K:138)>K-3&&Q<K&&(Q=K-3),10>=Q?(it[J++]=17,it[J++]=Q-3,rt[17]++):(it[J++]=18,it[J++]=Q-11,rt[18]++),K-=Q;else if(it[J++]=et[j],rt[et[j]]++,3>--K)for(;0<K--;)it[J++]=et[j],rt[et[j]]++;else for(;0<K;)(Q=6>K?K:6)>K-3&&Q<K&&(Q=K-3),it[J++]=16,it[J++]=Q-3,rt[16]++,K-=Q}for(r=o?it.subarray(0,J):it.slice(0,J),N=R(rt,7),H=0;19>H;H++)Y[H]=N[X[H]];for(I=19;4<I&&0===Y[I-1];I--);for(z=M(N),W.d(P-257,5,i),W.d(D-1,5,i),W.d(I-4,4,i),H=0;H<I;H++)W.d(Y[H],3,i);for(H=0,G=r.length;H<G;H++)if(U=r[H],W.d(z[U],N[U],i),16<=U){switch(H++,U){case 16:V=2;break;case 17:V=3;break;case 18:V=7;break;default:t("invalid code: "+U)}W.d(r[H],V,i)}var nt,ot,st,at,lt,ht,ut,ct,dt=[L,B],pt=[k,F];for(lt=dt[0],ht=dt[1],ut=pt[0],ct=pt[1],nt=0,ot=O.length;nt<ot;++nt)if(st=O[nt],W.d(lt[st],ht[st],i),256<st)W.d(O[++nt],O[++nt],i),at=O[++nt],W.d(ut[at],ct[at],i),W.d(O[++nt],O[++nt],i);else if(256===st)break;this.a=W.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var E,A,C=[];for(E=3;258>=E;E++)A=T(),C[E]=A[2]<<24|A[1]<<16|A[0];var w=o?new Uint32Array(C):C;function x(r,n){function s(e,r){var n,o,s,a,l=e.G,h=[],u=0;switch(n=w[e.length],h[u++]=65535&n,h[u++]=n>>16&255,h[u++]=n>>24,i){case 1===l:o=[0,l-1,0];break;case 2===l:o=[1,l-2,0];break;case 3===l:o=[2,l-3,0];break;case 4===l:o=[3,l-4,0];break;case 6>=l:o=[4,l-5,1];break;case 8>=l:o=[5,l-7,1];break;case 12>=l:o=[6,l-9,2];break;case 16>=l:o=[7,l-13,2];break;case 24>=l:o=[8,l-17,3];break;case 32>=l:o=[9,l-25,3];break;case 48>=l:o=[10,l-33,4];break;case 64>=l:o=[11,l-49,4];break;case 96>=l:o=[12,l-65,5];break;case 128>=l:o=[13,l-97,5];break;case 192>=l:o=[14,l-129,6];break;case 256>=l:o=[15,l-193,6];break;case 384>=l:o=[16,l-257,7];break;case 512>=l:o=[17,l-385,7];break;case 768>=l:o=[18,l-513,8];break;case 1024>=l:o=[19,l-769,8];break;case 1536>=l:o=[20,l-1025,9];break;case 2048>=l:o=[21,l-1537,9];break;case 3072>=l:o=[22,l-2049,10];break;case 4096>=l:o=[23,l-3073,10];break;case 6144>=l:o=[24,l-4097,11];break;case 8192>=l:o=[25,l-6145,11];break;case 12288>=l:o=[26,l-8193,12];break;case 16384>=l:o=[27,l-12289,12];break;case 24576>=l:o=[28,l-16385,13];break;case 32768>=l:o=[29,l-24577,13];break;default:t("invalid distance")}for(n=o,h[u++]=n[0],h[u++]=n[1],h[u++]=n[2],s=0,a=h.length;s<a;++s)m[y++]=h[s];b[h[0]]++,T[h[3]]++,v=e.length+r-1,f=null}var a,l,h,u,c,d,p,f,_,g={},m=o?new Uint16Array(2*n.length):[],y=0,v=0,b=new(o?Uint32Array:Array)(286),T=new(o?Uint32Array:Array)(30),E=r.w;if(!o){for(h=0;285>=h;)b[h++]=0;for(h=0;29>=h;)T[h++]=0}for(b[256]=1,a=0,l=n.length;a<l;++a){for(h=c=0,u=3;h<u&&a+h!==l;++h)c=c<<8|n[a+h];if(g[c]===e&&(g[c]=[]),d=g[c],!(0<v--)){for(;0<d.length&&32768<a-d[0];)d.shift();if(a+3>=l){for(f&&s(f,-1),h=0,u=l-a;h<u;++h)_=n[a+h],m[y++]=_,++b[_];break}if(0<d.length){var A=e,C=e,x=0,R=e,M=e,O=e,P=n.length,D=(M=0,d.length);t:for(;M<D;M++){if(A=d[D-M-1],R=3,3<x){for(O=x;3<O;O--)if(n[A+O-1]!==n[a+O-1])continue t;R=x}for(;258>R&&a+R<P&&n[A+R]===n[a+R];)++R;if(R>x&&(C=A,x=R),258===R)break}p=new S(x,a-C),f?f.length<p.length?(_=n[a-1],m[y++]=_,++b[_],s(p,0)):s(f,-1):p.length<E?f=p:s(p,0)}else f?s(f,-1):(_=n[a],m[y++]=_,++b[_])}d.push(a)}return m[y++]=256,b[256]++,r.L=b,r.K=T,o?m.subarray(0,y):m}function R(t,e){function i(t){var e=E[t][A[t]];e===y?(i(t+1),i(t+1)):--S[e],++A[t]}var r,n,s,a,l,h=t.length,u=new f(572),c=new(o?Uint8Array:Array)(h);if(!o)for(a=0;a<h;a++)c[a]=0;for(a=0;a<h;++a)0<t[a]&&u.push(a,t[a]);if(r=Array(u.length/2),n=new(o?Uint32Array:Array)(u.length/2),1===r.length)return c[u.pop().index]=1,c;for(a=0,l=u.length/2;a<l;++a)r[a]=u.pop(),n[a]=r[a].value;var d,p,_,g,m,y=n.length,v=new(o?Uint16Array:Array)(e),b=new(o?Uint8Array:Array)(e),S=new(o?Uint8Array:Array)(y),T=Array(e),E=Array(e),A=Array(e),C=(1<<e)-y,w=1<<e-1;for(v[e-1]=y,p=0;p<e;++p)C<w?b[p]=0:(b[p]=1,C-=w),C<<=1,v[e-2-p]=(v[e-1-p]/2|0)+y;for(v[0]=b[0],T[0]=Array(v[0]),E[0]=Array(v[0]),p=1;p<e;++p)v[p]>2*v[p-1]+b[p]&&(v[p]=2*v[p-1]+b[p]),T[p]=Array(v[p]),E[p]=Array(v[p]);for(d=0;d<y;++d)S[d]=e;for(_=0;_<v[e-1];++_)T[e-1][_]=n[_],E[e-1][_]=_;for(d=0;d<e;++d)A[d]=0;for(1===b[e-1]&&(--S[0],++A[e-1]),p=e-2;0<=p;--p){for(g=d=0,m=A[p+1],_=0;_<v[p];_++)(g=T[p+1][m]+T[p+1][m+1])>n[d]?(T[p][_]=g,E[p][_]=y,m+=2):(T[p][_]=n[d],E[p][_]=d,++d);A[p]=0,1===b[p]&&i(p)}for(s=S,a=0,l=r.length;a<l;++a)c[r[a].index]=s[a];return c}function M(e){var i,r,n,s,a=new(o?Uint16Array:Array)(e.length),l=[],h=[],u=0;for(i=0,r=e.length;i<r;i++)l[e[i]]=1+(0|l[e[i]]);for(i=1,r=16;i<=r;i++)h[i]=u,(u+=0|l[i])>1<<i&&t("overcommitted"),u<<=1;for(65536>u&&t("undercommitted"),i=0,r=e.length;i<r;i++)for(u=h[e[i]],h[e[i]]+=1,n=a[i]=0,s=e[i];n<s;n++)a[i]=a[i]<<1|1&u,u>>>=1;return a}function O(t,e){this.input=t,this.a=new(o?Uint8Array:Array)(32768),this.h=P.j;var i,r={};for(i in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.z=new g(this.input,r)}var P=v;function D(e,i){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=o?new Uint8Array(e):e,this.s=!1,this.m=B,this.B=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.l=i.bufferSize),i.bufferType&&(this.m=i.bufferType),i.resize&&(this.B=i.resize)),this.m){case I:this.b=32768,this.a=new(o?Uint8Array:Array)(32768+this.l+258);break;case B:this.b=0,this.a=new(o?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}O.prototype.n=function(){var e,i,r,n,a,l,h,u=0;switch(h=this.a,e=ut){case ut:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,h[u++]=r,e){case ut:switch(this.h){case P.NONE:a=0;break;case P.r:a=1;break;case P.j:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=a<<6|0,h[u++]=n|31-(256*r+n)%31,l=s(this.input),this.z.b=u,u=(h=this.z.n()).length,o&&((h=new Uint8Array(h.buffer)).length<=u+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,u+4)),h[u++]=l>>24&255,h[u++]=l>>16&255,h[u++]=l>>8&255,h[u++]=255&l,h},n("Zlib.Deflate",O),n("Zlib.Deflate.compress",(function(t,e){return new O(t,e).n()})),n("Zlib.Deflate.CompressionType",P),n("Zlib.Deflate.CompressionType.NONE",P.NONE),n("Zlib.Deflate.CompressionType.FIXED",P.r),n("Zlib.Deflate.CompressionType.DYNAMIC",P.j);var I=0,B=1,L={D:I,C:B};D.prototype.p=function(){for(;!this.s;){var r=tt(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var n=this.input,s=this.c,a=this.a,l=this.b,h=e,u=e,c=e,d=a.length,p=e;switch(this.e=this.g=0,(h=n[s++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),u=h,(h=n[s++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),u|=h<<8,(h=n[s++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),c=h,(h=n[s++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),u===~(c|=h<<8)&&t(Error("invalid uncompressed block header: length verify")),s+u>n.length&&t(Error("input buffer is broken")),this.m){case I:for(;l+u>a.length;){if(u-=p=d-l,o)a.set(n.subarray(s,s+p),l),l+=p,s+=p;else for(;p--;)a[l++]=n[s++];this.b=l,a=this.f(),l=this.b}break;case B:for(;l+u>a.length;)a=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(o)a.set(n.subarray(s,s+u),l),l+=u,s+=u;else for(;u--;)a[l++]=n[s++];this.c=s,this.b=l,this.a=a;break;case 1:this.o(J,$);break;case 2:it(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var F,k,N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=o?new Uint16Array(N):N,U=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],V=o?new Uint16Array(U):U,H=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],G=o?new Uint8Array(H):H,W=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],X=o?new Uint16Array(W):W,Y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=o?new Uint8Array(Y):Y,q=new(o?Uint8Array:Array)(288);for(F=0,k=q.length;F<k;++F)q[F]=143>=F?8:255>=F?9:279>=F?7:8;var K,Z,J=_(q),Q=new(o?Uint8Array:Array)(30);for(K=0,Z=Q.length;K<Z;++K)Q[K]=5;var $=_(Q);function tt(i,r){for(var n,o=i.g,s=i.e,a=i.input,l=i.c;s<r;)(n=a[l++])===e&&t(Error("input buffer is broken")),o|=n<<s,s+=8;return n=o&(1<<r)-1,i.g=o>>>r,i.e=s-r,i.c=l,n}function et(i,r){for(var n,o,s,a=i.g,l=i.e,h=i.input,u=i.c,c=r[0],d=r[1];l<d;)(n=h[u++])===e&&t(Error("input buffer is broken")),a|=n<<l,l+=8;return s=(o=c[a&(1<<d)-1])>>>16,i.g=a>>s,i.e=l-s,i.c=u,65535&o}function it(t){function e(t,e,i){var r,n,o,s;for(s=0;s<t;)switch(r=et(this,e)){case 16:for(o=3+tt(this,2);o--;)i[s++]=n;break;case 17:for(o=3+tt(this,3);o--;)i[s++]=0;n=0;break;case 18:for(o=11+tt(this,7);o--;)i[s++]=0;n=0;break;default:n=i[s++]=r}return i}var i,r,n,s,a=tt(t,5)+257,l=tt(t,5)+1,h=tt(t,4)+4,u=new(o?Uint8Array:Array)(z.length);for(s=0;s<h;++s)u[z[s]]=tt(t,3);i=_(u),r=new(o?Uint8Array:Array)(a),n=new(o?Uint8Array:Array)(l),t.o(_(e.call(t,a,i,r)),_(e.call(t,l,i,n)))}function rt(e,i){var r,n;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.M=i.verify)),r=e[this.c++],n=e[this.c++],15&r){case ut:this.method=ut;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+n)%31&&t(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new D(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}D.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,o,s,a,l=i.length-258;256!==(n=et(this,t));)if(256>n)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(a=V[o=n-257],0<G[o]&&(a+=tt(this,G[o])),n=et(this,e),s=X[n],0<j[n]&&(s+=tt(this,j[n])),r>=l&&(this.b=r,i=this.f(),r=this.b);a--;)i[r]=i[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.I=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,o,s,a,l=i.length;256!==(n=et(this,t));)if(256>n)r>=l&&(l=(i=this.f()).length),i[r++]=n;else for(a=V[o=n-257],0<G[o]&&(a+=tt(this,G[o])),n=et(this,e),s=X[n],0<j[n]&&(s+=tt(this,j[n])),r+a>l&&(l=(i=this.f()).length);a--;)i[r]=i[r++-s];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.f=function(){var t,e,i=new(o?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(o)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.k.push(i),this.q+=i.length,o)n.set(n.subarray(r,r+32768));else for(t=0;32768>t;++t)n[t]=n[r+t];return this.b=32768,n},D.prototype.J=function(t){var e,i,r,n=this.input.length/this.c+1|0,s=this.input,a=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),i=2>n?(r=(s.length-this.c)/this.u[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*n,o?(e=new Uint8Array(i)).set(a):e=a,this.a=e},D.prototype.t=function(){var t,e,i,r,n,s=0,a=this.a,l=this.k,h=new(o?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return o?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(r=0,n=(t=l[e]).length;r<n;++r)h[s++]=t[r];for(e=32768,i=this.b;e<i;++e)h[s++]=a[e];return this.k=[],this.buffer=h},D.prototype.H=function(){var t,e=this.b;return o?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},rt.prototype.p=function(){var e,i=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==s(e)&&t(Error("invalid adler-32 checksum")),e},n("Zlib.Inflate",rt),n("Zlib.Inflate.BufferType",L),L.ADAPTIVE=L.C,L.BLOCK=L.D,n("Zlib.Inflate.prototype.decompress",rt.prototype.p);var nt,ot,st=new(o?Uint8Array:Array)(288);for(nt=0,ot=st.length;nt<ot;++nt)st[nt]=143>=nt?8:255>=nt?9:279>=nt?7:8;_(st);var at,lt,ht=new(o?Uint8Array:Array)(30);for(at=0,lt=ht.length;at<lt;++at)ht[at]=5;_(ht);var ut=8}).call(qQ);var KQ=qQ.Zlib;KQ.Deflate=KQ.Deflate,KQ.Deflate.compress=KQ.Deflate.compress,KQ.Inflate=KQ.Inflate,KQ.Inflate.BufferType=KQ.Inflate.BufferType,KQ.Inflate.prototype.decompress=KQ.Inflate.prototype.decompress;for(var ZQ=function(){function t(t){var e,i=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var r=0,n=0,o=0;;){o=this.readUInt32();var s=function(){var t=[];for(r=0;r<4;++r)t.push(String.fromCharCode(i.data[i.pos++]));return t}.call(this).join("");switch(s){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(o);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var a=this.readUInt16(),l=this.readUInt16()||100;e.delay=1e3*a/l,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===s&&(this.pos+=4,o-=4),t=(null!=e?e.data:void 0)||this.imgData,r=0;o>=0?r<o:r>o;o>=0?++r:--r)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(o);var h=255-this.transparency.indexed.length;if(h>0)for(n=0;h>=0?n<h:n>h;h>=0?++n:--n)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(o)[0];break;case 2:this.transparency.rgb=this.read(o)}break;case"tEXt":var u=this.read(o),c=u.indexOf(0),d=String.fromCharCode.apply(String,u.slice(0,c));this.text[d]=String.fromCharCode.apply(String,u.slice(c+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(i.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var p=this.colorType;this.hasAlphaChannel=4===p||6===p;var f=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*f,this.colorSpace=function(){switch(i.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=o}if(this.pos+=4,this.pos>this.data.length)throw new Error(so(6017))}}var e=t.prototype;return e.read=function(t){var e=0,i=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)i.push(this.data[this.pos++]);return i},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new KQ.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,i=e*this.width,r=new Uint8Array(i*this.height),n=t.length,o=0,s=0,a=0,l=0,h=0,u=0,c=0,d=0,p=0,f=0,_=0,g=0,m=0,y=0,v=0,b=0,S=0,T=0,E=0;s<n;){switch(t[s++]){case 0:for(u=c=0;c<i;u=c+=1)r[a++]=t[s++];break;case 1:for(u=d=0;d<i;u=d+=1)l=t[s++],g=u<e?0:r[a-e],r[a++]=(l+g)%256;break;case 2:for(u=p=0;p<i;u=p+=1)l=t[s++],h=(u-u%e)/e,T=o&&r[(o-1)*i+h*e+u%e],r[a++]=(T+l)%256;break;case 3:for(u=f=0;f<i;u=f+=1)l=t[s++],h=(u-u%e)/e,g=u<e?0:r[a-e],T=o&&r[(o-1)*i+h*e+u%e],r[a++]=(l+Math.floor((g+T)/2))%256;break;case 4:for(u=_=0;_<i;u=_+=1)l=t[s++],h=(u-u%e)/e,g=u<e?0:r[a-e],0===o?T=E=0:(T=r[(o-1)*i+h*e+u%e],E=h&&r[(o-1)*i+(h-1)*e+u%e]),m=g+T-E,y=Math.abs(m-g),b=Math.abs(m-T),S=Math.abs(m-E),v=y<=b&&y<=S?g:b<=S?T:E,r[a++]=(l+v)%256;break;default:throw new Error(so(6018,t[s-1]))}o++}return r},e.copyToImageData=function(t,e){var i,r=this.hasAlphaChannel,n=this.colors;this.palette.length&&(i=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),n=4,r=!0);var o=t.data||t,s=o.length,a=i||e,l=0,h=0,u=0,c=0;if(1===n)for(;l<s;)u=i?4*e[l/4]:h,c=a[u++],o[l++]=c,o[l++]=c,o[l++]=c,o[l++]=r?a[u++]:255,h=u;else for(;l<s;)u=i?4*e[l/4]:h,o[l++]=a[u++],o[l++]=a[u++],o[l++]=a[u++],o[l++]=r?a[u++]:255,h=u},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],i=new Uint8Array((e.length||0)+t.length),r=0,n=0,o=0,s=0,a=0,l=t.length;a<l;s=a+=3)i[r++]=t[s],i[r++]=t[s+1],i[r++]=t[s+2],o=e[n++],i[r++]=null!=o?o:255;return i},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),i=e.createImageData(this.width,this.height);return this.copyToImageData(i,this.decodePixels(null)),e.putImageData(i,0,0)},t}(),JQ=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(so(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(so(6020));return!0},e.getFieldTypeName=function(t){return t in $Q?$Q[t]:null},e.getFieldTagName=function(t){return t in QQ?QQ[t]:(hn(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,i,r){var n=[],o=this.getFieldTypeLength(e);if(o*i<=4)!1===this._littleEndian?n.push(r>>>8*(4-o)):n.push(r);else for(var s=0;s<i;s++){var a=o*s;o>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(n.push(this.getUint32(r+a)),n.push(this.getUint32(r+a+4))):hn(8e3):n.push(this.getBytes(o,r+a))}return"ASCII"===e&&n.forEach((function(t,e,i){i[e]=String.fromCharCode(t)})),n},e.getBytes=function(t,e){if(t<=0)hn(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);hn(8002)}return 0},e.getBits=function(t,e,i){i=i||0;var r=e+Math.floor(i/8),n=i+t,o=32-t,s=0,a=0;return n<=0?hn(6023):n<=8?(s=24+i,a=this.getUint8(r)):n<=16?(s=16+i,a=this.getUint16(r)):n<=32?(s=i,a=this.getUint32(r)):hn(6022),{bits:a<<s>>>o,byteOffset:r+Math.floor(n/8),bitOffset:n%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),i=[],r=0,n=0;for(r=t+2,n=0;n<e;r+=12,n++){var o=this.getUint16(r),s=this.getUint16(r+2),a=this.getUint32(r+4),l=this.getUint32(r+8),h=this.getFieldTagName(o),u=this.getFieldTypeName(s),c=this.getFieldValues(h,u,a,l);i[h]={type:u,values:c}}this._fileDirectories.push(i);var d=this.getUint32(r);0!==d&&this.parseFileDirectory(d)},e.clampColorSample=function(t,e){var i=Math.pow(2,8-e);return Math.floor(t*i+(i-1))},e.parseTIFF=function(t,e){var i=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var r=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(r);var n=this._fileDirectories[0],o=n.ImageWidth.values[0],s=n.ImageLength.values[0];this._canvas.width=o,this._canvas.height=s;var a=[],l=n.Compression?n.Compression.values[0]:1,h=n.SamplesPerPixel.values[0],u=[],c=0,d=!1;n.BitsPerSample.values.forEach((function(t,e){u[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(u[e].hasBytesPerSample=!0,u[e].bytesPerSample=t/8),c+=t}),this);var p=0;c%8==0&&(d=!0,p=c/8);var f,_=n.StripOffsets.values,g=_.length;if(n.StripByteCounts)f=n.StripByteCounts.values;else{if(hn(8003),1!==g)throw Error(so(6024));f=[Math.ceil(o*s*c/8)]}for(var m=1,y=1,v=0;v<g;v++){var b=_[v];a[v]=[];for(var S=f[v],T=0,E=0,A=1,C=!0,w=[],x=0,R=0,M=0;T<S;T+=A)switch(l){case 1:w=[];for(var O=0;O<h;O++){var P=u[O];if(!P.hasBytesPerSample){var D=this.getBits(P.bitsPerSample,b+T,E);throw w.push(D.bits),T=D.byteOffset-b,E=D.bitOffset,RangeError(so(6025))}var I=P.bytesPerSample*O;w.push(this.getBytes(P.bytesPerSample,b+T+I))}if(a[v].push(w),!d)throw A=0,RangeError(so(6026));A=p;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(C){C=!1;var B=this.getUint8(b+T);B>=0&&B<=127?m=B+1:B>=-127&&B<=-1?y=1-B:C=!0}else{for(var L=this.getUint8(b+T),F=0;F<y;F++){var k=u[R];if(!k.hasBytesPerSample)throw RangeError(so(6025));M=M<<8*x|L,++x===k.bytesPerSample&&(w.push(M),M=x=0,R++),R===h&&(a[v].push(w),w=[],R=0)}0==--m&&(C=!0)}A=1}}if(e.getContext){var N=this._canvas.getContext("2d");N.fillStyle="rgba(255, 255, 255, 0)";var z=n.RowsPerStrip?n.RowsPerStrip.values[0]:s,U=a.length,V=s%z,H=0===V?z:V,G=z,W=0,X=n.PhotometricInterpretation.values[0],Y=[],j=0;n.ExtraSamples&&(j=(Y=n.ExtraSamples.values).length);var q=[],K=0;n.ColorMap&&(q=n.ColorMap.values,K=Math.pow(2,u[0].bitsPerSample));for(var Z=0;Z<U;Z++){Z+1===U&&(G=H);for(var J=a[Z].length,Q=W*Z,$=0,tt=0;$<G&&tt<J;$++)for(var et=0;et<o;et++,tt++){var it=a[Z][tt],rt=0,nt=0,ot=0,st=1;if(j>0)for(var at=0;at<j;at++)if(1===Y[at]||2===Y[at]){st=it[3+at]/256;break}!function(){switch(X){case 0:var t=0;u[0].hasBytesPerSample&&(t=Math.pow(16,2*u[0].bytesPerSample)),it.forEach((function(e,i,r){r[i]=t-e}));case 1:rt=nt=ot=i.clampColorSample(it[0],u[0].bitsPerSample);break;case 2:rt=i.clampColorSample(it[0],u[0].bitsPerSample),nt=i.clampColorSample(it[1],u[1].bitsPerSample),ot=i.clampColorSample(it[2],u[2].bitsPerSample);break;case 3:if(void 0===q)throw Error(so(6027));var e=it[0];rt=i.clampColorSample(q[e],16),nt=i.clampColorSample(q[K+e],16),ot=i.clampColorSample(q[2*K+e],16);break;default:throw RangeError(so(6028,X))}}(),N.fillStyle="rgba("+rt+", "+nt+", "+ot+", "+st+")",N.fillRect(et,Q+$,1,1)}W=G}}return this._canvas}},t}(),QQ={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},$Q={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},t$=new Array(123),e$=0;e$<123;++e$)t$[e$]=64;for(var i$=0;i$<64;++i$)t$["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(i$)]=i$;var r$={name:"Jacob__Codec__Base64",decode:function(t){var e,i,r,n,o,s,a=[],l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)e=t$[t.charCodeAt(l++)]<<2|(n=t$[t.charCodeAt(l++)])>>4,i=(15&n)<<4|(o=t$[t.charCodeAt(l++)])>>2,r=(3&o)<<6|(s=t$[t.charCodeAt(l++)]),a.push(String.fromCharCode(e)),64!==o&&a.push(String.fromCharCode(i)),64!==s&&a.push(String.fromCharCode(r));return a.join("")},decodeAsArray:function(t,e){var i,r,n,o=this.decode(t),s=[];for(i=0,n=o.length/e;i<n;i++)for(s[i]=0,r=e-1;r>=0;--r)s[i]+=o.charCodeAt(i*e+r)<<8*r;return s}},n$=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(n$.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};n$.gunzip=function(t){return t.constructor===Array||t.constructor,new n$(t).gunzip()[0][0]},n$.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},n$.LITERALS=288,n$.NAMEMAX=256,n$.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],n$.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n$.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],n$.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],n$.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],n$.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],n$.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},n$.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},n$.prototype.byteAlign=function(){this.bb=1},n$.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},n$.prototype.readBits=function(t){for(var e=0,i=t;i--;)e=e<<1|this.readBit();return t&&(e=n$.bitReverse[e]>>8-t),e},n$.prototype.flushBuffer=function(){this.bIdx=0},n$.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},n$.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},n$.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},n$.prototype.CreateTree=function(t,e,i){var r;for(this.Places=t,this.treepos=0,this.flens=i,this.fmax=e,r=0;r<17;r++)this.fpos[r]=0;return this.len=0,this.Rec()?-1:0},n$.prototype.DecodeValue=function(t){for(var e,i,r=0,n=t[r];;)if(this.readBit()){if(!(32768&n.b1))return n.b1;for(n=n.jump,e=t.length,i=0;i<e;i++)if(t[i]===n){r=i;break}}else{if(!(32768&n.b0))return n.b0;n=t[++r]}return-1},n$.prototype.DeflateLoop=function(){var t,e,i;do{var r,n;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),r=this.readByte(),r|=this.readByte()<<8,n=this.readByte(),65535&(r^~(n|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");r--;)o=this.readByte(),this.addBuffer(o);else if(1===e)for(;;)if((s=n$.bitReverse[this.readBits(7)]>>1)>23?(s=s<<1|this.readBit())>199?s=(s-=128)<<1|this.readBit():(s-=48)>143&&(s+=136):s+=256,s<256)this.addBuffer(s);else{if(256===s)break;for(s-=257,f=this.readBits(n$.cplext[s])+n$.cplens[s],s=n$.bitReverse[this.readBits(5)]>>3,n$.cpdext[s]>8?(_=this.readBits(8),_|=this.readBits(n$.cpdext[s]-8)<<8):_=this.readBits(n$.cpdext[s]),_+=n$.cpdist[s],s=0;s<f;s++){var o=this.buf32k[this.bIdx-_&32767];this.addBuffer(o)}}else if(2===e){var s,a,l,h,u,c=new Array(320);for(l=257+this.readBits(5),h=1+this.readBits(5),u=4+this.readBits(4),s=0;s<19;s++)c[s]=0;for(s=0;s<u;s++)c[n$.border[s]]=this.readBits(3);for(f=this.distanceTree.length,i=0;i<f;i++)this.distanceTree[i]=new n$.HufNode;if(this.CreateTree(this.distanceTree,19,c,0))return this.flushBuffer(),1;for(a=l+h,i=0;i<a;)if((s=this.DecodeValue(this.distanceTree))<16)c[i++]=s;else if(16===s){var d;if(i+(s=3+this.readBits(2))>a)return this.flushBuffer(),1;for(d=i?c[i-1]:0;s--;)c[i++]=d}else{if(i+(s=17===s?3+this.readBits(3):11+this.readBits(7))>a)return this.flushBuffer(),1;for(;s--;)c[i++]=0}for(f=this.literalTree.length,i=0;i<f;i++)this.literalTree[i]=new n$.HufNode;if(this.CreateTree(this.literalTree,l,c,0))return this.flushBuffer(),1;for(f=this.literalTree.length,i=0;i<f;i++)this.distanceTree[i]=new n$.HufNode;var p=new Array;for(i=l;i<c.length;i++)p[i-l]=c[i];if(this.CreateTree(this.distanceTree,h,p,0))return this.flushBuffer(),1;for(;;)if((s=this.DecodeValue(this.literalTree))>=256){var f,_;if(0==(s-=256))break;for(s--,f=this.readBits(n$.cplext[s])+n$.cplens[s],s=this.DecodeValue(this.distanceTree),n$.cpdext[s]>8?(_=this.readBits(8),_|=this.readBits(n$.cpdext[s]-8)<<8):_=this.readBits(n$.cpdext[s]),_+=n$.cpdist[s];f--;)o=this.buf32k[this.bIdx-_&32767],this.addBuffer(o)}else this.addBuffer(s)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},n$.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},n$.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var i=this.readByte();i|=this.readByte()<<8;var r=this.readByte();for(r|=this.readByte()<<8,o=0,this.nameBuf=[];i--;){var n=this.readByte();"/"===n|":"===n?o=0:o<n$.NAMEMAX-1&&(this.nameBuf[o++]=String.fromCharCode(n))}this.fileout||(this.fileout=this.nameBuf);for(var o=0;o<r;)n=this.readByte(),o++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},n$.prototype.skipdir=function(){var t,e,i=[];if(8&this.gpflags&&(i[0]=this.readByte(),i[1]=this.readByte(),i[2]=this.readByte(),i[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),i[0]=this.readByte(),8!==i[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(i[0]=this.readByte(),i[2]=this.readByte(),this.len=i[0]+256*i[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<n$.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var o$,s$,a$,l$,h$,u$,c$,d$,p$,f$,_$,g$,m$,y$,v$,b$,S$,T$,E$,A$,C$,w$,x$,R$,M$,O$,P$,D$,I$,B$,L$,F$,k$,N$,z$,U$,V$,H$,G$,W$,X$,Y$,j$,q$,K$,Z$,J$,Q$,$$,t0,e0,i0,r0,n0,o0,s0,a0,l0,h0,u0,c0,d0,p0,f0,_0,g0,m0,y0,v0,b0,S0,T0,E0,A0,C0,w0,x0,R0,M0,O0,P0,D0,I0,B0,L0,F0,k0,N0,z0,U0,V0,H0,G0,W0,X0,Y0,j0,q0,K0={name:"Jacob__Codec"};function Z0(t){var e=t.parent,i=t.getComponent(c1);return e&&i?Z0(e):t.getComponentsInChildren(c1)}K0.Base64=r$,K0.GZip=n$,K0.unzip=function(){return K0.GZip.gunzip.apply(K0.GZip,arguments)},K0.unzipBase64=function(){var t=K0.Base64.decode.apply(K0.Base64,arguments);try{return K0.GZip.gunzip.call(K0.GZip,t)}catch(e){return t.slice(7)}},K0.unzipBase64AsArray=function(t,e){e=e||1;var i,r,n,o=this.unzipBase64(t),s=[];for(i=0,n=o.length/e;i<n;i++)for(s[i]=0,r=e-1;r>=0;--r)s[i]+=o.charCodeAt(i*e+r)<<8*r;return s},K0.unzipAsArray=function(t,e){e=e||1;var i,r,n,o=this.unzip(t),s=[];for(i=0,n=o.length/e;i<n;i++)for(s[i]=0,r=e-1;r>=0;--r)s[i]+=o.charCodeAt(i*e+r)<<8*r;return s},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(q0||(q0={}));var J0,Q0,$0,t1,e1,i1,r1,n1,o1,s1,a1,l1,h1,u1,c1=t("ParticleSystem2D",(o$=_i("cc.ParticleSystem2D"),s$=Ui(),a$=Vi(),l$=Di(jQ),h$=Vi(),u$=Di(dc),c$=Vi(),d$=Vi(),p$=Vi(),f$=Vi(),_$=Vi(),g$=Vi(),m$=Vi(),y$=Vi(),v$=Hi(),b$=Vi(),S$=Vi(),T$=Vi(),E$=Vi(),A$=Vi(),C$=Vi(),w$=Vi(),x$=Vi(),R$=Vi(),M$=Vi(),O$=Vi(),P$=Vi(),D$=Vi(),I$=Di(kQ),B$=Vi(),L$=Di(FQ),F$=Vi(),k$=Vi(),N$=Vi(),z$=Vi(),U$=Vi(),V$=Vi(),H$=Vi(),G$=Vi(),W$=Vi(),X$=Vi(),Y$=Vi(),j$=Vi(),q$=Vi(),K$=Vi(),Z$=Vi(),J$=Vi(),Q$=Vi(),$$=Oi("preview"),t0=Vi(),o$(e0=s$(e0=ao(e0=Ii((j0=Y0=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"duration",r0,Ti(e)),Si(e,"emissionRate",n0,Ti(e)),Si(e,"life",o0,Ti(e)),Si(e,"lifeVar",s0,Ti(e)),Si(e,"angle",a0,Ti(e)),Si(e,"angleVar",l0,Ti(e)),Si(e,"startSize",h0,Ti(e)),Si(e,"startSizeVar",u0,Ti(e)),Si(e,"endSize",c0,Ti(e)),Si(e,"endSizeVar",d0,Ti(e)),Si(e,"startSpin",p0,Ti(e)),Si(e,"startSpinVar",f0,Ti(e)),Si(e,"endSpin",_0,Ti(e)),Si(e,"endSpinVar",g0,Ti(e)),Si(e,"sourcePos",m0,Ti(e)),Si(e,"posVar",y0,Ti(e)),Si(e,"emitterMode",v0,Ti(e)),Si(e,"gravity",b0,Ti(e)),Si(e,"speed",S0,Ti(e)),Si(e,"speedVar",T0,Ti(e)),Si(e,"tangentialAccel",E0,Ti(e)),Si(e,"tangentialAccelVar",A0,Ti(e)),Si(e,"radialAccel",C0,Ti(e)),Si(e,"radialAccelVar",w0,Ti(e)),Si(e,"rotationIsDir",x0,Ti(e)),Si(e,"startRadius",R0,Ti(e)),Si(e,"startRadiusVar",M0,Ti(e)),Si(e,"endRadius",O0,Ti(e)),Si(e,"endRadiusVar",P0,Ti(e)),Si(e,"rotatePerS",D0,Ti(e)),Si(e,"rotatePerSVar",I0,Ti(e)),e.aspectRatio=1,Si(e,"playOnLoad",B0,Ti(e)),Si(e,"autoRemoveOnFinish",L0,Ti(e)),Si(e,"_preview",F0,Ti(e)),Si(e,"_custom",k0,Ti(e)),Si(e,"_file",N0,Ti(e)),Si(e,"_spriteFrame",z0,Ti(e)),Si(e,"_totalParticles",U0,Ti(e)),Si(e,"_startColor",V0,Ti(e)),Si(e,"_startColorVar",H0,Ti(e)),Si(e,"_endColor",G0,Ti(e)),Si(e,"_endColorVar",W0,Ti(e)),Si(e,"_positionType",X0,Ti(e)),e._stopped=!0,e.initProperties(),e}He(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},i.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0},i.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new YQ(this)},i.onFocusInEditor=function(){this._focused=!0;for(var t=Z0(this.node),e=0;e<t.length;++e)t[e]._startPreview()},i.onLostFocusInEditor=function(){this._focused=!1;for(var t=Z0(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},i._startPreview=function(){this._preview&&this.resetSystem()},i._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},i.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},i.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},i.addParticle=function(){},i.stopSystem=function(){this._stopped=!0,this._simulator.stop()},i.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},i.isFull=function(){return this.particleCount>=this.totalParticles},i._applyFile=function(){var t=this._file;if(t){if(!t)return void We(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},i._initTextureWithDictionary=function(t){var e,i=this;if(t.spriteFrameUuid){var r=t.spriteFrameUuid;lo.loadAny(r,(function(e,r){e?(t.spriteFrameUuid=void 0,i._initTextureWithDictionary(t),Ye(e)):i.spriteFrame=r}))}else{var n=ho(this._plistFile,t.textureFileName||"");if(t.textureFileName)lo.loadRemote(n,(function(e,r){e?(t.textureFileName=void 0,i._initTextureWithDictionary(t),Ye(e)):i.spriteFrame=dc.createWithImage(r)}));else if(t.textureImageData){var o=t.textureImageData;if(!(o&&o.length>0))return!1;var s=lo.assets.get(n);if(!s){var a=K0.unzipBase64AsArray(o,1);if(!a)return $e(6030,this._file.name),!1;var l=(e=a).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?q0.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?q0.TIFF:q0.UNKNOWN;if(l!==q0.TIFF&&l!==q0.PNG)return $e(6031,this._file.name),!1;var h=document.createElement("canvas");l===q0.PNG?new ZQ(a).render(h):(this._tiffReader||(this._tiffReader=new JQ),this._tiffReader.parseTIFF(a,h)),s=new oi(h),lo.assets.add(n,s)}s||$e(6032,this._file.name),this.spriteFrame=dc.createWithImage(s)}}return!0},i._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||x.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||x.ONE_MINUS_SRC_ALPHA);var i=this._startColor;i.r=255*parseFloat(t.startColorRed||0),i.g=255*parseFloat(t.startColorGreen||0),i.b=255*parseFloat(t.startColorBlue||0),i.a=255*parseFloat(t.startColorAlpha||0);var r=this._startColorVar;r.r=255*parseFloat(t.startColorVarianceRed||0),r.g=255*parseFloat(t.startColorVarianceGreen||0),r.b=255*parseFloat(t.startColorVarianceBlue||0),r.a=255*parseFloat(t.startColorVarianceAlpha||0);var n=this._endColor;n.r=255*parseFloat(t.finishColorRed||0),n.g=255*parseFloat(t.finishColorGreen||0),n.b=255*parseFloat(t.finishColorBlue||0),n.a=255*parseFloat(t.finishColorAlpha||0);var o=this._endColorVar;if(o.r=255*parseFloat(t.finishColorVarianceRed||0),o.g=255*parseFloat(t.finishColorVarianceGreen||0),o.b=255*parseFloat(t.finishColorVarianceBlue||0),o.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:kQ.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||FQ.GRAVITY),this.emitterMode===FQ.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var s=t.rotationIsDir||"";null!==s?(s=s.toString().toLowerCase(),this.rotationIsDir="true"===s||"1"===s):this.rotationIsDir=!1}else{if(this.emitterMode!==FQ.RADIUS)return $e(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},i._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},i._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()):this.resetSystem()},i._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},i._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==kQ.FREE})},i._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},i._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame},i._render=function(t){this._positionType===kQ.RELATIVE?t.commitComp(this,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===kQ.GROUPED?t.commitComp(this,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._renderSpriteFrame,this._assembler,null)},Ge(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(uf),Y0.EmitterMode=FQ,Y0.PositionType=kQ,Y0.DURATION_INFINITY=-1,Y0.START_SIZE_EQUAL_TO_END_SIZE=-1,Y0.START_RADIUS_EQUAL_TO_END_RADIUS=-1,bi((i0=j0).prototype,"custom",[Pi,a$],Object.getOwnPropertyDescriptor(i0.prototype,"custom"),i0.prototype),bi(i0.prototype,"file",[l$,h$],Object.getOwnPropertyDescriptor(i0.prototype,"file"),i0.prototype),bi(i0.prototype,"spriteFrame",[u$,c$],Object.getOwnPropertyDescriptor(i0.prototype,"spriteFrame"),i0.prototype),bi(i0.prototype,"totalParticles",[Pi,d$],Object.getOwnPropertyDescriptor(i0.prototype,"totalParticles"),i0.prototype),r0=bi(i0.prototype,"duration",[Ai,Pi,p$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),n0=bi(i0.prototype,"emissionRate",[Ai,Pi,f$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),o0=bi(i0.prototype,"life",[Ai,Pi,_$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),s0=bi(i0.prototype,"lifeVar",[Ai,Pi,g$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(i0.prototype,"startColor",[Pi,m$],Object.getOwnPropertyDescriptor(i0.prototype,"startColor"),i0.prototype),bi(i0.prototype,"startColorVar",[Pi,y$],Object.getOwnPropertyDescriptor(i0.prototype,"startColorVar"),i0.prototype),bi(i0.prototype,"color",[v$],Object.getOwnPropertyDescriptor(i0.prototype,"color"),i0.prototype),bi(i0.prototype,"endColor",[Pi,b$],Object.getOwnPropertyDescriptor(i0.prototype,"endColor"),i0.prototype),bi(i0.prototype,"endColorVar",[Pi,S$],Object.getOwnPropertyDescriptor(i0.prototype,"endColorVar"),i0.prototype),a0=bi(i0.prototype,"angle",[Ai,Pi,T$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),l0=bi(i0.prototype,"angleVar",[Ai,Pi,E$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),h0=bi(i0.prototype,"startSize",[Ai,Pi,A$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),u0=bi(i0.prototype,"startSizeVar",[Ai,Pi,C$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c0=bi(i0.prototype,"endSize",[Ai,Pi,w$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d0=bi(i0.prototype,"endSizeVar",[Ai,Pi,x$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p0=bi(i0.prototype,"startSpin",[Ai,Pi,R$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f0=bi(i0.prototype,"startSpinVar",[Ai,Pi,M$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_0=bi(i0.prototype,"endSpin",[Ai,Pi,O$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),g0=bi(i0.prototype,"endSpinVar",[Ai,Pi,P$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m0=bi(i0.prototype,"sourcePos",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cr.ZERO.clone()}}),y0=bi(i0.prototype,"posVar",[Ai,Pi,D$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cr.ZERO.clone()}}),bi(i0.prototype,"positionType",[I$,B$],Object.getOwnPropertyDescriptor(i0.prototype,"positionType"),i0.prototype),bi(i0.prototype,"preview",[Pi],Object.getOwnPropertyDescriptor(i0.prototype,"preview"),i0.prototype),v0=bi(i0.prototype,"emitterMode",[Ai,Pi,L$,F$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FQ.GRAVITY}}),b0=bi(i0.prototype,"gravity",[Ai,Pi,k$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cr.ZERO.clone()}}),S0=bi(i0.prototype,"speed",[Ai,Pi,N$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),T0=bi(i0.prototype,"speedVar",[Ai,Pi,z$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),E0=bi(i0.prototype,"tangentialAccel",[Ai,Pi,U$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),A0=bi(i0.prototype,"tangentialAccelVar",[Ai,Pi,V$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C0=bi(i0.prototype,"radialAccel",[Ai,Pi,H$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w0=bi(i0.prototype,"radialAccelVar",[Ai,Pi,G$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),x0=bi(i0.prototype,"rotationIsDir",[Ai,Pi,W$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),R0=bi(i0.prototype,"startRadius",[Ai,Pi,X$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M0=bi(i0.prototype,"startRadiusVar",[Ai,Pi,Y$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O0=bi(i0.prototype,"endRadius",[Ai,Pi,j$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),P0=bi(i0.prototype,"endRadiusVar",[Ai,Pi,q$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D0=bi(i0.prototype,"rotatePerS",[Ai,Pi,K$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I0=bi(i0.prototype,"rotatePerSVar",[Ai,Pi,Z$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B0=bi(i0.prototype,"playOnLoad",[Ai,Pi,J$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),L0=bi(i0.prototype,"autoRemoveOnFinish",[Ai,Pi,Q$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),F0=bi(i0.prototype,"_preview",[$$,Pi,t0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),k0=bi(i0.prototype,"_custom",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N0=bi(i0.prototype,"_file",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z0=bi(i0.prototype,"_spriteFrame",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U0=bi(i0.prototype,"_totalParticles",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),V0=bi(i0.prototype,"_startColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(255,255,255,255)}}),H0=bi(i0.prototype,"_startColorVar",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(0,0,0,0)}}),G0=bi(i0.prototype,"_endColor",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(255,255,255,0)}}),W0=bi(i0.prototype,"_endColorVar",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tr(0,0,0,0)}}),X0=bi(i0.prototype,"_positionType",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kQ.FREE}}),e0=i0))||e0)||e0)||e0)||e0)),d1=function(){function t(t,e){this.point=new Cr,this.dir=new Cr,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),p1=t("MotionStreak",(J0=_i("cc.MotionStreak"),Q0=Ui(),$0=Ni(),t1=Di(si),J0(e1=Ii(e1=ao(e1=Q0(e1=$0((u1=h1=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_preview",r1,Ti(e)),Si(e,"_fadeTime",n1,Ti(e)),Si(e,"_minSeg",o1,Ti(e)),Si(e,"_stroke",s1,Ti(e)),Si(e,"_texture",a1,Ti(e)),Si(e,"_fastMode",l1,Ti(e)),e._points=[],e}He(e,t);var i=e.prototype;return i.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},i.onFocusInEditor=function(){this._preview&&this.reset()},i.onLostFocusInEditor=function(){this._preview&&this.reset()},i.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},i.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},i._render=function(t){t.commitComp(this,this._texture,this._assembler,null)},Ge(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(uf),h1.Point=d1,bi((i1=u1).prototype,"preview",[Pi],Object.getOwnPropertyDescriptor(i1.prototype,"preview"),i1.prototype),bi(i1.prototype,"fadeTime",[Pi],Object.getOwnPropertyDescriptor(i1.prototype,"fadeTime"),i1.prototype),bi(i1.prototype,"minSeg",[Pi],Object.getOwnPropertyDescriptor(i1.prototype,"minSeg"),i1.prototype),bi(i1.prototype,"stroke",[Pi],Object.getOwnPropertyDescriptor(i1.prototype,"stroke"),i1.prototype),bi(i1.prototype,"texture",[t1],Object.getOwnPropertyDescriptor(i1.prototype,"texture"),i1.prototype),bi(i1.prototype,"fastMode",[Pi],Object.getOwnPropertyDescriptor(i1.prototype,"fastMode"),i1.prototype),r1=bi(i1.prototype,"_preview",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),n1=bi(i1.prototype,"_fadeTime",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),o1=bi(i1.prototype,"_minSeg",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),s1=bi(i1.prototype,"_stroke",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),a1=bi(i1.prototype,"_texture",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l1=bi(i1.prototype,"_fastMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),e1=i1))||e1)||e1)||e1)||e1)||e1)),f1=(new Cr,new Cr),_1=new Cr;function g1(t,e){return t.x=-e.y,t.y=e.x,t}var m1={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.vertexCount=16,e.indicesCount=42,e},update:function(t,e){var i,r=t.stroke/2,n=t.node.worldMatrix,o=n.m12,s=n.m13,a=t.points;if(a.length>1){var l=a[0],h=l.point.x-o,u=l.point.y-s;h*h+u*u<t.minSeg&&(i=l)}i||(i=new p1.Point,a.unshift(i)),i.setPoint(o,s),i.time=t.fadeTime+e;var c,d=0;if(!(a.length<2)){var p=t.renderData,f=t.color,_=f.r,g=f.g,m=f.b,y=f.a,v=a[1];v.distance=Cr.subtract(_1,i.point,v.point).length(),_1.normalize(),v.setDir(_1.x,_1.y),i.setDir(_1.x,_1.y),p.dataLength=2*a.length;for(var b=p.data,S=t.fadeTime,T=!1,E=a.length-1;E>=0;E--){var A=a[E],C=A.point,w=A.dir;if(A.time-=e,A.time<0)a.splice(E,1);else{var x=A.time/S,R=a[E-1];if(!T){if(!R){a.splice(E,1);continue}C.x=R.point.x-w.x*x,C.y=R.point.y-w.y*x}T=!0,g1(f1,w);var M=(x*y<<24>>>0)+(m<<16)+(g<<8)+_,O=d;b[O].x=C.x+f1.x*r,b[O].y=C.y+f1.y*r,b[O].u=1,b[O].v=x,b[O].color._val=M,b[O+=1].x=C.x-f1.x*r,b[O].y=C.y-f1.y*r,b[O].u=0,b[O].v=x,b[O].color._val=M,d+=2}}c=d<=2?0:3*(d-2),p.vertexCount=d,p.indicesCount=c}},updateRenderData:function(){},fillBuffers:function(t,e){var i=t.renderData,r=i.data,n=(t.node,e.acquireBufferBatch()),o=n.byteOffset>>2,s=n.indicesOffset,a=n.vertexOffset;n.request(i.vertexCount,i.indicesCount)||(n=e.currBufferBatch,s=0,a=0);for(var l=n.vData,h=n.iData,u=i.vertexCount,c=i.indicesCount,d=0;d<u;d++){var p=r[d];l[o++]=p.x,l[o++]=p.y,l[o++]=p.z,l[o++]=p.u,l[o++]=p.v,tr.toArray(l,p.color,o),o+=4}for(var f=0,_=c;f<_;f+=2){var g=a+f;h[s++]=g,h[s++]=g+2,h[s++]=g+1,h[s++]=g+1,h[s++]=g+2,h[s++]=g+3}}},y1=t("MotionStreakAssemblerManager",{getAssembler:function(){return m1}});p1.Assembler=y1;var v1,b1,S1,T1={maxParticleDeltaTime:0,createData:function(){return Sd.add()},updateRenderData:function(){},fillBuffers:function(t,e){if(null!==t){var i=t._simulator.renderData;if(0!==i.vertexCount&&0!==i.indicesCount){var r=e.acquireBufferBatch(),n=r.byteOffset>>2,o=r.indicesOffset,s=r.vertexOffset;r.request(i.vertexCount,i.indicesCount)||(r=e.currBufferBatch,o=0,s=0);for(var a=r.vData,l=r.iData,h=i.vData,u=i.iData,c=9*i.vertexCount,d=0;d<c;d++)a[n++]=h[d];for(var p=i.indicesCount,f=0;f<p;f++)l[o++]=u[f]+s}}}},E1=t("ParticleSystem2DAssembler",{getAssembler:function(){return T1.maxParticleDeltaTime||(T1.maxParticleDeltaTime=ei.game.frameTime/1e3*2),T1}});c1.Assembler=E1,function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(v1||(v1={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(b1||(b1={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(S1||(S1={}));var A1,C1,w1=0;function x1(t,e){var i;e.invoking||(e.invoking=!0,(i=e.func).call.apply(i,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var i=t._operationQueue[0];i&&x1(t,i)})).catch((function(){})))}function R1(t,e,i){var r=i.value;i.value=function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return new Promise((function(e){var n=w1++,o=t;o._operationQueue.push({id:n,func:r,args:i,invoking:!1}),o._eventTarget.once(n.toString(),e),x1(o,o._operationQueue[0])}))}}function M1(t){return new Promise((function(e){var i=t.play();return void 0===i?e():(i.then(e).catch((function(){var i=function(){t.play().catch((function(){})),e()},r=document.getElementById("GameCanvas");null==r||r.addEventListener("touchend",i,{once:!0}),null==r||r.addEventListener("mousedown",i,{once:!0})})),null)}))}var O1,P1,D1,I1=function(){function t(t,e){this._domAudio=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._domAudio=t,t.volume=e}var e=t.prototype;return e.play=function(){var t=this;M1(this._domAudio).then((function(){var e;null===(e=t.onPlay)||void 0===e||e.call(t)})).catch((function(){}))},e.stop=function(){this._domAudio.pause()},Ge(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb&&this._domAudio.removeEventListener("ended",this._onEndCb),this._onEndCb=t,t&&this._domAudio.addEventListener("ended",t)}}]),t}(),B1=(C1=function(){function t(t){var e=this;this._domAudio=void 0,this._state=S1.INIT,this._onEnded=void 0,this._eventTarget=new co,this._operationQueue=[],this._domAudio=t,uo.on("hide",this._onHide,this),uo.on("show",this._onShow,this),this._onEnded=function(){e.seek(0).catch((function(){})),e._state=S1.INIT,e._eventTarget.emit(v1.ENDED)},this._domAudio.addEventListener("ended",this._onEnded)}var e=t.prototype;return e.destroy=function(){uo.off("hide",this._onHide,this),uo.off("show",this._onShow,this),this._domAudio.removeEventListener("ended",this._onEnded),this._domAudio=null},t.load=function(e){return new Promise((function(i){t.loadNative(e).then((function(e){i(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,i){var r=document.createElement("audio"),n="canplaythrough";uo.os===Ze.IOS?n="loadedmetadata":uo.browserType===Je.FIREFOX&&(n="canplay");var o=setTimeout((function(){0===r.readyState?l():a()}),8e3),s=function(){clearTimeout(o),r.removeEventListener(n,a,!1),r.removeEventListener("error",l,!1)},a=function(){s(),e(r)},l=function(){s(),i("load audio failure - "+t)};r.addEventListener(n,a,!1),r.addEventListener("error",l,!1),r.src=t}))},t.loadOneShotAudio=function(e,i){return new Promise((function(r,n){t.loadNative(e).then((function(t){var e=new I1(t,i);r(e)})).catch(n)}))},e._onHide=function(){var t=this;this._state===S1.PLAYING&&this.pause().then((function(){t._state=S1.INTERRUPTED,t._eventTarget.emit(v1.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===S1.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(v1.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){return t=Zr(t,0,this.duration),this._domAudio.currentTime=t,Promise.resolve()},e.play=function(){var t=this;return new Promise((function(e){M1(t._domAudio).then((function(){t._state=S1.PLAYING,e()})).catch((function(){}))}))},e.pause=function(){return this._domAudio.pause(),this._state=S1.PAUSED,Promise.resolve()},e.stop=function(){var t=this;return new Promise((function(e){t._domAudio.pause(),t._domAudio.currentTime=0,t._state=S1.STOPPED,e()}))},e.onInterruptionBegin=function(t){this._eventTarget.on(v1.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(v1.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(v1.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(v1.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(v1.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(v1.ENDED,t)},Ge(t,[{key:"src",get:function(){return this._domAudio?this._domAudio.src:""}},{key:"type",get:function(){return b1.DOM_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._domAudio.loop},set:function(t){this._domAudio.loop=t}},{key:"volume",get:function(){return this._domAudio.volume},set:function(t){t=En(t),this._domAudio.volume=t}},{key:"duration",get:function(){return this._domAudio.duration}},{key:"currentTime",get:function(){return this._domAudio.currentTime}}]),t}(),bi((A1=C1).prototype,"seek",[R1],Object.getOwnPropertyDescriptor(A1.prototype,"seek"),A1.prototype),bi(A1.prototype,"play",[R1],Object.getOwnPropertyDescriptor(A1.prototype,"play"),A1.prototype),bi(A1.prototype,"pause",[R1],Object.getOwnPropertyDescriptor(A1.prototype,"pause"),A1.prototype),bi(A1.prototype,"stop",[R1],Object.getOwnPropertyDescriptor(A1.prototype,"stop"),A1.prototype),A1),L1=function(){function t(t){this._nativeAudio=void 0,this._startTime=0,this._startOffset=0,this._isPaused=!0,this._nativeAudio=t}var e=t.prototype;return e.destroy=function(){this._nativeAudio=void 0},e._now=function(){return performance.now()/1e3},e._calculateCurrentTime=function(){var t=this._now()-this._startTime,e=this._startOffset+t;return e>=this.duration&&(this._startTime=this._now(),this._startOffset=0),e%this.duration},e.start=function(){this._isPaused=!1,this._startTime=this._now()},e.pause=function(){this._isPaused||(this._isPaused=!0,this._startOffset=this._calculateCurrentTime())},e.stop=function(){this._isPaused=!0,this._startOffset=0},e.seek=function(t){this._startTime=this._now(),this._startOffset=Zr(t,0,this.duration)},Ge(t,[{key:"duration",get:function(){return this._nativeAudio.duration}},{key:"currentTime",get:function(){return this._isPaused?this._startOffset:this._calculateCurrentTime()}}]),t}(),F1=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,k1=function(){function t(){this._context=void 0,this._context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}var e=t.prototype;return e.decodeAudioData=function(t){var e=this;return new Promise((function(i){var r=e._context.decodeAudioData(t,(function(t){i(t)}),(function(t){console.error("failed to load Web Audio",t)}));null==r||r.catch((function(){}))}))},e.runContext=function(){var t=this;return new Promise((function(e){var i=t._context;if(!i.resume)return e();if("running"===i.state)return e();if(i.resume().catch((function(){})),"running"!==i.state){var r=document.getElementById("GameCanvas"),n=function(){i.resume().then(e).catch((function(){}))};null==r||r.addEventListener("touchend",n,{once:!0}),null==r||r.addEventListener("mousedown",n,{once:!0})}return null}))},e.createBufferSource=function(t,e){var i=this._context.createBufferSource();return void 0!==t&&(i.buffer=t),void 0!==e&&(i.loop=e),i},e.createGain=function(t){void 0===t&&(t=1);var e=this._context.createGain();return this.setGainValue(e,t),e},e.setGainValue=function(t,e){if(t.gain.setTargetAtTime)try{t.gain.setTargetAtTime(e,this._context.currentTime,0)}catch(i){t.gain.setTargetAtTime(e,this._context.currentTime,.01)}else t.gain.value=e},e.connectContext=function(t){this._context&&t.connect(this._context.destination)},Ge(t,[{key:"currentTime",get:function(){return this._context.currentTime}}]),t}();k1.support=!!F1,k1.support&&(D1=new k1);var N1,z1,U1,V1,H1,G1=function(){function t(t,e){this._duration=void 0,this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._duration=t.duration,this._bufferSourceNode=D1.createBufferSource(t,!1);var i=D1.createGain(e);this._bufferSourceNode.connect(i),D1.connectContext(i)}var e=t.prototype;return e.play=function(){var t=this;D1.runContext().then((function(){var e;t._bufferSourceNode.start(),null===(e=t.onPlay)||void 0===e||e.call(t),window.setTimeout((function(){var e;null===(e=t.onEnd)||void 0===e||e.call(t)}),1e3*t._duration)})).catch((function(){}))},e.stop=function(){this._bufferSourceNode.stop()},Ge(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),W1=(P1=function(){function t(t,e){this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._currentTimer=0,this._volume=1,this._loop=!1,this._state=S1.INIT,this._audioTimer=void 0,this._eventTarget=new co,this._operationQueue=[],this._audioBuffer=t,this._audioTimer=new L1(t),this._gainNode=D1.createGain(),D1.connectContext(this._gainNode),this._src=e,uo.on("hide",this._onHide,this),uo.on("show",this._onShow,this)}var e=t.prototype;return e.destroy=function(){this._audioTimer.destroy(),this._audioBuffer&&(this._audioBuffer=null),uo.off("hide",this._onHide,this),uo.off("show",this._onShow,this)},t.load=function(e){return new Promise((function(i){t.loadNative(e).then((function(r){i(new t(r,e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,i){var r=new XMLHttpRequest,n="load audio failed: "+t+", status: ";r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200===r.status||0===r.status?D1.decodeAudioData(r.response).then((function(t){e(t)})).catch((function(){})):i(new Error(""+n+r.status+"(no response)"))},r.onerror=function(){i(new Error(""+n+r.status+"(error)"))},r.ontimeout=function(){i(new Error(""+n+r.status+"(time out)"))},r.onabort=function(){i(new Error(""+n+r.status+"(abort)"))},r.send(null)}))},t.loadOneShotAudio=function(e,i){return new Promise((function(r,n){t.loadNative(e).then((function(t){var e=new G1(t,i);r(e)})).catch(n)}))},e._onHide=function(){var t=this;this._state===S1.PLAYING&&this.pause().then((function(){t._state=S1.INTERRUPTED,t._eventTarget.emit(v1.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._state===S1.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(v1.INTERRUPTION_END)})).catch((function(){}))},e.seek=function(t){var e=this;return new Promise((function(i){e._audioTimer.seek(t),e._state===S1.PLAYING?e._doPlay().then(i).catch((function(){})):i()}))},e.play=function(){return this._doPlay()},e._doPlay=function(){var t=this;return new Promise((function(e){D1.runContext().then((function(){t._stopSourceNode(),t._sourceNode=D1.createBufferSource(t._audioBuffer,t.loop),t._sourceNode.connect(t._gainNode),t._sourceNode.start(0,t._audioTimer.currentTime),t._state=S1.PLAYING,t._audioTimer.start(),window.clearTimeout(t._currentTimer),t._currentTimer=window.setTimeout((function e(){t.loop?t._currentTimer=window.setTimeout(e,1e3*t._audioBuffer.duration):(t._audioTimer.stop(),t._eventTarget.emit(v1.ENDED),t._state=S1.INIT)}),1e3*(t._audioBuffer.duration-t._audioTimer.currentTime)),e()})).catch((function(){}))}))},e._stopSourceNode=function(){try{var t;null===(t=this._sourceNode)||void 0===t||t.stop()}catch(t){}},e.pause=function(){return this._state===S1.PLAYING&&this._sourceNode?(this._audioTimer.pause(),this._state=S1.PAUSED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.stop=function(){return this._sourceNode?(this._audioTimer.stop(),this._state=S1.STOPPED,window.clearTimeout(this._currentTimer),this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.onInterruptionBegin=function(t){this._eventTarget.on(v1.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(v1.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(v1.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(v1.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(v1.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(v1.ENDED,t)},Ge(t,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return b1.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._sourceNode&&(this._sourceNode.loop=t)}},{key:"volume",get:function(){return this._volume},set:function(t){t=En(t),this._volume=t,D1.setGainValue(this._gainNode,t)}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._audioTimer.currentTime}}]),t}(),bi((O1=P1).prototype,"seek",[R1],Object.getOwnPropertyDescriptor(O1.prototype,"seek"),O1.prototype),bi(O1.prototype,"play",[R1],Object.getOwnPropertyDescriptor(O1.prototype,"play"),O1.prototype),bi(O1.prototype,"pause",[R1],Object.getOwnPropertyDescriptor(O1.prototype,"pause"),O1.prototype),bi(O1.prototype,"stop",[R1],Object.getOwnPropertyDescriptor(O1.prototype,"stop"),O1.prototype),O1),X1=function(){function t(t){this._audio=void 0,this._audio=t}var e=t.prototype;return e.play=function(){this._audio.play()},e.stop=function(){this._audio.stop()},Ge(t,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(t){this._audio.onPlay=t}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(t){this._audio.onEnd=t}}]),t}(),Y1=function(){function t(t){this._player=void 0,this._player=t}t.load=function(e,i){return new Promise((function(r){(null==i?void 0:i.audioLoadMode)!==b1.DOM_AUDIO&&k1.support?W1.load(e).then((function(e){r(new t(e))})).catch((function(){})):(k1.support||$e(5201),B1.load(e).then((function(e){r(new t(e))})).catch((function(){})))}))};var e=t.prototype;return e.destroy=function(){this._player.destroy()},t.loadNative=function(t,e){return(null==e?void 0:e.audioLoadMode)!==b1.DOM_AUDIO&&k1.support?W1.loadNative(t):(k1.support||$e(5201),B1.loadNative(t))},t.loadOneShotAudio=function(t,e,i){return new Promise((function(r,n){(null==i?void 0:i.audioLoadMode)!==b1.DOM_AUDIO&&k1.support?W1.loadOneShotAudio(t,e).then((function(t){r(new X1(t))})).catch(n):(k1.support||$e(5201),B1.loadOneShotAudio(t,e).then((function(t){r(new X1(t))})).catch(n))}))},e.seek=function(t){return this._player.seek(t)},e.play=function(){return this._player.play()},e.pause=function(){return this._player.pause()},e.stop=function(){return this._player.stop()},e.onInterruptionBegin=function(t){this._player.onInterruptionBegin(t)},e.offInterruptionBegin=function(t){this._player.offInterruptionBegin(t)},e.onInterruptionEnd=function(t){this._player.onInterruptionEnd(t)},e.offInterruptionEnd=function(t){this._player.offInterruptionEnd(t)},e.onEnded=function(t){this._player.onEnded(t)},e.offEnded=function(t){this._player.offEnded(t)},Ge(t,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(t){this._player.loop=t}},{key:"volume",get:function(){return this._player.volume},set:function(t){this._player.volume=t}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),t}();Y1.maxAudioChannel=24;var j1=t("AudioClip",_i("cc.AudioClip")((H1=V1=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_duration",U1,Ti(e)),e._loadMode=b1.UNKNOWN_AUDIO,e._meta=null,e._player=void 0,e}He(e,t);var i=e.prototype;return i.destroy=function(){var e,i=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),i},i.validate=function(){return!!this._meta},i.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},i.getCurrentTime=function(){return this._player?this._player.currentTime:0},i.getVolume=function(){return this._player?this._player.volume:0},i.getLoop=function(){return!!this._player&&this._player.loop},i.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},i.setVolume=function(t){this._player&&(this._player.volume=t)},i.setLoop=function(t){this._player&&(this._player.loop=t)},i.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},i.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},i.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},i.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&Y1.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},Ge(e,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this._loadMode=t.type,this._player=t.player):(this._meta=null,this._loadMode=b1.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:S1.INIT}}]),e}(vi),V1.AudioType=b1,U1=bi((z1=H1).prototype,"_duration",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bi(z1.prototype,"_nativeDep",[Ar],Object.getOwnPropertyDescriptor(z1.prototype,"_nativeDep"),z1.prototype),N1=z1))||N1);function q1(t,e,i){Y1.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var r={player:e,url:t,duration:e.duration,type:e.type};i(null,r)})).catch((function(t){i(t)}))}function K1(t,e,i,r){var n=new j1;n._nativeUrl=t,n._nativeAsset=e,n._duration=e.duration,r(null,n)}ei.AudioClip=j1,dn.register({".mp3":q1,".ogg":q1,".wav":q1,".m4a":q1}),pn.register({".mp3":K1,".ogg":K1,".wav":K1,".m4a":K1});var Z1,J1,Q1,$1,t2,e2,i2,r2,n2,o2,s2,a2,l2,h2,u2,c2,d2,p2,f2,_2=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var i=this._findIndex(t,e);return i>-1?(t[i].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof Y1){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var i=this._findIndex(t,e);return-1!==i&&(eo(t,i),!0)},e.removePlaying=function(t){if(t instanceof Y1){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<Y1.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}());!function(t){t.STARTED="started",t.ENDED="ended"}(f2||(f2={}));var g2=function(e){return t({AudioSource:e,AudioSourceComponent:e}),e}((Z1=_i("cc.AudioSource"),J1=Ni(),Q1=Ui(),$1=Di(j1),t2=Di(j1),e2=Vi(),i2=Vi(),r2=Vi(),n2=Ji(),o2=Vi(),Z1(s2=J1(s2=Q1((p2=d2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return e=t.call.apply(t,[this].concat(r))||this,Si(e,"_clip",l2,Ti(e)),e._player=null,Si(e,"_loop",h2,Ti(e)),Si(e,"_playOnAwake",u2,Ti(e)),Si(e,"_volume",c2,Ti(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=void 0,e}He(e,t);var i=e.prototype;return i._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,e&&this._lastSetClip!==e&&(e._nativeAsset?(this._lastSetClip=e,Y1.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(i){t._lastSetClip===e&&(t._isLoaded=!0,t._player&&(t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=i,i.onEnded((function(){_2.removePlaying(i),t.node.emit(f2.ENDED,t)})),i.onInterruptionBegin((function(){_2.removePlaying(i)})),i.onInterruptionEnd((function(){_2.addPlaying(i)})),t._syncStates())})).catch((function(){}))):console.error("Invalid audio clip"))},i.onLoad=function(){this._syncPlayer()},i.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},i.onDisable=function(){var t=this._getRootNode();(null==t?void 0:t._persistNode)||this.pause()},i.onDestroy=function(){var t;this.stop(),null===(t=this._player)||void 0===t||t.destroy()},i._getRootNode=function(){for(var t,e,i=this.node,r=null===(t=i)||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.parent;r;){var n,o,s;r=null===(o=i=null===(n=i)||void 0===n?void 0:n.parent)||void 0===o||null===(s=o.parent)||void 0===s?void 0:s.parent}return i},i.play=function(){var t,e,i=this;this._isLoaded?(_2.discardOnePlayingIfNeeded(),this.state===S1.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){_2.addPlaying(i._player),i.node.emit(f2.STARTED,i)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},i.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){_2.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},i.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){_2.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},i.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?Y1.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){_2.discardOnePlayingIfNeeded(),t.onPlay=function(){_2.addPlaying(t)},t.onEnd=function(){_2.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},i._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var i;null===(i=t[e])||void 0===i||i.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},Ge(e,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=Zr(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=Zr(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.currentTime:0}},{key:"state",get:function(){return this._player?this._player.state:S1.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return Y1.maxAudioChannel}}]),e}($i),d2.AudioState=S1,d2.EventType=f2,l2=bi((a2=p2).prototype,"_clip",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h2=bi(a2.prototype,"_loop",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u2=bi(a2.prototype,"_playOnAwake",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),c2=bi(a2.prototype,"_volume",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bi(a2.prototype,"clip",[t2,e2],Object.getOwnPropertyDescriptor(a2.prototype,"clip"),a2.prototype),bi(a2.prototype,"loop",[i2],Object.getOwnPropertyDescriptor(a2.prototype,"loop"),a2.prototype),bi(a2.prototype,"playOnAwake",[r2],Object.getOwnPropertyDescriptor(a2.prototype,"playOnAwake"),a2.prototype),bi(a2.prototype,"volume",[n2,o2],Object.getOwnPropertyDescriptor(a2.prototype,"volume"),a2.prototype),s2=a2))||s2)||s2)||s2));Xi(j1,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:g2,targetName:"AudioSource"}]),rn(j1.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),ei.AudioSourceComponent=g2,qi.setClassAlias(g2,"cc.AudioSourceComponent");var m2=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){hn(1006)},e.update=function(){hn(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return hn(1008),null},e.retain=function(){},e.release=function(){},t}();m2.TAG_INVALID=-1;var y2=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this)._duration=0,e._timesForRepeat=1,e}He(e,t);var i=e.prototype;return i.getDuration=function(){return this._duration*(this._timesForRepeat||1)},i.setDuration=function(t){this._duration=t},i.clone=function(){return new e},e}(m2),v2=(function(t){function e(e,i){var r;return void 0===i&&(i=1),(r=t.call(this)||this)._speed=0,r._innerAction=null,e&&r.initWithAction(e,i),r}He(e,t);var i=e.prototype;i.getSpeed=function(){return this._speed},i.setSpeed=function(t){this._speed=t},i.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(We(1021),!1)},i.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},i.startWithTarget=function(t){m2.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),m2.prototype.stop.call(this)},i.step=function(t){this._innerAction.step(t*this._speed)},i.isDone=function(){return this._innerAction.isDone()},i.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction}}(m2),0),b2=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},S2=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},e._getElement=function(t,e){var i=this._elementPool.pop();return i||(i=new b2),i.target=t,i.paused=!!e,i},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,i){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+v2++);var r=this._hashTargets.get(e);r?r.actions||(r.actions=[]):(r=this._getElement(e,i),this._hashTargets.set(e,r),this._arrayTargets.push(r)),r.target=e,r.actions.push(t),t.startWithTarget(e)}else We(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i)for(var r=0;r<i.actions.length;r++)if(i.actions[r]===t){i.actions.splice(r,1),i.actionIndex>=r&&i.actionIndex--;break}}},e._removeActionByTag=function(t,e,i){for(var r=0,n=e.actions.length;r<n;++r){var o=e.actions[r];if(o&&o.getTag()===t){if(i&&o.getOriginalTarget()!==i)continue;this._removeActionAtIndex(r,e);break}}},e.removeActionByTag=function(t,e){var i=this;t===m2.TAG_INVALID&&hn(1002);var r=this._hashTargets;if(e){var n=r.get(e);n&&this._removeActionByTag(t,n,e)}else r.forEach((function(e){i._removeActionByTag(t,e)}))},e.getActionByTag=function(t,e){t===m2.TAG_INVALID&&hn(1004);var i=this._hashTargets.get(e);if(i){if(null!=i.actions)for(var r=0;r<i.actions.length;++r){var n=i.actions[r];if(n&&n.getTag()===t)return n}hn(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var r=e[i];r&&!r.paused&&(r.paused=!0,t.push(r.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){ei.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var i=this._arrayTargets,r=0,n=i.length;r<n;r++)if(i[r]===t){i.splice(r,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,i=this._arrayTargets,r=0;r<i.length;r++){this._currentTarget=i[r];var n=(e=this._currentTarget).target;if(n instanceof jr&&!n.isValid)this.removeAllActionsFromTarget(n),r--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var o=e.currentAction;e.currentAction=null,this.removeAction(o)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&r--}}},t}(),T2=t("TweenSystem",function(t){function e(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).actionMgr=new S2,e}return He(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},Ge(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(Zn));T2.ID="TWEEN",T2.instance=void 0,Fr.on(kr.EVENT_INIT,(function(){var t=new T2;T2.instance=t,Fr.registerSystem(T2.ID,t,Zn.Priority.MEDIUM)}));var E2=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.isDone=function(){return!0},i.step=function(){this.update(1)},i.update=function(){},i.reverse=function(){return this.clone()},i.clone=function(){return new e},e}(y2),A2=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Gi),e=0;e<t.length;++e)t[e].enabled=!0},i.reverse=function(){return new C2},i.clone=function(){return new e},e}(E2),C2=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.update=function(){for(var t=this.target.getComponentsInChildren(Gi),e=0;e<t.length;++e)t[e].enabled=!1},i.reverse=function(){return new A2},i.clone=function(){return new e},e}(E2);!function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;i.update=function(){for(var t=this.target.getComponentsInChildren(Gi),e=0;e<t.length;++e){var i=t[e];i.enabled=!i.enabled}},i.reverse=function(){return new e},i.clone=function(){return new e}}(E2);var w2=function(t){function e(e){var i;return(i=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&i.init(e),i}He(e,t);var i=e.prototype;return i.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},i.init=function(t){return this._isNeedCleanUp=t,!0},i.reverse=function(){return new e(this._isNeedCleanUp)},i.clone=function(){return new e(this._isNeedCleanUp)},e}(E2),x2=function(t){function e(e,i,r){var n;return(n=t.call(this)||this)._selectorTarget=null,n._function=null,n._data=null,n.initWithFunction(e,i,r),n}He(e,t);var i=e.prototype;return i.initWithFunction=function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},i.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},i.update=function(){this.execute()},i.getTargetCallback=function(){return this._selectorTarget},i.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},i.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(E2),R2=function(t){function e(e){var i;return(i=t.call(this)||this).MAX_VALUE=2,i._elapsed=0,i._firstTick=!1,i._easeList=[],i._speed=1,i._repeatForever=!1,i._repeatMethod=!1,i._speedMethod=!1,void 0===e||isNaN(e)||i.initWithDuration(e),i}He(e,t);var i=e.prototype;return i.getElapsed=function(){return this._elapsed},i.initWithDuration=function(t){return this._duration=0===t?je.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},i.isDone=function(){return this._elapsed>=this._duration},i._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},i._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},i.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},i.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},i._computeEaseTime=function(t){return t},i.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},i.startWithTarget=function(t){m2.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},i.reverse=function(){return hn(1010),this},i.setAmplitudeRate=function(){hn(1011)},i.getAmplitudeRate=function(){return hn(1012),0},i.speed=function(t){return t<=0?(hn(1013),this):(this._speedMethod=!0,this._speed*=t,this)},i.getSpeed=function(){return this._speed},i.setSpeed=function(t){return this._speed=t,this},i.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(hn(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},i.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(y2),M2=function(t){function e(i){var r;(r=t.call(this)||this)._actions=[],r._split=0,r._last=0,r._reversed=!1;var n=i instanceof Array?i:arguments;if(1===n.length)return We(1019),Ti(r);var o=n.length-1;if(o>=0&&null==n[o]&&hn(1015),o>=0){for(var s,a=n[0],l=1;l<o;l++)n[l]&&(s=a,a=e._actionOneTwo(s,n[l]));r.initWithTwoActions(a,n[o])}return r}He(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return We(1025),!1;var i=t._duration,r=e._duration,n=(i*=t._repeatMethod?t._timesForRepeat:1)+(r*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(n),this._actions[0]=t,this._actions[1]=e,!0},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},i.startWithTarget=function(t){R2.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},i.stop=function(){-1!==this._last&&this._actions[this._last].stop(),m2.prototype.stop.call(this)},i.update=function(t){var e,i,r=0,n=this._split,o=this._actions,s=this._last;(t=this._computeEaseTime(t))<n?(e=0!==n?t/n:1,0===r&&1===s&&this._reversed&&(o[1].update(0),o[1].stop())):(r=1,e=1===n?1:(t-n)/(1-n),-1===s&&(o[0].startWithTarget(this.target),o[0].update(1),o[0].stop()),0===s&&(o[0].update(1),o[0].stop())),i=o[r],s===r&&i.isDone()||(s!==r&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=r)},i.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(R2);function O2(t){var e=t instanceof Array?t:arguments;if(1===e.length)return We(1019),null;var i=e.length-1;i>=0&&null==e[i]&&hn(1015);var r=null;if(i>=0){r=e[0];for(var n=1;n<=i;n++)e[n]&&(r=M2._actionOneTwo(r,e[n]))}return r}M2._actionOneTwo=function(t,e){var i=new M2;return i.initWithTwoActions(t,e),i};var P2=function(t){function e(e,i){var r;return(r=t.call(this)||this)._times=0,r._total=0,r._nextDt=0,r._actionInstant=!1,r._innerAction=null,void 0!==i&&r.initWithAction(e,i),r}He(e,t);var i=e.prototype;return i.initWithAction=function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof E2&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},i.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,R2.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.stop=function(){this._innerAction.stop(),m2.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,r=this._times,n=this._nextDt;if(t>=n){for(;t>n&&this._total<r;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),n+=e._duration/i,this._nextDt=n>1?1:n;t>=1&&this._total<r&&(e.update(1),this._total++),this._actionInstant||(this._total===r?e.stop():e.update(t-(n-e._duration/i)))}else e.update(t*r%1)},i.isDone=function(){return this._total===this._times},i.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(R2),D2=function(t){function e(e){var i;return(i=t.call(this)||this)._innerAction=null,e&&i.initWithAction(e),i}He(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?(this._innerAction=t,!0):(We(1026),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},i.startWithTarget=function(t){R2.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},i.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},i.isDone=function(){return!1},i.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},i.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},i.getInnerAction=function(){return this._innerAction},e}(R2),I2=function(t){function e(i){var r;(r=t.call(this)||this)._one=null,r._two=null;var n=i instanceof Array?i:arguments;if(1===n.length)return We(1020),Ti(r);var o=n.length-1;if(o>=0&&null==n[o]&&hn(1015),o>=0){for(var s,a=n[0],l=1;l<o;l++)n[l]&&(s=a,a=e._actionOneTwo(s,n[l]));r.initWithTwoActions(a,n[o])}return r}He(e,t);var i=e.prototype;return i.initWithTwoActions=function(t,e){if(!t||!e)return We(1027),!1;var i=!1,r=t._duration,n=e._duration;return this.initWithDuration(Math.max(r,n))&&(this._one=t,this._two=e,r>n?this._two=M2._actionOneTwo(e,F2(r-n)):r<n&&(this._one=M2._actionOneTwo(t,F2(n-r))),i=!0),i},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},i.startWithTarget=function(t){R2.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},i.stop=function(){this._one.stop(),this._two.stop(),m2.prototype.stop.call(this)},i.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},i.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(R2);function B2(t){var e=t instanceof Array?t:arguments;if(1===e.length)return We(1020),null;e.length>0&&null==e[e.length-1]&&hn(1015);for(var i=e[0],r=1;r<e.length;r++)null!=e[r]&&(i=I2._actionOneTwo(i,e[r]));return i}I2._actionOneTwo=function(t,e){var i=new I2;return i.initWithTwoActions(t,e),i};var L2=function(t){function e(){return t.apply(this,arguments)||this}He(e,t);var i=e.prototype;return i.update=function(){},i.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(R2);function F2(t){return new L2(t)}var k2=function(t){function e(e){var i;return(i=t.call(this)||this)._other=null,e&&i.initWithAction(e),i}He(e,t);var i=e.prototype;return i.initWithAction=function(t){return t?t===this._other?(We(1029),!1):!!R2.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(We(1028),!1)},i.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},i.startWithTarget=function(t){R2.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},i.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},i.reverse=function(){return this._other.clone()},i.stop=function(){this._other.stop(),m2.prototype.stop.call(this)},e}(R2),N2=function(t){function e(e,i,r){var n;if((n=t.call(this)||this)._opts=void 0,n._props=void 0,n._originProps=void 0,null==r)r=Object.create(null);else if(function(t){var e=" [Tween:] ",i=" option is not support in v + "+fo,r=t;r.delay&&ti(e+"delay"+i),r.repeat&&ti(e+"repeat"+i),r.repeatDelay&&ti(e+"repeatDelay"+i),r.interpolation&&ti(e+"interpolation"+i),r.onStop&&ti(e+"onStop"+i)}(r),r.easing&&"string"==typeof r.easing&&(r.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var i=(t=t.replace(e,e.toLowerCase())).split("-");if(2===i.length){var r=i[0];if("linear"===r)t="linear";else{var n=i[1];switch(r){case"quadratic":t="quad"+n;break;case"quartic":t="quart"+n;break;case"quintic":t="quint"+n;break;case"sinusoidal":t="sine"+n;break;case"exponential":t="expo"+n;break;case"circular":t="circ"+n;break;default:t=r+n}}}}return t}(r.easing)),r.progress||(r.progress=n.progress),r.easing&&"string"==typeof r.easing){var o=r.easing;r.easing=po[o],r.easing||$e(1031,o)}for(var s in n._opts=r,n._props=Object.create(null),i)if(i.hasOwnProperty(s)){var a=i[s];if("function"==typeof a&&(a=a()),null!=a&&"string"!=typeof a){var l=void 0,h=void 0;void 0!==a.value&&(a.easing||a.progress)&&("string"==typeof a.easing?(l=po[a.easing])||$e(1031,a.easing):l=a.easing,h=a.progress,a=a.value);var u=Object.create(null);u.value=a,u.easing=l,u.progress=h,n._props[s]=u}}return n._originProps=i,n.initWithDuration(e),n}He(e,t);var i=e.prototype;return i.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},i.startWithTarget=function(t){R2.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,i=this._props;for(var r in i){var n=t[r];if(void 0!==n){var o=i[r],s=o.value;if("number"==typeof n)o.start=n,o.current=n,o.end=e?n+s:s;else if("object"==typeof n)for(var a in null==o.start&&(o.start={},o.current={},o.end={}),s)isNaN(n[a])||(o.start[a]=n[a],o.current[a]=n[a],o.end[a]=e?n[a]+s[a]:s[a])}}this._opts.onStart&&this._opts.onStart(this.target)},i.update=function(t){var e=this.target;if(e){var i=this._props,r=this._opts,n=t;r.easing&&(n=r.easing(t));var o=r.progress;for(var s in i){var a=i[s],l=a.easing?a.easing(t):n,h=a.progress?a.progress:o,u=a.start,c=a.end;if("number"==typeof u)a.current=h(u,c,a.current,l);else if("object"==typeof u)for(var d in u)a.current[d]=h(u[d],c[d],a.current[d],l);e[s]=a.current}r.onUpdate&&r.onUpdate(this.target,t),1===t&&r.onComplete&&r.onComplete(this.target)}},i.progress=function(t,e,i,r){return t+(e-t)*r},e}(R2),z2=function(t){function e(e){var i;return(i=t.call(this)||this)._props=void 0,i._props={},void 0!==e&&i.init(e),i}He(e,t);var i=e.prototype;return i.init=function(t){for(var e in t)this._props[e]=t[e];return!0},i.update=function(){var t=this._props,e=this.target;for(var i in t)e[i]=t[i]},i.clone=function(){var t=new e;return t.init(this._props),t},e}(E2),U2=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=m2.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof m2?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&T2.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),T2.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(ti("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&T2.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return V2(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,i){(i=i||Object.create(null)).relative=!1;var r=new N2(t,e,i);return this._actions.push(r),this},e.by=function(t,e,i){(i=i||Object.create(null)).relative=!0;var r=new N2(t,e,i);return this._actions.push(r),this},e.set=function(t){var e=new z2(t);return this._actions.push(e),this},e.delay=function(t){var e=F2(t);return this._actions.push(e),this},e.call=function(t){var e=function(t){return new x2(t,void 0,void 0)}(t);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,i){if(e==1/0)return this.repeatForever(i);var r,n=this._actions;return r=i instanceof t?i._union():n.pop(),n.push(function(t,e){return new P2(t,e)}(r,e)),this},e.repeatForever=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new D2(t)}(i)),this},e.reverseTime=function(e){var i,r=this._actions;return i=e instanceof t?e._union():r.pop(),r.push(function(t){return new k2(t)}(i)),this},e.hide=function(){var t=new C2;return this._actions.push(t),this},e.show=function(){var t=new A2;return this._actions.push(t),this},e.removeSelf=function(){var t=new w2(!1);return this._actions.push(t),this},t.stopAll=function(){T2.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){T2.instance.ActionManager.removeActionByTag(t,e)},t.stopAllByTarget=function(t){T2.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:O2(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return O2.apply(O2,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var i=arguments.length,r=0;r<i;r++){var n=e[r]=r<0||arguments.length<=r?void 0:arguments[r];n instanceof t&&(e[r]=n._union())}return B2.apply(B2,e)},t}());function V2(t){return new U2(t)}function H2(t){return ti("tweenUtil' is deprecated, please use 'tween' instead "),new U2(t)}U2._tmp_args=[],ei.Tween=U2,ei.tween=V2,ei.tweenUtil=H2;var G2,W2,X2=(G2=function(t,e){return(G2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}G2(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});!function(t){var e,i,r,n=function(){function t(t,e,i){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=i}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,i,r,n,o,s,a){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(i%=this.duration,e>0&&(e%=this.duration));for(var l=this.timelines,h=0,u=l.length;h<u;h++)l[h].apply(t,e,i,n,o,s,a)},t.binarySearch=function(t,e,i){void 0===i&&(i=1);var r=0,n=t.length/i-2;if(0==n)return i;for(var o=n>>>1;;){if(t[(o+1)*i]<=e?r=o+1:n=o,r==n)return(r+1)*i;o=r+n>>>1}},t.linearSearch=function(t,e,i){for(var r=0,n=t.length-i;r<=n;r+=i)if(t[r]>e)return r;return-1},t}();t.Animation=n,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(i=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(r=t.TimelineType||(t.TimelineType={}));var o=function(){function e(i){if(i<=0)throw new Error("frameCount must be > 0: "+i);this.curves=t.Utils.newFloatArray((i-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var i=t*e.BEZIER_SIZE;if(i==this.curves.length)return e.LINEAR;var r=this.curves[i];return r==e.LINEAR?e.LINEAR:r==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,i,r,n,o){var s=.03*(2*-i+n),a=.03*(2*-r+o),l=.006*(3*(i-n)+1),h=.006*(3*(r-o)+1),u=2*s+l,c=2*a+h,d=.3*i+s+.16666667*l,p=.3*r+a+.16666667*h,f=t*e.BEZIER_SIZE,_=this.curves;_[f++]=e.BEZIER;for(var g=d,m=p,y=f+e.BEZIER_SIZE-1;f<y;f+=2)_[f]=g,_[f+1]=m,d+=u,p+=c,u+=l,c+=h,g+=d,m+=p},e.prototype.getCurvePercent=function(i,r){r=t.MathUtils.clamp(r,0,1);var n=this.curves,o=i*e.BEZIER_SIZE,s=n[o];if(s==e.LINEAR)return r;if(s==e.STEPPED)return 0;for(var a=0,l=++o,h=o+e.BEZIER_SIZE-1;o<h;o+=2)if((a=n[o])>=r){var u=void 0,c=void 0;return o==l?(u=0,c=0):(u=n[o-2],c=n[o-1]),c+(n[o+1]-c)*(r-u)/(a-u)}var d=n[o-1];return d+(1-d)*(r-a)/(1-a)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=o;var s=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e<<1),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.rotate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i){t<<=1,this.frames[t]=e,this.frames[t+o.ROTATION]=i},o.prototype.apply=function(t,i,r,s,a,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return void(u.rotation=u.data.rotation);case e.first:var c=u.data.rotation-u.rotation;u.rotation+=(c-360*(16384-(16384.499999999996-c/360|0)))*a}else if(r>=h[h.length-o.ENTRIES]){var d=h[h.length+o.PREV_ROTATION];switch(l){case e.setup:u.rotation=u.data.rotation+d*a;break;case e.first:case e.replace:d+=u.data.rotation-u.rotation,d-=360*(16384-(16384.499999999996-d/360|0));case e.add:u.rotation+=d*a}}else{var p=n.binarySearch(h,r,o.ENTRIES),f=h[p+o.PREV_ROTATION],_=h[p],g=this.getCurvePercent((p>>1)-1,1-(r-_)/(h[p+o.PREV_TIME]-_)),m=h[p+o.ROTATION]-f;switch(m=f+(m-360*(16384-(16384.499999999996-m/360|0)))*g,l){case e.setup:u.rotation=u.data.rotation+(m-360*(16384-(16384.499999999996-m/360|0)))*a;break;case e.first:case e.replace:m+=u.data.rotation-u.rotation;case e.add:u.rotation+=(m-360*(16384-(16384.499999999996-m/360|0)))*a}}},o.ENTRIES=2,o.PREV_TIME=-2,o.PREV_ROTATION=-1,o.ROTATION=1,o}(o);t.RotateTimeline=s;var a=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.translate<<24)+this.boneIndex},o.prototype.setFrame=function(t,e,i,r){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.X]=i,this.frames[t+o.Y]=r},o.prototype.apply=function(t,i,r,s,a,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return u.x=u.data.x,void(u.y=u.data.y);case e.first:u.x+=(u.data.x-u.x)*a,u.y+=(u.data.y-u.y)*a}else{var c=0,d=0;if(r>=h[h.length-o.ENTRIES])c=h[h.length+o.PREV_X],d=h[h.length+o.PREV_Y];else{var p=n.binarySearch(h,r,o.ENTRIES);c=h[p+o.PREV_X],d=h[p+o.PREV_Y];var f=h[p],_=this.getCurvePercent(p/o.ENTRIES-1,1-(r-f)/(h[p+o.PREV_TIME]-f));c+=(h[p+o.X]-c)*_,d+=(h[p+o.Y]-d)*_}switch(l){case e.setup:u.x=u.data.x+c*a,u.y=u.data.y+d*a;break;case e.first:case e.replace:u.x+=(u.data.x+c-u.x)*a,u.y+=(u.data.y+d-u.y)*a;break;case e.add:u.x+=c*a,u.y+=d*a}}},o.ENTRIES=3,o.PREV_TIME=-3,o.PREV_X=-2,o.PREV_Y=-1,o.X=1,o.Y=2,o}(o);t.TranslateTimeline=a;var l=function(o){function s(t){return o.call(this,t)||this}return X2(s,o),s.prototype.getPropertyId=function(){return(r.scale<<24)+this.boneIndex},s.prototype.apply=function(r,o,a,l,h,u,c){var d=this.frames,p=r.bones[this.boneIndex];if(p.active)if(a<d[0])switch(u){case e.setup:return p.scaleX=p.data.scaleX,void(p.scaleY=p.data.scaleY);case e.first:p.scaleX+=(p.data.scaleX-p.scaleX)*h,p.scaleY+=(p.data.scaleY-p.scaleY)*h}else{var f=0,_=0;if(a>=d[d.length-s.ENTRIES])f=d[d.length+s.PREV_X]*p.data.scaleX,_=d[d.length+s.PREV_Y]*p.data.scaleY;else{var g=n.binarySearch(d,a,s.ENTRIES);f=d[g+s.PREV_X],_=d[g+s.PREV_Y];var m=d[g],y=this.getCurvePercent(g/s.ENTRIES-1,1-(a-m)/(d[g+s.PREV_TIME]-m));f=(f+(d[g+s.X]-f)*y)*p.data.scaleX,_=(_+(d[g+s.Y]-_)*y)*p.data.scaleY}if(1==h)u==e.add?(p.scaleX+=f-p.data.scaleX,p.scaleY+=_-p.data.scaleY):(p.scaleX=f,p.scaleY=_);else{var v=0,b=0;if(c==i.mixOut)switch(u){case e.setup:v=p.data.scaleX,b=p.data.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*h,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*h;break;case e.first:case e.replace:v=p.scaleX,b=p.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-v)*h,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-b)*h;break;case e.add:v=p.scaleX,b=p.scaleY,p.scaleX=v+(Math.abs(f)*t.MathUtils.signum(v)-p.data.scaleX)*h,p.scaleY=b+(Math.abs(_)*t.MathUtils.signum(b)-p.data.scaleY)*h}else switch(u){case e.setup:v=Math.abs(p.data.scaleX)*t.MathUtils.signum(f),b=Math.abs(p.data.scaleY)*t.MathUtils.signum(_),p.scaleX=v+(f-v)*h,p.scaleY=b+(_-b)*h;break;case e.first:case e.replace:v=Math.abs(p.scaleX)*t.MathUtils.signum(f),b=Math.abs(p.scaleY)*t.MathUtils.signum(_),p.scaleX=v+(f-v)*h,p.scaleY=b+(_-b)*h;break;case e.add:v=t.MathUtils.signum(f),b=t.MathUtils.signum(_),p.scaleX=Math.abs(p.scaleX)*v+(f-Math.abs(p.data.scaleX)*v)*h,p.scaleY=Math.abs(p.scaleY)*b+(_-Math.abs(p.data.scaleY)*b)*h}}}},s}(a);t.ScaleTimeline=l;var h=function(t){function i(e){return t.call(this,e)||this}return X2(i,t),i.prototype.getPropertyId=function(){return(r.shear<<24)+this.boneIndex},i.prototype.apply=function(t,r,o,s,a,l){var h=this.frames,u=t.bones[this.boneIndex];if(u.active)if(o<h[0])switch(l){case e.setup:return u.shearX=u.data.shearX,void(u.shearY=u.data.shearY);case e.first:u.shearX+=(u.data.shearX-u.shearX)*a,u.shearY+=(u.data.shearY-u.shearY)*a}else{var c=0,d=0;if(o>=h[h.length-i.ENTRIES])c=h[h.length+i.PREV_X],d=h[h.length+i.PREV_Y];else{var p=n.binarySearch(h,o,i.ENTRIES);c=h[p+i.PREV_X],d=h[p+i.PREV_Y];var f=h[p],_=this.getCurvePercent(p/i.ENTRIES-1,1-(o-f)/(h[p+i.PREV_TIME]-f));c+=(h[p+i.X]-c)*_,d+=(h[p+i.Y]-d)*_}switch(l){case e.setup:u.shearX=u.data.shearX+c*a,u.shearY=u.data.shearY+d*a;break;case e.first:case e.replace:u.shearX+=(u.data.shearX+c-u.shearX)*a,u.shearY+=(u.data.shearY+d-u.shearY)*a;break;case e.add:u.shearX+=c*a,u.shearY+=d*a}}},i}(a);t.ShearTimeline=h;var u=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.color<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,r,n,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=r,this.frames[t+o.B]=n,this.frames[t+o.A]=s},o.prototype.apply=function(t,i,r,s,a,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(r<u[0])switch(l){case e.setup:return void h.color.setFromColor(h.data.color);case e.first:var c=h.color,d=h.data.color;c.add((d.r-c.r)*a,(d.g-c.g)*a,(d.b-c.b)*a,(d.a-c.a)*a)}else{var p=0,f=0,_=0,g=0;if(r>=u[u.length-o.ENTRIES]){var m=u.length;p=u[m+o.PREV_R],f=u[m+o.PREV_G],_=u[m+o.PREV_B],g=u[m+o.PREV_A]}else{var y=n.binarySearch(u,r,o.ENTRIES);p=u[y+o.PREV_R],f=u[y+o.PREV_G],_=u[y+o.PREV_B],g=u[y+o.PREV_A];var v=u[y],b=this.getCurvePercent(y/o.ENTRIES-1,1-(r-v)/(u[y+o.PREV_TIME]-v));p+=(u[y+o.R]-p)*b,f+=(u[y+o.G]-f)*b,_+=(u[y+o.B]-_)*b,g+=(u[y+o.A]-g)*b}1==a?h.color.set(p,f,_,g):(c=h.color,l==e.setup&&c.setFromColor(h.data.color),c.add((p-c.r)*a,(f-c.g)*a,(_-c.b)*a,(g-c.a)*a))}}},o.ENTRIES=5,o.PREV_TIME=-5,o.PREV_R=-4,o.PREV_G=-3,o.PREV_B=-2,o.PREV_A=-1,o.R=1,o.G=2,o.B=3,o.A=4,o}(o);t.ColorTimeline=u;var c=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.twoColor<<24)+this.slotIndex},o.prototype.setFrame=function(t,e,i,r,n,s,a,l,h){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.R]=i,this.frames[t+o.G]=r,this.frames[t+o.B]=n,this.frames[t+o.A]=s,this.frames[t+o.R2]=a,this.frames[t+o.G2]=l,this.frames[t+o.B2]=h},o.prototype.apply=function(t,i,r,s,a,l){var h=t.slots[this.slotIndex];if(h.bone.active){var u=this.frames;if(r<u[0])switch(l){case e.setup:return h.color.setFromColor(h.data.color),void h.darkColor.setFromColor(h.data.darkColor);case e.first:var c=h.color,d=h.darkColor,p=h.data.color,f=h.data.darkColor;c.add((p.r-c.r)*a,(p.g-c.g)*a,(p.b-c.b)*a,(p.a-c.a)*a),d.add((f.r-d.r)*a,(f.g-d.g)*a,(f.b-d.b)*a,0)}else{var _=0,g=0,m=0,y=0,v=0,b=0,S=0;if(r>=u[u.length-o.ENTRIES]){var T=u.length;_=u[T+o.PREV_R],g=u[T+o.PREV_G],m=u[T+o.PREV_B],y=u[T+o.PREV_A],v=u[T+o.PREV_R2],b=u[T+o.PREV_G2],S=u[T+o.PREV_B2]}else{var E=n.binarySearch(u,r,o.ENTRIES);_=u[E+o.PREV_R],g=u[E+o.PREV_G],m=u[E+o.PREV_B],y=u[E+o.PREV_A],v=u[E+o.PREV_R2],b=u[E+o.PREV_G2],S=u[E+o.PREV_B2];var A=u[E],C=this.getCurvePercent(E/o.ENTRIES-1,1-(r-A)/(u[E+o.PREV_TIME]-A));_+=(u[E+o.R]-_)*C,g+=(u[E+o.G]-g)*C,m+=(u[E+o.B]-m)*C,y+=(u[E+o.A]-y)*C,v+=(u[E+o.R2]-v)*C,b+=(u[E+o.G2]-b)*C,S+=(u[E+o.B2]-S)*C}1==a?(h.color.set(_,g,m,y),h.darkColor.set(v,b,S,1)):(c=h.color,d=h.darkColor,l==e.setup&&(c.setFromColor(h.data.color),d.setFromColor(h.data.darkColor)),c.add((_-c.r)*a,(g-c.g)*a,(m-c.b)*a,(y-c.a)*a),d.add((v-d.r)*a,(b-d.g)*a,(S-d.b)*a,0))}}},o.ENTRIES=8,o.PREV_TIME=-8,o.PREV_R=-7,o.PREV_G=-6,o.PREV_B=-5,o.PREV_A=-4,o.PREV_R2=-3,o.PREV_G2=-2,o.PREV_B2=-1,o.R=1,o.G=2,o.B=3,o.A=4,o.R2=5,o.G2=6,o.B2=7,o}(o);t.TwoColorTimeline=c;var d=function(){function o(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return o.prototype.getPropertyId=function(){return(r.attachment<<24)+this.slotIndex},o.prototype.getFrameCount=function(){return this.frames.length},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},o.prototype.apply=function(t,r,o,s,a,l,h){var u=t.slots[this.slotIndex];if(u.bone.active)if(h!=i.mixOut||l!=e.setup){var c=this.frames;if(o<c[0]){if(l==e.setup||l==e.first){var d=u.data.attachmentName;u.setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p;p=o>=c[c.length-1]?c.length-1:n.binarySearch(c,o,1)-1;var f=this.attachmentNames[p];t.slots[this.slotIndex].setAttachment(null==f?null:t.getAttachment(this.slotIndex,f))}}else{var _=u.data.attachmentName;u.setAttachment(null==_?null:t.getAttachment(this.slotIndex,_))}},o}();t.AttachmentTimeline=d;var p=null,f=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e),r.frameVertices=new Array(e),null==p&&(p=t.Utils.newFloatArray(64)),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.deform<<27)+ +this.attachment.id+this.slotIndex},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.frameVertices[t]=i},o.prototype.apply=function(i,r,o,s,a,l){var h=i.slots[this.slotIndex];if(h.bone.active){var u=h.getAttachment();if(u instanceof t.VertexAttachment&&u.deformAttachment==this.attachment){var c=h.deform;0==c.length&&(l=e.setup);var d=this.frameVertices,p=d[0].length,f=this.frames;if(o<f[0]){var _=u;switch(l){case e.setup:return void(c.length=0);case e.first:if(1==a){c.length=0;break}var g=t.Utils.setArraySize(c,p);if(null==_.bones)for(var m=_.vertices,y=0;y<p;y++)g[y]+=(m[y]-g[y])*a;else for(a=1-a,y=0;y<p;y++)g[y]*=a}}else{var v=t.Utils.setArraySize(c,p);if(o>=f[f.length-1]){var b=d[f.length-1];if(1==a)if(l==e.add)if(null==(_=u).bones){m=_.vertices;for(var S=0;S<p;S++)v[S]+=b[S]-m[S]}else for(var T=0;T<p;T++)v[T]+=b[T];else t.Utils.arrayCopy(b,0,v,0,p);else switch(l){case e.setup:var E=u;if(null==E.bones){m=E.vertices;for(var A=0;A<p;A++){var C=m[A];v[A]=C+(b[A]-C)*a}}else for(var w=0;w<p;w++)v[w]=b[w]*a;break;case e.first:case e.replace:for(var x=0;x<p;x++)v[x]+=(b[x]-v[x])*a;case e.add:if(null==(_=u).bones){m=_.vertices;for(var R=0;R<p;R++)v[R]+=(b[R]-m[R])*a}else for(var M=0;M<p;M++)v[M]+=b[M]*a}}else{var O=n.binarySearch(f,o),P=d[O-1],D=d[O],I=f[O],B=this.getCurvePercent(O-1,1-(o-I)/(f[O-1]-I));if(1==a)if(l==e.add)if(null==(_=u).bones){m=_.vertices;for(var L=0;L<p;L++){var F=P[L];v[L]+=F+(D[L]-F)*B-m[L]}}else for(var k=0;k<p;k++)F=P[k],v[k]+=F+(D[k]-F)*B;else for(var N=0;N<p;N++)F=P[N],v[N]=F+(D[N]-F)*B;else switch(l){case e.setup:var z=u;if(null==z.bones){m=z.vertices;for(var U=0;U<p;U++)F=P[U],C=m[U],v[U]=C+(F+(D[U]-F)*B-C)*a}else for(var V=0;V<p;V++)F=P[V],v[V]=(F+(D[V]-F)*B)*a;break;case e.first:case e.replace:for(var H=0;H<p;H++)F=P[H],v[H]+=(F+(D[H]-F)*B-v[H])*a;break;case e.add:if(null==(_=u).bones){m=_.vertices;for(var G=0;G<p;G++)F=P[G],v[G]+=(F+(D[G]-F)*B-m[G])*a}else for(var W=0;W<p;W++)F=P[W],v[W]+=(F+(D[W]-F)*B)*a}}}}}},o}(o);t.DeformTimeline=f;var _=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return r.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,i,r,o,s,a){if(null!=r){var l=this.frames,h=this.frames.length;if(e>i)this.apply(t,e,Number.MAX_VALUE,r,o,s,a),e=-1;else if(e>=l[h-1])return;if(!(i<l[0])){var u=0;if(e<l[0])u=0;else for(var c=l[u=n.binarySearch(l,e)];u>0&&l[u-1]==c;)u--;for(;u<h&&i>=l[u];u++)r.push(this.events[u])}}},e}();t.EventTimeline=_;var g=function(){function o(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return o.prototype.getPropertyId=function(){return r.drawOrder<<24},o.prototype.getFrameCount=function(){return this.frames.length},o.prototype.setFrame=function(t,e,i){this.frames[t]=e,this.drawOrders[t]=i},o.prototype.apply=function(r,o,s,a,l,h,u){var c=r.drawOrder,d=r.slots;if(u!=i.mixOut||h!=e.setup){var p=this.frames;if(s<p[0])h!=e.setup&&h!=e.first||t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length);else{var f;f=s>=p[p.length-1]?p.length-1:n.binarySearch(p,s)-1;var _=this.drawOrders[f];if(null==_)t.Utils.arrayCopy(d,0,c,0,d.length);else for(var g=0,m=_.length;g<m;g++)c[g]=d[_[g]]}}else t.Utils.arrayCopy(r.slots,0,r.drawOrder,0,r.slots.length)},o}();t.DrawOrderTimeline=g;var m=function(o){function s(e){var i=o.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*s.ENTRIES),i}return X2(s,o),s.prototype.getPropertyId=function(){return(r.ikConstraint<<24)+this.ikConstraintIndex},s.prototype.setFrame=function(t,e,i,r,n,o,a){t*=s.ENTRIES,this.frames[t]=e,this.frames[t+s.MIX]=i,this.frames[t+s.SOFTNESS]=r,this.frames[t+s.BEND_DIRECTION]=n,this.frames[t+s.COMPRESS]=o?1:0,this.frames[t+s.STRETCH]=a?1:0},s.prototype.apply=function(t,r,o,a,l,h,u){var c=this.frames,d=t.ikConstraints[this.ikConstraintIndex];if(d.active)if(o<c[0])switch(h){case e.setup:return d.mix=d.data.mix,d.softness=d.data.softness,d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,void(d.stretch=d.data.stretch);case e.first:d.mix+=(d.data.mix-d.mix)*l,d.softness+=(d.data.softness-d.softness)*l,d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch}else if(o>=c[c.length-s.ENTRIES])h==e.setup?(d.mix=d.data.mix+(c[c.length+s.PREV_MIX]-d.data.mix)*l,d.softness=d.data.softness+(c[c.length+s.PREV_SOFTNESS]-d.data.softness)*l,u==i.mixOut?(d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch):(d.bendDirection=c[c.length+s.PREV_BEND_DIRECTION],d.compress=0!=c[c.length+s.PREV_COMPRESS],d.stretch=0!=c[c.length+s.PREV_STRETCH])):(d.mix+=(c[c.length+s.PREV_MIX]-d.mix)*l,d.softness+=(c[c.length+s.PREV_SOFTNESS]-d.softness)*l,u==i.mixIn&&(d.bendDirection=c[c.length+s.PREV_BEND_DIRECTION],d.compress=0!=c[c.length+s.PREV_COMPRESS],d.stretch=0!=c[c.length+s.PREV_STRETCH]));else{var p=n.binarySearch(c,o,s.ENTRIES),f=c[p+s.PREV_MIX],_=c[p+s.PREV_SOFTNESS],g=c[p],m=this.getCurvePercent(p/s.ENTRIES-1,1-(o-g)/(c[p+s.PREV_TIME]-g));h==e.setup?(d.mix=d.data.mix+(f+(c[p+s.MIX]-f)*m-d.data.mix)*l,d.softness=d.data.softness+(_+(c[p+s.SOFTNESS]-_)*m-d.data.softness)*l,u==i.mixOut?(d.bendDirection=d.data.bendDirection,d.compress=d.data.compress,d.stretch=d.data.stretch):(d.bendDirection=c[p+s.PREV_BEND_DIRECTION],d.compress=0!=c[p+s.PREV_COMPRESS],d.stretch=0!=c[p+s.PREV_STRETCH])):(d.mix+=(f+(c[p+s.MIX]-f)*m-d.mix)*l,d.softness+=(_+(c[p+s.SOFTNESS]-_)*m-d.softness)*l,u==i.mixIn&&(d.bendDirection=c[p+s.PREV_BEND_DIRECTION],d.compress=0!=c[p+s.PREV_COMPRESS],d.stretch=0!=c[p+s.PREV_STRETCH]))}},s.ENTRIES=6,s.PREV_TIME=-6,s.PREV_MIX=-5,s.PREV_SOFTNESS=-4,s.PREV_BEND_DIRECTION=-3,s.PREV_COMPRESS=-2,s.PREV_STRETCH=-1,s.MIX=1,s.SOFTNESS=2,s.BEND_DIRECTION=3,s.COMPRESS=4,s.STRETCH=5,s}(o);t.IkConstraintTimeline=m;var y=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.transformConstraint<<24)+this.transformConstraintIndex},o.prototype.setFrame=function(t,e,i,r,n,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=r,this.frames[t+o.SCALE]=n,this.frames[t+o.SHEAR]=s},o.prototype.apply=function(t,i,r,s,a,l){var h=this.frames,u=t.transformConstraints[this.transformConstraintIndex];if(u.active)if(r<h[0]){var c=u.data;switch(l){case e.setup:return u.rotateMix=c.rotateMix,u.translateMix=c.translateMix,u.scaleMix=c.scaleMix,void(u.shearMix=c.shearMix);case e.first:u.rotateMix+=(c.rotateMix-u.rotateMix)*a,u.translateMix+=(c.translateMix-u.translateMix)*a,u.scaleMix+=(c.scaleMix-u.scaleMix)*a,u.shearMix+=(c.shearMix-u.shearMix)*a}}else{var d=0,p=0,f=0,_=0;if(r>=h[h.length-o.ENTRIES]){var g=h.length;d=h[g+o.PREV_ROTATE],p=h[g+o.PREV_TRANSLATE],f=h[g+o.PREV_SCALE],_=h[g+o.PREV_SHEAR]}else{var m=n.binarySearch(h,r,o.ENTRIES);d=h[m+o.PREV_ROTATE],p=h[m+o.PREV_TRANSLATE],f=h[m+o.PREV_SCALE],_=h[m+o.PREV_SHEAR];var y=h[m],v=this.getCurvePercent(m/o.ENTRIES-1,1-(r-y)/(h[m+o.PREV_TIME]-y));d+=(h[m+o.ROTATE]-d)*v,p+=(h[m+o.TRANSLATE]-p)*v,f+=(h[m+o.SCALE]-f)*v,_+=(h[m+o.SHEAR]-_)*v}l==e.setup?(c=u.data,u.rotateMix=c.rotateMix+(d-c.rotateMix)*a,u.translateMix=c.translateMix+(p-c.translateMix)*a,u.scaleMix=c.scaleMix+(f-c.scaleMix)*a,u.shearMix=c.shearMix+(_-c.shearMix)*a):(u.rotateMix+=(d-u.rotateMix)*a,u.translateMix+=(p-u.translateMix)*a,u.scaleMix+=(f-u.scaleMix)*a,u.shearMix+=(_-u.shearMix)*a)}},o.ENTRIES=5,o.PREV_TIME=-5,o.PREV_ROTATE=-4,o.PREV_TRANSLATE=-3,o.PREV_SCALE=-2,o.PREV_SHEAR=-1,o.ROTATE=1,o.TRANSLATE=2,o.SCALE=3,o.SHEAR=4,o}(o);t.TransformConstraintTimeline=y;var v=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.pathConstraintPosition<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.VALUE]=i},o.prototype.apply=function(t,i,r,s,a,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return void(u.position=u.data.position);case e.first:u.position+=(u.data.position-u.position)*a}else{var c=0;if(r>=h[h.length-o.ENTRIES])c=h[h.length+o.PREV_VALUE];else{var d=n.binarySearch(h,r,o.ENTRIES);c=h[d+o.PREV_VALUE];var p=h[d],f=this.getCurvePercent(d/o.ENTRIES-1,1-(r-p)/(h[d+o.PREV_TIME]-p));c+=(h[d+o.VALUE]-c)*f}l==e.setup?u.position=u.data.position+(c-u.data.position)*a:u.position+=(c-u.position)*a}},o.ENTRIES=2,o.PREV_TIME=-2,o.PREV_VALUE=-1,o.VALUE=1,o}(o);t.PathConstraintPositionTimeline=v;var b=function(t){function i(e){return t.call(this,e)||this}return X2(i,t),i.prototype.getPropertyId=function(){return(r.pathConstraintSpacing<<24)+this.pathConstraintIndex},i.prototype.apply=function(t,r,o,s,a,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(o<h[0])switch(l){case e.setup:return void(u.spacing=u.data.spacing);case e.first:u.spacing+=(u.data.spacing-u.spacing)*a}else{var c=0;if(o>=h[h.length-i.ENTRIES])c=h[h.length+i.PREV_VALUE];else{var d=n.binarySearch(h,o,i.ENTRIES);c=h[d+i.PREV_VALUE];var p=h[d],f=this.getCurvePercent(d/i.ENTRIES-1,1-(o-p)/(h[d+i.PREV_TIME]-p));c+=(h[d+i.VALUE]-c)*f}l==e.setup?u.spacing=u.data.spacing+(c-u.data.spacing)*a:u.spacing+=(c-u.spacing)*a}},i}(v);t.PathConstraintSpacingTimeline=b;var S=function(i){function o(e){var r=i.call(this,e)||this;return r.frames=t.Utils.newFloatArray(e*o.ENTRIES),r}return X2(o,i),o.prototype.getPropertyId=function(){return(r.pathConstraintMix<<24)+this.pathConstraintIndex},o.prototype.setFrame=function(t,e,i,r){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.ROTATE]=i,this.frames[t+o.TRANSLATE]=r},o.prototype.apply=function(t,i,r,s,a,l){var h=this.frames,u=t.pathConstraints[this.pathConstraintIndex];if(u.active)if(r<h[0])switch(l){case e.setup:return u.rotateMix=u.data.rotateMix,void(u.translateMix=u.data.translateMix);case e.first:u.rotateMix+=(u.data.rotateMix-u.rotateMix)*a,u.translateMix+=(u.data.translateMix-u.translateMix)*a}else{var c=0,d=0;if(r>=h[h.length-o.ENTRIES])c=h[h.length+o.PREV_ROTATE],d=h[h.length+o.PREV_TRANSLATE];else{var p=n.binarySearch(h,r,o.ENTRIES);c=h[p+o.PREV_ROTATE],d=h[p+o.PREV_TRANSLATE];var f=h[p],_=this.getCurvePercent(p/o.ENTRIES-1,1-(r-f)/(h[p+o.PREV_TIME]-f));c+=(h[p+o.ROTATE]-c)*_,d+=(h[p+o.TRANSLATE]-d)*_}l==e.setup?(u.rotateMix=u.data.rotateMix+(c-u.data.rotateMix)*a,u.translateMix=u.data.translateMix+(d-u.data.translateMix)*a):(u.rotateMix+=(c-u.rotateMix)*a,u.translateMix+=(d-u.translateMix)*a)}},o.ENTRIES=3,o.PREV_TIME=-3,o.PREV_ROTATE=-2,o.PREV_TRANSLATE=-1,o.ROTATE=1,o.TRANSLATE=2,o}(o);t.PathConstraintMixTimeline=S}(W2||(W2={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new n(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new i})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,i=0,r=e.length;i<r;i++){var n=e[i];if(null!=n){n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast;var o=t*n.timeScale;if(n.delay>0){if(n.delay-=o,n.delay>0)continue;o=-n.delay,n.delay=0}var s=n.next;if(null!=s){var a=n.trackLast-s.delay;if(a>=0){for(s.delay=0,s.trackTime+=0==n.timeScale?0:(a/n.timeScale+t)*s.timeScale,n.trackTime+=o,this.setCurrent(i,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(n.trackLast>=n.trackEnd&&null==n.mixingFrom){e[i]=null,this.queue.end(n),this.disposeNext(n);continue}if(null!=n.mixingFrom&&this.updateMixingFrom(n,t)){var l=n.mixingFrom;for(n.mixingFrom=null,null!=l&&(l.mixingTo=null);null!=l;)this.queue.end(l),l=l.mixingFrom}n.trackTime+=o}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var i=t.mixingFrom;if(null==i)return!0;var r=this.updateMixingFrom(i,e);return i.animationLast=i.nextAnimationLast,i.trackLast=i.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=i.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=i.mixingFrom,null!=i.mixingFrom&&(i.mixingFrom.mixingTo=t),t.interruptAlpha=i.interruptAlpha,this.queue.end(i)),r):(i.trackTime+=e*i.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(i){if(null==i)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var r=this.events,n=this.tracks,o=!1,s=0,a=n.length;s<a;s++){var l=n[s];if(!(null==l||l.delay>0)){o=!0;var h=0==s?t.MixBlend.first:l.mixBlend,u=l.alpha;null!=l.mixingFrom?u*=this.applyMixingFrom(l,i,h):l.trackTime>=l.trackEnd&&null==l.next&&(u=0);var c=l.animationLast,d=l.getAnimationTime(),p=l.animation.timelines.length,f=l.animation.timelines;if(0==s&&1==u||h==t.MixBlend.add)for(var _=0;_<p;_++)t.Utils.webkit602BugfixHelper(u,h),f[_].apply(i,c,d,r,u,h,t.MixDirection.mixIn);else{var g=l.timelineMode,m=0==l.timelinesRotation.length;m&&t.Utils.setArraySize(l.timelinesRotation,p<<1,null);var y=l.timelinesRotation;for(_=0;_<p;_++){var v=f[_],b=(g[_]&e.NOT_LAST-1)==e.SUBSEQUENT?h:t.MixBlend.setup;v instanceof t.RotateTimeline?this.applyRotateTimeline(v,i,d,u,b,y,_<<1,m):(t.Utils.webkit602BugfixHelper(u,h),v.apply(i,c,d,r,u,b,t.MixDirection.mixIn))}}this.queueEvents(l,d),r.length=0,l.nextAnimationLast=d,l.nextTrackLast=l.trackTime}}return this.queue.drain(),o},e.prototype.applyMixingFrom=function(i,r,n){var o=i.mixingFrom;null!=o.mixingFrom&&this.applyMixingFrom(o,r,n);var s=0;0==i.mixDuration?(s=1,n==t.MixBlend.first&&(n=t.MixBlend.setup)):((s=i.mixTime/i.mixDuration)>1&&(s=1),n!=t.MixBlend.first&&(n=o.mixBlend));var a=s<o.eventThreshold?this.events:null,l=s<o.attachmentThreshold,h=s<o.drawOrderThreshold,u=o.animationLast,c=o.getAnimationTime(),d=o.animation.timelines.length,p=o.animation.timelines,f=o.alpha*i.interruptAlpha,_=f*(1-s);if(n==t.MixBlend.add)for(var g=0;g<d;g++)p[g].apply(r,u,c,a,_,n,t.MixDirection.mixOut);else{var m=o.timelineMode,y=o.timelineHoldMix,v=0==o.timelinesRotation.length;v&&t.Utils.setArraySize(o.timelinesRotation,d<<1,null);var b=o.timelinesRotation;for(o.totalAlpha=0,g=0;g<d;g++){var S=p[g],T=t.MixDirection.mixOut,E=void 0,A=0;switch(m[g]&e.NOT_LAST-1){case e.SUBSEQUENT:if(E=n,!l&&S instanceof t.AttachmentTimeline){if((m[g]&e.NOT_LAST)==e.NOT_LAST)continue;E=t.MixBlend.setup}if(!h&&S instanceof t.DrawOrderTimeline)continue;A=_;break;case e.FIRST:E=t.MixBlend.setup,A=_;break;case e.HOLD:E=t.MixBlend.setup,A=f;break;default:E=t.MixBlend.setup;var C=y[g];A=f*Math.max(0,1-C.mixTime/C.mixDuration)}o.totalAlpha+=A,S instanceof t.RotateTimeline?this.applyRotateTimeline(S,r,c,A,E,b,g<<1,v):(t.Utils.webkit602BugfixHelper(A,n),E==t.MixBlend.setup&&(S instanceof t.AttachmentTimeline?(l||(m[g]&e.NOT_LAST)==e.NOT_LAST)&&(T=t.MixDirection.mixIn):S instanceof t.DrawOrderTimeline&&h&&(T=t.MixDirection.mixIn)),S.apply(r,u,c,a,A,E,T))}}return i.mixDuration>0&&this.queueEvents(o,c),this.events.length=0,o.nextAnimationLast=c,o.nextTrackLast=o.trackTime,s},e.prototype.applyRotateTimeline=function(e,i,r,n,o,s,a,l){if(l&&(s[a]=0),1!=n){var h=e,u=h.frames,c=i.bones[h.boneIndex];if(c.active){var d=0,p=0;if(r<u[0])switch(o){case t.MixBlend.setup:c.rotation=c.data.rotation;default:return;case t.MixBlend.first:d=c.rotation,p=c.data.rotation}else if(d=o==t.MixBlend.setup?c.data.rotation:c.rotation,r>=u[u.length-t.RotateTimeline.ENTRIES])p=c.data.rotation+u[u.length+t.RotateTimeline.PREV_ROTATION];else{var f=t.Animation.binarySearch(u,r,t.RotateTimeline.ENTRIES),_=u[f+t.RotateTimeline.PREV_ROTATION],g=u[f],m=h.getCurvePercent((f>>1)-1,1-(r-g)/(u[f+t.RotateTimeline.PREV_TIME]-g));p=u[f+t.RotateTimeline.ROTATION]-_,p=_+(p-=360*(16384-(16384.499999999996-p/360|0)))*m+c.data.rotation,p-=360*(16384-(16384.499999999996-p/360|0))}var y=0,v=p-d;if(0==(v-=360*(16384-(16384.499999999996-v/360|0))))y=s[a];else{var b=0,S=0;l?(b=0,S=v):(b=s[a],S=s[a+1]);var T=v>0,E=b>=0;t.MathUtils.signum(S)!=t.MathUtils.signum(v)&&Math.abs(S)<=90&&(Math.abs(b)>180&&(b+=360*t.MathUtils.signum(b)),E=T),y=v+b-b%360,E!=T&&(y+=360*t.MathUtils.signum(b)),s[a]=y}s[a+1]=v,d+=y*n,c.rotation=d-360*(16384-(16384.499999999996-d/360|0))}}else e.apply(i,0,r,null,1,o,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var i=t.animationStart,r=t.animationEnd,n=r-i,o=t.trackLast%n,s=this.events,a=0,l=s.length;a<l;a++){var h=s[a];if(h.time<o)break;h.time>r||this.queue.event(t,h)}for((t.loop?0==n||o>t.trackTime%n:e>=r&&t.animationLast<r)&&this.queue.complete(t);a<l;a++)s[a].time<i||this.queue.event(t,s[a])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,i=this.tracks.length;e<i;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var i=e;;){var r=i.mixingFrom;if(null==r)break;this.queue.end(r),i.mixingFrom=null,i.mixingTo=null,i=r}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,i){var r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(i&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,r,i)},e.prototype.setAnimationWith=function(t,e,i){if(null==e)throw new Error("animation cannot be null.");var r=!0,n=this.expandToIndex(t);null!=n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.disposeNext(n),n=n.mixingFrom,r=!1):this.disposeNext(n));var o=this.trackEntry(t,e,i,n);return this.setCurrent(t,o,r),this.queue.drain(),o},e.prototype.addAnimation=function(t,e,i,r){var n=this.data.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,i,r)},e.prototype.addAnimationWith=function(t,e,i,r){if(null==e)throw new Error("animation cannot be null.");var n=this.expandToIndex(t);if(null!=n)for(;null!=n.next;)n=n.next;var o=this.trackEntry(t,e,i,n);if(null==n)this.setCurrent(t,o,!0),this.queue.drain();else if(n.next=o,r<=0){var s=n.animationEnd-n.animationStart;0!=s?(n.loop?r+=s*(1+(n.trackTime/s|0)):r+=Math.max(s,n.trackTime),r-=this.data.getMix(n.animation,e)):r=n.trackTime}return o.delay=r,o},e.prototype.setEmptyAnimation=function(t,i){var r=this.setAnimationWith(t,e.emptyAnimation,!1);return r.mixDuration=i,r.trackEnd=i,r},e.prototype.addEmptyAnimation=function(t,i,r){r<=0&&(r-=i);var n=this.addAnimationWith(t,e.emptyAnimation,!1,r);return n.mixDuration=i,n.trackEnd=i,n},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var i=0,r=this.tracks.length;i<r;i++){var n=this.tracks[i];null!=n&&this.setEmptyAnimation(n.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,i,r){var n=this.trackEntryPool.obtain();return n.trackIndex=t,n.animation=e,n.loop=i,n.holdPrevious=!1,n.eventThreshold=0,n.attachmentThreshold=0,n.drawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.interruptAlpha=1,n.mixTime=0,n.mixDuration=null==r?0:this.data.getMix(r.animation,e),n},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,i=this.tracks.length;e<i;e++)if(null!=(r=this.tracks[e])){for(;null!=r.mixingFrom;)r=r.mixingFrom;do{null!=r.mixingFrom&&r.mixBlend==t.MixBlend.add||this.computeHold(r),r=r.mixingTo}while(null!=r)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var r=this.tracks[e];null!=r;)this.computeNotLast(r),r=r.mixingFrom},e.prototype.computeHold=function(i){var r=i.mixingTo,n=i.animation.timelines,o=i.animation.timelines.length,s=t.Utils.setArraySize(i.timelineMode,o);i.timelineHoldMix.length=0;var a=t.Utils.setArraySize(i.timelineHoldMix,o),l=this.propertyIDs;if(null!=r&&r.holdPrevious)for(var h=0;h<o;h++)l.add(n[h].getPropertyId()),s[h]=e.HOLD;else t:for(h=0;h<o;h++){var u=n[h],c=u.getPropertyId();if(l.add(c))if(null==r||u instanceof t.AttachmentTimeline||u instanceof t.DrawOrderTimeline||u instanceof t.EventTimeline||!r.animation.hasTimeline(c))s[h]=e.FIRST;else{for(var d=r.mixingTo;null!=d;d=d.mixingTo)if(!d.animation.hasTimeline(c)){if(i.mixDuration>0){s[h]=e.HOLD_MIX,a[h]=d;continue t}break}s[h]=e.HOLD}else s[h]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(i){for(var r=i.animation.timelines,n=i.animation.timelines.length,o=i.timelineMode,s=this.propertyIDs,a=0;a<n;a++)if(r[a]instanceof t.AttachmentTimeline){var l=r[a];s.add(l.slotIndex)||(o[a]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var i=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=i;var r,n=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(r.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(r.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(r.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(r.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(r.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(r.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,i=0;i<t.length;i+=2){var n=t[i],o=t[i+1];switch(n){case r.start:null!=o.listener&&o.listener.start&&o.listener.start(o);for(var s=0;s<e.length;s++)e[s].start&&e[s].start(o);break;case r.interrupt:for(null!=o.listener&&o.listener.interrupt&&o.listener.interrupt(o),s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(o);break;case r.end:for(null!=o.listener&&o.listener.end&&o.listener.end(o),s=0;s<e.length;s++)e[s].end&&e[s].end(o);case r.dispose:for(null!=o.listener&&o.listener.dispose&&o.listener.dispose(o),s=0;s<e.length;s++)e[s].dispose&&e[s].dispose(o);this.animState.trackEntryPool.free(o);break;case r.complete:for(null!=o.listener&&o.listener.complete&&o.listener.complete(o),s=0;s<e.length;s++)e[s].complete&&e[s].complete(o);break;case r.event:var a=t[2+i++];for(null!=o.listener&&o.listener.event&&o.listener.event(o,a),s=0;s<e.length;s++)e[s].event&&e[s].event(o,a)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=n,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(r=t.EventType||(t.EventType={}));var o=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=o}(W2||(W2={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,i){var r=this.skeletonData.findAnimation(t);if(null==r)throw new Error("Animation not found: "+t);var n=this.skeletonData.findAnimation(e);if(null==n)throw new Error("Animation not found: "+e);this.setMixWith(r,n,i)},t.prototype.setMixWith=function(t,e,i){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var r=t.name+"."+e.name;this.animationToMixTime[r]=i},t.prototype.getMix=function(t,e){var i=t.name+"."+e.name,r=this.animationToMixTime[i];return void 0===r?this.defaultMix:r},t}();t.AnimationStateData=e}(W2||(W2={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(){200==r.status?e(r.responseText):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.downloadBinary=function(t,e,i){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status?e(new Uint8Array(r.response)):i(r.status,r.responseText)},r.onerror=function(){i(r.status,r.responseText)},r.send()},e.prototype.loadBinary=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load binary "+t+": status "+status+", "+i,r&&r(t,"Couldn't load binary "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadText=function(t,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){n.assets[t]=e,i&&i(t,e),n.toLoad--,n.loaded++}),(function(e,i){n.errors[t]="Couldn't load text "+t+": status "+status+", "+i,r&&r(t,"Couldn't load text "+t+": status "+status+", "+i),n.toLoad--,n.loaded++}))},e.prototype.loadTexture=function(t,e,i){var r=this;void 0===e&&(e=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var n=new Image;n.crossOrigin="anonymous",n.onload=function(){var i=r.textureLoader(n);r.assets[t]=i,r.toLoad--,r.loaded++,e&&e(t,n)},n.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},n.src=t},e.prototype.loadTextureData=function(t,e,i,r){var n=this;void 0===i&&(i=null),void 0===r&&(r=null),t=this.pathPrefix+t,this.toLoad++;var o=new Image;o.onload=function(){var e=n.textureLoader(o);n.assets[t]=e,n.toLoad--,n.loaded++,i&&i(t,o)},o.onerror=function(){n.errors[t]="Couldn't load image "+t,n.toLoad--,n.loaded++,r&&r(t,"Couldn't load image "+t)},o.src=e},e.prototype.loadTextureAtlas=function(i,r,n){var o=this;void 0===r&&(r=null),void 0===n&&(n=null);var s=i.lastIndexOf("/")>=0?i.substring(0,i.lastIndexOf("/")):"";i=this.pathPrefix+i,this.toLoad++,e.downloadText(i,(function(e){var a={count:0},l=new Array;try{new t.TextureAtlas(e,(function(e){l.push(s+"/"+e);var i=document.createElement("img");return i.width=16,i.height=16,new t.FakeTexture(i)}))}catch(t){var h=t;return o.errors[i]="Couldn't load texture atlas "+i+": "+h.message,n&&n(i,"Couldn't load texture atlas "+i+": "+h.message),o.toLoad--,void o.loaded++}for(var u=function(h){var u=!1;o.loadTexture(h,(function(h){if(a.count++,a.count==l.length)if(u)o.errors[i]="Couldn't load texture atlas page "+h+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+h+" of atlas "+i),o.toLoad--,o.loaded++;else try{var c=new t.TextureAtlas(e,(function(t){return o.get(s+"/"+t)}));o.assets[i]=c,r&&r(i,c),o.toLoad--,o.loaded++}catch(t){var d=t;o.errors[i]="Couldn't load texture atlas "+i+": "+d.message,n&&n(i,"Couldn't load texture atlas "+i+": "+d.message),o.toLoad--,o.loaded++}}),(function(t){u=!0,a.count++,a.count==l.length&&(o.errors[i]="Couldn't load texture atlas page "+t+"} of atlas "+i,n&&n(i,"Couldn't load texture atlas page "+t+" of atlas "+i),o.toLoad--,o.loaded++)}))},c=0,d=l;c<d.length;c++)u(d[c])}),(function(t,e){o.errors[i]="Couldn't load texture atlas "+i+": status "+status+", "+e,n&&n(i,"Couldn't load texture atlas "+i+": status "+status+", "+e),o.toLoad--,o.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(W2||(W2={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var o=new t.RegionAttachment(i);return o.setRegion(n),o},e.prototype.newMeshAttachment=function(e,i,r){var n=this.atlas.findRegion(r);if(null==n)return null;n.renderObject=n;var o=new t.MeshAttachment(i);return o.region=n,o},e.prototype.newBoundingBoxAttachment=function(e,i){return new t.BoundingBoxAttachment(i)},e.prototype.newPathAttachment=function(e,i){return new t.PathAttachment(i)},e.prototype.newPointAttachment=function(e,i){return new t.PointAttachment(i)},e.prototype.newClippingAttachment=function(e,i){return new t.ClippingAttachment(i)},e}();t.AtlasAttachmentLoader=e}(W2||(W2={})),function(t){var e;(e=t.BlendMode||(t.BlendMode={}))[e.Normal=0]="Normal",e[e.Additive=1]="Additive",e[e.Multiply=2]="Multiply",e[e.Screen=3]="Screen"}(W2||(W2={})),function(t){var e=function(){function e(t,e,i){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=i,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,i,r,n,o,s,a){this.ax=e,this.ay=i,this.arotation=r,this.ascaleX=n,this.ascaleY=o,this.ashearX=s,this.ashearY=a,this.appliedValid=!0;var l=this.parent;if(null==l){var h=this.skeleton,u=r+90+a,c=h.scaleX,d=h.scaleY;return this.a=t.MathUtils.cosDeg(r+s)*n*c,this.b=t.MathUtils.cosDeg(u)*o*c,this.c=t.MathUtils.sinDeg(r+s)*n*d,this.d=t.MathUtils.sinDeg(u)*o*d,this.worldX=e*c+h.x,void(this.worldY=i*d+h.y)}var p=l.a,f=l.b,_=l.c,g=l.d;switch(this.worldX=p*e+f*i+l.worldX,this.worldY=_*e+g*i+l.worldY,this.data.transformMode){case t.TransformMode.Normal:u=r+90+a;var m=t.MathUtils.cosDeg(r+s)*n,y=t.MathUtils.cosDeg(u)*o,v=t.MathUtils.sinDeg(r+s)*n,b=t.MathUtils.sinDeg(u)*o;return this.a=p*m+f*v,this.b=p*y+f*b,this.c=_*m+g*v,void(this.d=_*y+g*b);case t.TransformMode.OnlyTranslation:u=r+90+a,this.a=t.MathUtils.cosDeg(r+s)*n,this.b=t.MathUtils.cosDeg(u)*o,this.c=t.MathUtils.sinDeg(r+s)*n,this.d=t.MathUtils.sinDeg(u)*o;break;case t.TransformMode.NoRotationOrReflection:var S=0;(A=p*p+_*_)>1e-4?(f=_*(A=Math.abs(p*g-f*_)/A),g=p*A,S=Math.atan2(_,p)*t.MathUtils.radDeg):(p=0,_=0,S=90-Math.atan2(g,f)*t.MathUtils.radDeg);var T=r+s-S,E=r+a-S+90;m=t.MathUtils.cosDeg(T)*n,y=t.MathUtils.cosDeg(E)*o,v=t.MathUtils.sinDeg(T)*n,b=t.MathUtils.sinDeg(E)*o,this.a=p*m-f*v,this.b=p*y-f*b,this.c=_*m+g*v,this.d=_*y+g*b;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var A,C=t.MathUtils.cosDeg(r),w=t.MathUtils.sinDeg(r),x=(p*C+f*w)/this.skeleton.scaleX,R=(_*C+g*w)/this.skeleton.scaleY;(A=Math.sqrt(x*x+R*R))>1e-5&&(A=1/A),x*=A,R*=A,A=Math.sqrt(x*x+R*R),this.data.transformMode==t.TransformMode.NoScale&&p*g-f*_<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(A=-A);var M=Math.PI/2+Math.atan2(R,x),O=Math.cos(M)*A,P=Math.sin(M)*A;m=t.MathUtils.cosDeg(s)*n,y=t.MathUtils.cosDeg(90+a)*o,v=t.MathUtils.sinDeg(s)*n,b=t.MathUtils.sinDeg(90+a)*o,this.a=x*m+O*v,this.b=x*y+O*b,this.c=R*m+P*v,this.d=R*y+P*b}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var i=e.a,r=e.b,n=e.c,o=e.d,s=1/(i*o-r*n),a=this.worldX-e.worldX,l=this.worldY-e.worldY;this.ax=a*o*s-l*r*s,this.ay=l*i*s-a*n*s;var h=s*o,u=s*i,c=s*r,d=s*n,p=h*this.a-c*this.c,f=h*this.b-c*this.d,_=u*this.c-d*this.a,g=u*this.d-d*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(p*p+_*_),this.ascaleX>1e-4){var m=p*g-f*_;this.ascaleY=m/this.ascaleX,this.ashearY=Math.atan2(p*f+_*g,m)*t.MathUtils.radDeg,this.arotation=Math.atan2(_,p)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(f*f+g*g),this.ashearY=0,this.arotation=90-Math.atan2(g,f)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,i=this.b,r=this.c,n=this.d,o=1/(e*n-i*r),s=t.x-this.worldX,a=t.y-this.worldY;return t.x=s*n*o-a*i*o,t.y=a*e*o-s*r*o,t},e.prototype.localToWorld=function(t){var e=t.x,i=t.y;return t.x=e*this.a+i*this.b+this.worldX,t.y=e*this.c+i*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(this.a*i-this.c*r,this.d*r-this.b*i)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var i=t.MathUtils.sinDeg(e),r=t.MathUtils.cosDeg(e);return Math.atan2(r*this.c+i*this.d,r*this.a+i*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var i=this.a,r=this.b,n=this.c,o=this.d,s=t.MathUtils.cosDeg(e),a=t.MathUtils.sinDeg(e);this.a=s*i-a*n,this.b=s*r-a*o,this.c=a*i+s*n,this.d=a*r+s*o,this.appliedValid=!1},e}();t.Bone=e}(W2||(W2={})),function(t){var e;t.BoneData=function(i,r,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,i<0)throw new Error("index must be >= 0.");if(null==r)throw new Error("name cannot be null.");this.index=i,this.name=r,this.parent=n},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(W2||(W2={})),function(t){t.ConstraintData=function(t,e,i){this.name=t,this.order=e,this.skinRequired=i}}(W2||(W2={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(W2||(W2={})),function(t){t.EventData=function(t){this.name=t}}(W2||(W2={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var i=0;i<t.bones.length;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,i,r,n,o,s,a){e.appliedValid||e.updateAppliedTransform();var l=e.parent,h=1/(l.a*l.d-l.b*l.c),u=i-l.worldX,c=r-l.worldY,d=(u*l.d-c*l.b)*h-e.ax,p=(c*l.a-u*l.c)*h-e.ay,f=Math.atan2(p,d)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);var _=e.ascaleX,g=e.ascaleY;if(n||o){var m=e.data.length*_,y=Math.sqrt(d*d+p*p);if(n&&y<m||o&&y>m&&m>1e-4){var v=(y/m-1)*a+1;_*=v,s&&(g*=v)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+f*a,_,g,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,i,r,n,o,s,a,l){if(0!=l){e.appliedValid||e.updateAppliedTransform(),i.appliedValid||i.updateAppliedTransform();var h=e.ax,u=e.ay,c=e.ascaleX,d=c,p=e.ascaleY,f=i.ascaleX,_=0,g=0,m=0;c<0?(c=-c,_=180,m=-1):(_=0,m=1),p<0&&(p=-p,m=-m),f<0?(f=-f,g=180):g=0;var y=i.ax,v=0,b=0,S=0,T=e.a,E=e.b,A=e.c,C=e.d,w=Math.abs(c-p)<=1e-4;w?(b=T*y+E*(v=i.ay)+e.worldX,S=A*y+C*v+e.worldY):(v=0,b=T*y+e.worldX,S=A*y+e.worldY);var x=e.parent;T=x.a,E=x.b,A=x.c;var R,M,O=1/(T*(C=x.d)-E*A),P=b-x.worldX,D=S-x.worldY,I=(P*C-D*E)*O-h,B=(D*T-P*A)*O-u,L=Math.sqrt(I*I+B*B),F=i.data.length*f;if(L<1e-4)return this.apply1(e,r,n,!1,s,!1,l),void i.updateWorldTransformWith(y,v,0,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY);var k=((P=r-x.worldX)*C-(D=n-x.worldY)*E)*O-h,N=(D*T-P*A)*O-u,z=k*k+N*N;if(0!=a){a*=c*(f+1)/2;var U=Math.sqrt(z),V=U-L-F*c+a;if(V>0){var H=Math.min(1,V/(2*a))-1;z=(k-=(H=(V-a*(1-H*H))/U)*k)*k+(N-=H*N)*N}}t:if(w){var G=(z-L*L-(F*=c)*F)/(2*L*F);G<-1?G=-1:G>1&&(G=1,s&&(d*=(Math.sqrt(z)/(L+F)-1)*l+1)),M=Math.acos(G)*o,T=L+F*G,E=F*Math.sin(M),R=Math.atan2(N*T-k*E,k*T+N*E)}else{var W=(T=c*F)*T,X=(E=p*F)*E,Y=Math.atan2(N,k),j=-2*X*L,q=X-W;if((C=j*j-4*q*(A=X*L*L+W*z-W*X))>=0){var K=Math.sqrt(C);j<0&&(K=-K);var Z=(K=-(j+K)/2)/q,J=A/K,Q=Math.abs(Z)<Math.abs(J)?Z:J;if(Q*Q<=z){D=Math.sqrt(z-Q*Q)*o,R=Y-Math.atan2(D,Q),M=Math.atan2(D/p,(Q-L)/c);break t}}var $=t.MathUtils.PI,tt=L-T,et=tt*tt,it=0,rt=0,nt=L+T,ot=nt*nt,st=0;(A=-T*L/(W-X))>=-1&&A<=1&&(A=Math.acos(A),(C=(P=T*Math.cos(A)+L)*P+(D=E*Math.sin(A))*D)<et&&($=A,et=C,tt=P,it=D),C>ot&&(rt=A,ot=C,nt=P,st=D)),z<=(et+ot)/2?(R=Y-Math.atan2(it*o,tt),M=$*o):(R=Y-Math.atan2(st*o,nt),M=rt*o)}var at=Math.atan2(v,y)*m,lt=e.arotation;(R=(R-at)*t.MathUtils.radDeg+_-lt)>180?R-=360:R<-180&&(R+=360),e.updateWorldTransformWith(h,u,lt+R*l,d,e.ascaleY,0,0),lt=i.arotation,(M=((M+at)*t.MathUtils.radDeg-i.ashearX)*m+g-lt)>180?M-=360:M<-180&&(M+=360),i.updateWorldTransformWith(y,v,lt+M*l,i.ascaleX,i.ascaleY,i.ashearX,i.ashearY)}else i.updateWorldTransform()},e}();t.IkConstraint=e}(W2||(W2={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.bendDirection=1,i.compress=!1,i.stretch=!1,i.uniform=!1,i.mix=1,i.softness=0,i}return X2(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(W2||(W2={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var i=0,r=t.bones.length;i<r;i++)this.bones.push(e.findBone(t.bones[i].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var i=this.target.getAttachment();if(i instanceof t.PathAttachment){var r=this.rotateMix,n=this.translateMix,o=r>0;if(n>0||o){var s=this.data,a=s.spacingMode==t.SpacingMode.Percent,l=s.rotateMode,h=l==t.RotateMode.Tangent,u=l==t.RotateMode.ChainScale,c=this.bones.length,d=h?c:c+1,p=this.bones,f=t.Utils.setArraySize(this.spaces,d),_=null,g=this.spacing;if(u||!a){u&&(_=t.Utils.setArraySize(this.lengths,c));for(var m=s.spacingMode==t.SpacingMode.Length,y=0,v=d-1;y<v;){var b=(P=p[y]).data.length;if(b<e.epsilon)u&&(_[y]=0),f[++y]=0;else if(a){if(u){var S=b*P.a,T=b*P.c,E=Math.sqrt(S*S+T*T);_[y]=E}f[++y]=g}else{S=b*P.a,T=b*P.c;var A=Math.sqrt(S*S+T*T);u&&(_[y]=A),f[++y]=(m?b+g:g)*A/b}}}else for(y=1;y<d;y++)f[y]=g;var C=this.computeWorldPositions(i,d,h,s.positionMode==t.PositionMode.Percent,a),w=C[0],x=C[1],R=s.offsetRotation,M=!1;0==R?M=l==t.RotateMode.Chain:(M=!1,R*=(O=this.target.bone).a*O.d-O.b*O.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),y=0;for(var O=3;y<c;y++,O+=3){var P;(P=p[y]).worldX+=(w-P.worldX)*n,P.worldY+=(x-P.worldY)*n;var D=(S=C[O])-w,I=(T=C[O+1])-x;if(u){var B=_[y];if(0!=B){var L=(Math.sqrt(D*D+I*I)/B-1)*r+1;P.a*=L,P.c*=L}}if(w=S,x=T,o){var F=P.a,k=P.b,N=P.c,z=P.d,U=0,V=0,H=0;if(U=h?C[O-1]:0==f[y+1]?C[O+2]:Math.atan2(I,D),U-=Math.atan2(N,F),M){V=Math.cos(U),H=Math.sin(U);var G=P.data.length;w+=(G*(V*F-H*N)-D)*r,x+=(G*(H*F+V*N)-I)*r}else U+=R;U>t.MathUtils.PI?U-=t.MathUtils.PI2:U<-t.MathUtils.PI&&(U+=t.MathUtils.PI2),U*=r,V=Math.cos(U),H=Math.sin(U),P.a=V*F-H*N,P.b=V*k-H*z,P.c=H*F+V*N,P.d=H*k+V*z}P.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(i,r,n,o,s){var a=this.target,l=this.position,h=this.spaces,u=t.Utils.setArraySize(this.positions,3*r+2),c=null,d=i.closed,p=i.worldVerticesLength,f=p/6,_=e.NONE;if(!i.constantSpeed){var g=i.lengths,m=g[f-=d?1:2];if(o&&(l*=m),s)for(var y=1;y<r;y++)h[y]*=m;c=t.Utils.setArraySize(this.world,8),y=0;for(var v=0,b=0;y<r;y++,v+=3){var S=l+=X=h[y];if(d)(S%=m)<0&&(S+=m),b=0;else{if(S<0){_!=e.BEFORE&&(_=e.BEFORE,i.computeWorldVertices(a,2,4,c,0,2)),this.addBeforePosition(S,c,0,u,v);continue}if(S>m){_!=e.AFTER&&(_=e.AFTER,i.computeWorldVertices(a,p-6,4,c,0,2)),this.addAfterPosition(S-m,c,0,u,v);continue}}for(;;b++){var T=g[b];if(!(S>T)){0==b?S/=T:S=(S-(K=g[b-1]))/(T-K);break}}b!=_&&(_=b,d&&b==f?(i.computeWorldVertices(a,p-4,4,c,0,2),i.computeWorldVertices(a,0,4,c,4,2)):i.computeWorldVertices(a,6*b+2,8,c,0,2)),this.addCurvePosition(S,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],u,v,n||y>0&&0==X)}return u}d?(p+=2,c=t.Utils.setArraySize(this.world,p),i.computeWorldVertices(a,2,p-4,c,0,2),i.computeWorldVertices(a,0,2,c,p-4,2),c[p-2]=c[0],c[p-1]=c[1]):(f--,p-=4,c=t.Utils.setArraySize(this.world,p),i.computeWorldVertices(a,2,p,c,0,2));for(var E=t.Utils.setArraySize(this.curves,f),A=0,C=c[0],w=c[1],x=0,R=0,M=0,O=0,P=0,D=0,I=0,B=0,L=0,F=0,k=0,N=0,z=0,U=0,V=(y=0,2);y<f;y++,V+=6)x=c[V],R=c[V+1],M=c[V+2],O=c[V+3],k=2*(I=.1875*(C-2*x+M))+(L=.09375*(3*(x-M)-C+(P=c[V+4]))),N=2*(B=.1875*(w-2*R+O))+(F=.09375*(3*(R-O)-w+(D=c[V+5]))),z=.75*(x-C)+I+.16666667*L,U=.75*(R-w)+B+.16666667*F,A+=Math.sqrt(z*z+U*U),z+=k,U+=N,k+=L,N+=F,A+=Math.sqrt(z*z+U*U),z+=k,U+=N,A+=Math.sqrt(z*z+U*U),z+=k+L,U+=N+F,A+=Math.sqrt(z*z+U*U),E[y]=A,C=P,w=D;if(l*=o?A:A/i.lengths[f-1],s)for(y=1;y<r;y++)h[y]*=A;for(var H=this.segments,G=0,W=(y=0,v=0,b=0,0);y<r;y++,v+=3){var X;if(S=l+=X=h[y],d)(S%=A)<0&&(S+=A),b=0;else{if(S<0){this.addBeforePosition(S,c,0,u,v);continue}if(S>A){this.addAfterPosition(S-A,c,p-4,u,v);continue}}for(;;b++){var Y=E[b];if(!(S>Y)){0==b?S/=Y:S=(S-(K=E[b-1]))/(Y-K);break}}if(b!=_){_=b;var j=6*b;for(C=c[j],w=c[j+1],x=c[j+2],R=c[j+3],M=c[j+4],O=c[j+5],k=2*(I=.03*(C-2*x+M))+(L=.006*(3*(x-M)-C+(P=c[j+6]))),N=2*(B=.03*(w-2*R+O))+(F=.006*(3*(R-O)-w+(D=c[j+7]))),z=.3*(x-C)+I+.16666667*L,U=.3*(R-w)+B+.16666667*F,G=Math.sqrt(z*z+U*U),H[0]=G,j=1;j<8;j++)z+=k,U+=N,k+=L,N+=F,G+=Math.sqrt(z*z+U*U),H[j]=G;z+=k,U+=N,G+=Math.sqrt(z*z+U*U),H[8]=G,z+=k+L,U+=N+F,G+=Math.sqrt(z*z+U*U),H[9]=G,W=0}for(S*=G;;W++){var q=H[W];if(!(S>q)){var K;0==W?S/=q:S=W+(S-(K=H[W-1]))/(q-K);break}}this.addCurvePosition(.1*S,C,w,x,R,M,O,P,D,u,v,n||y>0&&0==X)}return u},e.prototype.addBeforePosition=function(t,e,i,r,n){var o=e[i],s=e[i+1],a=e[i+2]-o,l=e[i+3]-s,h=Math.atan2(l,a);r[n]=o+t*Math.cos(h),r[n+1]=s+t*Math.sin(h),r[n+2]=h},e.prototype.addAfterPosition=function(t,e,i,r,n){var o=e[i+2],s=e[i+3],a=o-e[i],l=s-e[i+1],h=Math.atan2(l,a);r[n]=o+t*Math.cos(h),r[n+1]=s+t*Math.sin(h),r[n+2]=h},e.prototype.addCurvePosition=function(t,e,i,r,n,o,s,a,l,h,u,c){if(0==t||isNaN(t))return h[u]=e,h[u+1]=i,void(h[u+2]=Math.atan2(n-i,r-e));var d=t*t,p=d*t,f=1-t,_=f*f,g=_*f,m=f*t,y=3*m,v=f*y,b=y*t,S=e*g+r*v+o*b+a*p,T=i*g+n*v+s*b+l*p;h[u]=S,h[u+1]=T,c&&(h[u+2]=t<.001?Math.atan2(n-i,r-e):Math.atan2(T-(i*_+n*m*2+s*d),S-(e*_+r*m*2+o*d)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(W2||(W2={})),function(t){var e,i,r,n=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i}return X2(e,t),e}(t.ConstraintData);t.PathConstraintData=n,(r=t.PositionMode||(t.PositionMode={}))[r.Fixed=0]="Fixed",r[r.Percent=1]="Percent",(i=t.SpacingMode||(t.SpacingMode={}))[i.Length=0]="Length",i[i.Fixed=1]="Fixed",i[i.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(W2||(W2={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),i=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,i,r){var n=this.clientAssets[t];return null==n&&(n=new e(t),this.clientAssets[t]=n),null!==i&&(n.textureLoader=i),n.toLoad.push(r),this.queuedAssets[r]!==r&&(this.queuedAssets[r]=r,!0)},t.prototype.loadText=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=r.responseText:i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadJson=function(t,e){var i=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?i.rawAssets[e]=JSON.parse(r.responseText):i.errors[e]="Couldn't load text "+e+": status "+r.status+", "+r.responseText)},r.open("GET",e,!0),r.send()}},t.prototype.loadTexture=function(t,e,i){var r=this;if(i=this.pathPrefix+i,this.queueAsset(t,e,i)){var n=new Image;n.src=i,n.crossOrigin="anonymous",n.onload=function(){r.rawAssets[i]=n},n.onerror=function(){r.errors[i]="Couldn't load image "+i}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var i=this.clientAssets[t];return null==i||i.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var i=t.toLoad[e];if(null==t.assets[i]){var r=this.rawAssets[i];if(null==r)continue;r instanceof HTMLImageElement?t.assets[i]=t.textureLoader(r):t.assets[i]=r}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=i}(W2||(W2={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var i=0;i<e.bones.length;i++){var r=e.bones[i],n=void 0;if(null==r.parent)n=new t.Bone(r,this,null);else{var o=this.bones[r.parent.index];n=new t.Bone(r,this,o),o.children.push(n)}this.bones.push(n)}for(this.slots=new Array,this.drawOrder=new Array,i=0;i<e.slots.length;i++){var s=e.slots[i],a=(n=this.bones[s.boneData.index],new t.Slot(s,n));this.slots.push(a),this.drawOrder.push(a)}for(this.ikConstraints=new Array,i=0;i<e.ikConstraints.length;i++){var l=e.ikConstraints[i];this.ikConstraints.push(new t.IkConstraint(l,this))}for(this.transformConstraints=new Array,i=0;i<e.transformConstraints.length;i++){var h=e.transformConstraints[i];this.transformConstraints.push(new t.TransformConstraint(h,this))}for(this.pathConstraints=new Array,i=0;i<e.pathConstraints.length;i++){var u=e.pathConstraints[i];this.pathConstraints.push(new t.PathConstraint(u,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,i=t.length;e<i;e++)(n=t[e]).sorted=n.data.skinRequired,n.active=!n.sorted;if(null!=this.skin){var r=this.skin.bones;for(e=0,i=this.skin.bones.length;e<i;e++){var n=this.bones[r[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(null!=n)}}var o=this.ikConstraints,s=this.transformConstraints,a=this.pathConstraints,l=o.length,h=s.length,u=a.length,c=l+h+u;t:for(e=0;e<c;e++){for(var d=0;d<l;d++)if((p=o[d]).data.order==e){this.sortIkConstraint(p);continue t}for(d=0;d<h;d++)if((p=s[d]).data.order==e){this.sortTransformConstraint(p);continue t}for(d=0;d<u;d++){var p;if((p=a[d]).data.order==e){this.sortPathConstraint(p);continue t}}}for(e=0,i=t.length;e<i;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target;this.sortBone(i);var r=e.bones,n=r[0];if(this.sortBone(n),r.length>1){var o=r[r.length-1];this._updateCache.indexOf(o)>-1||this.updateCacheReset.push(o)}this._updateCache.push(e),this.sortReset(n.children),r[r.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var i=e.target,r=i.data.index,n=i.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,r,n),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,r,n);for(var o=0,s=this.data.skins.length;o<s;o++)this.sortPathConstraintAttachment(this.data.skins[o],r,n);var a=i.getAttachment();a instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(a,n);var l=e.bones,h=l.length;for(o=0;o<h;o++)this.sortBone(l[o]);for(this._updateCache.push(e),o=0;o<h;o++)this.sortReset(l[o].children);for(o=0;o<h;o++)l[o].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var i=e.bones,r=i.length;if(e.data.local)for(var n=0;n<r;n++){var o=i[n];this.sortBone(o.parent),this._updateCache.indexOf(o)>-1||this.updateCacheReset.push(o)}else for(n=0;n<r;n++)this.sortBone(i[n]);this._updateCache.push(e);for(var s=0;s<r;s++)this.sortReset(i[s].children);for(s=0;s<r;s++)i[s].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,i){var r=t.attachments[e];if(r)for(var n in r)this.sortPathConstraintAttachmentWith(r[n],i)},e.prototype.sortPathConstraintAttachmentWith=function(e,i){if(e instanceof t.PathAttachment){var r=e.bones;if(null==r)this.sortBone(i);else for(var n=this.bones,o=0;o<r.length;)for(var s=r[o++],a=o+s;o<a;o++){var l=r[o];this.sortBone(n[l])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e];r.active&&(r.sorted&&this.sortReset(r.children),r.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,i=t.length;e<i;e++){var r=t[e];r.ax=r.x,r.ay=r.y,r.arotation=r.rotation,r.ascaleX=r.scaleX,r.ascaleY=r.scaleY,r.ashearX=r.shearX,r.ashearY=r.shearY,r.appliedValid=!0}var n=this._updateCache;for(e=0,i=n.length;e<i;e++)n[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,i=t.length;e<i;e++)t[e].setToSetupPose();var r=this.ikConstraints;for(e=0,i=r.length;e<i;e++)(a=r[e]).mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch;var n=this.transformConstraints;for(e=0,i=n.length;e<i;e++){var o=(a=n[e]).data;a.rotateMix=o.rotateMix,a.translateMix=o.translateMix,a.scaleMix=o.scaleMix,a.shearMix=o.shearMix}var s=this.pathConstraints;for(e=0,i=s.length;e<i;e++){var a;o=(a=s[e]).data,a.position=o.position,a.spacing=o.spacing,a.rotateMix=o.rotateMix,a.translateMix=o.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var i=0,r=e.length;i<r;i++)e[i].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].data.name==t)return i;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i],o=n.data.attachmentName;if(null!=o){var s=t.getAttachment(i,o);null!=s&&n.setAttachment(s)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var i=this.skin.getAttachment(t,e);if(null!=i)return i}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var i=this.slots,r=0,n=i.length;r<n;r++){var o=i[r];if(o.data.name==t){var s=null;if(null!=e&&null==(s=this.getAttachment(r,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void o.setAttachment(s)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.data.name==t)return n}return null},e.prototype.getBounds=function(e,i,r){if(void 0===r&&(r=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==i)throw new Error("size cannot be null.");for(var n=this.drawOrder,o=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,h=0,u=n.length;h<u;h++){var c=n[h];if(c.bone.active){var d=0,p=null,f=c.getAttachment();if(f instanceof t.RegionAttachment)d=8,p=t.Utils.setArraySize(r,d,0),f.computeWorldVertices(c.bone,p,0,2);else if(f instanceof t.MeshAttachment){var _=f;d=_.worldVerticesLength,p=t.Utils.setArraySize(r,d,0),_.computeWorldVertices(c,0,d,p,0,2)}if(null!=p)for(var g=0,m=p.length;g<m;g+=2){var y=p[g],v=p[g+1];o=Math.min(o,y),s=Math.min(s,v),a=Math.max(a,y),l=Math.max(l,v)}}}e.set(o,s),i.set(a-o,l-s)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(W2||(W2={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(r){var n=this.scale,o=new t.SkeletonData;o.name="";var s=new i(r);o.hash=s.readString(),o.version=s.readString(),o.x=s.readFloat(),o.y=s.readFloat(),o.width=s.readFloat(),o.height=s.readFloat();var a=s.readBoolean();a&&(o.fps=s.readFloat(),o.imagesPath=s.readString(),o.audioPath=s.readString());var l=0;l=s.readInt(!0);for(var h=0;h<l;h++)s.strings.push(s.readString());for(l=s.readInt(!0),h=0;h<l;h++){var u=s.readString(),c=0==h?null:o.bones[s.readInt(!0)];(f=new t.BoneData(h,u,c)).rotation=s.readFloat(),f.x=s.readFloat()*n,f.y=s.readFloat()*n,f.scaleX=s.readFloat(),f.scaleY=s.readFloat(),f.shearX=s.readFloat(),f.shearY=s.readFloat(),f.length=s.readFloat()*n,f.transformMode=e.TransformModeValues[s.readInt(!0)],f.skinRequired=s.readBoolean(),a&&t.Color.rgba8888ToColor(f.color,s.readInt32()),o.bones.push(f)}for(l=s.readInt(!0),h=0;h<l;h++){var d=s.readString(),p=o.bones[s.readInt(!0)],f=new t.SlotData(h,d,p);t.Color.rgba8888ToColor(f.color,s.readInt32());var _=s.readInt32();-1!=_&&t.Color.rgb888ToColor(f.darkColor=new t.Color,_),f.attachmentName=s.readStringRef(),f.blendMode=e.BlendModeValues[s.readInt(!0)],o.slots.push(f)}l=s.readInt(!0),h=0;for(var g=void 0;h<l;h++){(f=new t.IkConstraintData(s.readString())).order=s.readInt(!0),f.skinRequired=s.readBoolean(),g=s.readInt(!0);for(var m=0;m<g;m++)f.bones.push(o.bones[s.readInt(!0)]);f.target=o.bones[s.readInt(!0)],f.mix=s.readFloat(),f.softness=s.readFloat()*n,f.bendDirection=s.readByte(),f.compress=s.readBoolean(),f.stretch=s.readBoolean(),f.uniform=s.readBoolean(),o.ikConstraints.push(f)}for(l=s.readInt(!0),h=0,g=void 0;h<l;h++){for((f=new t.TransformConstraintData(s.readString())).order=s.readInt(!0),f.skinRequired=s.readBoolean(),g=s.readInt(!0),m=0;m<g;m++)f.bones.push(o.bones[s.readInt(!0)]);f.target=o.bones[s.readInt(!0)],f.local=s.readBoolean(),f.relative=s.readBoolean(),f.offsetRotation=s.readFloat(),f.offsetX=s.readFloat()*n,f.offsetY=s.readFloat()*n,f.offsetScaleX=s.readFloat(),f.offsetScaleY=s.readFloat(),f.offsetShearY=s.readFloat(),f.rotateMix=s.readFloat(),f.translateMix=s.readFloat(),f.scaleMix=s.readFloat(),f.shearMix=s.readFloat(),o.transformConstraints.push(f)}for(l=s.readInt(!0),h=0,g=void 0;h<l;h++){for((f=new t.PathConstraintData(s.readString())).order=s.readInt(!0),f.skinRequired=s.readBoolean(),g=s.readInt(!0),m=0;m<g;m++)f.bones.push(o.bones[s.readInt(!0)]);f.target=o.slots[s.readInt(!0)],f.positionMode=e.PositionModeValues[s.readInt(!0)],f.spacingMode=e.SpacingModeValues[s.readInt(!0)],f.rotateMode=e.RotateModeValues[s.readInt(!0)],f.offsetRotation=s.readFloat(),f.position=s.readFloat(),f.positionMode==t.PositionMode.Fixed&&(f.position*=n),f.spacing=s.readFloat(),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=n),f.rotateMix=s.readFloat(),f.translateMix=s.readFloat(),o.pathConstraints.push(f)}var y=this.readSkin(s,o,!0,a);for(null!=y&&(o.defaultSkin=y,o.skins.push(y)),h=o.skins.length,t.Utils.setArraySize(o.skins,l=h+s.readInt(!0));h<l;h++)o.skins[h]=this.readSkin(s,o,!1,a);for(l=this.linkedMeshes.length,h=0;h<l;h++){var v=this.linkedMeshes[h],b=null==v.skin?o.defaultSkin:o.findSkin(v.skin);if(null==b)throw new Error("Skin not found: "+v.skin);var S=b.getAttachment(v.slotIndex,v.parent);if(null==S)throw new Error("Parent mesh not found: "+v.parent);v.mesh.deformAttachment=v.inheritDeform?S:v.mesh,v.mesh.setParentMesh(S),v.mesh.updateUVs()}for(this.linkedMeshes.length=0,l=s.readInt(!0),h=0;h<l;h++)(f=new t.EventData(s.readStringRef())).intValue=s.readInt(!1),f.floatValue=s.readFloat(),f.stringValue=s.readString(),f.audioPath=s.readString(),null!=f.audioPath&&(f.volume=s.readFloat(),f.balance=s.readFloat()),o.events.push(f);for(l=s.readInt(!0),h=0;h<l;h++)o.animations.push(this.readAnimation(s,s.readString(),o));return o},e.prototype.readSkin=function(e,i,r,n){var o=null,s=0;if(r){if(0==(s=e.readInt(!0)))return null;o=new t.Skin("default")}else{(o=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var a=0,l=o.bones.length;a<l;a++)o.bones[a]=i.bones[e.readInt(!0)];for(a=0,l=e.readInt(!0);a<l;a++)o.constraints.push(i.ikConstraints[e.readInt(!0)]);for(a=0,l=e.readInt(!0);a<l;a++)o.constraints.push(i.transformConstraints[e.readInt(!0)]);for(a=0,l=e.readInt(!0);a<l;a++)o.constraints.push(i.pathConstraints[e.readInt(!0)]);s=e.readInt(!0)}for(a=0;a<s;a++)for(var h=e.readInt(!0),u=0,c=e.readInt(!0);u<c;u++){var d=e.readStringRef(),p=this.readAttachment(e,i,o,h,d,n);null!=p&&o.setAttachment(h,d,p)}return o},e.prototype.readAttachment=function(i,n,o,s,a,l){var h=this.scale,u=i.readStringRef();null==u&&(u=a);var c=i.readByte();switch(e.AttachmentTypeValues[c]){case t.AttachmentType.Region:var d=i.readStringRef(),p=i.readFloat(),f=i.readFloat(),_=i.readFloat(),g=i.readFloat(),m=i.readFloat(),y=i.readFloat(),v=i.readFloat(),b=i.readInt32();null==d&&(d=u);var S=this.attachmentLoader.newRegionAttachment(o,u,d);return null==S?null:(S.path=d,S.x=f*h,S.y=_*h,S.scaleX=g,S.scaleY=m,S.rotation=p,S.width=y*h,S.height=v*h,t.Color.rgba8888ToColor(S.color,b),S.updateOffset(),S);case t.AttachmentType.BoundingBox:var T=i.readInt(!0),E=this.readVertices(i,T),A=(b=l?i.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(o,u));return null==A?null:(A.worldVerticesLength=T<<1,A.vertices=E.vertices,A.bones=E.bones,l&&t.Color.rgba8888ToColor(A.color,b),A);case t.AttachmentType.Mesh:d=i.readStringRef(),b=i.readInt32(),T=i.readInt(!0);var C=this.readFloatArray(i,T<<1,1),w=this.readShortArray(i),x=(E=this.readVertices(i,T),i.readInt(!0)),R=null;return y=0,v=0,l&&(R=this.readShortArray(i),y=i.readFloat(),v=i.readFloat()),null==d&&(d=u),null==(M=this.attachmentLoader.newMeshAttachment(o,u,d))?null:(M.path=d,t.Color.rgba8888ToColor(M.color,b),M.bones=E.bones,M.vertices=E.vertices,M.worldVerticesLength=T<<1,M.triangles=w,M.regionUVs=C,M.updateUVs(),M.hullLength=x<<1,l&&(M.edges=R,M.width=y*h,M.height=v*h),M);case t.AttachmentType.LinkedMesh:d=i.readStringRef(),b=i.readInt32();var M,O=i.readStringRef(),P=i.readStringRef(),D=i.readBoolean();return y=0,v=0,l&&(y=i.readFloat(),v=i.readFloat()),null==d&&(d=u),null==(M=this.attachmentLoader.newMeshAttachment(o,u,d))?null:(M.path=d,t.Color.rgba8888ToColor(M.color,b),l&&(M.width=y*h,M.height=v*h),this.linkedMeshes.push(new r(M,O,s,P,D)),M);case t.AttachmentType.Path:for(var I=i.readBoolean(),B=i.readBoolean(),L=(T=i.readInt(!0),E=this.readVertices(i,T),t.Utils.newArray(T/3,0)),F=0,k=L.length;F<k;F++)L[F]=i.readFloat()*h;return b=l?i.readInt32():0,null==(d=this.attachmentLoader.newPathAttachment(o,u))?null:(d.closed=I,d.constantSpeed=B,d.worldVerticesLength=T<<1,d.vertices=E.vertices,d.bones=E.bones,d.lengths=L,l&&t.Color.rgba8888ToColor(d.color,b),d);case t.AttachmentType.Point:p=i.readFloat(),f=i.readFloat(),_=i.readFloat(),b=l?i.readInt32():0;var N=this.attachmentLoader.newPointAttachment(o,u);return null==N?null:(N.x=f*h,N.y=_*h,N.rotation=p,l&&t.Color.rgba8888ToColor(N.color,b),N);case t.AttachmentType.Clipping:var z=i.readInt(!0),U=(T=i.readInt(!0),E=this.readVertices(i,T),b=l?i.readInt32():0,this.attachmentLoader.newClippingAttachment(o,u));return null==U?null:(U.endSlot=n.slots[z],U.worldVerticesLength=T<<1,U.vertices=E.vertices,U.bones=E.bones,l&&t.Color.rgba8888ToColor(U.color,b),U)}return null},e.prototype.readVertices=function(e,i){var r=i<<1,o=new n,s=this.scale;if(!e.readBoolean())return o.vertices=this.readFloatArray(e,r,s),o;for(var a=new Array,l=new Array,h=0;h<i;h++){var u=e.readInt(!0);l.push(u);for(var c=0;c<u;c++)l.push(e.readInt(!0)),a.push(e.readFloat()*s),a.push(e.readFloat()*s),a.push(e.readFloat())}return o.vertices=t.Utils.toFloatArray(a),o.bones=l,o},e.prototype.readFloatArray=function(t,e,i){var r=new Array(e);if(1==i)for(var n=0;n<e;n++)r[n]=t.readFloat();else for(n=0;n<e;n++)r[n]=t.readFloat()*i;return r},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),i=new Array(e),r=0;r<e;r++)i[r]=t.readShort();return i},e.prototype.readAnimation=function(i,r,n){for(var o=new Array,s=this.scale,a=0,l=new t.Color,h=new t.Color,u=0,c=i.readInt(!0);u<c;u++)for(var d=i.readInt(!0),p=0,f=i.readInt(!0);p<f;p++){var _=i.readByte(),g=i.readInt(!0);switch(_){case e.SLOT_ATTACHMENT:(b=new t.AttachmentTimeline(g)).slotIndex=d;for(var m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readStringRef());o.push(b),a=Math.max(a,b.frames[g-1]);break;case e.SLOT_COLOR:for((b=new t.ColorTimeline(g)).slotIndex=d,m=0;m<g;m++){var y=i.readFloat();t.Color.rgba8888ToColor(l,i.readInt32()),b.setFrame(m,y,l.r,l.g,l.b,l.a),m<g-1&&this.readCurve(i,m,b)}o.push(b),a=Math.max(a,b.frames[(g-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((b=new t.TwoColorTimeline(g)).slotIndex=d,m=0;m<g;m++)y=i.readFloat(),t.Color.rgba8888ToColor(l,i.readInt32()),t.Color.rgb888ToColor(h,i.readInt32()),b.setFrame(m,y,l.r,l.g,l.b,l.a,h.r,h.g,h.b),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.TwoColorTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var v=i.readInt(!0);for(p=0,f=i.readInt(!0);p<f;p++)switch(_=i.readByte(),g=i.readInt(!0),_){case e.BONE_ROTATE:for((b=new t.RotateTimeline(g)).boneIndex=v,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var b=void 0,S=1;for(_==e.BONE_SCALE?b=new t.ScaleTimeline(g):_==e.BONE_SHEAR?b=new t.ShearTimeline(g):(b=new t.TranslateTimeline(g),S=s),b.boneIndex=v,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()*S,i.readFloat()*S),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.TranslateTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var T=i.readInt(!0);for(g=i.readInt(!0),(b=new t.IkConstraintTimeline(g)).ikConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat()*s,i.readByte(),i.readBoolean(),i.readBoolean()),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.IkConstraintTimeline.ENTRIES])}for(u=0,c=i.readInt(!0);u<c;u++){for(T=i.readInt(!0),g=i.readInt(!0),(b=new t.TransformConstraintTimeline(g)).transformConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.TransformConstraintTimeline.ENTRIES])}for(u=0,c=i.readInt(!0);u<c;u++){T=i.readInt(!0);var E=n.pathConstraints[T];for(p=0,f=i.readInt(!0);p<f;p++)switch(_=i.readByte(),g=i.readInt(!0),_){case e.PATH_POSITION:case e.PATH_SPACING:for(b=void 0,S=1,_==e.PATH_SPACING?(b=new t.PathConstraintSpacingTimeline(g),E.spacingMode!=t.SpacingMode.Length&&E.spacingMode!=t.SpacingMode.Fixed||(S=s)):(b=new t.PathConstraintPositionTimeline(g),E.positionMode==t.PositionMode.Fixed&&(S=s)),b.pathConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat()*S),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((b=new t.PathConstraintMixTimeline(g)).pathConstraintIndex=T,m=0;m<g;m++)b.setFrame(m,i.readFloat(),i.readFloat(),i.readFloat()),m<g-1&&this.readCurve(i,m,b);o.push(b),a=Math.max(a,b.frames[(g-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(u=0,c=i.readInt(!0);u<c;u++){var A=n.skins[i.readInt(!0)];for(p=0,f=i.readInt(!0);p<f;p++){d=i.readInt(!0);for(var C=0,w=i.readInt(!0);C<w;C++){var x=A.getAttachment(d,i.readStringRef()),R=null!=x.bones,M=x.vertices,O=R?M.length/3*2:M.length;for(g=i.readInt(!0),(b=new t.DeformTimeline(g)).slotIndex=d,b.attachment=x,m=0;m<g;m++){y=i.readFloat();var P=void 0,D=i.readInt(!0);if(0==D)P=R?t.Utils.newFloatArray(O):M;else{P=t.Utils.newFloatArray(O);var I=i.readInt(!0);if(D+=I,1==s)for(var B=I;B<D;B++)P[B]=i.readFloat();else for(B=I;B<D;B++)P[B]=i.readFloat()*s;if(!R){B=0;for(var L=P.length;B<L;B++)P[B]+=M[B]}}b.setFrame(m,y,P),m<g-1&&this.readCurve(i,m,b)}o.push(b),a=Math.max(a,b.frames[g-1])}}}var F=i.readInt(!0);if(F>0){b=new t.DrawOrderTimeline(F);var k=n.slots.length;for(u=0;u<F;u++){y=i.readFloat();var N=i.readInt(!0),z=t.Utils.newArray(k,0);for(p=k-1;p>=0;p--)z[p]=-1;var U=t.Utils.newArray(k-N,0),V=0,H=0;for(p=0;p<N;p++){for(d=i.readInt(!0);V!=d;)U[H++]=V++;z[V+i.readInt(!0)]=V++}for(;V<k;)U[H++]=V++;for(p=k-1;p>=0;p--)-1==z[p]&&(z[p]=U[--H]);b.setFrame(u,y,z)}o.push(b),a=Math.max(a,b.frames[F-1])}var G=i.readInt(!0);if(G>0){for(b=new t.EventTimeline(G),u=0;u<G;u++){y=i.readFloat();var W=n.events[i.readInt(!0)],X=new t.Event(y,W);X.intValue=i.readInt(!1),X.floatValue=i.readFloat(),X.stringValue=i.readBoolean()?i.readString():W.stringValue,null!=X.data.audioPath&&(X.volume=i.readFloat(),X.balance=i.readFloat()),b.setFrame(u,X)}o.push(b),a=Math.max(a,b.frames[G-1])}return new t.Animation(r,o,a)},e.prototype.readCurve=function(t,i,r){switch(t.readByte()){case e.CURVE_STEPPED:r.setStepped(i);break;case e.CURVE_BEZIER:this.setCurve(r,i,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,i,r,n,o){t.setCurve(e,i,r,n,o)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var i=function(){function t(t,e,i,r){void 0===e&&(e=new Array),void 0===i&&(i=0),void 0===r&&(r=new DataView(t.buffer)),this.strings=e,this.index=i,this.buffer=r}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),i=127&e;return 0!=(128&e)&&(i|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(i|=(127&(e=this.readByte()))<<28)))),t?i:i>>>1^-(1&i)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",i=0;i<t;){var r=this.readByte();switch(r>>4){case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&this.readByte()),i+=2;break;case 14:e+=String.fromCharCode((15&r)<<12|(63&this.readByte())<<6|63&this.readByte()),i+=3;break;default:e+=String.fromCharCode(r),i++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),r=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n},n=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(W2||(W2={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,i){if(null==e)throw new Error("skeleton cannot be null.");var r=this.boundingBoxes,n=this.polygons,o=this.polygonPool,s=e.slots,a=s.length;r.length=0,o.freeAll(n),n.length=0;for(var l=0;l<a;l++){var h=s[l];if(h.bone.active){var u=h.getAttachment();if(u instanceof t.BoundingBoxAttachment){var c=u;r.push(c);var d=o.obtain();d.length!=c.worldVerticesLength&&(d=t.Utils.newFloatArray(c.worldVerticesLength)),n.push(d),c.computeWorldVertices(h,0,c.worldVerticesLength,d,0,2)}}}i?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,n=this.polygons,o=0,s=n.length;o<s;o++)for(var a=n[o],l=a,h=0,u=a.length;h<u;h+=2){var c=l[h],d=l[h+1];t=Math.min(t,c),e=Math.min(e,d),i=Math.max(i,c),r=Math.max(r,d)}this.minX=t,this.minY=e,this.maxX=i,this.maxY=r},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,i,r){var n=this.minX,o=this.minY,s=this.maxX,a=this.maxY;if(t<=n&&i<=n||e<=o&&r<=o||t>=s&&i>=s||e>=a&&r>=a)return!1;var l=(r-e)/(i-t),h=l*(n-t)+e;if(h>o&&h<a)return!0;if((h=l*(s-t)+e)>o&&h<a)return!0;var u=(o-e)/l+t;return u>n&&u<s||(u=(a-e)/l+t)>n&&u<s},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var i=this.polygons,r=0,n=i.length;r<n;r++)if(this.containsPointPolygon(i[r],t,e))return this.boundingBoxes[r];return null},e.prototype.containsPointPolygon=function(t,e,i){for(var r=t,n=t.length,o=n-2,s=!1,a=0;a<n;a+=2){var l=r[a+1],h=r[o+1];if(l<i&&h>=i||h<i&&l>=i){var u=r[a];u+(i-l)/(h-l)*(r[o]-u)<e&&(s=!s)}o=a}return s},e.prototype.intersectsSegment=function(t,e,i,r){for(var n=this.polygons,o=0,s=n.length;o<s;o++)if(this.intersectsSegmentPolygon(n[o],t,e,i,r))return this.boundingBoxes[o];return null},e.prototype.intersectsSegmentPolygon=function(t,e,i,r,n){for(var o=t,s=t.length,a=e-r,l=i-n,h=e*n-i*r,u=o[s-2],c=o[s-1],d=0;d<s;d+=2){var p=o[d],f=o[d+1],_=u*f-c*p,g=u-p,m=c-f,y=a*m-l*g,v=(h*g-a*_)/y;if((v>=u&&v<=p||v>=p&&v<=u)&&(v>=e&&v<=r||v>=r&&v<=e)){var b=(h*m-l*_)/y;if((b>=c&&b<=f||b>=f&&b<=c)&&(b>=i&&b<=n||b>=n&&b<=i))return!0}u=p,c=f}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(W2||(W2={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(i,r){if(null!=this.clipAttachment)return 0;this.clipAttachment=r;var n=r.worldVerticesLength,o=t.Utils.setArraySize(this.clippingPolygon,n);r.computeWorldVertices(i,0,n,o,0,2);var s=this.clippingPolygon;e.makeClockwise(s);for(var a=this.clippingPolygons=this.triangulator.decompose(s,this.triangulator.triangulate(s)),l=0,h=a.length;l<h;l++){var u=a[l];e.makeClockwise(u),u.push(u[0]),u.push(u[1])}return a.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,i,r,n,o,s,a,l,h,u,c){void 0===h&&(h=2),void 0===u&&(u=0),void 0===c&&(c=0);var d=this.clipOutput,p=this.clippedVertices,f=this.clippedTriangles,_=this.clippingPolygons,g=this.clippingPolygons.length,m=l?12:8,y=0;p.length=0,f.length=0;t:for(var v=0;v<n;v+=3)for(var b=r[v]*h,S=e[b+u],T=e[b+u+1],E=o[b+c],A=o[b+c+1],C=e[(b=r[v+1]*h)+u],w=e[b+u+1],x=o[b+c],R=o[b+c+1],M=e[(b=r[v+2]*h)+u],O=e[b+u+1],P=o[b+c],D=o[b+c+1],I=0;I<g;I++){var B=p.length;if(!this.clip(S,T,C,w,M,O,_[I],d)){(G=t.Utils.setArraySize(p,B+3*m))[B]=S,G[B+1]=T,G[B+2]=s.r,G[B+3]=s.g,G[B+4]=s.b,G[B+5]=s.a,l?(G[B+6]=E,G[B+7]=A,G[B+8]=a.r,G[B+9]=a.g,G[B+10]=a.b,G[B+11]=a.a,G[B+12]=C,G[B+13]=w,G[B+14]=s.r,G[B+15]=s.g,G[B+16]=s.b,G[B+17]=s.a,G[B+18]=x,G[B+19]=R,G[B+20]=a.r,G[B+21]=a.g,G[B+22]=a.b,G[B+23]=a.a,G[B+24]=M,G[B+25]=O,G[B+26]=s.r,G[B+27]=s.g,G[B+28]=s.b,G[B+29]=s.a,G[B+30]=P,G[B+31]=D,G[B+32]=a.r,G[B+33]=a.g,G[B+34]=a.b,G[B+35]=a.a):(G[B+6]=E,G[B+7]=A,G[B+8]=C,G[B+9]=w,G[B+10]=s.r,G[B+11]=s.g,G[B+12]=s.b,G[B+13]=s.a,G[B+14]=x,G[B+15]=R,G[B+16]=M,G[B+17]=O,G[B+18]=s.r,G[B+19]=s.g,G[B+20]=s.b,G[B+21]=s.a,G[B+22]=P,G[B+23]=D),B=f.length,(Q=t.Utils.setArraySize(f,B+3))[B]=y,Q[B+1]=y+1,Q[B+2]=y+2,y+=3;continue t}var L=d.length;if(0!=L){for(var F=w-O,k=M-C,N=S-M,z=O-T,U=1/(F*N+k*(T-O)),V=L>>1,H=this.clipOutput,G=t.Utils.setArraySize(p,B+V*m),W=0;W<L;W+=2){var X=H[W],Y=H[W+1];G[B]=X,G[B+1]=Y,G[B+2]=s.r,G[B+3]=s.g,G[B+4]=s.b,G[B+5]=s.a;var j=X-M,q=Y-O,K=(F*j+k*q)*U,Z=(z*j+N*q)*U,J=1-K-Z;G[B+6]=E*K+x*Z+P*J,G[B+7]=A*K+R*Z+D*J,l&&(G[B+8]=a.r,G[B+9]=a.g,G[B+10]=a.b,G[B+11]=a.a),B+=m}B=f.length;var Q=t.Utils.setArraySize(f,B+3*(V-2));for(V--,W=1;W<V;W++)Q[B]=y,Q[B+1]=y+W,Q[B+2]=y+W+1,B+=3;y+=V+1}}},e.prototype.clip=function(t,e,i,r,n,o,s,a){var l=a,h=!1,u=null;s.length%4>=2?(u=a,a=this.scratch):u=this.scratch,u.length=0,u.push(t),u.push(e),u.push(i),u.push(r),u.push(n),u.push(o),u.push(t),u.push(e),a.length=0;for(var c=s,d=s.length-4,p=0;;p+=2){for(var f=c[p],_=c[p+1],g=c[p+2],m=c[p+3],y=f-g,v=_-m,b=u,S=u.length-2,T=a.length,E=0;E<S;E+=2){var A=b[E],C=b[E+1],w=b[E+2],x=b[E+3],R=y*(x-m)-v*(w-g)>0;if(y*(C-m)-v*(A-g)>0){if(R){a.push(w),a.push(x);continue}var M=(P=x-C)*(g-f)-(D=w-A)*(m-_);if(Math.abs(M)>1e-6){var O=(D*(_-C)-P*(f-A))/M;a.push(f+(g-f)*O),a.push(_+(m-_)*O)}else a.push(f),a.push(_)}else if(R){var P,D;M=(P=x-C)*(g-f)-(D=w-A)*(m-_),Math.abs(M)>1e-6?(O=(D*(_-C)-P*(f-A))/M,a.push(f+(g-f)*O),a.push(_+(m-_)*O)):(a.push(f),a.push(_)),a.push(w),a.push(x)}h=!0}if(T==a.length)return l.length=0,!0;if(a.push(a[0]),a.push(a[1]),p==d)break;var I=a;(a=u).length=0,u=I}if(l!=a){l.length=0,p=0;for(var B=a.length-2;p<B;p++)l[p]=a[p]}else l.length=l.length-2;return h},e.makeClockwise=function(t){for(var e=t,i=t.length,r=e[i-2]*e[1]-e[0]*e[i-1],n=0,o=0,s=0,a=0,l=i-3;a<l;a+=2)n=e[a],o=e[a+1],s=e[a+2],r+=n*e[a+3]-s*o;if(!(r<0)){a=0;var h=i-2;for(l=i>>1;a<l;a+=2){var u=e[a],c=e[a+1],d=h-a;e[a]=e[d],e[a+1]=e[d+1],e[d]=u,e[d+1]=c}}},e}();t.SkeletonClipping=e}(W2||(W2={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++){var n=e[i];if(n.name==t)return n}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,i=0,r=e.length;i<r;i++)if(e[i].name==t)return i;return-1},t}();t.SkeletonData=e}(W2||(W2={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,n=new t.SkeletonData,o="string"==typeof i?JSON.parse(i):i,s=o.skeleton;if(null!=s&&(n.hash=s.hash,n.version=s.spine,n.x=s.x,n.y=s.y,n.width=s.width,n.height=s.height,n.fps=s.fps,n.imagesPath=s.images),o.bones)for(var a=0;a<o.bones.length;a++){var l=o.bones[a],h=null,u=this.getValue(l,"parent",null);if(null!=u&&null==(h=n.findBone(u)))throw new Error("Parent bone not found: "+u);(f=new t.BoneData(n.bones.length,l.name,h)).length=this.getValue(l,"length",0)*r,f.x=this.getValue(l,"x",0)*r,f.y=this.getValue(l,"y",0)*r,f.rotation=this.getValue(l,"rotation",0),f.scaleX=this.getValue(l,"scaleX",1),f.scaleY=this.getValue(l,"scaleY",1),f.shearX=this.getValue(l,"shearX",0),f.shearY=this.getValue(l,"shearY",0),f.transformMode=e.transformModeFromString(this.getValue(l,"transform","normal")),f.skinRequired=this.getValue(l,"skin",!1),n.bones.push(f)}if(o.slots)for(a=0;a<o.slots.length;a++){var c=(M=o.slots[a]).name,d=M.bone,p=n.findBone(d);if(null==p)throw new Error("Slot bone not found: "+d);var f=new t.SlotData(n.slots.length,c,p),_=this.getValue(M,"color",null);null!=_&&f.color.setFromString(_);var g=this.getValue(M,"dark",null);null!=g&&(f.darkColor=new t.Color(1,1,1,1),f.darkColor.setFromString(g)),f.attachmentName=this.getValue(M,"attachment",null),f.blendMode=e.blendModeFromString(this.getValue(M,"blend","normal")),n.slots.push(f)}if(o.ik)for(a=0;a<o.ik.length;a++){var m=o.ik[a];(f=new t.IkConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1);for(var y=0;y<m.bones.length;y++){if(d=m.bones[y],null==(w=n.findBone(d)))throw new Error("IK bone not found: "+d);f.bones.push(w)}var v=m.target;if(f.target=n.findBone(v),null==f.target)throw new Error("IK target bone not found: "+v);f.mix=this.getValue(m,"mix",1),f.softness=this.getValue(m,"softness",0)*r,f.bendDirection=this.getValue(m,"bendPositive",!0)?1:-1,f.compress=this.getValue(m,"compress",!1),f.stretch=this.getValue(m,"stretch",!1),f.uniform=this.getValue(m,"uniform",!1),n.ikConstraints.push(f)}if(o.transform)for(a=0;a<o.transform.length;a++){for(m=o.transform[a],(f=new t.TransformConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1),y=0;y<m.bones.length;y++){if(d=m.bones[y],null==(w=n.findBone(d)))throw new Error("Transform constraint bone not found: "+d);f.bones.push(w)}if(v=m.target,f.target=n.findBone(v),null==f.target)throw new Error("Transform constraint target bone not found: "+v);f.local=this.getValue(m,"local",!1),f.relative=this.getValue(m,"relative",!1),f.offsetRotation=this.getValue(m,"rotation",0),f.offsetX=this.getValue(m,"x",0)*r,f.offsetY=this.getValue(m,"y",0)*r,f.offsetScaleX=this.getValue(m,"scaleX",0),f.offsetScaleY=this.getValue(m,"scaleY",0),f.offsetShearY=this.getValue(m,"shearY",0),f.rotateMix=this.getValue(m,"rotateMix",1),f.translateMix=this.getValue(m,"translateMix",1),f.scaleMix=this.getValue(m,"scaleMix",1),f.shearMix=this.getValue(m,"shearMix",1),n.transformConstraints.push(f)}if(o.path)for(a=0;a<o.path.length;a++){for(m=o.path[a],(f=new t.PathConstraintData(m.name)).order=this.getValue(m,"order",0),f.skinRequired=this.getValue(m,"skin",!1),y=0;y<m.bones.length;y++){if(d=m.bones[y],null==(w=n.findBone(d)))throw new Error("Transform constraint bone not found: "+d);f.bones.push(w)}if(v=m.target,f.target=n.findSlot(v),null==f.target)throw new Error("Path target slot not found: "+v);f.positionMode=e.positionModeFromString(this.getValue(m,"positionMode","percent")),f.spacingMode=e.spacingModeFromString(this.getValue(m,"spacingMode","length")),f.rotateMode=e.rotateModeFromString(this.getValue(m,"rotateMode","tangent")),f.offsetRotation=this.getValue(m,"rotation",0),f.position=this.getValue(m,"position",0),f.positionMode==t.PositionMode.Fixed&&(f.position*=r),f.spacing=this.getValue(m,"spacing",0),f.spacingMode!=t.SpacingMode.Length&&f.spacingMode!=t.SpacingMode.Fixed||(f.spacing*=r),f.rotateMix=this.getValue(m,"rotateMix",1),f.translateMix=this.getValue(m,"translateMix",1),n.pathConstraints.push(f)}if(o.skins){var b=o.skins;if(!(b instanceof Array)){var S=[];for(var T in b)S.push({name:T,attachments:b[T]});b=S}for(a=0;a<b.length;a++){var E=b[a],A=new t.Skin(E.name);if(E.bones)for(var C=0;C<E.bones.length;C++){var w;if(null==(w=n.findBone(E.bones[C])))throw new Error("Skin bone not found: "+E.bones[a]);A.bones.push(w)}if(E.ik)for(C=0;C<E.ik.length;C++){if(null==(x=n.findIkConstraint(E.ik[C])))throw new Error("Skin IK constraint not found: "+E.ik[a]);A.constraints.push(x)}if(E.transform)for(C=0;C<E.transform.length;C++){if(null==(x=n.findTransformConstraint(E.transform[C])))throw new Error("Skin transform constraint not found: "+E.transform[a]);A.constraints.push(x)}if(E.path)for(C=0;C<E.path.length;C++){var x;if(null==(x=n.findPathConstraint(E.path[C])))throw new Error("Skin path constraint not found: "+E.path[a]);A.constraints.push(x)}for(var c in E.attachments){var R=n.findSlot(c);if(null==R)throw new Error("Slot not found: "+c);var M=E.attachments[c];for(var O in M){var P=this.readAttachment(M[O],A,R.index,O,n);null!=P&&A.setAttachment(R.index,O,P)}}n.skins.push(A),"default"==A.name&&(n.defaultSkin=A)}}a=0;for(var D=this.linkedMeshes.length;a<D;a++){var I=this.linkedMeshes[a];if(null==(A=null==I.skin?n.defaultSkin:n.findSkin(I.skin)))throw new Error("Skin not found: "+I.skin);var B=A.getAttachment(I.slotIndex,I.parent);if(null==B)throw new Error("Parent mesh not found: "+I.parent);I.mesh.deformAttachment=I.inheritDeform?B:I.mesh,I.mesh.setParentMesh(B),I.mesh.updateUVs()}if(this.linkedMeshes.length=0,o.events)for(var L in o.events){var F=o.events[L];(f=new t.EventData(L)).intValue=this.getValue(F,"int",0),f.floatValue=this.getValue(F,"float",0),f.stringValue=this.getValue(F,"string",""),f.audioPath=this.getValue(F,"audio",null),null!=f.audioPath&&(f.volume=this.getValue(F,"volume",1),f.balance=this.getValue(F,"balance",0)),n.events.push(f)}if(o.animations)for(var k in o.animations){var N=o.animations[k];this.readAnimation(N,k,n)}return n},e.prototype.readAttachment=function(e,r,n,o,s){var a=this.scale;switch(o=this.getValue(e,"name",o),this.getValue(e,"type","region")){case"region":var l=this.getValue(e,"path",o),h=this.attachmentLoader.newRegionAttachment(r,o,l);return null==h?null:(h.path=l,h.x=this.getValue(e,"x",0)*a,h.y=this.getValue(e,"y",0)*a,h.scaleX=this.getValue(e,"scaleX",1),h.scaleY=this.getValue(e,"scaleY",1),h.rotation=this.getValue(e,"rotation",0),h.width=e.width*a,h.height=e.height*a,null!=(v=this.getValue(e,"color",null))&&h.color.setFromString(v),h.updateOffset(),h);case"boundingbox":var u=this.attachmentLoader.newBoundingBoxAttachment(r,o);return null==u?null:(this.readVertices(e,u,e.vertexCount<<1),null!=(v=this.getValue(e,"color",null))&&u.color.setFromString(v),u);case"mesh":case"linkedmesh":l=this.getValue(e,"path",o);var c=this.attachmentLoader.newMeshAttachment(r,o,l);if(null==c)return null;c.path=l,null!=(v=this.getValue(e,"color",null))&&c.color.setFromString(v),c.width=this.getValue(e,"width",0)*a,c.height=this.getValue(e,"height",0)*a;var d=this.getValue(e,"parent",null);if(null!=d)return this.linkedMeshes.push(new i(c,this.getValue(e,"skin",null),n,d,this.getValue(e,"deform",!0))),c;var p=e.uvs;return this.readVertices(e,c,p.length),c.triangles=e.triangles,c.regionUVs=p,c.updateUVs(),c.edges=this.getValue(e,"edges",null),c.hullLength=2*this.getValue(e,"hull",0),c;case"path":if(null==(l=this.attachmentLoader.newPathAttachment(r,o)))return null;l.closed=this.getValue(e,"closed",!1),l.constantSpeed=this.getValue(e,"constantSpeed",!0);var f=e.vertexCount;this.readVertices(e,l,f<<1);for(var _=t.Utils.newArray(f/3,0),g=0;g<e.lengths.length;g++)_[g]=e.lengths[g]*a;return l.lengths=_,null!=(v=this.getValue(e,"color",null))&&l.color.setFromString(v),l;case"point":var m=this.attachmentLoader.newPointAttachment(r,o);return null==m?null:(m.x=this.getValue(e,"x",0)*a,m.y=this.getValue(e,"y",0)*a,m.rotation=this.getValue(e,"rotation",0),null!=(v=this.getValue(e,"color",null))&&m.color.setFromString(v),m);case"clipping":var y=this.attachmentLoader.newClippingAttachment(r,o);if(null==y)return null;var v,b=this.getValue(e,"end",null);if(null!=b){var S=s.findSlot(b);if(null==S)throw new Error("Clipping end slot not found: "+b);y.endSlot=S}return f=e.vertexCount,this.readVertices(e,y,f<<1),null!=(v=this.getValue(e,"color",null))&&y.color.setFromString(v),y}return null},e.prototype.readVertices=function(e,i,r){var n=this.scale;i.worldVerticesLength=r;var o=e.vertices;if(r!=o.length){var s=new Array,a=new Array;for(c=0,d=o.length;c<d;){var l=o[c++];a.push(l);for(var h=c+4*l;c<h;c+=4)a.push(o[c]),s.push(o[c+1]*n),s.push(o[c+2]*n),s.push(o[c+3])}i.bones=a,i.vertices=t.Utils.toFloatArray(s)}else{var u=t.Utils.toFloatArray(o);if(1!=n)for(var c=0,d=o.length;c<d;c++)u[c]*=n;i.vertices=u}},e.prototype.readAnimation=function(e,i,r){var n=this.scale,o=new Array,s=0;if(e.slots)for(var a in e.slots){var l=e.slots[a];if(-1==(J=r.findSlotIndex(a)))throw new Error("Slot not found: "+a);for(var h in l){var u=l[h];if("attachment"==h){(b=new t.AttachmentTimeline(u.length)).slotIndex=J;for(var c=0,d=0;d<u.length;d++){var p=u[d];b.setFrame(c++,this.getValue(p,"time",0),p.name)}o.push(b),s=Math.max(s,b.frames[b.getFrameCount()-1])}else if("color"==h){for((b=new t.ColorTimeline(u.length)).slotIndex=J,c=0,d=0;d<u.length;d++){p=u[d];var f=new t.Color;f.setFromString(p.color),b.setFrame(c,this.getValue(p,"time",0),f.r,f.g,f.b,f.a),this.readCurve(p,b,c),c++}o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=h)throw new Error("Invalid timeline type for a slot: "+h+" ("+a+")");for((b=new t.TwoColorTimeline(u.length)).slotIndex=J,c=0,d=0;d<u.length;d++){p=u[d];var _=new t.Color,g=new t.Color;_.setFromString(p.light),g.setFromString(p.dark),b.setFrame(c,this.getValue(p,"time",0),_.r,_.g,_.b,_.a,g.r,g.g,g.b),this.readCurve(p,b,c),c++}o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var m in e.bones){var y=e.bones[m],v=r.findBoneIndex(m);if(-1==v)throw new Error("Bone not found: "+m);for(var h in y)if(u=y[h],"rotate"===h){for((b=new t.RotateTimeline(u.length)).boneIndex=v,c=0,d=0;d<u.length;d++)p=u[d],b.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"angle",0)),this.readCurve(p,b,c),c++;o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==h&&"scale"!==h&&"shear"!==h)throw new Error("Invalid timeline type for a bone: "+h+" ("+m+")");var b=null,S=1,T=0;for("scale"===h?(b=new t.ScaleTimeline(u.length),T=1):"shear"===h?b=new t.ShearTimeline(u.length):(b=new t.TranslateTimeline(u.length),S=n),b.boneIndex=v,c=0,d=0;d<u.length;d++){p=u[d];var E=this.getValue(p,"x",T),A=this.getValue(p,"y",T);b.setFrame(c,this.getValue(p,"time",0),E*S,A*S),this.readCurve(p,b,c),c++}o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var C in e.ik){var w=e.ik[C],x=r.findIkConstraint(C);for((b=new t.IkConstraintTimeline(w.length)).ikConstraintIndex=r.ikConstraints.indexOf(x),c=0,d=0;d<w.length;d++)p=w[d],b.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"mix",1),this.getValue(p,"softness",0)*n,this.getValue(p,"bendPositive",!0)?1:-1,this.getValue(p,"compress",!1),this.getValue(p,"stretch",!1)),this.readCurve(p,b,c),c++;o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var C in e.transform){for(w=e.transform[C],x=r.findTransformConstraint(C),(b=new t.TransformConstraintTimeline(w.length)).transformConstraintIndex=r.transformConstraints.indexOf(x),c=0,d=0;d<w.length;d++)p=w[d],b.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1),this.getValue(p,"scaleMix",1),this.getValue(p,"shearMix",1)),this.readCurve(p,b,c),c++;o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var R=e.path||e.paths;if(R)for(var C in R){w=R[C];var M=r.findPathConstraintIndex(C);if(-1==M)throw new Error("Path constraint not found: "+C);var O=r.pathConstraints[M];for(var h in w)if(u=w[h],"position"===h||"spacing"===h){for(b=null,S=1,"spacing"===h?(b=new t.PathConstraintSpacingTimeline(u.length),O.spacingMode!=t.SpacingMode.Length&&O.spacingMode!=t.SpacingMode.Fixed||(S=n)):(b=new t.PathConstraintPositionTimeline(u.length),O.positionMode==t.PositionMode.Fixed&&(S=n)),b.pathConstraintIndex=M,c=0,d=0;d<u.length;d++)p=u[d],b.setFrame(c,this.getValue(p,"time",0),this.getValue(p,h,0)*S),this.readCurve(p,b,c),c++;o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===h){for((b=new t.PathConstraintMixTimeline(u.length)).pathConstraintIndex=M,c=0,d=0;d<u.length;d++)p=u[d],b.setFrame(c,this.getValue(p,"time",0),this.getValue(p,"rotateMix",1),this.getValue(p,"translateMix",1)),this.readCurve(p,b,c),c++;o.push(b),s=Math.max(s,b.frames[(b.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var P in e.deform){var D=e.deform[P],I=r.findSkin(P);if(null==I)throw new Error("Skin not found: "+P);for(var a in D){if(l=D[a],-1==(J=r.findSlotIndex(a)))throw new Error("Slot not found: "+l.name);for(var h in l){u=l[h];var B=I.getAttachment(J,h);if(null!=B){var L=null!=B.bones,F=B.vertices,k=L?F.length/3*2:F.length;(b=new t.DeformTimeline(u.length)).slotIndex=J,b.attachment=B,c=0;for(var N=0;N<u.length;N++){p=u[N];var z=void 0,U=this.getValue(p,"vertices",null);if(null==U)z=L?t.Utils.newFloatArray(k):F;else{z=t.Utils.newFloatArray(k);var V=this.getValue(p,"offset",0);if(t.Utils.arrayCopy(U,0,z,V,U.length),1!=n)for(var H=(d=V)+U.length;d<H;d++)z[d]*=n;if(!L)for(d=0;d<k;d++)z[d]+=F[d]}b.setFrame(c,this.getValue(p,"time",0),z),this.readCurve(p,b,c),c++}o.push(b),s=Math.max(s,b.frames[b.getFrameCount()-1])}}}}var G=e.drawOrder;if(null==G&&(G=e.draworder),null!=G){b=new t.DrawOrderTimeline(G.length);var W=r.slots.length;for(c=0,N=0;N<G.length;N++){var X=G[N],Y=null,j=this.getValue(X,"offsets",null);if(null!=j){Y=t.Utils.newArray(W,-1);var q=t.Utils.newArray(W-j.length,0),K=0,Z=0;for(d=0;d<j.length;d++){var J,Q=j[d];if(-1==(J=r.findSlotIndex(Q.slot)))throw new Error("Slot not found: "+Q.slot);for(;K!=J;)q[Z++]=K++;Y[K+Q.offset]=K++}for(;K<W;)q[Z++]=K++;for(d=W-1;d>=0;d--)-1==Y[d]&&(Y[d]=q[--Z])}b.setFrame(c++,this.getValue(X,"time",0),Y)}o.push(b),s=Math.max(s,b.frames[b.getFrameCount()-1])}if(e.events){for(b=new t.EventTimeline(e.events.length),c=0,d=0;d<e.events.length;d++){var $=e.events[d],tt=r.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),b.setFrame(c++,et)}o.push(b),s=Math.max(s,b.frames[b.getFrameCount()-1])}if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");r.animations.push(new t.Animation(i,o,s))},e.prototype.readCurve=function(t,e,i){var r=t.curve;r&&("stepped"==r?e.setStepped(i):"[object Array]"===Object.prototype.toString.call(r)?e.setCurve(i,r[0],r[1],r[2],r[3]):e.setCurve(i,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,i){return void 0!==t[e]?t[e]:i},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var i=function(t,e,i,r,n){this.mesh=t,this.skin=e,this.slotIndex=i,this.parent=r,this.inheritDeform=n}}(W2||(W2={})),function(t){var e=function(t,e,i){this.slotIndex=t,this.name=e,this.attachment=i};t.SkinEntry=e;var i=function(){function i(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return i.prototype.setAttachment=function(t,e,i){if(null==i)throw new Error("attachment cannot be null.");var r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=i},i.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var i=t.bones[e],r=!1,n=0;n<this.bones.length;n++)if(this.bones[n]==i){r=!0;break}r||this.bones.push(i)}for(e=0;e<t.constraints.length;e++){var o=t.constraints[e];for(r=!1,n=0;n<this.constraints.length;n++)if(this.constraints[n]==o){r=!0;break}r||this.constraints.push(o)}var s=t.getAttachments();for(e=0;e<s.length;e++){var a=s[e];this.setAttachment(a.slotIndex,a.name,a.attachment)}},i.prototype.copySkin=function(e){for(var i=0;i<e.bones.length;i++){for(var r=e.bones[i],n=!1,o=0;o<this.bones.length;o++)if(this.bones[o]==r){n=!0;break}n||this.bones.push(r)}for(i=0;i<e.constraints.length;i++){var s=e.constraints[i];for(n=!1,o=0;o<this.constraints.length;o++)if(this.constraints[o]==s){n=!0;break}n||this.constraints.push(s)}var a=e.getAttachments();for(i=0;i<a.length;i++){var l=a[i];null!=l.attachment&&(l.attachment instanceof t.MeshAttachment?(l.attachment=l.attachment.newLinkedMesh(),this.setAttachment(l.slotIndex,l.name,l.attachment)):(l.attachment=l.attachment.copy(),this.setAttachment(l.slotIndex,l.name,l.attachment)))}},i.prototype.getAttachment=function(t,e){var i=this.attachments[t];return i?i[e]:null},i.prototype.removeAttachment=function(t,e){var i=this.attachments[t];i&&(i[e]=null)},i.prototype.getAttachments=function(){for(var t=new Array,i=0;i<this.attachments.length;i++){var r=this.attachments[i];if(r)for(var n in r){var o=r[n];o&&t.push(new e(i,n,o))}}return t},i.prototype.getAttachmentsForSlot=function(t,i){var r=this.attachments[t];if(r)for(var n in r){var o=r[n];o&&i.push(new e(t,n,o))}},i.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},i.prototype.attachAll=function(t,e){for(var i=0,r=0;r<t.slots.length;r++){var n=t.slots[r],o=n.getAttachment();if(o&&i<e.attachments.length){var s=e.attachments[i];for(var a in s)if(o==s[a]){var l=this.getAttachment(i,a);null!=l&&n.setAttachment(l);break}}i++}},i}();t.Skin=i}(W2||(W2={})),function(t){var e=function(){function e(e,i){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("bone cannot be null.");this.data=e,this.bone=i,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(W2||(W2={})),function(t){t.SlotData=function(e,i,r){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");if(null==r)throw new Error("boneData cannot be null.");this.index=e,this.name=i,this.boneData=r}}(W2||(W2={})),function(t){var e,i,r=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return i.MirroredRepeat;case"clamptoedge":return i.ClampToEdge;case"repeat":return i.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=r,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(i=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return X2(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(r);t.FakeTexture=n}(W2||(W2={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,o){if(null==o)throw new Error("textureLoader cannot be null.");for(var s=new i(e),a=new Array(4),l=null;;){var h=s.readLine();if(null==h)break;if(0==(h=h.trim()).length)l=null;else if(l){var u=new n;u.name=h,u.page=l;var c=s.readValue();"true"==c.toLocaleLowerCase()?u.degrees=90:"false"==c.toLocaleLowerCase()?u.degrees=0:u.degrees=parseFloat(c),u.rotate=90==u.degrees,s.readTuple(a);var d=parseInt(a[0]),p=parseInt(a[1]);s.readTuple(a);var f=parseInt(a[0]),_=parseInt(a[1]);u.u=d/l.width,u.v=p/l.height,u.rotate?(u.u2=(d+_)/l.width,u.v2=(p+f)/l.height):(u.u2=(d+f)/l.width,u.v2=(p+_)/l.height),u.x=d,u.y=p,u.width=Math.abs(f),u.height=Math.abs(_),4==s.readTuple(a)&&4==s.readTuple(a)&&s.readTuple(a),u.originalWidth=parseInt(a[0]),u.originalHeight=parseInt(a[1]),s.readTuple(a),u.offsetX=parseInt(a[0]),u.offsetY=parseInt(a[1]),u.index=parseInt(s.readValue()),u.texture=l.texture,this.regions.push(u)}else{(l=new r).name=h,2==s.readTuple(a)&&(l.width=parseInt(a[0]),l.height=parseInt(a[1]),s.readTuple(a)),s.readTuple(a),l.minFilter=t.Texture.filterFromString(a[0]),l.magFilter=t.Texture.filterFromString(a[1]);var g=s.readValue();l.uWrap=t.TextureWrap.ClampToEdge,l.vWrap=t.TextureWrap.ClampToEdge,"x"==g?l.uWrap=t.TextureWrap.Repeat:"y"==g?l.vWrap=t.TextureWrap.Repeat:"xy"==g&&(l.uWrap=l.vWrap=t.TextureWrap.Repeat),l.texture=o(h),l.texture.setFilters(l.minFilter,l.magFilter),l.texture.setWraps(l.uWrap,l.vWrap),l.width=l.texture.getImage().width,l.height=l.texture.getImage().height,this.pages.push(l)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var i=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw new Error("Invalid line: "+e);for(var r=0,n=i+1;r<3;r++){var o=e.indexOf(",",n);if(-1==o)break;t[r]=e.substr(n,o-n).trim(),n=o+1}return t[r]=e.substring(n).trim(),r+1},t}(),r=function(){};t.TextureAtlasPage=r;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return X2(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=n}(W2||(W2={})),function(t){var e=function(){function e(e,i){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==i)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var r=0;r<e.bones.length;r++)this.bones.push(i.findBone(e.bones[r].name));this.target=i.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,o=this.target,s=o.a,a=o.b,l=o.c,h=o.d,u=s*h-a*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,_=p.length;f<_;f++){var g=p[f],m=!1;if(0!=e){var y=g.a,v=g.b,b=g.c,S=g.d;(x=Math.atan2(l,s)-Math.atan2(b,y)+c)>t.MathUtils.PI?x-=t.MathUtils.PI2:x<-t.MathUtils.PI&&(x+=t.MathUtils.PI2),x*=e;var T=Math.cos(x),E=Math.sin(x);g.a=T*y-E*b,g.b=T*v-E*S,g.c=E*y+T*b,g.d=E*v+T*S,m=!0}if(0!=i){var A=this.temp;o.localToWorld(A.set(this.data.offsetX,this.data.offsetY)),g.worldX+=(A.x-g.worldX)*i,g.worldY+=(A.y-g.worldY)*i,m=!0}if(r>0){var C=Math.sqrt(g.a*g.a+g.c*g.c),w=Math.sqrt(s*s+l*l);C>1e-5&&(C=(C+(w-C+this.data.offsetScaleX)*r)/C),g.a*=C,g.c*=C,C=Math.sqrt(g.b*g.b+g.d*g.d),w=Math.sqrt(a*a+h*h),C>1e-5&&(C=(C+(w-C+this.data.offsetScaleY)*r)/C),g.b*=C,g.d*=C,m=!0}if(n>0){v=g.b,S=g.d;var x,R=Math.atan2(S,v);(x=Math.atan2(h,a)-Math.atan2(l,s)-(R-Math.atan2(g.c,g.a)))>t.MathUtils.PI?x-=t.MathUtils.PI2:x<-t.MathUtils.PI&&(x+=t.MathUtils.PI2),x=R+(x+d)*n,C=Math.sqrt(v*v+S*S),g.b=Math.cos(x)*C,g.d=Math.sin(x)*C,m=!0}m&&(g.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,i=this.translateMix,r=this.scaleMix,n=this.shearMix,o=this.target,s=o.a,a=o.b,l=o.c,h=o.d,u=s*h-a*l>0?t.MathUtils.degRad:-t.MathUtils.degRad,c=this.data.offsetRotation*u,d=this.data.offsetShearY*u,p=this.bones,f=0,_=p.length;f<_;f++){var g,m=p[f],y=!1;if(0!=e){var v=m.a,b=m.b,S=m.c,T=m.d;(g=Math.atan2(l,s)+c)>t.MathUtils.PI?g-=t.MathUtils.PI2:g<-t.MathUtils.PI&&(g+=t.MathUtils.PI2),g*=e;var E=Math.cos(g),A=Math.sin(g);m.a=E*v-A*S,m.b=E*b-A*T,m.c=A*v+E*S,m.d=A*b+E*T,y=!0}if(0!=i){var C=this.temp;o.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),m.worldX+=C.x*i,m.worldY+=C.y*i,y=!0}if(r>0){var w=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleX)*r+1;m.a*=w,m.c*=w,w=(Math.sqrt(a*a+h*h)-1+this.data.offsetScaleY)*r+1,m.b*=w,m.d*=w,y=!0}if(n>0)(g=Math.atan2(h,a)-Math.atan2(l,s))>t.MathUtils.PI?g-=t.MathUtils.PI2:g<-t.MathUtils.PI&&(g+=t.MathUtils.PI2),b=m.b,T=m.d,g=Math.atan2(T,b)+(g-t.MathUtils.PI/2+d)*n,w=Math.sqrt(b*b+T*T),m.b=Math.cos(g)*w,m.d=Math.sin(g)*w,y=!0;y&&(m.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var o=this.bones,s=0,a=o.length;s<a;s++){var l=o[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;if(0!=t){var u=n.arotation-h+this.data.offsetRotation;h+=(u-=360*(16384-(16384.499999999996-u/360|0)))*t}var c=l.ax,d=l.ay;0!=e&&(c+=(n.ax-c+this.data.offsetX)*e,d+=(n.ay-d+this.data.offsetY)*e);var p=l.ascaleX,f=l.ascaleY;0!=i&&(p>1e-5&&(p=(p+(n.ascaleX-p+this.data.offsetScaleX)*i)/p),f>1e-5&&(f=(f+(n.ascaleY-f+this.data.offsetScaleY)*i)/f));var _=l.ashearY;0!=r&&(u=n.ashearY-_+this.data.offsetShearY,u-=360*(16384-(16384.499999999996-u/360|0)),l.shearY+=u*r),l.updateWorldTransformWith(c,d,h,p,f,l.ashearX,_)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,i=this.scaleMix,r=this.shearMix,n=this.target;n.appliedValid||n.updateAppliedTransform();for(var o=this.bones,s=0,a=o.length;s<a;s++){var l=o[s];l.appliedValid||l.updateAppliedTransform();var h=l.arotation;0!=t&&(h+=(n.arotation+this.data.offsetRotation)*t);var u=l.ax,c=l.ay;0!=e&&(u+=(n.ax+this.data.offsetX)*e,c+=(n.ay+this.data.offsetY)*e);var d=l.ascaleX,p=l.ascaleY;0!=i&&(d>1e-5&&(d*=(n.ascaleX-1+this.data.offsetScaleX)*i+1),p>1e-5&&(p*=(n.ascaleY-1+this.data.offsetScaleY)*i+1));var f=l.ashearY;0!=r&&(f+=(n.ashearY+this.data.offsetShearY)*r),l.updateWorldTransformWith(u,c,h,d,p,l.ashearX,f)}},e}();t.TransformConstraint=e}(W2||(W2={})),function(t){var e=function(t){function e(e){var i=t.call(this,e,0,!1)||this;return i.bones=new Array,i.rotateMix=0,i.translateMix=0,i.scaleMix=0,i.shearMix=0,i.offsetRotation=0,i.offsetX=0,i.offsetY=0,i.offsetScaleX=0,i.offsetScaleY=0,i.offsetShearY=0,i.relative=!1,i.local=!1,i}return X2(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(W2||(W2={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var i=t,r=t.length>>1,n=this.indicesArray;n.length=0;for(var o=0;o<r;o++)n[o]=o;var s=this.isConcaveArray;s.length=0,o=0;for(var a=r;o<a;++o)s[o]=e.isConcave(o,r,i,n);var l=this.triangles;for(l.length=0;r>3;){for(var h=r-1,u=(o=0,1);;){t:if(!s[o]){for(var c=n[h]<<1,d=n[o]<<1,p=n[u]<<1,f=i[c],_=i[c+1],g=i[d],m=i[d+1],y=i[p],v=i[p+1],b=(u+1)%r;b!=h;b=(b+1)%r)if(s[b]){var S=n[b]<<1,T=i[S],E=i[S+1];if(e.positiveArea(y,v,f,_,T,E)&&e.positiveArea(f,_,g,m,T,E)&&e.positiveArea(g,m,y,v,T,E))break t}break}if(0==u){do{if(!s[o])break;o--}while(o>0);break}h=o,o=u,u=(u+1)%r}l.push(n[(r+o-1)%r]),l.push(n[o]),l.push(n[(o+1)%r]),n.splice(o,1),s.splice(o,1);var A=(--r+o-1)%r,C=o==r?0:o;s[A]=e.isConcave(A,r,i,n),s[C]=e.isConcave(C,r,i,n)}return 3==r&&(l.push(n[2]),l.push(n[0]),l.push(n[1])),l},e.prototype.decompose=function(t,i){var r=t,n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var o=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(o),o.length=0;var s=this.polygonIndicesPool.obtain();s.length=0;var a=this.polygonPool.obtain();a.length=0;for(var l=-1,h=0,u=0,c=i.length;u<c;u+=3){var d=i[u]<<1,p=i[u+1]<<1,f=i[u+2]<<1,_=r[d],g=r[d+1],m=r[p],y=r[p+1],v=r[f],b=r[f+1],S=!1;if(l==d){var T=a.length-4,E=e.winding(a[T],a[T+1],a[T+2],a[T+3],v,b),A=e.winding(v,b,a[0],a[1],a[2],a[3]);E==h&&A==h&&(a.push(v),a.push(b),s.push(f),S=!0)}S||(a.length>0?(n.push(a),o.push(s)):(this.polygonPool.free(a),this.polygonIndicesPool.free(s)),(a=this.polygonPool.obtain()).length=0,a.push(_),a.push(g),a.push(m),a.push(y),a.push(v),a.push(b),(s=this.polygonIndicesPool.obtain()).length=0,s.push(d),s.push(p),s.push(f),h=e.winding(_,g,m,y,v,b),l=d)}for(a.length>0&&(n.push(a),o.push(s)),u=0,c=n.length;u<c;u++)if(0!=(s=o[u]).length)for(var C=s[0],w=s[s.length-1],x=(a=n[u])[T=a.length-4],R=a[T+1],M=a[T+2],O=a[T+3],P=a[0],D=a[1],I=a[2],B=a[3],L=e.winding(x,R,M,O,P,D),F=0;F<c;F++)if(F!=u){var k=o[F];if(3==k.length){var N=k[0],z=k[1],U=k[2],V=n[F];v=V[V.length-2],b=V[V.length-1],N==C&&z==w&&(E=e.winding(x,R,M,O,v,b),A=e.winding(v,b,P,D,I,B),E==L&&A==L&&(V.length=0,k.length=0,a.push(v),a.push(b),s.push(U),x=M,R=O,M=v,O=b,F=0))}}for(u=n.length-1;u>=0;u--)0==(a=n[u]).length&&(n.splice(u,1),this.polygonPool.free(a),s=o[u],o.splice(u,1),this.polygonIndicesPool.free(s));return n},e.isConcave=function(t,e,i,r){var n=r[(e+t-1)%e]<<1,o=r[t]<<1,s=r[(t+1)%e]<<1;return!this.positiveArea(i[n],i[n+1],i[o],i[o+1],i[s],i[s+1])},e.positiveArea=function(t,e,i,r,n,o){return t*(o-r)+i*(e-o)+n*(r-e)>=0},e.winding=function(t,e,i,r,n,o){var s=i-t,a=r-e;return n*a-o*s+s*e-t*a>=0?1:-1},e}();t.Triangulator=e}(W2||(W2={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var i=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.r=t,this.g=e,this.b=i,this.a=r}return t.prototype.set=function(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,i,r){return this.r+=t,this.g+=e,this.b+=i,this.a+=r,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=i;var r=function(){function t(){}return t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))},t.randomTriangularWith=function(t,e,i){var r=Math.random(),n=e-t;return r<=(i-t)/n?t+Math.sqrt(r*n*(i-t)):e-Math.sqrt((1-r)*n*(e-i))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=r;var n=function(){function t(){}return t.prototype.apply=function(t,e,i){return t+(e-t)*this.applyInternal(i)},t}();t.Interpolation=n;var o=function(t){function e(e){var i=t.call(this)||this;return i.power=2,i.power=e,i}return X2(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(n);t.Pow=o;var s=function(t){function e(e){return t.call(this,e)||this}return X2(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(o);t.PowOut=s;var a=function(){function t(){}return t.arrayCopy=function(t,e,i,r,n){for(var o=e,s=r;o<e+n;o++,s++)i[s]=t[o]},t.setArraySize=function(t,e,i){void 0===i&&(i=0);var r=t.length;if(r==e)return t;if(t.length=e,r<e)for(var n=r;n<e;n++)t[n]=i;return t},t.ensureArrayCapacity=function(e,i,r){return void 0===r&&(r=0),e.length>=i?e:t.setArraySize(e,i,r)},t.newArray=function(t,e){for(var i=new Array(t),r=0;r<t;r++)i[r]=e;return i},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),r=0;r<i.length;r++)i[r]=0;return i},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=a;var l=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var i=t.bones[e];console.log(i.data.name+", "+i.a+", "+i.b+", "+i.c+", "+i.d+", "+i.worldX+", "+i.worldY)}},t}();t.DebugUtils=l;var h=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=h;var u=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=u;var c=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=c;var d=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=d}(W2||(W2={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var i=function(e){function i(t){var r=e.call(this,t)||this;return r.id=(65535&i.nextID++)<<11,r.worldVerticesLength=0,r.deformAttachment=r,r}return X2(i,e),i.prototype.computeWorldVertices=function(t,e,i,r,n,o){i=n+(i>>1)*o;var s=t.bone.skeleton,a=t.deform,l=this.vertices,h=this.bones;if(null!=h){for(var u=0,c=0,d=0;d<e;d+=2)u+=(g=h[u])+1,c+=g;var p=s.bones;if(0==a.length)for(R=n,A=3*c;R<i;R+=o){var f=0,_=0,g=h[u++];for(g+=u;u<g;u++,A+=3){b=p[h[u]],M=l[A],O=l[A+1];var m=l[A+2];f+=(M*b.a+O*b.b+b.worldX)*m,_+=(M*b.c+O*b.d+b.worldY)*m}r[R]=f,r[R+1]=_}else for(var y=a,v=(R=n,A=3*c,c<<1);R<i;R+=o){for(f=0,_=0,g=h[u++],g+=u;u<g;u++,A+=3,v+=2)b=p[h[u]],M=l[A]+y[v],O=l[A+1]+y[v+1],m=l[A+2],f+=(M*b.a+O*b.b+b.worldX)*m,_+=(M*b.c+O*b.d+b.worldY)*m;r[R]=f,r[R+1]=_}}else{a.length>0&&(l=a);for(var b,S=(b=t.bone).worldX,T=b.worldY,E=b.a,A=b.b,C=b.c,w=b.d,x=e,R=n;R<i;x+=2,R+=o){var M=l[x],O=l[x+1];r[R]=M*E+O*A+S,r[R+1]=M*C+O*w+T}}},i.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},i.nextID=0,i}(e);t.VertexAttachment=i}(W2||(W2={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r}return X2(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.BoundingBoxAttachment=e}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.2275,.2275,.8078,1),r}return X2(i,e),i.prototype.copy=function(){var t=new i(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.ClippingAttachment=e}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(1,1,1,1),r.tempColor=new t.Color(0,0,0,0),r}return X2(i,e),i.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var i=this.uvs,r=this.uvs.length,n=this.region.u,o=this.region.v,s=0,a=0;if(this.region instanceof t.TextureAtlasRegion){var l=this.region,h=l.texture.getImage().width,u=l.texture.getImage().height;switch(l.degrees){case 90:n-=(l.originalHeight-l.offsetY-l.height)/h,o-=(l.originalWidth-l.offsetX-l.width)/u,s=l.originalHeight/h,a=l.originalWidth/u;for(var c=0;c<r;c+=2)i[c]=n+e[c+1]*s,i[c+1]=o+(1-e[c])*a;return;case 180:for(n-=(l.originalWidth-l.offsetX-l.width)/h,o-=l.offsetY/u,s=l.originalWidth/h,a=l.originalHeight/u,c=0;c<r;c+=2)i[c]=n+(1-e[c])*s,i[c+1]=o+(1-e[c+1])*a;return;case 270:for(n-=l.offsetY/h,o-=l.offsetX/u,s=l.originalHeight/h,a=l.originalWidth/u,c=0;c<r;c+=2)i[c]=n+(1-e[c+1])*s,i[c+1]=o+e[c]*a;return}n-=l.offsetX/h,o-=(l.originalHeight-l.offsetY-l.height)/u,s=l.originalWidth/h,a=l.originalHeight/u}else null==this.region?(n=o=0,s=a=1):(s=this.region.u2-n,a=this.region.v2-o);for(c=0;c<r;c+=2)i[c]=n+e[c]*s,i[c+1]=o+e[c+1]*a},i.prototype.getParentMesh=function(){return this.parentMesh},i.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},i.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new i(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},i.prototype.newLinkedMesh=function(){var t=new i(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},i}(t.VertexAttachment);t.MeshAttachment=e}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.closed=!1,r.constantSpeed=!1,r.color=new t.Color(1,1,1,1),r}return X2(i,e),i.prototype.copy=function(){var e=new i(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},i}(t.VertexAttachment);t.PathAttachment=e}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.color=new t.Color(.38,.94,0,1),r}return X2(i,e),i.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},i.prototype.computeWorldRotation=function(e){var i=t.MathUtils.cosDeg(this.rotation),r=t.MathUtils.sinDeg(this.rotation),n=i*e.a+r*e.b,o=i*e.c+r*e.d;return Math.atan2(o,n)*t.MathUtils.radDeg},i.prototype.copy=function(){var t=new i(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},i}(t.VertexAttachment);t.PointAttachment=e}(W2||(W2={})),function(t){var e=function(e){function i(i){var r=e.call(this,i)||this;return r.x=0,r.y=0,r.scaleX=1,r.scaleY=1,r.rotation=0,r.width=0,r.height=0,r.color=new t.Color(1,1,1,1),r.offset=t.Utils.newFloatArray(8),r.uvs=t.Utils.newFloatArray(8),r.tempColor=new t.Color(1,1,1,1),r}return X2(i,e),i.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*t,n=-this.height/2*this.scaleY+this.region.offsetY*e,o=r+this.region.width*t,s=n+this.region.height*e,a=this.rotation*Math.PI/180,l=Math.cos(a),h=Math.sin(a),u=r*l+this.x,c=r*h,d=n*l+this.y,p=n*h,f=o*l+this.x,_=o*h,g=s*l+this.y,m=s*h,y=this.offset;y[i.OX1]=u-p,y[i.OY1]=d+c,y[i.OX2]=u-m,y[i.OY2]=g+c,y[i.OX3]=f-m,y[i.OY3]=g+_,y[i.OX4]=f-p,y[i.OY4]=d+_},i.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},i.prototype.computeWorldVertices=function(t,e,r,n){var o=this.offset,s=t.worldX,a=t.worldY,l=t.a,h=t.b,u=t.c,c=t.d,d=0,p=0;d=o[i.OX1],p=o[i.OY1],e[r]=d*l+p*h+s,e[r+1]=d*u+p*c+a,r+=n,d=o[i.OX2],p=o[i.OY2],e[r]=d*l+p*h+s,e[r+1]=d*u+p*c+a,r+=n,d=o[i.OX3],p=o[i.OY3],e[r]=d*l+p*h+s,e[r+1]=d*u+p*c+a,r+=n,d=o[i.OX4],p=o[i.OY4],e[r]=d*l+p*h+s,e[r+1]=d*u+p*c+a},i.prototype.copy=function(){var e=new i(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},i.OX1=0,i.OY1=1,i.OX2=2,i.OY2=3,i.OX3=4,i.OY3=5,i.OX4=6,i.OY4=7,i.X1=0,i.Y1=1,i.C1R=2,i.C1G=3,i.C1B=4,i.C1A=5,i.U1=6,i.V1=7,i.X2=8,i.Y2=9,i.C2R=10,i.C2G=11,i.C2B=12,i.C2A=13,i.U2=14,i.V2=15,i.X3=16,i.Y3=17,i.C3R=18,i.C3G=19,i.C3B=20,i.C3A=21,i.U3=22,i.V3=23,i.X4=24,i.Y4=25,i.C4R=26,i.C4G=27,i.C4B=28,i.C4A=29,i.U4=30,i.V4=31,i}(t.Attachment);t.RegionAttachment=e}(W2||(W2={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(W2||(W2={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var i=this.angle*t.MathUtils.degreesToRadians,r=e.x-this.worldX,n=e.y-this.worldY,o=Math.sqrt(r*r+n*n);if(o<this.radius){var s=this.interpolation.apply(0,i,(this.radius-o)/this.radius),a=Math.cos(s),l=Math.sin(s);e.x=a*r-l*n+this.worldX,e.y=l*r+a*n+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(W2||(W2={}));var Y2,j2,q2,K2,Z2,J2,Q2=W2,$2=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),t3=1/60,e3=[],i3=[],r3=0,n3=0,o3=0,s3=null,a3=null,l3=0,h3=0,u3=0,c3=0,d3=null,p3=null,f3=0,_3=0,g3=new Q2.Color(1,1,1,1),m3=new Q2.Color(1,1,1,1),y3=[0,1,2,2,3,0],v3=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var i=null==t?void 0:t.skeleton,r=null==t?void 0:t.listener,n=null==t?void 0:t.state,o=null==i?void 0:i.data.findAnimation(this._animationName);null==n||n.setAnimationWith(0,o,!1),this.bind(r),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,i=null==e?void 0:e.skeleton,r=null==e?void 0:e.clipper,n=null==e?void 0:e.state;do{null==i||i.update(t3),null==n||n.update(t3),null==n||n.apply(i),null==i||i.updateWorldTransform(),this._frameIdx++,this.updateFrame(i,r,this._frameIdx),this.totalTime+=t3}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,i,r,n){if(K2=i.a*e.a*t.a*255,Y2=e.r*t.r*255,j2=e.g*t.g*255,q2=e.b*t.b*255,g3.r=Y2*i.r,g3.g=j2*i.g,g3.b=q2*i.b,g3.a=K2,null==n.darkColor?m3.set(0,0,0,1):(m3.r=n.darkColor.r*Y2,m3.g=n.darkColor.g*j2,m3.b=n.darkColor.b*q2),m3.a=0,Z2=(g3.a<<24>>>0)+(g3.b<<16)+(g3.g<<8)+g3.r,J2=(m3.a<<24>>>0)+(m3.b<<16)+(m3.g<<8)+m3.r,d3!==Z2||p3!==J2){var o=this._tempColors;d3=Z2,p3=J2,c3>0&&(o[c3-1].vfOffset=o3),o[c3++]={fr:g3.r,fg:g3.g,fb:g3.b,fa:g3.a,dr:m3.r,dg:m3.g,db:m3.b,da:m3.a,vfOffset:0}}if(r.isClipping()){r.clipTriangles(e3,f3,i3,_3,e3,g3,m3,!0,6,o3,o3+2);var s=r.clippedVertices,a=r.clippedTriangles;_3=a.length,f3=s.length/12*6;for(var l=0,h=n3,u=a.length;l<u;)i3[h++]=a[l++];for(var c=0,d=s.length,p=o3;c<d;c+=12,p+=6)e3[p]=s[c],e3[p+1]=s[c+1],e3[p+2]=s[c+6],e3[p+3]=s[c+7],e3[p+4]=Z2,e3[p+5]=J2}else for(var f=o3,_=o3+f3;f<_;f+=6)e3[f+4]=Z2,e3[f+5]=J2},e.updateFrame=function(t,e,i){o3=0,r3=0,n3=0,s3=null,a3=null,l3=0,h3=0,u3=0,c3=0,d3=null,p3=null,this.frames[i]=this.frames[i]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var r=this.frames[i],n=this._tempSegments=r.segments,o=this._tempColors=r.colors,s=this._tempBoneInfos=r.boneInfos;this.traverseSkeleton(t,e),c3>0&&(o[c3-1].vfOffset=o3),o.length=c3,s.length=r3;var a=u3-1;if(a>=0)if(h3>0){var l=n[a];l.indexCount=h3,l.vfCount=13*l3,l.vertexCount=l3,n.length=u3}else n.length=u3-1;if(0!==n.length){var h=r.vertices,u=o3/6*13;(!h||h.length<u)&&(h=r.vertices=new Float32Array(u));for(var c=0,d=0;c<u;)h[c]=e3[d++],h[c+1]=e3[d++],h[c+3]=e3[d++],h[c+4]=e3[d++],this._setVerticeColor(e3[d++],h,c+5),this._setVerticeColor(e3[d++],h,c+9),c+=13;var p=r.indices;(!p||p.length<n3)&&(p=r.indices=new Uint16Array(n3));for(var f=0;f<n3;f++)p[f]=i3[f];r.vertices=h,r.indices=p}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var i,r,n,o,s,a,l,h,u,c,d,p,f=this._tempSegments,_=this._tempBoneInfos,g=t.color,m=t.bones;if(this._enableCacheAttachedInfo)for(var y=0,v=m.length;y<v;y++,r3++){var b=m[y],S=_[r3];S||(S=_[r3]={}),S.a=b.a,S.b=b.b,S.c=b.c,S.d=b.d,S.worldX=b.worldX,S.worldY=b.worldY}for(var T=0,E=t.drawOrder.length;T<E;T++)if(p=t.drawOrder[T],f3=0,_3=0,i=p.getAttachment())if(a=i instanceof Q2.RegionAttachment,l=i instanceof Q2.MeshAttachment,i instanceof Q2.ClippingAttachment)e.clipStart(p,i);else if(a||l)if(h=i.region.texture.getRealTexture()){if(d=p.data.blendMode,s3===h.nativeUrl&&a3===d||(s3=h.nativeUrl,a3=d,(u=u3-1)>=0&&(h3>0?((c=f[u]).indexCount=h3,c.vertexCount=l3,c.vfCount=13*l3):u3--),f[u3]={tex:h,blendMode:d,indexCount:0,vertexCount:0,vfCount:0},u3++,h3=0,l3=0),a)s=y3,f3=24,_3=6,i.computeWorldVertices(p.bone,e3,o3,6);else if(l){var A=i;s=A.triangles,f3=6*(A.worldVerticesLength>>1),_3=s.length,A.computeWorldVertices(p,0,A.worldVerticesLength,e3,o3,6)}if(0!==f3&&0!==_3){for(var C=0,w=n3,x=s.length;C<x;)i3[w++]=s[C++];o=i.uvs;for(var R=o3,M=o3+f3,O=0;R<M;R+=6,O+=2)e3[R+2]=o[O],e3[R+3]=o[O+1];if(r=i.color,n=p.color,this.fillVertices(g,r,n,e,p),_3>0){for(var P=n3,D=n3+_3;P<D;P++)i3[P]+=l3;n3+=_3,o3+=f3,h3+=_3,l3+=f3/6}e.clipEndWithSlot(p)}else e.clipEndWithSlot(p)}else e.clipEndWithSlot(p);else e.clipEndWithSlot(p);else e.clipEndWithSlot(p);e.clipEnd()},e._setVerticeColor=function(t,e,i){e[i]=(255&t)/255,e[i+1]=(t>>8&255)/255,e[i+2]=(t>>16&255)/255,e[i+3]=(t>>24&255)/255},t}(),b3=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var i=e.animationsCache;for(var r in i){var n=i[r];n&&(this._animationPool[t+"#"+r]=n,n.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var i=this._skeletonCache[t];if(!i){var r=new Q2.Skeleton(e),n=new Q2.SkeletonClipping,o=new Q2.AnimationStateData(r.data),s=new Q2.AnimationState(o),a=new $2;s.addListener(a),this._skeletonCache[t]=i={skeleton:r,clipper:n,state:s,listener:a,animationsCache:{},curAnimationCache:null}}return i},e.getAnimationCache=function(t,e){var i=this._skeletonCache[t];return i?i.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var i=e.animationsCache;for(var r in i)i[r].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var i=this._skeletonCache[t],r=i&&i.skeleton;if(!r)return null;if(!r.data.findAnimation(e))return null;var n=i.animationsCache,o=n[e];if(!o){var s=t+"#"+e;(o=this._animationPool[s])?delete this._animationPool[s]:(o=new v3)._privateMode=this._privateMode,o.init(i,e),n[e]=o}return o},e.updateAnimationCache=function(t,e){if(e){var i=this.initAnimationCache(t,e);if(!i)return null;i.updateAllFrame()}else{var r=this._skeletonCache[t];if(!r||!r.skeleton)return;var n=r.animationsCache;for(var o in n)n[o].updateAllFrame()}},t}();b3.FrameTime=t3,b3.sharedCache=new b3;var S3,T3,E3,A3,C3,w3,x3,R3,M3,O3,P3,D3=new Wi,I3=new fi,B3=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){if(this._inited){var t=this._skeletonComp.socketNodes;if(0!==t.size){var e;if(e=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var i,r=function(t,e){I3.set(t.scale);var i=D3;i.m00=e.a,i.m01=e.c,i.m04=e.b,i.m05=e.d,i.m12=e.worldX,i.m13=e.worldY,t.matrix=D3,t.scale=I3},n=qe(t.keys());!(i=n()).done;){var o=i.value,s=t.get(o);if(s&&s.isValid){var a=e[o];a?r(s,a):(s.removeFromParent(),s.destroy(),t.delete(o))}else t.delete(o)}}}},t}(),L3=function(t){function e(e){var i;return(i=t.call(this,e)||this).name="sp.SkeletonTexture",i._texture=null,i._material=null,i}He(e,t);var i=e.prototype;return i.setRealTexture=function(t){this._texture=t},i.getRealTexture=function(){return this._texture},i.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(F3(t),F3(e))},i.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(k3(t),k3(e))},i.dispose=function(){},e}(Q2.Texture);function F3(t){switch(t){case Q2.TextureFilter.Nearest:case Q2.TextureFilter.MipMapNearestNearest:case Q2.TextureFilter.MipMapLinearNearest:return Tr.NEAREST;case Q2.TextureFilter.MipMap:case Q2.TextureFilter.MipMapNearestLinear:case Q2.TextureFilter.MipMapLinearLinear:case Q2.TextureFilter.Linear:default:return Tr.LINEAR}}function k3(t){switch(t){case Q2.TextureWrap.MirroredRepeat:return kn.MIRRORED_REPEAT;case Q2.TextureWrap.ClampToEdge:return kn.CLAMP_TO_EDGE;case Q2.TextureWrap.Repeat:default:return kn.REPEAT}}var N3=(S3=_i("sp.SkeletonData"),T3=Di([si]),E3=Di([ji]),S3((P3=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"_skeletonJson",w3,Ti(e)),Si(e,"textures",x3,Ti(e)),Si(e,"textureNames",R3,Ti(e)),Si(e,"scale",M3,Ti(e)),Si(e,"_atlasText",O3,Ti(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}He(e,t);var i=e.prototype;return i.createNode=function(t){var e=new br(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},i.reset=function(){this._skeletonCache=null,this._atlasCache=null},i.resetEnums=function(){},i.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var i=new Q2.AtlasAttachmentLoader(e),r=null,n=null;return this.skeletonJson?(n=new Q2.SkeletonJson(i),r=this.skeletonJson):(n=new Q2.SkeletonBinary(i),r=new Uint8Array(this._nativeAsset)),n.scale=this.scale,this._skeletonCache=n.readSkeletonData(r),e.dispose(),this._skeletonCache},i.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,i={},r=0;r<e.length;r++)i[e[r].name]=r;return this._skinsEnum=Mi(i)}return null},i.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},i=t.animations,r=0;r<i.length;r++)e[i[r].name]=r+1;return this._animsEnum=Mi(e)}return null},i.destroy=function(){return b3.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},i._getTexture=function(t){for(var e=this.textureNames,i=0;i<e.length;i++)if(e[i]===t){var r=this.textures[i],n=new L3({width:r.width,height:r.height});return n.setRealTexture(r),n}return console.error(this.name+" no textures found!"),null},i._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new Q2.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},Ge(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}(vi),w3=bi((C3=P3).prototype,"_skeletonJson",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x3=bi(C3.prototype,"textures",[Ai,T3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R3=bi(C3.prototype,"textureNames",[Ai,E3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M3=bi(C3.prototype,"scale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),O3=bi(C3.prototype,"_atlasText",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),A3=C3))||A3);ei.internal.SpineSkeletonData=N3;var z3,U3,V3,H3,G3,W3,X3,Y3,j3,q3,K3,Z3,J3,Q3,$3,t5,e5,i5,r5,n5,o5,s5,a5,l5,h5,u5,c5,d5,p5,f5,_5,g5,m5,y5,v5,b5,S5,T5,E5,A5,C5,w5,x5,R5,M5,O5,P5,D5,I5,B5,L5,F5,k5,N5,z5,U5,V5,H5=function(t){function e(){var e;return(e=t.call(this)||this)._skeletons=new Set,e}He(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,Fr.registerSystem(e.ID,e._instance,Zn.Priority.HIGH)),e._instance};var i=e.prototype;return i.add=function(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))},i.remove=function(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)},i.postUpdate=function(t){this._skeletons&&this._skeletons.forEach((function(e){e.updateAnimation(t)}))},e}(Zn);function G5(t,e,i){_o.Attr.setClassAttr(t,e,"type","Enum"),_o.Attr.setClassAttr(t,e,"enumList",Mi.getList(i))}H5.ID="SKELETON",H5._instance=void 0,function(t){t[t.default=0]="default"}(N5||(N5={})),Hr(N5),function(t){t[t["<None>"]=0]="<None>"}(z5||(z5={})),Hr(z5),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(U5||(U5={})),Hr(U5),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(V5||(V5={}));var W5=(z3=_i("sp.Skeleton.SpineSocket"),U3=Di(br),z3((G3=bi((H3=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),Si(this,"path",G3,this),Si(this,"target",W3,this),this.path=t,this.target=e}).prototype,"path",[Ai,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),W3=bi(H3.prototype,"target",[U3,Pi,Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V3=H3))||V3);qi.setClassAlias(W5,"sp.Skeleton.SpineSocket");var X5=(X3=_i("sp.Skeleton"),Y3=Ni(),j3=Ui(),q3=Di(Sr),K3=Ur(),Z3=Wr(),J3=Hi(),Q3=Di(N3),$3=Wr(),t5=Di(N5),e5=Vi(),i5=Wr(),r5=Di(z5),n5=Vi(),o5=Wr(),s5=Vi(),a5=Di(U5),l5=Vi(),h5=Vi(),u5=Vi(),c5=Vi(),d5=Vi(),p5=Vi(),f5=Vi(),_5=Di([W5]),g5=Vi(),m5=Hi(),y5=Hi(),X3(v5=Y3(v5=j3(v5=Ii((k5=F5=function(t){function e(){var e;return e=t.call(this)||this,Si(e,"paused",S5,Ti(e)),Si(e,"loop",T5,Ti(e)),Si(e,"_premultipliedAlpha",E5,Ti(e)),Si(e,"_timeScale",A5,Ti(e)),e.enableBatch=!1,e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e._materialCache={},e._enumSkins=Mi({}),e._enumAnimations=Mi({}),e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._playTimes=0,e._isAniComplete=!0,Si(e,"_useTint",C5,Ti(e)),Si(e,"_preCacheMode",w5,Ti(e)),Si(e,"_cacheMode",x5,Ti(e)),Si(e,"_defaultCacheMode",R5,Ti(e)),Si(e,"_debugBones",M5,Ti(e)),Si(e,"_debugSlots",O5,Ti(e)),Si(e,"_skeletonData",P5,Ti(e)),Si(e,"defaultSkin",D5,Ti(e)),Si(e,"defaultAnimation",I5,Ti(e)),Si(e,"_sockets",B5,Ti(e)),e._meshRenderDataArray=[],Si(e,"_debugMesh",L5,Ti(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._meshRenderDataArrayIdx=0,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new B3,G5(Ti(e),"_defaultSkinIndex",e._enumSkins),G5(Ti(e),"_animationIndex",e._enumAnimations),e}He(e,t);var i=e.prototype;return i.disableRender=function(){this.destroyRenderData()},i.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===U5.SHARED_CACHE?this._skeletonCache=b3.sharedCache:this._cacheMode===U5.PRIVATE_CACHE&&(this._skeletonCache=new b3,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&ti("Debug bones or slots is invalid in cached mode");var i=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=i.skeleton,this._clipper=i.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new Q2.Skeleton(t),this._clipper=new Q2.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this.markForUpdateRenderData()},i.setSlotsRange=function(t,e){this.isAnimationCached()?ti("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},i.setAnimationStateData=function(t){if(this.isAnimationCached())ti("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new Q2.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},i.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,i=0,r=e.length;i<r;i++){var n=e[i];n&&"DEBUG_DRAW_NODE"===n.name&&n.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},i.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},i.isAnimationCached=function(){return this._cacheMode!==U5.REALTIME},i.updateAnimation=function(t){if(!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var i=e.frames;this._curFrame=i[i.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var r=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,r.animationName,r.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},i.setVertexEffectDelegate=function(t){this._effectDelegate=t},i.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},i.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},i.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},i.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},i.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},i.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},i.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},i.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},i.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},i.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},i.getTextureAtlas=function(t){return t.region},i.setMix=function(t,e,i){this._state&&this._state.data.setMix(t,e,i)},i.setAnimation=function(t,e,i){if(this._playTimes=i?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&ti("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var r=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);r||(r=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),r&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=r,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var n=this._skeleton.data.findAnimation(e);if(!n)return hn(7509,e),null;var o=this._state.setAnimationWith(t,n,i);return this._state.apply(this._skeleton),o}return null},i.addAnimation=function(t,e,i,r){if(r=r||0,this.isAnimationCached())0!==t&&ti("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:i,delay:r});else if(this._skeleton){var n,o=this._skeleton.data.findAnimation(e);return o?null===(n=this._state)||void 0===n?void 0:n.addAnimationWith(t,o,i,r):(hn(7510,e),null)}return null},i.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},i.getCurrent=function(t){if(this.isAnimationCached())ti("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},i.clearTracks=function(){this.isAnimationCached()?ti("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},i.clearTrack=function(t){this.isAnimationCached()?ti("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},i.setStartListener=function(t){this._ensureListener(),this._listener.start=t},i.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},i.setEndListener=function(t){this._ensureListener(),this._listener.end=t},i.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},i.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},i.setEventListener=function(t){this._ensureListener(),this._listener.event=t},i.setTrackStartListener=function(t,e){$2.getListeners(t).start=e},i.setTrackInterruptListener=function(t,e){$2.getListeners(t).interrupt=e},i.setTrackEndListener=function(t,e){$2.getListeners(t).end=e},i.setTrackDisposeListener=function(t,e){$2.getListeners(t).dispose=e},i.setTrackCompleteListener=function(t,e){$2.getListeners(t).complete=function(t){var i=Math.floor(t.trackTime/t.animationEnd);e(t,i)}},i.setTrackEventListener=function(t,e){$2.getListeners(t).event=e},i.getState=function(){return this._state},i.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),H5.getInstance().add(this)},i.onDisable=function(){t.prototype.onDisable.call(this),H5.getInstance().remove(this)},i.onDestroy=function(){this._cleanMaterialCache(),this.destroyRenderData(),t.prototype.onDestroy.call(this)},i.requestMeshRenderData=function(t){if(this._meshRenderDataArray.length>0&&0===this._meshRenderDataArray[this._meshRenderDataArray.length-1].renderData.vertexCount)return this._meshRenderDataArray[this._meshRenderDataArray.length-1];var e=new Sd(t),i={renderData:e};return e.material=null,this._meshRenderDataArray.push(i),i},i.destroyRenderData=function(){this._meshRenderDataArray.length>0&&(this._meshRenderDataArray.forEach((function(t){t.renderData.reset()})),this._meshRenderDataArray.length=0)},i.getMaterialForBlendAndTint=function(t,e,i){var r=i+"/"+t+"/"+e,n=this._materialCache[r];if(n)return n;var o=this.customMaterial;null===o&&(o=Li.get("default-spine-material"));var s=!1;switch(i){case V5.TWO_COLORED:s=!0;break;case V5.COLORED_TEXTURED:}return n=new qr({parent:o,subModelIdx:0,owner:this}),this._materialCache[r]=n,n.overridePipelineStates({blendState:{blendColor:tr.WHITE,targets:[{blendEq:R.ADD,blendAlphaEq:R.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),n.recompileShaders({TWO_COLORED:s}),n},i.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc(),this._blendHash=-1},i.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},i._render=function(t){if(this._meshRenderDataArray)for(var e=0;e<this._meshRenderDataArray.length;e++){var i=this.material;this._meshRenderDataArrayIdx=e;var r=this._meshRenderDataArray[e];r.renderData.material&&(this.material=r.renderData.material),r.texture&&t.commitComp(this,r.texture,this._assembler,null),this.material=i}},i.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},i._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},i._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var i=e.frames,r=b3.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var n=Math.floor(this._accTime/r);if(e.isCompleted||e.updateToFrame(n),e.isCompleted&&n>=i.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=i[i.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,this._emitCacheCompleteEvent(),void this.markForUpdateRenderData();this._accTime=0,n=0,this._emitCacheCompleteEvent()}this._curFrame=i[n],this.markForUpdateRenderData()}},i._updateRealtime=function(t){var e=this._skeleton,i=this._state;e&&(e.update(t),i&&(i.update(t),i.apply(e)),this.markForUpdateRenderData())},i._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(i){return null==i.parent?i.data.name||"<Unamed>":e(t[i.parent.data.index])+"/"+i.data.name},i=0,r=t.length;i<r;i++){var n=t[i].data,o=e(t[i]);this._cachedSockets.set(o,n.index)}}},i._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData()},i._updateBatch=function(){this.markForUpdateRenderData()},i._validateRender=function(){this.skeletonData||this.disableRender()},i._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():z5,this._enumAnimations=Mi({}),Object.assign(this._enumAnimations,t),Mi.update(this._enumAnimations),G5(this,"_animationIndex",this._enumAnimations)},i._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():N5,this._enumSkins=Mi({}),Object.assign(this._enumSkins,t),Mi.update(this._enumSkins),G5(this,"_defaultSkinIndex",this._enumSkins)},i._ensureListener=function(){this._listener||(this._listener=new $2,this._state&&this._state.addListener(this._listener))},i._updateSkeletonData=function(){if(this.skeletonData){var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new Q2.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){ti(t)}this._indexBoneSockets(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}else this.disableRender()}else this.disableRender()},i._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},i._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new br("DEBUG_DRAW_NODE");t.hideFlags|=jr.Flags.DontSave|jr.Flags.HideInHierarchy;var e=t.addComponent(P_);e.lineWidth=1,e.strokeColor=new tr(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&ti("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},i._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),0===this._meshRenderDataArray.length&&this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._colorDirty=!0,this._updateColor())},i._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var i=this._sockets[t];if(i.path&&i.target){var r=this._cachedSockets.get(i.path);if(!r){console.error("Skeleton data does not contain path "+i.path);continue}this._socketNodes.set(r,i.target)}}}},i._verifySockets=function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e].target;!r||r.parent&&r.parent===this.node||console.error("Target node "+r.name+" is expected to be a direct child of "+this.node.name)}var n=new Map;t.forEach((function(t){t.target&&(n.get(t.target)?console.error("Target node "+t.target.name+" has existed."):n.set(t.target,!0))}))},i._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},Ge(e,[{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this._skeletonData=t,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.destroyRenderData(),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var i=e[t];void 0!==i?(this.defaultSkin=i,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var i=e[t];if(void 0!==i)return i}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var i=e[t];void 0!==i?(this.animation=i,this.animation=i):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint(),this.markForUpdateRenderData())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]),e}(uf),F5.SpineSocket=W5,F5.AnimationCacheMode=U5,bi((b5=k5).prototype,"customMaterial",[Ar,q3,K3,Z3],Object.getOwnPropertyDescriptor(b5.prototype,"customMaterial"),b5.prototype),S5=bi(b5.prototype,"paused",[J3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bi(b5.prototype,"skeletonData",[Pi,Q3],Object.getOwnPropertyDescriptor(b5.prototype,"skeletonData"),b5.prototype),bi(b5.prototype,"_defaultSkinIndex",[$3,t5,e5],Object.getOwnPropertyDescriptor(b5.prototype,"_defaultSkinIndex"),b5.prototype),bi(b5.prototype,"_animationIndex",[i5,r5,n5],Object.getOwnPropertyDescriptor(b5.prototype,"_animationIndex"),b5.prototype),bi(b5.prototype,"defaultCacheMode",[o5,s5,Pi,a5],Object.getOwnPropertyDescriptor(b5.prototype,"defaultCacheMode"),b5.prototype),T5=bi(b5.prototype,"loop",[Ai,l5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),E5=bi(b5.prototype,"_premultipliedAlpha",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bi(b5.prototype,"premultipliedAlpha",[Pi,h5],Object.getOwnPropertyDescriptor(b5.prototype,"premultipliedAlpha"),b5.prototype),A5=bi(b5.prototype,"_timeScale",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),bi(b5.prototype,"timeScale",[u5,Pi],Object.getOwnPropertyDescriptor(b5.prototype,"timeScale"),b5.prototype),bi(b5.prototype,"debugSlots",[Pi,c5],Object.getOwnPropertyDescriptor(b5.prototype,"debugSlots"),b5.prototype),bi(b5.prototype,"debugBones",[Pi,d5],Object.getOwnPropertyDescriptor(b5.prototype,"debugBones"),b5.prototype),bi(b5.prototype,"debugMesh",[Pi,p5],Object.getOwnPropertyDescriptor(b5.prototype,"debugMesh"),b5.prototype),bi(b5.prototype,"useTint",[Pi,f5],Object.getOwnPropertyDescriptor(b5.prototype,"useTint"),b5.prototype),bi(b5.prototype,"sockets",[_5,g5],Object.getOwnPropertyDescriptor(b5.prototype,"sockets"),b5.prototype),C5=bi(b5.prototype,"_useTint",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w5=bi(b5.prototype,"_preCacheMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),x5=bi(b5.prototype,"_cacheMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return U5.REALTIME}}),R5=bi(b5.prototype,"_defaultCacheMode",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return U5.REALTIME}}),M5=bi(b5.prototype,"_debugBones",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),O5=bi(b5.prototype,"_debugSlots",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),P5=bi(b5.prototype,"_skeletonData",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D5=bi(b5.prototype,"defaultSkin",[Ai,m5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),I5=bi(b5.prototype,"defaultAnimation",[y5,Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),B5=bi(b5.prototype,"_sockets",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L5=bi(b5.prototype,"_debugMesh",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),v5=b5))||v5)||v5)||v5)||v5);ei.internal.SpineSkeleton=X5;var Y5,j5,q5,K5,Z5,J5,Q5,$5,t8,e8,i8,r8,n8,o8,s8,a8,l8,h8,u8,c8,d8,p8,f8,_8,g8,m8,y8,v8,b8,S8,T8,E8,A8,C8,w8,x8,R8,M8,O8,P8,D8,I8,B8=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new Q2.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new Q2.Pow(e),this._vertexEffect=new Q2.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new Q2.PowOut(e),this._vertexEffect=new Q2.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),L8=0,F8=[0,1,2,2,3,0],k8=new tr(0,0,255,255),N8=new tr(255,0,0,255),z8=new tr(0,255,0,255),U8=new tr(255,255,0,255),V8=new Q2.Color(1,1,1,1),H8=new Q2.Color(1,1,1,1),G8=new Q2.Vector2,W8=new Q2.Vector2,X8=new Float32Array(4),Y8=new Float32Array(4),j8=new fi,q8=0,K8=0,Z8=0,J8=0,Q8=0,$8=0,t6=0,e6=null,i6=null,r6=null;function n6(t){var e,i;switch(t){case Q2.BlendMode.Additive:e=Y5?x.ONE:x.SRC_ALPHA,i=x.ONE;break;case Q2.BlendMode.Multiply:e=x.DST_COLOR,i=x.ONE_MINUS_SRC_ALPHA;break;case Q2.BlendMode.Screen:e=x.ONE,i=x.ONE_MINUS_SRC_COLOR;break;case Q2.BlendMode.Normal:default:e=Y5?x.ONE:x.SRC_ALPHA,i=x.ONE_MINUS_SRC_ALPHA}return O8.getMaterialForBlendAndTint(e,i,Z5?V5.TWO_COLORED:V5.COLORED_TEXTURED)}function o6(t){C8=t.fa*r8,v8=t8*(j5=Y5?C8/255:1),b8=e8*j5,S8=i8*j5,T8=t.fr*v8,E8=t.fg*b8,A8=t.fb*S8,X8[0]=T8/255,X8[1]=E8/255,X8[2]=A8/255,X8[3]=C8/255,w8=t.dr*v8,x8=t.dg*b8,R8=t.db*S8,M8=Y5?255:0,Y8[0]=w8/255,Y8[1]=x8/255,Y8[2]=R8/255,Y8[3]=M8/255}var s6=new Float32Array(4);function a6(t){return s6[0]=t.r/255,s6[1]=t.g/255,s6[2]=t.b/255,s6[3]=t.a/255,s6}function l6(t){return t?13:9}var h6={createData:function(){},updateRenderData:function(t){O8=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e,i=t.color;t8=i.r/255,e8=i.g/255,i8=i.b/255,r8=i.a/255,Z5=t.useTint||t.isAnimationCached(),n8=l6(Z5),D8=t.node,t.destroyRenderData(),P8=t.requestMeshRenderData(n8),O8=t,i6=null,u8=!0,Y5=t.premultipliedAlpha,j5=1,L8=0,I8=!1,e6=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==i._val||Y5)&&(I8=!0),Z5&&(L8|=1),O8.enableBatch&&(e=D8.worldMatrix,u8=!1,L8|=16),t.isAnimationCached()?function(t){var e=O8._curFrame;if(e){var i,r,n=e.segments;if(0!==n.length){o8=12;var o=null,s=e.vertices,a=e.indices,l=0,h=0,u=0;t&&(p8=t.m00,g8=t.m01,f8=t.m04,m8=t.m05,_8=t.m12,y8=t.m13);var c=16&L8,d=c&&(1===p8&&0===g8&&0===f8&&1===m8),p=0,f=e.colors,_=f[p++],g=_.vfOffset;o6(_);for(var m=0,y=n.length;m<y;m++){var v=n[m];if(o=n6(v.blendMode)){i6||(i6=o),r6||(r6=v.tex),P8.renderData.material&&(P8.renderData.material=i6),(u8||o.hash!==i6.hash||v.tex&&v.tex!==r6)&&(u8=!1,P8.texture||(P8.texture=v.tex),P8=O8.requestMeshRenderData(l6(Z5)),i6=o,r6=v.tex,P8.texture=v.tex,P8.renderData.material=i6),K8=v.vertexCount,Q8=v.indexCount,P8.renderData.reserve(K8,Q8),$8=P8.renderData.indicesCount,Z8=P8.renderData.vertexCount,t6=P8.renderData.vDataOffset,i=P8.renderData.vData,r=P8.renderData.iData;for(var b=$8,S=$8+Q8;b<S;b++)r[b]=Z8+a[h++];u=v.vfCount;var T=s.subarray(l,l+u);l+=u;var E=t6;n8=l6(Z5);for(var A=0;A<T.length;)i[E+0]=T[A+0],i[E+1]=T[A+1],i[E+3]=T[A+3],i[E+4]=T[A+4],i[E+5]=T[A+5],i[E+6]=T[A+6],i[E+7]=T[A+7],i[E+8]=T[A+8],Z5&&(i[E+9]=T[A+9],i[E+10]=T[A+10],i[E+11]=T[A+11],i[E+12]=T[A+12]),E+=n8,A+=13;if(d)for(var C=t6,w=t6+u;C<w;C+=n8)i[C]+=_8,i[C+1]+=y8;else if(c)for(var x=t6,R=t6+u;x<R;x+=n8)c8=i[x],d8=i[x+1],i[x]=c8*p8+d8*f8+_8,i[x+1]=c8*g8+d8*m8+y8;if(P8.renderData.advance(K8,Q8),I8)for(var M=l-u,O=t6,P=t6+u;O<P;O+=n8,M+=6)M>=g&&(o6(_=f[p++]),g=_.vfOffset),i.set(X8,O+5),i.set(Y8,O+9)}}}}}(e):(e6&&e6.begin(t._skeleton),function(t){var e,i,r,n,o,s,a,l,h=O8._skeleton,u=h.color,c=O8._debugRenderer,d=O8._clipper,p=null;q5=O8._startSlotIndex,K5=O8._endSlotIndex,h8=!1,-1===q5&&(h8=!0),J5=O8.debugSlots,Q5=O8.debugBones,$5=O8.debugMesh,c&&(Q5||J5||$5)&&(c.clear(),c.lineWidth=5),o8=12,q8=0,Z8=0,J8=0,Q8=0,$8=0;for(var f=0,_=h.drawOrder.length;f<_;f++){var g;if(void 0!==(l=h.drawOrder[f]))if(q5>=0&&q5===l.data.index&&(h8=!0),h8)if(K5>=0&&K5===l.data.index&&(h8=!1),q8=0,Q8=0,r=l.getAttachment())if(s=r instanceof Q2.RegionAttachment,a=r instanceof Q2.MeshAttachment,r instanceof Q2.ClippingAttachment)d.clipStart(l,r);else if(s||a){var m=r.region.texture.getRealTexture();if(p=n6(l.data.blendMode)){if(i6||(i6=p),(null===(g=P8)||void 0===g?void 0:g.renderData.material)||(P8.renderData.material=i6),(u8||p.hash!==i6.hash||m&&r6!==m)&&(u8=!1,P8=O8.requestMeshRenderData(n8),i6=p,r6=m,P8.texture=m,P8.renderData.material=i6),s){if(o=F8,q8=4*n8,Q8=6,P8.renderData.reserve(4,6),$8=P8.renderData.indicesCount,Z8=P8.renderData.vertexCount,J8=P8.renderData.vDataOffset,e=P8.renderData.vData,i=P8.renderData.iData,r.computeWorldVertices(l.bone,e,J8,n8),c&&J5){c.strokeColor=k8,c.moveTo(e[J8],e[J8+1]);for(var y=J8+n8,v=J8+q8;y<v;y+=n8)c.lineTo(e[y],e[y+1]);c.close(),c.stroke()}}else if(a){var b=r;if(o=b.triangles,q8=(b.worldVerticesLength>>1)*n8,Q8=o.length,P8.renderData.reserve(b.worldVerticesLength>>1,Q8),$8=P8.renderData.indicesCount,Z8=P8.renderData.vertexCount,J8=P8.renderData.vDataOffset,e=P8.renderData.vData,i=P8.renderData.iData,b.computeWorldVertices(l,0,b.worldVerticesLength,e,J8,n8),c&&$5){c.strokeColor=U8;for(var S=0,T=o.length;S<T;S+=3){var E=o[S]*n8+J8,A=o[S+1]*n8+J8,C=o[S+2]*n8+J8;c.moveTo(e[E],e[E+1]),c.lineTo(e[A],e[A+1]),c.lineTo(e[C],e[C+1]),c.close(),c.stroke()}}}if(0!==q8&&0!==Q8){var w=r;i.set(o,$8),n=w.uvs;for(var x=J8,R=J8+q8,M=0;x<R;x+=n8,M+=2)e[x+3]=n[M],e[x+4]=n[M+1];if(u6(u,w.color,l.color,d,l),e=P8.renderData.vData,i=P8.renderData.iData,Q8>0){for(var O=$8,P=$8+Q8;O<P;O++)i[O]+=Z8;if(t){p8=t.m00,f8=t.m04,_8=t.m12,g8=t.m01,m8=t.m05,y8=t.m13;for(var D=J8,I=J8+q8;D<I;D+=n8)c8=e[D],d8=e[D+1],e[D]=c8*p8+d8*f8+_8,e[D+1]=c8*g8+d8*m8+y8}P8.renderData.advance(q8/n8,Q8)}d.clipEndWithSlot(l)}else d.clipEndWithSlot(l)}else d.clipEndWithSlot(l)}else d.clipEndWithSlot(l);else d.clipEndWithSlot(l);else d.clipEndWithSlot(l)}if(d.clipEnd(),c&&Q5){var B;c.strokeColor=N8,c.fillColor=k8;for(var L=0,F=h.bones.length;L<F;L++){var k=(B=h.bones[L]).data.length*B.a+B.worldX,N=B.data.length*B.c+B.worldY;c.moveTo(B.worldX,B.worldY),c.lineTo(k,N),c.stroke(),c.circle(B.worldX,B.worldY,1.5*Math.PI),c.fill(),0===L&&(c.fillColor=z8)}}}(e),e6&&e6.end()),t.attachUtil._syncAttachedNode(),D8=void 0,P8=void 0,O8=void 0,e6=null}}(t)},updateColor:function(t){t&&(O8=t).markForUpdateRenderData()},fillBuffers:function(t,e){if(t&&t.meshRenderDataArray){O8=t;var i=t.meshRenderDataArray,r=t.node,n=i[t._meshRenderDataArrayIdx].renderData,o=e.acquireBufferBatch(9===n.floatStride?Qf:$f),s=o.byteOffset>>2,a=o.indicesOffset,l=o.vertexOffset;o.request(n.vertexCount,n.indicesCount)||(o=e.currBufferBatch,s=0,a=0,l=0);var h=o.vData,u=o.iData,c=r.worldMatrix,d=n.vData,p=n.vertexStart,f=n.iData,_=n.floatStride;h.set(d.subarray(p,p+n.vertexCount*_),s);for(var g=0;g<n.vertexCount;g++){var m=s+g*_;j8.set(h[m],h[m+1],h[m+2]),j8.transformMat4(c),h[m]=j8.x,h[m+1]=j8.y,h[m+2]=j8.z}for(var y=n.indicesStart,v=0;v<n.indicesCount;v+=1)u[v+a]=f[v+y]+l}}};function u6(t,e,i,r,n){var o=P8.renderData.vData,s=P8.renderData.iData;if(V8.a=i.a*e.a*t.a*r8*255,j5=Y5?V8.a:255,s8=t8*e.r*t.r*j5,a8=e8*e.g*t.g*j5,l8=i8*e.b*t.b*j5,V8.r=s8*i.r,V8.g=a8*i.g,V8.b=l8*i.b,null==n.darkColor?H8.set(0,0,0,1):(H8.r=n.darkColor.r*s8,H8.g=n.darkColor.g*a8,H8.b=n.darkColor.b*l8),H8.a=Y5?255:0,r.isClipping()){o8=Z5?12:8;var a=o.subarray(J8),l=o.subarray(J8+3);r.clipTriangles(a,q8,s.subarray($8),Q8,l,V8,H8,Z5,n8);var h=new Float32Array(r.clippedVertices),u=r.clippedTriangles;if(Q8=u.length,q8=h.length/o8*n8,P8.renderData.reserve(q8/n8,Q8),$8=P8.renderData.indicesCount,Z8=P8.renderData.vertexCount,J8=P8.renderData.vDataOffset,o=P8.renderData.vData,s=P8.renderData.iData,u.length>0&&s.set(u,$8),e6)for(var c=0,d=h.length,p=J8;c<d;c+=o8,p+=n8)G8.x=h[c],G8.y=h[c+1],V8.set(h[c+2],h[c+3],h[c+4],h[c+5]),W8.x=h[c+6],W8.y=h[c+7],Z5?H8.set(h[c+8],h[c+9],h[c+10],h[c+11]):H8.set(0,0,0,0),e6.transform(G8,W8,V8,H8),o[p]=G8.x,o[p+1]=G8.y,o[p+3]=W8.x,o[p+4]=W8.y,o.set(a6(V8),p+5),Z5&&o.set(a6(H8),p+9);else for(var f=0,_=h.length,g=J8;f<_;f+=o8,g+=n8)o[g]=h[f],o[g+1]=h[f+1],o[g+3]=h[f+6],o[g+4]=h[f+7],o[g+5]=h[f+2]/255,o[g+6]=h[f+3]/255,o[g+7]=h[f+4]/255,o[g+8]=h[f+5]/255,Z5&&(o[g+9]=h[f+8]/255,o[g+10]=h[f+9]/255,o[g+11]=h[f+10]/255,o[g+12]=h[f+11]/255)}else if(e6)for(var m=J8,y=J8+q8;m<y;m+=n8)G8.x=o[m],G8.y=o[m+1],W8.x=o[m+3],W8.y=o[m+4],e6.transform(G8,W8,V8,H8),o[m]=G8.x,o[m+1]=G8.y,o[m+3]=W8.x,o[m+4]=W8.y,o.set(a6(V8),m+5),Z5&&o.set(a6(H8),m+9);else{X8.set(a6(V8)),Y8.set(a6(H8));for(var v=J8,b=J8+q8;v<b;v+=n8)o.set(X8,v+5),Z5&&o.set(Y8,v+9)}}ei.internal.SpineAssembler=h6;var c6,d6,p6={getAssembler:function(){return h6}};X5.Assembler=p6,function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(c6||(c6={})),Hr(c6),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(d6||(d6={})),Hr(d6),t("sp",Object.freeze({__proto__:null,spine:Q2,get ATTACHMENT_TYPE(){return c6},get AnimationEventType(){return d6},timeScale:1,get DefaultSkinsEnum(){return N5},get DefaultAnimsEnum(){return z5},get AnimationCacheMode(){return U5},get SpineMaterialType(){return V5},SpineSocket:W5,Skeleton:X5,SkeletonData:N3,SkeletonTexture:L3,convertFilter:F3,convertWraps:k3,VertexEffectDelegate:B8,simpleSpineAssembler:p6}))}}}));
